(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{2245:function(module,exports,__webpack_require__){eval("var api = __webpack_require__(350);\n            var content = __webpack_require__(2246);\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.i, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjI0NS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8vVXNlcnMvZXJpa19yaXR0ZXIvcmVwb3MvZ2l0aHViLmNvbS9hcGFjaGUtc3VwZXJzZXQvc3VwZXJzZXQtdWkvcGx1Z2lucy9sZWdhY3ktcGx1Z2luLWNoYXJ0LWNhbGVuZGFyL3NyYy92ZW5kb3IvY2FsLWhlYXRtYXAuY3NzPzhmMjgiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwaSA9IHJlcXVpcmUoXCIhLi4vLi4vLi4vLi4vcGFja2FnZXMvc3VwZXJzZXQtdWktZGVtby9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9pbmplY3RTdHlsZXNJbnRvU3R5bGVUYWcuanNcIik7XG4gICAgICAgICAgICB2YXIgY29udGVudCA9IHJlcXVpcmUoXCIhIS4uLy4uLy4uLy4uL3BhY2thZ2VzL3N1cGVyc2V0LXVpLWRlbW8vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvZGlzdC9janMuanM/P3JlZi0tNi0xIS4uLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9wb3N0Y3NzLWxvYWRlci9zcmMvaW5kZXguanM/P3Bvc3Rjc3MhLi9jYWwtaGVhdG1hcC5jc3NcIik7XG5cbiAgICAgICAgICAgIGNvbnRlbnQgPSBjb250ZW50Ll9fZXNNb2R1bGUgPyBjb250ZW50LmRlZmF1bHQgOiBjb250ZW50O1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbnRlbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgIGNvbnRlbnQgPSBbW21vZHVsZS5pZCwgY29udGVudCwgJyddXTtcbiAgICAgICAgICAgIH1cblxudmFyIG9wdGlvbnMgPSB7fTtcblxub3B0aW9ucy5pbnNlcnQgPSBcImhlYWRcIjtcbm9wdGlvbnMuc2luZ2xldG9uID0gZmFsc2U7XG5cbnZhciB1cGRhdGUgPSBhcGkoY29udGVudCwgb3B0aW9ucyk7XG5cbnZhciBleHBvcnRlZCA9IGNvbnRlbnQubG9jYWxzID8gY29udGVudC5sb2NhbHMgOiB7fTtcblxuXG5cbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0ZWQ7Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///2245\n")},2246:function(module,exports,__webpack_require__){eval('// Imports\nvar ___CSS_LOADER_API_IMPORT___ = __webpack_require__(351);\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.i, "/* [LICENSE TBD] */\\n/* Cal-HeatMap CSS */\\n\\n.cal-heatmap-container {\\n  display: block;\\n}\\n\\n.cal-heatmap-container .graph-label {\\n  fill: #999;\\n  font-size: 10px;\\n}\\n\\n.cal-heatmap-container .graph,\\n.cal-heatmap-container .graph-legend rect {\\n  shape-rendering: crispedges;\\n}\\n\\n.cal-heatmap-container .graph-rect {\\n  fill: #ededed;\\n}\\n\\n.cal-heatmap-container .graph-subdomain-group rect:hover {\\n  stroke: #000;\\n  stroke-width: 1px;\\n}\\n\\n.cal-heatmap-container .subdomain-text {\\n  font-size: 8px;\\n  fill: #999;\\n  pointer-events: none;\\n}\\n\\n.cal-heatmap-container .hover_cursor:hover {\\n  cursor: pointer;\\n}\\n\\n.cal-heatmap-container .qi {\\n  background-color: #999;\\n  fill: #999;\\n}\\n\\n/*\\nRemove comment to apply this style to date with value equal to 0\\n.q0\\n{\\n  background-color: #fff;\\n  fill: #fff;\\n  stroke: #ededed\\n}\\n*/\\n\\n.cal-heatmap-container .q1 {\\n  background-color: #dae289;\\n  fill: #dae289;\\n}\\n\\n.cal-heatmap-container .q2 {\\n  background-color: #cedb9c;\\n  fill: #9cc069;\\n}\\n\\n.cal-heatmap-container .q3 {\\n  background-color: #b5cf6b;\\n  fill: #669d45;\\n}\\n\\n.cal-heatmap-container .q4 {\\n  background-color: #637939;\\n  fill: #637939;\\n}\\n\\n.cal-heatmap-container .q5 {\\n  background-color: #3b6427;\\n  fill: #3b6427;\\n}\\n\\n.cal-heatmap-container rect.highlight {\\n  stroke: #444;\\n  stroke-width: 1;\\n}\\n\\n.cal-heatmap-container text.highlight {\\n  fill: #444;\\n}\\n\\n.cal-heatmap-container rect.highlight-now {\\n  stroke: red;\\n}\\n\\n.cal-heatmap-container text.highlight-now {\\n  fill: red;\\n  font-weight: 800;\\n}\\n\\n.cal-heatmap-container .domain-background {\\n  fill: none;\\n  shape-rendering: crispedges;\\n}\\n\\n.ch-tooltip {\\n  padding: 10px;\\n  background: #222;\\n  color: #bbb;\\n  font-size: 12px;\\n  line-height: 1.4;\\n  width: 140px;\\n  position: absolute;\\n  z-index: 99999;\\n  text-align: center;\\n  border-radius: 2px;\\n  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);\\n  display: none;\\n  box-sizing: border-box;\\n}\\n\\n.ch-tooltip::after {\\n  position: absolute;\\n  width: 0;\\n  height: 0;\\n  border-color: transparent;\\n  border-style: solid;\\n  content: \'\';\\n  padding: 0;\\n  display: block;\\n  bottom: -6px;\\n  left: 50%;\\n  margin-left: -6px;\\n  border-width: 6px 6px 0;\\n  border-top-color: #222;\\n}\\n", ""]);\n// Exports\nmodule.exports = exports;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjI0Ni5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8vVXNlcnMvZXJpa19yaXR0ZXIvcmVwb3MvZ2l0aHViLmNvbS9hcGFjaGUtc3VwZXJzZXQvc3VwZXJzZXQtdWkvcGx1Z2lucy9sZWdhY3ktcGx1Z2luLWNoYXJ0LWNhbGVuZGFyL3NyYy92ZW5kb3IvY2FsLWhlYXRtYXAuY3NzP2UxMjEiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gSW1wb3J0c1xudmFyIF9fX0NTU19MT0FERVJfQVBJX0lNUE9SVF9fXyA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi9wYWNrYWdlcy9zdXBlcnNldC11aS1kZW1vL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2Rpc3QvcnVudGltZS9hcGkuanNcIik7XG5leHBvcnRzID0gX19fQ1NTX0xPQURFUl9BUElfSU1QT1JUX19fKGZhbHNlKTtcbi8vIE1vZHVsZVxuZXhwb3J0cy5wdXNoKFttb2R1bGUuaWQsIFwiLyogW0xJQ0VOU0UgVEJEXSAqL1xcbi8qIENhbC1IZWF0TWFwIENTUyAqL1xcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIge1xcbiAgZGlzcGxheTogYmxvY2s7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgLmdyYXBoLWxhYmVsIHtcXG4gIGZpbGw6ICM5OTk7XFxuICBmb250LXNpemU6IDEwcHg7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgLmdyYXBoLFxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgLmdyYXBoLWxlZ2VuZCByZWN0IHtcXG4gIHNoYXBlLXJlbmRlcmluZzogY3Jpc3BlZGdlcztcXG59XFxuXFxuLmNhbC1oZWF0bWFwLWNvbnRhaW5lciAuZ3JhcGgtcmVjdCB7XFxuICBmaWxsOiAjZWRlZGVkO1xcbn1cXG5cXG4uY2FsLWhlYXRtYXAtY29udGFpbmVyIC5ncmFwaC1zdWJkb21haW4tZ3JvdXAgcmVjdDpob3ZlciB7XFxuICBzdHJva2U6ICMwMDA7XFxuICBzdHJva2Utd2lkdGg6IDFweDtcXG59XFxuXFxuLmNhbC1oZWF0bWFwLWNvbnRhaW5lciAuc3ViZG9tYWluLXRleHQge1xcbiAgZm9udC1zaXplOiA4cHg7XFxuICBmaWxsOiAjOTk5O1xcbiAgcG9pbnRlci1ldmVudHM6IG5vbmU7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgLmhvdmVyX2N1cnNvcjpob3ZlciB7XFxuICBjdXJzb3I6IHBvaW50ZXI7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgLnFpIHtcXG4gIGJhY2tncm91bmQtY29sb3I6ICM5OTk7XFxuICBmaWxsOiAjOTk5O1xcbn1cXG5cXG4vKlxcblJlbW92ZSBjb21tZW50IHRvIGFwcGx5IHRoaXMgc3R5bGUgdG8gZGF0ZSB3aXRoIHZhbHVlIGVxdWFsIHRvIDBcXG4ucTBcXG57XFxuICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmO1xcbiAgZmlsbDogI2ZmZjtcXG4gIHN0cm9rZTogI2VkZWRlZFxcbn1cXG4qL1xcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgLnExIHtcXG4gIGJhY2tncm91bmQtY29sb3I6ICNkYWUyODk7XFxuICBmaWxsOiAjZGFlMjg5O1xcbn1cXG5cXG4uY2FsLWhlYXRtYXAtY29udGFpbmVyIC5xMiB7XFxuICBiYWNrZ3JvdW5kLWNvbG9yOiAjY2VkYjljO1xcbiAgZmlsbDogIzljYzA2OTtcXG59XFxuXFxuLmNhbC1oZWF0bWFwLWNvbnRhaW5lciAucTMge1xcbiAgYmFja2dyb3VuZC1jb2xvcjogI2I1Y2Y2YjtcXG4gIGZpbGw6ICM2NjlkNDU7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgLnE0IHtcXG4gIGJhY2tncm91bmQtY29sb3I6ICM2Mzc5Mzk7XFxuICBmaWxsOiAjNjM3OTM5O1xcbn1cXG5cXG4uY2FsLWhlYXRtYXAtY29udGFpbmVyIC5xNSB7XFxuICBiYWNrZ3JvdW5kLWNvbG9yOiAjM2I2NDI3O1xcbiAgZmlsbDogIzNiNjQyNztcXG59XFxuXFxuLmNhbC1oZWF0bWFwLWNvbnRhaW5lciByZWN0LmhpZ2hsaWdodCB7XFxuICBzdHJva2U6ICM0NDQ7XFxuICBzdHJva2Utd2lkdGg6IDE7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgdGV4dC5oaWdobGlnaHQge1xcbiAgZmlsbDogIzQ0NDtcXG59XFxuXFxuLmNhbC1oZWF0bWFwLWNvbnRhaW5lciByZWN0LmhpZ2hsaWdodC1ub3cge1xcbiAgc3Ryb2tlOiByZWQ7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgdGV4dC5oaWdobGlnaHQtbm93IHtcXG4gIGZpbGw6IHJlZDtcXG4gIGZvbnQtd2VpZ2h0OiA4MDA7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgLmRvbWFpbi1iYWNrZ3JvdW5kIHtcXG4gIGZpbGw6IG5vbmU7XFxuICBzaGFwZS1yZW5kZXJpbmc6IGNyaXNwZWRnZXM7XFxufVxcblxcbi5jaC10b29sdGlwIHtcXG4gIHBhZGRpbmc6IDEwcHg7XFxuICBiYWNrZ3JvdW5kOiAjMjIyO1xcbiAgY29sb3I6ICNiYmI7XFxuICBmb250LXNpemU6IDEycHg7XFxuICBsaW5lLWhlaWdodDogMS40O1xcbiAgd2lkdGg6IDE0MHB4O1xcbiAgcG9zaXRpb246IGFic29sdXRlO1xcbiAgei1pbmRleDogOTk5OTk7XFxuICB0ZXh0LWFsaWduOiBjZW50ZXI7XFxuICBib3JkZXItcmFkaXVzOiAycHg7XFxuICBib3gtc2hhZG93OiAycHggMnB4IDJweCByZ2JhKDAsIDAsIDAsIDAuMik7XFxuICBkaXNwbGF5OiBub25lO1xcbiAgYm94LXNpemluZzogYm9yZGVyLWJveDtcXG59XFxuXFxuLmNoLXRvb2x0aXA6OmFmdGVyIHtcXG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcXG4gIHdpZHRoOiAwO1xcbiAgaGVpZ2h0OiAwO1xcbiAgYm9yZGVyLWNvbG9yOiB0cmFuc3BhcmVudDtcXG4gIGJvcmRlci1zdHlsZTogc29saWQ7XFxuICBjb250ZW50OiAnJztcXG4gIHBhZGRpbmc6IDA7XFxuICBkaXNwbGF5OiBibG9jaztcXG4gIGJvdHRvbTogLTZweDtcXG4gIGxlZnQ6IDUwJTtcXG4gIG1hcmdpbi1sZWZ0OiAtNnB4O1xcbiAgYm9yZGVyLXdpZHRoOiA2cHggNnB4IDA7XFxuICBib3JkZXItdG9wLWNvbG9yOiAjMjIyO1xcbn1cXG5cIiwgXCJcIl0pO1xuLy8gRXhwb3J0c1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///2246\n')},2247:function(module,exports,__webpack_require__){eval("var api = __webpack_require__(350);\n            var content = __webpack_require__(2248);\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.i, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjI0Ny5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8vVXNlcnMvZXJpa19yaXR0ZXIvcmVwb3MvZ2l0aHViLmNvbS9hcGFjaGUtc3VwZXJzZXQvc3VwZXJzZXQtdWkvcGx1Z2lucy9sZWdhY3ktcGx1Z2luLWNoYXJ0LWNhbGVuZGFyL3NyYy92ZW5kb3IvZDN0aXAuY3NzPzY0Y2MiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwaSA9IHJlcXVpcmUoXCIhLi4vLi4vLi4vLi4vcGFja2FnZXMvc3VwZXJzZXQtdWktZGVtby9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9pbmplY3RTdHlsZXNJbnRvU3R5bGVUYWcuanNcIik7XG4gICAgICAgICAgICB2YXIgY29udGVudCA9IHJlcXVpcmUoXCIhIS4uLy4uLy4uLy4uL3BhY2thZ2VzL3N1cGVyc2V0LXVpLWRlbW8vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvZGlzdC9janMuanM/P3JlZi0tNi0xIS4uLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9wb3N0Y3NzLWxvYWRlci9zcmMvaW5kZXguanM/P3Bvc3Rjc3MhLi9kM3RpcC5jc3NcIik7XG5cbiAgICAgICAgICAgIGNvbnRlbnQgPSBjb250ZW50Ll9fZXNNb2R1bGUgPyBjb250ZW50LmRlZmF1bHQgOiBjb250ZW50O1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbnRlbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgIGNvbnRlbnQgPSBbW21vZHVsZS5pZCwgY29udGVudCwgJyddXTtcbiAgICAgICAgICAgIH1cblxudmFyIG9wdGlvbnMgPSB7fTtcblxub3B0aW9ucy5pbnNlcnQgPSBcImhlYWRcIjtcbm9wdGlvbnMuc2luZ2xldG9uID0gZmFsc2U7XG5cbnZhciB1cGRhdGUgPSBhcGkoY29udGVudCwgb3B0aW9ucyk7XG5cbnZhciBleHBvcnRlZCA9IGNvbnRlbnQubG9jYWxzID8gY29udGVudC5sb2NhbHMgOiB7fTtcblxuXG5cbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0ZWQ7Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///2247\n")},2248:function(module,exports,__webpack_require__){eval("// Imports\nvar ___CSS_LOADER_API_IMPORT___ = __webpack_require__(351);\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.i, \"/**\\n * Licensed to the Apache Software Foundation (ASF) under one\\n * or more contributor license agreements.  See the NOTICE file\\n * distributed with this work for additional information\\n * regarding copyright ownership.  The ASF licenses this file\\n * to you under the Apache License, Version 2.0 (the\\n * \\\"License\\\"); you may not use this file except in compliance\\n * with the License.  You may obtain a copy of the License at\\n *\\n *   http://www.apache.org/licenses/LICENSE-2.0\\n *\\n * Unless required by applicable law or agreed to in writing,\\n * software distributed under the License is distributed on an\\n * \\\"AS IS\\\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\\n * KIND, either express or implied.  See the License for the\\n * specific language governing permissions and limitations\\n * under the License.\\n */\\n/* from d3-tip */\\n.d3-tip {\\n  line-height: 1;\\n  padding: 12px;\\n  background: rgba(0, 0, 0, 0.8);\\n  color: #fff;\\n  border-radius: 2px;\\n  pointer-events: none;\\n  z-index: 1000;\\n}\\n\\n/* Creates a small triangle extender for the tooltip */\\n.d3-tip:after {\\n  box-sizing: border-box;\\n  display: inline;\\n  font-size: 10px;\\n  width: 100%;\\n  line-height: 1;\\n  color: rgba(0, 0, 0, 0.8);\\n  position: absolute;\\n  pointer-events: none;\\n}\\n\\n/* Northward tooltips */\\n.d3-tip.n:after {\\n  content: '\\\\25BC';\\n  margin: -1px 0 0 0;\\n  top: 100%;\\n  left: 0;\\n  text-align: center;\\n}\\n\\n/* Eastward tooltips */\\n.d3-tip.e:after {\\n  content: '\\\\25C0';\\n  margin: -4px 0 0 0;\\n  top: 50%;\\n  left: -8px;\\n}\\n\\n/* Southward tooltips */\\n.d3-tip.s:after {\\n  content: '\\\\25B2';\\n  margin: 0 0 1px 0;\\n  top: -8px;\\n  left: 0;\\n  text-align: center;\\n}\\n\\n/* Westward tooltips */\\n.d3-tip.w:after {\\n  content: '\\\\25B6';\\n  margin: -4px 0 0 -1px;\\n  top: 50%;\\n  left: 100%;\\n}\\n\", \"\"]);\n// Exports\nmodule.exports = exports;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjI0OC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8vVXNlcnMvZXJpa19yaXR0ZXIvcmVwb3MvZ2l0aHViLmNvbS9hcGFjaGUtc3VwZXJzZXQvc3VwZXJzZXQtdWkvcGx1Z2lucy9sZWdhY3ktcGx1Z2luLWNoYXJ0LWNhbGVuZGFyL3NyYy92ZW5kb3IvZDN0aXAuY3NzPzU3ZDEiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gSW1wb3J0c1xudmFyIF9fX0NTU19MT0FERVJfQVBJX0lNUE9SVF9fXyA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi9wYWNrYWdlcy9zdXBlcnNldC11aS1kZW1vL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2Rpc3QvcnVudGltZS9hcGkuanNcIik7XG5leHBvcnRzID0gX19fQ1NTX0xPQURFUl9BUElfSU1QT1JUX19fKGZhbHNlKTtcbi8vIE1vZHVsZVxuZXhwb3J0cy5wdXNoKFttb2R1bGUuaWQsIFwiLyoqXFxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxcbiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXFxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxcbiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcXG4gKiBcXFwiTGljZW5zZVxcXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXFxuICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxcbiAqXFxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcXG4gKlxcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxcbiAqIFxcXCJBUyBJU1xcXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxcbiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cXG4gKi9cXG4vKiBmcm9tIGQzLXRpcCAqL1xcbi5kMy10aXAge1xcbiAgbGluZS1oZWlnaHQ6IDE7XFxuICBwYWRkaW5nOiAxMnB4O1xcbiAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjgpO1xcbiAgY29sb3I6ICNmZmY7XFxuICBib3JkZXItcmFkaXVzOiAycHg7XFxuICBwb2ludGVyLWV2ZW50czogbm9uZTtcXG4gIHotaW5kZXg6IDEwMDA7XFxufVxcblxcbi8qIENyZWF0ZXMgYSBzbWFsbCB0cmlhbmdsZSBleHRlbmRlciBmb3IgdGhlIHRvb2x0aXAgKi9cXG4uZDMtdGlwOmFmdGVyIHtcXG4gIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XFxuICBkaXNwbGF5OiBpbmxpbmU7XFxuICBmb250LXNpemU6IDEwcHg7XFxuICB3aWR0aDogMTAwJTtcXG4gIGxpbmUtaGVpZ2h0OiAxO1xcbiAgY29sb3I6IHJnYmEoMCwgMCwgMCwgMC44KTtcXG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcXG4gIHBvaW50ZXItZXZlbnRzOiBub25lO1xcbn1cXG5cXG4vKiBOb3J0aHdhcmQgdG9vbHRpcHMgKi9cXG4uZDMtdGlwLm46YWZ0ZXIge1xcbiAgY29udGVudDogJ1xcXFwyNUJDJztcXG4gIG1hcmdpbjogLTFweCAwIDAgMDtcXG4gIHRvcDogMTAwJTtcXG4gIGxlZnQ6IDA7XFxuICB0ZXh0LWFsaWduOiBjZW50ZXI7XFxufVxcblxcbi8qIEVhc3R3YXJkIHRvb2x0aXBzICovXFxuLmQzLXRpcC5lOmFmdGVyIHtcXG4gIGNvbnRlbnQ6ICdcXFxcMjVDMCc7XFxuICBtYXJnaW46IC00cHggMCAwIDA7XFxuICB0b3A6IDUwJTtcXG4gIGxlZnQ6IC04cHg7XFxufVxcblxcbi8qIFNvdXRod2FyZCB0b29sdGlwcyAqL1xcbi5kMy10aXAuczphZnRlciB7XFxuICBjb250ZW50OiAnXFxcXDI1QjInO1xcbiAgbWFyZ2luOiAwIDAgMXB4IDA7XFxuICB0b3A6IC04cHg7XFxuICBsZWZ0OiAwO1xcbiAgdGV4dC1hbGlnbjogY2VudGVyO1xcbn1cXG5cXG4vKiBXZXN0d2FyZCB0b29sdGlwcyAqL1xcbi5kMy10aXAudzphZnRlciB7XFxuICBjb250ZW50OiAnXFxcXDI1QjYnO1xcbiAgbWFyZ2luOiAtNHB4IDAgMCAtMXB4O1xcbiAgdG9wOiA1MCU7XFxuICBsZWZ0OiAxMDAlO1xcbn1cXG5cIiwgXCJcIl0pO1xuLy8gRXhwb3J0c1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///2248\n")},2516:function(module,__webpack_exports__,__webpack_require__){"use strict";eval('// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/node_modules/react/index.js\nvar react = __webpack_require__(0);\nvar react_default = /*#__PURE__*/__webpack_require__.n(react);\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/node_modules/prop-types/index.js\nvar prop_types = __webpack_require__(56);\nvar prop_types_default = /*#__PURE__*/__webpack_require__.n(prop_types);\n\n// EXTERNAL MODULE: ../superset-ui-core/src/chart/components/reactify.tsx\nvar reactify = __webpack_require__(1014);\n\n// EXTERNAL MODULE: ../superset-ui-core/src/style/index.ts\nvar style = __webpack_require__(434);\n\n// CONCATENATED MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/plugins/legacy-plugin-chart-calendar/node_modules/d3-array/src/extent.js\n/* harmony default export */ var extent = (function(values, valueof) {\n  let min;\n  let max;\n  if (valueof === undefined) {\n    for (const value of values) {\n      if (value != null) {\n        if (min === undefined) {\n          if (value >= value) min = max = value;\n        } else {\n          if (min > value) min = value;\n          if (max < value) max = value;\n        }\n      }\n    }\n  } else {\n    let index = -1;\n    for (let value of values) {\n      if ((value = valueof(value, ++index, values)) != null) {\n        if (min === undefined) {\n          if (value >= value) min = max = value;\n        } else {\n          if (min > value) min = value;\n          if (max < value) max = value;\n        }\n      }\n    }\n  }\n  return [min, max];\n});\n\n// CONCATENATED MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/plugins/legacy-plugin-chart-calendar/node_modules/d3-array/src/range.js\n/* harmony default export */ var range = (function(start, stop, step) {\n  start = +start, stop = +stop, step = (n = arguments.length) < 2 ? (stop = start, start = 0, 1) : n < 3 ? 1 : +step;\n\n  var i = -1,\n      n = Math.max(0, Math.ceil((stop - start) / step)) | 0,\n      range = new Array(n);\n\n  while (++i < n) {\n    range[i] = start + i * step;\n  }\n\n  return range;\n});\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/node_modules/d3-selection/src/select.js\nvar src_select = __webpack_require__(854);\n\n// EXTERNAL MODULE: ../superset-ui-core/src/number-format/NumberFormatterRegistrySingleton.ts\nvar NumberFormatterRegistrySingleton = __webpack_require__(148);\n\n// EXTERNAL MODULE: ../superset-ui-core/src/time-format/TimeFormatterRegistrySingleton.ts + 5 modules\nvar TimeFormatterRegistrySingleton = __webpack_require__(132);\n\n// EXTERNAL MODULE: ../superset-ui-core/src/color/SequentialSchemeRegistrySingleton.ts\nvar SequentialSchemeRegistrySingleton = __webpack_require__(574);\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/node_modules/core-js/modules/es.string.replace.js\nvar es_string_replace = __webpack_require__(291);\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/node_modules/core-js/modules/web.dom-collections.iterator.js\nvar web_dom_collections_iterator = __webpack_require__(52);\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/node_modules/d3-tip/index.js\nvar d3_tip = __webpack_require__(850);\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/plugins/legacy-plugin-chart-calendar/src/vendor/d3tip.css\nvar d3tip = __webpack_require__(2247);\n\n// CONCATENATED MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.js\n// [LICENSE TBD]\n/* Copied and altered from http://cal-heatmap.com/ , alterations around:\n * - tuning tooltips\n * - supporting multi-colors scales\n * - legend format\n * - UTC handling\n */ /* eslint-disable */var d3= true?__webpack_require__(153):undefined,d3= true?__webpack_require__(153):undefined,CalHeatMap=function(){\'use strict\';var self=this;self.tip=Object(d3_tip["a" /* default */])().attr("class","d3-tip").direction("n").offset([-5,0]).html(d=>`\n      ${self.options.timeFormatter(d.t)}: <strong>${self.options.valueFormatter(d.v)}</strong>\n    `);self.legendTip=Object(d3_tip["a" /* default */])().attr("class","d3-tip").direction("n").offset([-5,0]).html(d=>self.options.valueFormatter(d));this.allowedDataType=["json","csv","tsv","txt"];// Default settings\nthis.options={// selector string of the container to append the graph to\n// Accept any string value accepted by document.querySelector or CSS3\n// or an Element object\nitemSelector:"#cal-heatmap",// Whether to paint the calendar on init()\n// Used by testsuite to reduce testing time\npaintOnLoad:!0,// ================================================\n// DOMAIN\n// ================================================\n// Number of domain to display on the graph\nrange:12,// Size of each cell, in pixel\ncellSize:10,// Padding between each cell, in pixel\ncellPadding:2,// For rounded subdomain rectangles, in pixels\ncellRadius:0,domainGutter:2,domainMargin:[0,0,0,0],valueFormatter:d=>d,timeFormatter:d=>d,domain:"hour",subDomain:"min",// Number of columns to split the subDomains to\n// If not null, will takes precedence over rowLimit\ncolLimit:null,// Number of rows to split the subDomains to\n// Will be ignored if colLimit is not null\nrowLimit:null,// First day of the week is Monday\n// 0 to start the week on Sunday\nweekStartOnMonday:!0,// Start date of the graph\n// @default now\nstart:new Date,minDate:null,maxDate:null,// ================================================\n// DATA\n// ================================================\n// Data source\n// URL, where to fetch the original datas\ndata:"",// Data type\n// Default: json\ndataType:this.allowedDataType[0],// Payload sent when using POST http method\n// Leave to null (default) for GET request\n// Expect a string, formatted like "a=b;c=d"\ndataPostPayload:null,// Additional headers sent when requesting data\n// Expect an object formatted like:\n// { \'X-CSRF-TOKEN\': \'token\' }\ndataRequestHeaders:null,// Whether to consider missing date:value from the datasource\n// as equal to 0, or just leave them as missing\nconsiderMissingDataAsZero:!1,// Load remote data on calendar creation\n// When false, the calendar will be left empty\nloadOnInit:!0,// Calendar orientation\n// false: display domains side by side\n// true : display domains one under the other\nverticalOrientation:!1,// Domain dynamic width/height\n// The width on a domain depends on the number of\ndomainDynamicDimension:!0,// Domain Label properties\nlabel:{// valid: top, right, bottom, left\nposition:"bottom",// Valid: left, center, right\n// Also valid are the direct svg values: start, middle, end\nalign:"center",// By default, there is no margin/padding around the label\noffset:{x:0,y:0},rotate:null,// Used only on vertical orientation\nwidth:100,// Used only on horizontal orientation\nheight:null},// ================================================\n// LEGEND\n// ================================================\n// Threshold for the legend\nlegend:[10,20,30,40],// Whether to display the legend\ndisplayLegend:!0,legendCellSize:10,legendCellPadding:2,legendMargin:[0,0,0,0],// Legend vertical position\n// top: place legend above calendar\n// bottom: place legend below the calendar\nlegendVerticalPosition:"bottom",// Legend horizontal position\n// accepted values: left, center, right\nlegendHorizontalPosition:"left",// Legend rotation\n// accepted values: horizontal, vertical\nlegendOrientation:"horizontal",// Objects holding all the heatmap different colors\n// null to disable, and use the default css styles\n//\n// Examples:\n// legendColors: {\n//    min: "green",\n//    max: "red",\n//    empty: "#ffffff",\n//    base: "grey",\n//    overflow: "red",\n//    colorScaler: null,\n// }\nlegendColors:null,// ================================================\n// HIGHLIGHT\n// ================================================\n// List of dates to highlight\n// Valid values:\n// - []: don\'t highlight anything\n// - "now": highlight the current date\n// - an array of Date objects: highlight the specified dates\nhighlight:[],// ================================================\n// TEXT FORMATTING / i18n\n// ================================================\n// Name of the items to represent in the calendar\nitemName:["item","items"],// Formatting of the domain label\n// @default: null, will use the formatting according to domain type\n// Accept a string used as specifier by d3.time.format()\n// or a function\n//\n// Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n// for accepted date formatting used by d3.time.format()\ndomainLabelFormat:null,// Formatting of the title displayed when hovering a subDomain cell\nsubDomainTitleFormat:{empty:"{date}",filled:"{count} {name} {connector} {date}"},// Formatting of the {date} used in subDomainTitleFormat\n// @default: null, will use the formatting according to subDomain type\n// Accept a string used as specifier by d3.time.format()\n// or a function\n//\n// Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n// for accepted date formatting used by d3.time.format()\nsubDomainDateFormat:null,// Formatting of the text inside each subDomain cell\n// @default: null, no text\n// Accept a string used as specifier by d3.time.format()\n// or a function\n//\n// Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n// for accepted date formatting used by d3.time.format()\nsubDomainTextFormat:null,// Formatting of the title displayed when hovering a legend cell\nlegendTitleFormat:{lower:"less than {min} {name}",inner:"between {down} and {up} {name}",upper:"more than {max} {name}"},// Animation duration, in ms\nanimationDuration:500,nextSelector:!1,previousSelector:!1,itemNamespace:"cal-heatmap",tooltip:!1,// ================================================\n// EVENTS CALLBACK\n// ================================================\n// Callback when clicking on a time block\nonClick:null,// Callback after painting the empty calendar\n// Can be used to trigger an API call, once the calendar is ready to be filled\nafterLoad:null,// Callback after loading the next domain in the calendar\nafterLoadNextDomain:null,// Callback after loading the previous domain in the calendar\nafterLoadPreviousDomain:null,// Callback after finishing all actions on the calendar\nonComplete:null,// Callback after fetching the datas, but before applying them to the calendar\n// Used mainly to convert the datas if they\'re not formatted like expected\n// Takes the fetched "data" object as argument, must return a json object\n// formatted like {timestamp:count, timestamp2:count2},\nafterLoadData:function(data){return data},// Callback triggered after calling and completing update().\nafterUpdate:null,// Callback triggered after calling next().\n// The `status` argument is equal to true if there is no\n// more next domain to load\n//\n// This callback is also executed once, after calling previous(),\n// only when the max domain is reached\nonMaxDomainReached:null,// Callback triggered after calling previous().\n// The `status` argument is equal to true if there is no\n// more previous domain to load\n//\n// This callback is also executed once, after calling next(),\n// only when the min domain is reached\nonMinDomainReached:null};this._domainType={min:{name:"minute",level:10,maxItemNumber:60,defaultRowNumber:10,defaultColumnNumber:6,row:function(d){return self.getSubDomainRowNumber(d)},column:function(d){return self.getSubDomainColumnNumber(d)},position:{x:function(d){return Math.floor(d.getMinutes()/self._domainType.min.row(d))},y:function(d){return d.getMinutes()%self._domainType.min.row(d)}},format:{date:"%H:%M, %A %B %-e, %Y",legend:"",connector:"at"},extractUnit:function(d){return new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours(),d.getMinutes()).getTime()}},hour:{name:"hour",level:20,maxItemNumber:function(d){switch(self.options.domain){case"day":return 24;case"week":return 168;case"month":return 24*(self.options.domainDynamicDimension?self.getDayCountInMonth(d):31);}},defaultRowNumber:6,defaultColumnNumber:function(d){switch(self.options.domain){case"day":return 4;case"week":return 28;case"month":return self.options.domainDynamicDimension?self.getDayCountInMonth(d):31;}},row:function(d){return self.getSubDomainRowNumber(d)},column:function(d){return self.getSubDomainColumnNumber(d)},position:{x:function(d){if("month"===self.options.domain){if(0<self.options.colLimit||0<self.options.rowLimit){return Math.floor((d.getHours()+24*(d.getDate()-1))/self._domainType.hour.row(d))}return Math.floor(d.getHours()/self._domainType.hour.row(d))+4*(d.getDate()-1)}else if("week"===self.options.domain){if(0<self.options.colLimit||0<self.options.rowLimit){return Math.floor((d.getHours()+24*self.getWeekDay(d))/self._domainType.hour.row(d))}return Math.floor(d.getHours()/self._domainType.hour.row(d))+4*self.getWeekDay(d)}return Math.floor(d.getHours()/self._domainType.hour.row(d))},y:function(d){var p=d.getHours();if(0<self.options.colLimit||0<self.options.rowLimit){switch(self.options.domain){case"month":p+=24*(d.getDate()-1);break;case"week":p+=24*self.getWeekDay(d);break;}}return Math.floor(p%self._domainType.hour.row(d))}},format:{date:"%Hh, %A %B %-e, %Y",legend:"%H:00",connector:"at"},extractUnit:function(d){return new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours()).getTime()}},day:{name:"day",level:30,maxItemNumber:function(d){switch(self.options.domain){case"week":return 7;case"month":return self.options.domainDynamicDimension?self.getDayCountInMonth(d):31;case"year":return self.options.domainDynamicDimension?self.getDayCountInYear(d):366;}},defaultColumnNumber:function(d){d=new Date(d);switch(self.options.domain){case"week":return 1;case"month":return self.options.domainDynamicDimension&&!self.options.verticalOrientation?self.getWeekNumber(new Date(d.getFullYear(),d.getMonth()+1,0))-self.getWeekNumber(d)+1:6;case"year":return self.options.domainDynamicDimension?self.getWeekNumber(new Date(d.getFullYear(),11,31))-self.getWeekNumber(new Date(d.getFullYear(),0))+1:54;}},defaultRowNumber:7,row:function(d){return self.getSubDomainRowNumber(d)},column:function(d){return self.getSubDomainColumnNumber(d)},position:{x:function(d){switch(self.options.domain){case"week":return Math.floor(self.getWeekDay(d)/self._domainType.day.row(d));case"month":if(0<self.options.colLimit||0<self.options.rowLimit){return Math.floor((d.getDate()-1)/self._domainType.day.row(d))}return self.getWeekNumber(d)-self.getWeekNumber(new Date(d.getFullYear(),d.getMonth()));case"year":if(0<self.options.colLimit||0<self.options.rowLimit){return Math.floor((self.getDayOfYear(d)-1)/self._domainType.day.row(d))}return self.getWeekNumber(d);}},y:function(d){var p=self.getWeekDay(d);if(0<self.options.colLimit||0<self.options.rowLimit){switch(self.options.domain){case"year":p=self.getDayOfYear(d)-1;break;case"week":p=self.getWeekDay(d);break;case"month":p=d.getDate()-1;break;}}return Math.floor(p%self._domainType.day.row(d))}},format:{date:"%A %B %-e, %Y",legend:"%e %b",connector:"on"},extractUnit:function(d){return new Date(d.getFullYear(),d.getMonth(),d.getDate()).getTime()}},week:{name:"week",level:40,maxItemNumber:54,defaultColumnNumber:function(d){d=new Date(d);switch(self.options.domain){case"year":return self._domainType.week.maxItemNumber;case"month":return self.options.domainDynamicDimension?self.getWeekNumber(new Date(d.getFullYear(),d.getMonth()+1,0))-self.getWeekNumber(d):5;}},defaultRowNumber:1,row:function(d){return self.getSubDomainRowNumber(d)},column:function(d){return self.getSubDomainColumnNumber(d)},position:{x:function(d){switch(self.options.domain){case"year":return Math.floor(self.getWeekNumber(d)/self._domainType.week.row(d));case"month":return Math.floor(self.getMonthWeekNumber(d)/self._domainType.week.row(d));}},y:function(d){return self.getWeekNumber(d)%self._domainType.week.row(d)}},format:{date:"%B Week #%W",legend:"%B Week #%W",connector:"in"},extractUnit:function(d){var dt=new Date(d.getFullYear(),d.getMonth(),d.getDate()),weekDay=dt.getDay()-(self.options.weekStartOnMonday?1:0);// According to ISO-8601, week number computation are based on week starting on Monday\nif(0>weekDay){weekDay=6}dt.setDate(dt.getDate()-weekDay);return dt.getTime()}},month:{name:"month",level:50,maxItemNumber:12,defaultColumnNumber:12,defaultRowNumber:1,row:function(){return self.getSubDomainRowNumber()},column:function(){return self.getSubDomainColumnNumber()},position:{x:function(d){return Math.floor(d.getMonth()/self._domainType.month.row(d))},y:function(d){return d.getMonth()%self._domainType.month.row(d)}},format:{date:"%B %Y",legend:"%B",connector:"in"},extractUnit:function(d){return new Date(d.getFullYear(),d.getMonth()).getTime()}},year:{name:"year",level:60,row:function(){return self.options.rowLimit||1},column:function(){return self.options.colLimit||1},position:{x:function(){return 1},y:function(){return 1}},format:{date:"%Y",legend:"%Y",connector:"in"},extractUnit:function(d){return new Date(d.getFullYear()).getTime()}}};for(var type in this._domainType){if(this._domainType.hasOwnProperty(type)){var d=this._domainType[type];this._domainType["x_"+type]={name:"x_"+type,level:d.type,maxItemNumber:d.maxItemNumber,defaultRowNumber:d.defaultRowNumber,defaultColumnNumber:d.defaultColumnNumber,row:d.column,column:d.row,position:{x:d.position.y,y:d.position.x},format:d.format,extractUnit:d.extractUnit}}}// Record the address of the last inserted domain when browsing\nthis.lastInsertedSvg=null;this._completed=!1;// Record all the valid domains\n// Each domain value is a timestamp in milliseconds\nthis._domains=d3.map();this.graphDim={width:0,height:0};this.legendDim={width:0,height:0};this.NAVIGATE_LEFT=1;this.NAVIGATE_RIGHT=2;// Various update mode when using the update() API\nthis.RESET_ALL_ON_UPDATE=0;this.RESET_SINGLE_ON_UPDATE=1;this.APPEND_ON_UPDATE=2;this.DEFAULT_LEGEND_MARGIN=10;this.root=null;this.tooltip=null;this._maxDomainReached=!1;this._minDomainReached=!1;this.domainPosition=new DomainPosition;this.Legend=null;this.legendScale=null;// List of domains that are skipped because of DST\n// All times belonging to these domains should be re-assigned to the previous domain\nthis.DSTDomain=[];/**\n   * Display the graph for the first time\n   * @return bool True if the calendar is created\n   */this._init=function(){self.getDomain(self.options.start).map(function(d){return d.getTime()}).map(function(d){self._domains.set(d,self.getSubDomain(d).map(function(d){return{t:self._domainType[self.options.subDomain].extractUnit(d),v:null}}))});self.root=d3.select(self.options.itemSelector).append("svg").attr("class","cal-heatmap-container");self.root.attr("x",0).attr("y",0).append("svg").attr("class","graph");self.Legend=new Legend(self);if(self.options.paintOnLoad){_initCalendar()}self.root.call(self.tip);self.root.call(self.legendTip);return!0};function _initCalendar(){self.verticalDomainLabel="top"===self.options.label.position||"bottom"===self.options.label.position;self.domainVerticalLabelHeight=null===self.options.label.height?Math.max(25,2*self.options.cellSize):self.options.label.height;self.domainHorizontalLabelWidth=0;if(""===self.options.domainLabelFormat&&null===self.options.label.height){self.domainVerticalLabelHeight=0}if(!self.verticalDomainLabel){self.domainVerticalLabelHeight=0;self.domainHorizontalLabelWidth=self.options.label.width}self.paint();// =========================================================================//\n// ATTACHING DOMAIN NAVIGATION EVENT                    //\n// =========================================================================//\nif(!1!==self.options.nextSelector){d3.select(self.options.nextSelector).on("click."+self.options.itemNamespace,function(){d3.event.preventDefault();return self.loadNextDomain(1)})}if(!1!==self.options.previousSelector){d3.select(self.options.previousSelector).on("click."+self.options.itemNamespace,function(){d3.event.preventDefault();return self.loadPreviousDomain(1)})}self.Legend.redraw(self.graphDim.width-self.options.domainGutter-self.options.cellPadding);self.afterLoad();var domains=self.getDomainKeys();// Fill the graph with some datas\nif(self.options.loadOnInit){self.getDatas(self.options.data,new Date(domains[0]),self.getSubDomain(domains[domains.length-1]).pop(),function(){self.fill();self.onComplete()})}else{self.onComplete()}self.checkIfMinDomainIsReached(domains[0]);self.checkIfMaxDomainIsReached(self.getNextDomain().getTime())}// Return the width of the domain block, without the domain gutter\n// @param int d Domain start timestamp\nfunction w(d,outer){var width=self.options.cellSize*self._domainType[self.options.subDomain].column(d)+self.options.cellPadding*self._domainType[self.options.subDomain].column(d);if(2===arguments.length&&!0===outer){return width+=self.domainHorizontalLabelWidth+self.options.domainGutter+self.options.domainMargin[1]+self.options.domainMargin[3]}return width}// Return the height of the domain block, without the domain gutter\nfunction h(d,outer){var height=self.options.cellSize*self._domainType[self.options.subDomain].row(d)+self.options.cellPadding*self._domainType[self.options.subDomain].row(d);if(2===arguments.length&&!0===outer){height+=self.options.domainGutter+self.domainVerticalLabelHeight+self.options.domainMargin[0]+self.options.domainMargin[2]}return height}/**\n   *\n   *\n   * @param int navigationDir\n   */this.paint=function(navigationDir){var options=self.options;if(0===arguments.length){navigationDir=!1}// Painting all the domains\nvar domainSvg=self.root.select(".graph").selectAll(".graph-domain").data(function(){var data=self.getDomainKeys();return navigationDir===self.NAVIGATE_LEFT?data.reverse():data},function(d){return d}),enteringDomainDim=0,exitingDomainDim=0,svg=domainSvg.enter().append("svg").attr("width",function(d){return w(d,!0)}).attr("height",function(d){return h(d,!0)}).attr("x",function(d){if(options.verticalOrientation){self.graphDim.width=Math.max(self.graphDim.width,w(d,!0));return 0}else{return getDomainPosition(d,self.graphDim,"width",w(d,!0))}}).attr("y",function(d){if(options.verticalOrientation){return getDomainPosition(d,self.graphDim,"height",h(d,!0))}else{self.graphDim.height=Math.max(self.graphDim.height,h(d,!0));return 0}}).attr("class",function(d){var classname="graph-domain",date=new Date(d);switch(options.domain){case"hour":classname+=" h_"+date.getHours();/* falls through */case"day":classname+=" d_"+date.getDate()+" dy_"+date.getDay();/* falls through */case"week":classname+=" w_"+self.getWeekNumber(date);/* falls through */case"month":classname+=" m_"+(date.getMonth()+1);/* falls through */case"year":classname+=" y_"+date.getFullYear();}return classname});self.lastInsertedSvg=svg;function getDomainPosition(domainIndex,graphDim,axis,domainDim){var tmp=0;switch(navigationDir){case!1:tmp=graphDim[axis];graphDim[axis]+=domainDim;self.domainPosition.setPosition(domainIndex,tmp);return tmp;case self.NAVIGATE_RIGHT:self.domainPosition.setPosition(domainIndex,graphDim[axis]);enteringDomainDim=domainDim;exitingDomainDim=self.domainPosition.getPositionFromIndex(1);self.domainPosition.shiftRightBy(exitingDomainDim);return graphDim[axis];case self.NAVIGATE_LEFT:tmp=-domainDim;enteringDomainDim=-tmp;exitingDomainDim=graphDim[axis]-self.domainPosition.getLast();self.domainPosition.setPosition(domainIndex,tmp);self.domainPosition.shiftLeftBy(enteringDomainDim);return tmp;}}svg.append("rect").attr("width",function(d){return w(d,!0)-options.domainGutter-options.cellPadding}).attr("height",function(d){return h(d,!0)-options.domainGutter-options.cellPadding}).attr("class","domain-background");// =========================================================================//\n// PAINTING SUBDOMAINS                            //\n// =========================================================================//\nvar subDomainSvgGroup=svg.append("svg").attr("x",function(){if("left"===options.label.position){return self.domainHorizontalLabelWidth+options.domainMargin[3]}else{return options.domainMargin[3]}}).attr("y",function(){if("top"===options.label.position){return self.domainVerticalLabelHeight+options.domainMargin[0]}else{return options.domainMargin[0]}}).attr("class","graph-subdomain-group"),rect=subDomainSvgGroup.selectAll("g").data(function(d){return self._domains.get(d)}).enter().append("g");rect.append("rect").attr("class",function(d){return"graph-rect"+self.getHighlightClassName(d.t)+(null!==options.onClick?" hover_cursor":"")}).attr("width",options.cellSize).attr("height",options.cellSize).attr("x",function(d){return self.positionSubDomainX(d.t)}).attr("y",function(d){return self.positionSubDomainY(d.t)}).on("click",function(d){if(null!==options.onClick){return self.onClick(new Date(d.t),d.v)}}).call(function(selection){if(0<options.cellRadius){selection.attr("rx",options.cellRadius).attr("ry",options.cellRadius)}if(null!==self.legendScale&&null!==options.legendColors&&options.legendColors.hasOwnProperty("base")){selection.attr("fill",options.legendColors.base)}if(options.tooltip){selection.on("mouseover",function(d){self.tip.show(d,this)}).on("mouseout",function(){self.tip.hide(d)})}});// Appending a title to each subdomain\nif(!options.tooltip){rect.append("title").text(function(d){return self.formatDate(new Date(d.t),options.subDomainDateFormat)})}// =========================================================================//\n// PAINTING LABEL                              //\n// =========================================================================//\nif(""!==options.domainLabelFormat){svg.append("text").attr("class","graph-label").attr("y",function(d){var y=options.domainMargin[0];switch(options.label.position){case"top":y+=self.domainVerticalLabelHeight/2;break;case"bottom":y+=h(d)+self.domainVerticalLabelHeight/2;}return y+options.label.offset.y*("right"===options.label.rotate&&"right"===options.label.position||"left"===options.label.rotate&&"left"===options.label.position?-1:1)}).attr("x",function(d){var x=options.domainMargin[3];switch(options.label.position){case"right":x+=w(d);break;case"bottom":case"top":x+=w(d)/2;}if("right"===options.label.align){return x+self.domainHorizontalLabelWidth-options.label.offset.x*("right"===options.label.rotate?-1:1)}return x+options.label.offset.x}).attr("text-anchor",function(){switch(options.label.align){case"start":case"left":return"start";case"end":case"right":return"end";default:return"middle";}}).attr("dominant-baseline",function(){return self.verticalDomainLabel?"middle":"top"}).text(function(d){return self.formatDate(new Date(d),options.domainLabelFormat)}).call(domainRotate)}function domainRotate(selection){switch(options.label.rotate){case"right":selection.attr("transform",function(d){var s="rotate(90), ";switch(options.label.position){case"right":s+="translate(-"+w(d)+" , -"+w(d)+")";break;case"left":s+="translate(0, -"+self.domainHorizontalLabelWidth+")";break;}return s});break;case"left":selection.attr("transform",function(d){var s="rotate(270), ";switch(options.label.position){case"right":s+="translate(-"+(w(d)+self.domainHorizontalLabelWidth)+" , "+w(d)+")";break;case"left":s+="translate(-"+self.domainHorizontalLabelWidth+" , "+self.domainHorizontalLabelWidth+")";break;}return s});break;}}// =========================================================================//\n// PAINTING DOMAIN SUBDOMAIN CONTENT                    //\n// =========================================================================//\nif(null!==options.subDomainTextFormat){rect.append("text").attr("class",function(d){return"subdomain-text"+self.getHighlightClassName(d.t)}).attr("x",function(d){return self.positionSubDomainX(d.t)+options.cellSize/2}).attr("y",function(d){return self.positionSubDomainY(d.t)+options.cellSize/2}).attr("text-anchor","middle").attr("dominant-baseline","central").text(function(d){return self.formatDate(new Date(d.t),options.subDomainTextFormat)})}// =========================================================================//\n// ANIMATION                                //\n// =========================================================================//\nif(!1!==navigationDir){domainSvg.transition().duration(options.animationDuration).attr("x",function(d){return options.verticalOrientation?0:self.domainPosition.getPosition(d)}).attr("y",function(d){return options.verticalOrientation?self.domainPosition.getPosition(d):0})}var tempWidth=self.graphDim.width,tempHeight=self.graphDim.height;if(options.verticalOrientation){self.graphDim.height+=enteringDomainDim-exitingDomainDim}else{self.graphDim.width+=enteringDomainDim-exitingDomainDim}// At the time of exit, domainsWidth and domainsHeight already automatically shifted\ndomainSvg.exit().transition().duration(options.animationDuration).attr("x",function(d){if(options.verticalOrientation){return 0}else{switch(navigationDir){case self.NAVIGATE_LEFT:return Math.min(self.graphDim.width,tempWidth);case self.NAVIGATE_RIGHT:return-w(d,!0);}}}).attr("y",function(d){if(options.verticalOrientation){switch(navigationDir){case self.NAVIGATE_LEFT:return Math.min(self.graphDim.height,tempHeight);case self.NAVIGATE_RIGHT:return-h(d,!0);}}else{return 0}}).remove();// Resize the root container\nself.resize()}};CalHeatMap.prototype={/**\n   * Validate and merge user settings with default settings\n   *\n   * @param  {object} settings User settings\n   * @return {bool} False if settings contains error\n   */ /* jshint maxstatements:false */init:function(settings){\'use strict\';var parent=this,options=parent.options=mergeRecursive(parent.options,settings);// Fatal errors\n// Stop script execution on error\n(/**\n     * Ensure that the domain and subdomain are valid\n     *\n     * @throw {Error} when domain or subdomain are not valid\n     * @return {bool} True if domain and subdomain are valid and compatible\n     */function(){if(!parent._domainType.hasOwnProperty(options.domain)||"min"===options.domain||"x_"===options.domain.substring(0,2)){throw new Error("The domain \'"+options.domain+"\' is not valid")}if(!parent._domainType.hasOwnProperty(options.subDomain)||"year"===options.subDomain){throw new Error("The subDomain \'"+options.subDomain+"\' is not valid")}if(parent._domainType[options.domain].level<=parent._domainType[options.subDomain].level){throw new Error("\'"+options.subDomain+"\' is not a valid subDomain to \'"+options.domain+"\'")}return!0}/**\n     * Fine-tune the label alignement depending on its position\n     *\n     * @return void\n     */)();validateSelector(options.itemSelector,!1,"itemSelector");if(-1===parent.allowedDataType.indexOf(options.dataType)){throw new Error("The data type \'"+options.dataType+"\' is not valid data type")}if(null===d3.select(options.itemSelector)[0][0]){throw new Error("The node \'"+options.itemSelector+"\' specified in itemSelector does not exists")}try{validateSelector(options.nextSelector,!0,"nextSelector");validateSelector(options.previousSelector,!0,"previousSelector")}catch(error){console.log(error.message);return!1}// If other settings contains error, will fallback to default\nif(!settings.hasOwnProperty("subDomain")){this.options.subDomain=getOptimalSubDomain(settings.domain)}if("string"!=typeof options.itemNamespace||""===options.itemNamespace){console.log("itemNamespace can not be empty, falling back to cal-heatmap");options.itemNamespace="cal-heatmap"}// Don\'t touch these settings\nvar s=["data","onComplete","onClick","afterLoad","afterLoadData","afterLoadPreviousDomain","afterLoadNextDomain","afterUpdate"];for(var k in s){if(settings.hasOwnProperty(s[k])){options[s[k]]=settings[s[k]]}}options.subDomainDateFormat="string"==typeof options.subDomainDateFormat||"function"==typeof options.subDomainDateFormat?options.subDomainDateFormat:this._domainType[options.subDomain].format.date;options.domainLabelFormat="string"==typeof options.domainLabelFormat||"function"==typeof options.domainLabelFormat?options.domainLabelFormat:this._domainType[options.domain].format.legend;options.subDomainTextFormat="string"==typeof options.subDomainTextFormat&&""!==options.subDomainTextFormat||"function"==typeof options.subDomainTextFormat?options.subDomainTextFormat:null;options.domainMargin=expandMarginSetting(options.domainMargin);options.legendMargin=expandMarginSetting(options.legendMargin);options.highlight=parent.expandDateSetting(options.highlight);options.itemName=/**\n     * Convert a string to an array like [singular-form, plural-form]\n     *\n     * @param  {string|array} value Date to convert\n     * @return {array}       An array like [singular-form, plural-form]\n     */function(value){if("string"==typeof value){return[value,value+(""!==value?"s":"")]}if(Array.isArray(value)){if(1===value.length){return[value[0],value[0]+"s"]}else if(2<value.length){return value.slice(0,2)}return value}return["item","items"]}(options.itemName);options.colLimit=function(value){return 0<value?value:null}(options.colLimit);options.rowLimit=function(value){if(0<value&&0<options.colLimit){console.log("colLimit and rowLimit are mutually exclusive, rowLimit will be ignored");return null}return 0<value?value:null}(options.rowLimit);if(!settings.hasOwnProperty("legendMargin")){autoAddLegendMargin()}(function(){// Auto-align label, depending on it\'s position\nif(!settings.hasOwnProperty("label")||settings.hasOwnProperty("label")&&!settings.label.hasOwnProperty("align")){switch(options.label.position){case"left":options.label.align="right";break;case"right":options.label.align="left";break;default:options.label.align="center";}if("left"===options.label.rotate){options.label.align="right"}else if("right"===options.label.rotate){options.label.align="left"}}if(!settings.hasOwnProperty("label")||settings.hasOwnProperty("label")&&!settings.label.hasOwnProperty("offset")){if("left"===options.label.position||"right"===options.label.position){options.label.offset={x:10,y:15}}}}/**\n     * If not specified, add some margin around the legend depending on its position\n     *\n     * @return void\n     */)();/**\n     * Validate that a queryString is valid\n     *\n     * @param  {Element|string|bool} selector   The queryString to test\n     * @param  {bool}  canBeFalse  Whether false is an accepted and valid value\n     * @param  {string} name    Name of the tested selector\n     * @throws {Error}        If the selector is not valid\n     * @return {bool}        True if the selector is a valid queryString\n     */function validateSelector(selector,canBeFalse,name){if((canBeFalse&&!1===selector||selector instanceof Element||"string"==typeof selector)&&""!==selector){return!0}throw new Error("The "+name+" is not valid")}/**\n     * Return the optimal subDomain for the specified domain\n     *\n     * @param  {string} domain a domain name\n     * @return {string}        the subDomain name\n     */function getOptimalSubDomain(domain){switch(domain){case"year":return"month";case"month":return"day";case"week":return"day";case"day":return"hour";default:return"min";}}function autoAddLegendMargin(){switch(options.legendVerticalPosition){case"top":options.legendMargin[2]=parent.DEFAULT_LEGEND_MARGIN;break;case"bottom":options.legendMargin[0]=parent.DEFAULT_LEGEND_MARGIN;break;case"middle":case"center":options.legendMargin["right"===options.legendHorizontalPosition?3:1]=parent.DEFAULT_LEGEND_MARGIN;}}/**\n     * Expand a number of an array of numbers to an usable 4 values array\n     *\n     * @param  {integer|array} value\n     * @return {array}        array\n     */function expandMarginSetting(value){if("number"==typeof value){value=[value]}if(!Array.isArray(value)){console.log("Margin only takes an integer or an array of integers");value=[0]}switch(value.length){case 1:return[value[0],value[0],value[0],value[0]];case 2:return[value[0],value[1],value[0],value[1]];case 3:return[value[0],value[1],value[2],value[1]];case 4:return value;default:return value.slice(0,4);}}return this._init()},/**\n   * Convert a keyword or an array of keyword/date to an array of date objects\n   *\n   * @param  {string|array|Date} value Data to convert\n   * @return {array}       An array of Dates\n   */expandDateSetting:function(value){\'use strict\';if(!Array.isArray(value)){value=[value]}return value.map(function(data){if("now"===data){return new Date}if(data instanceof Date){return data}return!1}).filter(function(d){return!1!==d})},/**\n   * Fill the calendar by coloring the cells\n   *\n   * @param array svg An array of html node to apply the transformation to (optional)\n   *                  It\'s used to limit the painting to only a subset of the calendar\n   * @return void\n   */fill:function(svg){\'use strict\';var parent=this,options=parent.options;if(0===arguments.length){svg=parent.root.selectAll(".graph-domain")}var rect=svg.selectAll("svg").selectAll("g").data(function(d){return parent._domains.get(d)});/**\n     * Colorize the cell via a style attribute if enabled\n     */rect.transition().duration(options.animationDuration).select("rect").attr("class",function(d){var htmlClass=parent.getHighlightClassName(d.t).trim().split(" "),pastDate=parent.dateIsLessThan(d.t,new Date),sameDate=parent.dateIsEqual(d.t,new Date);if(null===parent.legendScale||null===d.v&&options.hasOwnProperty("considerMissingDataAsZero")&&!options.considerMissingDataAsZero&&!options.legendColors.hasOwnProperty("base")){htmlClass.push("graph-rect")}if(sameDate){htmlClass.push("now")}else if(!pastDate){htmlClass.push("future")}if(null!==d.v){htmlClass.push(parent.Legend.getClass(d.v,null===parent.legendScale))}else if(options.considerMissingDataAsZero&&pastDate){htmlClass.push(parent.Legend.getClass(0,null===parent.legendScale))}if(null!==options.onClick){htmlClass.push("hover_cursor")}return htmlClass.join(" ")}).call(function(element){if(null===parent.legendScale){return!1}element.attr("fill",function(d){if(null===d.v&&options.hasOwnProperty("considerMissingDataAsZero")&&!options.considerMissingDataAsZero){if(options.legendColors.hasOwnProperty("base")){return options.legendColors.base}}if(null!==options.legendColors&&options.legendColors.hasOwnProperty("empty")&&(0===d.v||null===d.v&&options.hasOwnProperty("considerMissingDataAsZero")&&options.considerMissingDataAsZero)){return options.legendColors.empty}if(0>d.v&&0<options.legend[0]&&null!==options.legendColors&&options.legendColors.hasOwnProperty("overflow")){return options.legendColors.overflow}return parent.legendScale(Math.min(d.v,options.legend[options.legend.length-1]))})});rect.transition().duration(options.animationDuration).select("title").text(function(d){return parent.getSubDomainTitle(d)});/**\n     * Change the subDomainText class if necessary\n     * Also change the text, e.g when text is representing the value\n     * instead of the date\n     */rect.transition().duration(options.animationDuration).select("text").attr("class",function(d){return"subdomain-text"+parent.getHighlightClassName(d.t)}).call(function(element){if("function"==typeof options.subDomainTextFormat){element.text(function(d){return options.subDomainTextFormat(d.t,d.v)})}})},/**\n   * Sprintf like function.\n   * Replaces placeholders {0} in string with values from provided object.\n   *\n   * @param string formatted String containing placeholders.\n   * @param object args Object with properties to replace placeholders in string.\n   *\n   * @return String\n   */formatStringWithObject:function(formatted,args){\'use strict\';for(var prop in args){if(args.hasOwnProperty(prop)){var regexp=new RegExp("\\\\{"+prop+"\\\\}","gi");formatted=formatted.replace(regexp,args[prop])}}return formatted},// =========================================================================//\n// EVENTS CALLBACK                              //\n// =========================================================================//\n/**\n   * Helper method for triggering event callback\n   *\n   * @param  string  eventName       Name of the event to trigger\n   * @param  array  successArgs     List of argument to pass to the callback\n   * @param  boolean  skip      Whether to skip the event triggering\n   * @return mixed  True when the triggering was skipped, false on error, else the callback function\n   */triggerEvent:function(eventName,successArgs,skip){\'use strict\';if(3===arguments.length&&skip||null===this.options[eventName]){return!0}if("function"==typeof this.options[eventName]){if("function"==typeof successArgs){successArgs=successArgs()}return this.options[eventName].apply(this,successArgs)}else{console.log("Provided callback for "+eventName+" is not a function.");return!1}},/**\n   * Event triggered on a mouse click on a subDomain cell\n   *\n   * @param  Date    d    Date of the subdomain block\n   * @param  int    itemNb  Number of items in that date\n   */onClick:function(d,itemNb){\'use strict\';return this.triggerEvent("onClick",[d,itemNb])},/**\n   * Event triggered after drawing the calendar, byt before filling it with data\n   */afterLoad:function(){\'use strict\';return this.triggerEvent("afterLoad")},/**\n   * Event triggered after completing drawing and filling the calendar\n   */onComplete:function(){\'use strict\';var response=this.triggerEvent("onComplete",[],this._completed);this._completed=!0;return response},/**\n   * Event triggered after shifting the calendar one domain back\n   *\n   * @param  Date    start  Domain start date\n   * @param  Date    end    Domain end date\n   */afterLoadPreviousDomain:function(start){\'use strict\';var parent=this;return this.triggerEvent("afterLoadPreviousDomain",function(){var subDomain=parent.getSubDomain(start);return[subDomain.shift(),subDomain.pop()]})},/**\n   * Event triggered after shifting the calendar one domain above\n   *\n   * @param  Date    start  Domain start date\n   * @param  Date    end    Domain end date\n   */afterLoadNextDomain:function(start){\'use strict\';var parent=this;return this.triggerEvent("afterLoadNextDomain",function(){var subDomain=parent.getSubDomain(start);return[subDomain.shift(),subDomain.pop()]})},/**\n   * Event triggered after loading the leftmost domain allowed by minDate\n   *\n   * @param  boolean  reached True if the leftmost domain was reached\n   */onMinDomainReached:function(reached){\'use strict\';this._minDomainReached=reached;return this.triggerEvent("onMinDomainReached",[reached])},/**\n   * Event triggered after loading the rightmost domain allowed by maxDate\n   *\n   * @param  boolean  reached True if the rightmost domain was reached\n   */onMaxDomainReached:function(reached){\'use strict\';this._maxDomainReached=reached;return this.triggerEvent("onMaxDomainReached",[reached])},checkIfMinDomainIsReached:function(date,upperBound){\'use strict\';if(this.minDomainIsReached(date)){this.onMinDomainReached(!0)}if(2===arguments.length){if(this._maxDomainReached&&!this.maxDomainIsReached(upperBound)){this.onMaxDomainReached(!1)}}},checkIfMaxDomainIsReached:function(date,lowerBound){\'use strict\';if(this.maxDomainIsReached(date)){this.onMaxDomainReached(!0)}if(2===arguments.length){if(this._minDomainReached&&!this.minDomainIsReached(lowerBound)){this.onMinDomainReached(!1)}}},afterUpdate:function(){\'use strict\';return this.triggerEvent("afterUpdate")},// =========================================================================//\n// FORMATTER                                //\n// =========================================================================//\nformatNumber:d3.format(",g"),formatDate:function(d,format){\'use strict\';if(2>arguments.length){format="title"}if("function"==typeof format){return format(d)}else{var f=d3.time.format(format);return f(d)}},getSubDomainTitle:function(d){\'use strict\';if(null===d.v&&!this.options.considerMissingDataAsZero){return this.formatStringWithObject(this.options.subDomainTitleFormat.empty,{date:this.formatDate(new Date(d.t),this.options.subDomainDateFormat)})}else{var value=d.v;// Consider null as 0\nif(null===value&&this.options.considerMissingDataAsZero){value=0}return this.formatStringWithObject(this.options.subDomainTitleFormat.filled,{count:this.formatNumber(value),name:this.options.itemName[1!==value?1:0],connector:this._domainType[this.options.subDomain].format.connector,date:this.formatDate(new Date(d.t),this.options.subDomainDateFormat)})}},// =========================================================================//\n// DOMAIN NAVIGATION                            //\n// =========================================================================//\n/**\n   * Shift the calendar one domain forward\n   *\n   * The new domain is loaded only if it\'s not beyond maxDate\n   *\n   * @param int n Number of domains to load\n   * @return bool True if the next domain was loaded, else false\n   */loadNextDomain:function(n){\'use strict\';if(this._maxDomainReached||0===n){return!1}var bound=this.loadNewDomains(this.NAVIGATE_RIGHT,this.getDomain(this.getNextDomain(),n));this.afterLoadNextDomain(bound.end);this.checkIfMaxDomainIsReached(this.getNextDomain().getTime(),bound.start);return!0},/**\n   * Shift the calendar one domain backward\n   *\n   * The previous domain is loaded only if it\'s not beyond the minDate\n   *\n   * @param int n Number of domains to load\n   * @return bool True if the previous domain was loaded, else false\n   */loadPreviousDomain:function(n){\'use strict\';if(this._minDomainReached||0===n){return!1}var bound=this.loadNewDomains(this.NAVIGATE_LEFT,this.getDomain(this.getDomainKeys()[0],-n).reverse());this.afterLoadPreviousDomain(bound.start);this.checkIfMinDomainIsReached(bound.start,bound.end);return!0},loadNewDomains:function(direction,newDomains){\'use strict\';var parent=this,backward=direction===this.NAVIGATE_LEFT,i=-1,total=newDomains.length,domains=this.getDomainKeys();function buildSubDomain(d){return{t:parent._domainType[parent.options.subDomain].extractUnit(d),v:null}}// Remove out of bound domains from list of new domains to prepend\nwhile(++i<total){if(backward&&this.minDomainIsReached(newDomains[i])){newDomains=newDomains.slice(0,i+1);break}if(!backward&&this.maxDomainIsReached(newDomains[i])){newDomains=newDomains.slice(0,i);break}}newDomains=newDomains.slice(-this.options.range);for(i=0,total=newDomains.length;i<total;i+=1){this._domains.set(newDomains[i].getTime(),this.getSubDomain(newDomains[i]).map(buildSubDomain));this._domains.remove(backward?domains.pop():domains.shift())}domains=this.getDomainKeys();if(backward){newDomains=newDomains.reverse()}this.paint(direction);this.getDatas(this.options.data,newDomains[0],this.getSubDomain(newDomains[newDomains.length-1]).pop(),function(){parent.fill(parent.lastInsertedSvg)});return{start:newDomains[backward?0:1],end:domains[domains.length-1]}},/**\n   * Return whether a date is inside the scope determined by maxDate\n   *\n   * @param int datetimestamp The timestamp in ms to test\n   * @return bool True if the specified date correspond to the calendar upper bound\n   */maxDomainIsReached:function(datetimestamp){\'use strict\';return null!==this.options.maxDate&&this.options.maxDate.getTime()<datetimestamp},/**\n   * Return whether a date is inside the scope determined by minDate\n   *\n   * @param int datetimestamp The timestamp in ms to test\n   * @return bool True if the specified date correspond to the calendar lower bound\n   */minDomainIsReached:function(datetimestamp){\'use strict\';return null!==this.options.minDate&&this.options.minDate.getTime()>=datetimestamp},/**\n   * Return the list of the calendar\'s domain timestamp\n   *\n   * @return Array a sorted array of timestamp\n   */getDomainKeys:function(){\'use strict\';return this._domains.keys().map(function(d){return parseInt(d,10)}).sort(function(a,b){return a-b})},// =========================================================================//\n// POSITIONNING                                //\n// =========================================================================//\npositionSubDomainX:function(d){\'use strict\';var index=this._domainType[this.options.subDomain].position.x(new Date(d));return index*this.options.cellSize+index*this.options.cellPadding},positionSubDomainY:function(d){\'use strict\';var index=this._domainType[this.options.subDomain].position.y(new Date(d));return index*this.options.cellSize+index*this.options.cellPadding},getSubDomainColumnNumber:function(d){\'use strict\';if(0<this.options.rowLimit){var i=this._domainType[this.options.subDomain].maxItemNumber;if("function"==typeof i){i=i(d)}return Math.ceil(i/this.options.rowLimit)}var j=this._domainType[this.options.subDomain].defaultColumnNumber;if("function"==typeof j){j=j(d)}return this.options.colLimit||j},getSubDomainRowNumber:function(d){\'use strict\';if(0<this.options.colLimit){var i=this._domainType[this.options.subDomain].maxItemNumber;if("function"==typeof i){i=i(d)}return Math.ceil(i/this.options.colLimit)}var j=this._domainType[this.options.subDomain].defaultRowNumber;if("function"==typeof j){j=j(d)}return this.options.rowLimit||j},/**\n   * Return a classname if the specified date should be highlighted\n   *\n   * @param  timestamp date Date of the current subDomain\n   * @return String the highlight class\n   */getHighlightClassName:function(d){\'use strict\';d=new Date(d);if(0<this.options.highlight.length){for(var i in this.options.highlight){if(this.dateIsEqual(this.options.highlight[i],d)){return this.isNow(this.options.highlight[i])?" highlight-now":" highlight"}}}return""},/**\n   * Return whether the specified date is now,\n   * according to the type of subdomain\n   *\n   * @param  Date d The date to compare\n   * @return bool True if the date correspond to a subdomain cell\n   */isNow:function(d){\'use strict\';return this.dateIsEqual(d,new Date)},/**\n   * Return whether 2 dates are equals\n   * This function is subdomain-aware,\n   * and dates comparison are dependent of the subdomain\n   *\n   * @param  Date dateA First date to compare\n   * @param  Date dateB Secon date to compare\n   * @return bool true if the 2 dates are equals\n   */ /* jshint maxcomplexity: false */dateIsEqual:function(dateA,dateB){\'use strict\';if(!(dateA instanceof Date)){dateA=new Date(dateA)}if(!(dateB instanceof Date)){dateB=new Date(dateB)}switch(this.options.subDomain){case"x_min":case"min":return dateA.getFullYear()===dateB.getFullYear()&&dateA.getMonth()===dateB.getMonth()&&dateA.getDate()===dateB.getDate()&&dateA.getHours()===dateB.getHours()&&dateA.getMinutes()===dateB.getMinutes();case"x_hour":case"hour":return dateA.getFullYear()===dateB.getFullYear()&&dateA.getMonth()===dateB.getMonth()&&dateA.getDate()===dateB.getDate()&&dateA.getHours()===dateB.getHours();case"x_day":case"day":return dateA.getFullYear()===dateB.getFullYear()&&dateA.getMonth()===dateB.getMonth()&&dateA.getDate()===dateB.getDate();case"x_week":case"week":return dateA.getFullYear()===dateB.getFullYear()&&this.getWeekNumber(dateA)===this.getWeekNumber(dateB);case"x_month":case"month":return dateA.getFullYear()===dateB.getFullYear()&&dateA.getMonth()===dateB.getMonth();default:return!1;}},/**\n   * Returns wether or not dateA is less than or equal to dateB. This function is subdomain aware.\n   * Performs automatic conversion of values.\n   * @param dateA may be a number or a Date\n   * @param dateB may be a number or a Date\n   * @returns {boolean}\n   */dateIsLessThan:function(dateA,dateB){\'use strict\';if(!(dateA instanceof Date)){dateA=new Date(dateA)}if(!(dateB instanceof Date)){dateB=new Date(dateB)}function normalizedMillis(date,subdomain){switch(subdomain){case"x_min":case"min":return new Date(date.getFullYear(),date.getMonth(),date.getDate(),date.getHours(),date.getMinutes()).getTime();case"x_hour":case"hour":return new Date(date.getFullYear(),date.getMonth(),date.getDate(),date.getHours()).getTime();case"x_day":case"day":return new Date(date.getFullYear(),date.getMonth(),date.getDate()).getTime();case"x_week":case"week":case"x_month":case"month":return new Date(date.getFullYear(),date.getMonth()).getTime();default:return date.getTime();}}return normalizedMillis(dateA,this.options.subDomain)<normalizedMillis(dateB,this.options.subDomain)},// =========================================================================//\n// DATE COMPUTATION                              //\n// =========================================================================//\n/**\n   * Return the day of the year for the date\n   * @param  Date\n   * @return  int Day of the year [1,366]\n   */getDayOfYear:d3.time.format("%j"),/**\n   * Return the week number of the year\n   * Monday as the first day of the week\n   * @return int  Week number [0-53]\n   */getWeekNumber:function(d){\'use strict\';var f=!0===this.options.weekStartOnMonday?d3.time.format("%W"):d3.time.format("%U");return f(d)},/**\n   * Return the week number, relative to its month\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Week number, relative to the month [0-5]\n   */getMonthWeekNumber:function(d){\'use strict\';if("number"==typeof d){d=new Date(d)}var monthFirstWeekNumber=this.getWeekNumber(new Date(d.getFullYear(),d.getMonth()));return this.getWeekNumber(d)-monthFirstWeekNumber-1},/**\n   * Return the number of weeks in the dates\' year\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of weeks in the date\'s year\n   */getWeekNumberInYear:function(d){\'use strict\';if("number"==typeof d){d=new Date(d)}},/**\n   * Return the number of days in the date\'s month\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of days in the date\'s month\n   */getDayCountInMonth:function(d){\'use strict\';return this.getEndOfMonth(d).getDate()},/**\n   * Return the number of days in the date\'s year\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of days in the date\'s year\n   */getDayCountInYear:function(d){\'use strict\';if("number"==typeof d){d=new Date(d)}return 1===new Date(d.getFullYear(),1,29).getMonth()?366:365},/**\n   * Get the weekday from a date\n   *\n   * Return the week day number (0-6) of a date,\n   * depending on whether the week start on monday or sunday\n   *\n   * @param  Date d\n   * @return int The week day number (0-6)\n   */getWeekDay:function(d){\'use strict\';if(!1===this.options.weekStartOnMonday){return d.getDay()}return 0===d.getDay()?6:d.getDay()-1},/**\n   * Get the last day of the month\n   * @param  Date|int  d  Date or timestamp in milliseconds\n   * @return Date      Last day of the month\n   */getEndOfMonth:function(d){\'use strict\';if("number"==typeof d){d=new Date(d)}return new Date(d.getFullYear(),d.getMonth()+1,0)},/**\n   *\n   * @param  Date date\n   * @param  int count\n   * @param  string step\n   * @return Date\n   */jumpDate:function(date,count,step){\'use strict\';var d=new Date(date);switch(step){case"hour":d.setHours(d.getHours()+count);break;case"day":d.setHours(d.getHours()+24*count);break;case"week":d.setHours(d.getHours()+7*(24*count));break;case"month":d.setMonth(d.getMonth()+count);break;case"year":d.setFullYear(d.getFullYear()+count);}return new Date(d)},// =========================================================================//\n// DOMAIN COMPUTATION                            //\n// =========================================================================//\n/**\n   * Return all the minutes between 2 dates\n   *\n   * @param  Date  d  date  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of minutes\n   */getMinuteDomain:function(d,range){\'use strict\';var start=new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours()),stop=null;if(range instanceof Date){stop=new Date(range.getFullYear(),range.getMonth(),range.getDate(),range.getHours())}else{stop=new Date(+start+60*(1e3*range))}return d3.time.minutes(Math.min(start,stop),Math.max(start,stop))},/**\n   * Return all the hours between 2 dates\n   *\n   * @param  Date  d  A date\n   * @param  int|date  range  Number of hours in the range, or a stop date\n   * @return array  An array of hours\n   */getHourDomain:function(d,range){\'use strict\';var start=new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours()),stop=null;if(range instanceof Date){stop=new Date(range.getFullYear(),range.getMonth(),range.getDate(),range.getHours())}else{stop=new Date(start);stop.setHours(stop.getHours()+range)}var domains=d3.time.hours(Math.min(start,stop),Math.max(start,stop)),i=0,total=domains.length;// Passing from DST to standard time\n// If there are 25 hours, let\'s compress the duplicate hours\nfor(i=0;i<total;i+=1){if(0<i&&domains[i].getHours()===domains[i-1].getHours()){this.DSTDomain.push(domains[i].getTime());domains.splice(i,1);break}}// d3.time.hours is returning more hours than needed when changing\n// from DST to standard time, because there is really 2 hours between\n// 1am and 2am!\nif("number"==typeof range&&domains.length>Math.abs(range)){domains.splice(domains.length-1,1)}return domains},/**\n   * Return all the days between 2 dates\n   *\n   * @param  Date    d    A date\n   * @param  int|date  range  Number of days in the range, or a stop date\n   * @return array  An array of weeks\n   */getDayDomain:function(d,range){\'use strict\';var start=new Date(d.getFullYear(),d.getMonth(),d.getDate()),stop=null;if(range instanceof Date){stop=new Date(range.getFullYear(),range.getMonth(),range.getDate())}else{stop=new Date(start);stop=new Date(stop.setDate(stop.getDate()+parseInt(range,10)))}return d3.time.days(Math.min(start,stop),Math.max(start,stop))},/**\n   * Return all the weeks between 2 dates\n   *\n   * @param  Date  d  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of weeks\n   */getWeekDomain:function(d,range){\'use strict\';var weekStart;if(!1===this.options.weekStartOnMonday){weekStart=new Date(d.getFullYear(),d.getMonth(),d.getDate()-d.getDay())}else{if(1===d.getDay()){weekStart=new Date(d.getFullYear(),d.getMonth(),d.getDate())}else if(0===d.getDay()){weekStart=new Date(d.getFullYear(),d.getMonth(),d.getDate());weekStart.setDate(weekStart.getDate()-6)}else{weekStart=new Date(d.getFullYear(),d.getMonth(),d.getDate()-d.getDay()+1)}}var endDate=new Date(weekStart),stop=range;if("object"!=typeof range){stop=new Date(endDate.setDate(endDate.getDate()+7*range))}return!0===this.options.weekStartOnMonday?d3.time.mondays(Math.min(weekStart,stop),Math.max(weekStart,stop)):d3.time.sundays(Math.min(weekStart,stop),Math.max(weekStart,stop))},/**\n   * Return all the months between 2 dates\n   *\n   * @param  Date    d    A date\n   * @param  int|date  range  Number of months in the range, or a stop date\n   * @return array  An array of months\n   */getMonthDomain:function(d,range){\'use strict\';var start=new Date(d.getFullYear(),d.getMonth()),stop=null;if(range instanceof Date){stop=new Date(range.getFullYear(),range.getMonth())}else{stop=new Date(start);stop=stop.setMonth(stop.getMonth()+range)}return d3.time.months(Math.min(start,stop),Math.max(start,stop))},/**\n   * Return all the years between 2 dates\n   *\n   * @param  Date  d  date  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of hours\n   */getYearDomain:function(d,range){\'use strict\';var start=new Date(d.getFullYear(),0),stop=null;if(range instanceof Date){stop=new Date(range.getFullYear(),0)}else{stop=new Date(d.getFullYear()+range,0)}return d3.time.years(Math.min(start,stop),Math.max(start,stop))},/**\n   * Get an array of domain start dates\n   *\n   * @param  int|Date date A random date included in the wanted domain\n   * @param  int|Date range Number of dates to get, or a stop date\n   * @return Array of dates\n   */getDomain:function(date,range){\'use strict\';if("number"==typeof date){date=new Date(date)}if(2>arguments.length){range=this.options.range}switch(this.options.domain){case"hour":var domains=this.getHourDomain(date,range);// Case where an hour is missing, when passing from standard time to DST\n// Missing hour is perfectly acceptabl in subDomain, but not in domains\nif("number"==typeof range&&domains.length<range){if(0<range){domains.push(this.getHourDomain(domains[domains.length-1],2)[1])}else{domains.shift(this.getHourDomain(domains[0],-2)[0])}}return domains;case"day":return this.getDayDomain(date,range);case"week":return this.getWeekDomain(date,range);case"month":return this.getMonthDomain(date,range);case"year":return this.getYearDomain(date,range);}},/* jshint maxcomplexity: false */getSubDomain:function(date){\'use strict\';if("number"==typeof date){date=new Date(date)}var parent=this,computeDaySubDomainSize=function(date,domain){switch(domain){case"year":return parent.getDayCountInYear(date);case"month":return parent.getDayCountInMonth(date);case"week":return 7;}},computeMinSubDomainSize=function(date,domain){switch(domain){case"hour":return 60;case"day":return 1440;case"week":return 10080;}},computeHourSubDomainSize=function(date,domain){switch(domain){case"day":return 24;case"week":return 168;case"month":return 24*parent.getDayCountInMonth(date);}},computeWeekSubDomainSize=function(date,domain){if("month"===domain){var endOfMonth=new Date(date.getFullYear(),date.getMonth()+1,0),endWeekNb=parent.getWeekNumber(endOfMonth),startWeekNb=parent.getWeekNumber(new Date(date.getFullYear(),date.getMonth()));if(startWeekNb>endWeekNb){startWeekNb=0;endWeekNb+=1}return endWeekNb-startWeekNb+1}else if("year"===domain){return parent.getWeekNumber(new Date(date.getFullYear(),11,31))}};/**\n     * @return int\n     */switch(this.options.subDomain){case"x_min":case"min":return this.getMinuteDomain(date,computeMinSubDomainSize(date,this.options.domain));case"x_hour":case"hour":return this.getHourDomain(date,computeHourSubDomainSize(date,this.options.domain));case"x_day":case"day":return this.getDayDomain(date,computeDaySubDomainSize(date,this.options.domain));case"x_week":case"week":return this.getWeekDomain(date,computeWeekSubDomainSize(date,this.options.domain));case"x_month":case"month":return this.getMonthDomain(date,12);}},/**\n   * Get the n-th next domain after the calendar newest (rightmost) domain\n   * @param  int n\n   * @return Date The start date of the wanted domain\n   */getNextDomain:function(n){\'use strict\';if(0===arguments.length){n=1}return this.getDomain(this.jumpDate(this.getDomainKeys().pop(),n,this.options.domain),1)[0]},/**\n   * Get the n-th domain before the calendar oldest (leftmost) domain\n   * @param  int n\n   * @return Date The start date of the wanted domain\n   */getPreviousDomain:function(n){\'use strict\';if(0===arguments.length){n=1}return this.getDomain(this.jumpDate(this.getDomainKeys().shift(),-n,this.options.domain),1)[0]},// =========================================================================//\n// DATAS                                  //\n// =========================================================================//\n/**\n   * Fetch and interpret data from the datasource\n   *\n   * @param string|object source\n   * @param Date startDate\n   * @param Date endDate\n   * @param function callback\n   * @param function|boolean afterLoad function used to convert the data into a json object. Use true to use the afterLoad callback\n   * @param updateMode\n   *\n   * @return mixed\n   * - True if there are no data to load\n   * - False if data are loaded asynchronously\n   */getDatas:function(source,startDate,endDate,callback,afterLoad,updateMode){\'use strict\';var self=this;if(5>arguments.length){afterLoad=!0}if(6>arguments.length){updateMode=this.APPEND_ON_UPDATE}var _callback=function(error,data){if(!1!==afterLoad){if("function"==typeof afterLoad){data=afterLoad(data)}else if("function"==typeof self.options.afterLoadData){data=self.options.afterLoadData(data)}else{console.log("Provided callback for afterLoadData is not a function.")}}else if("csv"===self.options.dataType||"tsv"===self.options.dataType){data=this.interpretCSV(data)}self.parseDatas(data,updateMode,startDate,endDate);if("function"==typeof callback){callback()}};switch(typeof source){case"string":if(""===source){_callback(null,{});return!0}else{var url=this.parseURI(source,startDate,endDate),requestType="GET";if(null!==self.options.dataPostPayload){requestType="POST"}var payload=null;if(null!==self.options.dataPostPayload){payload=this.parseURI(self.options.dataPostPayload,startDate,endDate)}var xhr=null;switch(this.options.dataType){case"json":xhr=d3.json(url);break;case"csv":xhr=d3.csv(url);break;case"tsv":xhr=d3.tsv(url);break;case"txt":xhr=d3.text(url,"text/plain");break;}// jshint maxdepth:5\nif(null!==self.options.dataRequestHeaders){for(var header in self.options.dataRequestHeaders){if(self.options.dataRequestHeaders.hasOwnProperty(header)){xhr.header(header,self.options.dataRequestHeaders[header])}}}xhr.send(requestType,payload,_callback)}return!1;case"object":if(source===Object(source)){_callback(null,source);return!1}/* falls through */default:_callback(null,{});return!0;}},/**\n   * Populate the calendar internal data\n   *\n   * @param object data\n   * @param constant updateMode\n   * @param Date startDate\n   * @param Date endDate\n   *\n   * @return void\n   */parseDatas:function(data,updateMode,startDate,endDate){\'use strict\';if(updateMode===this.RESET_ALL_ON_UPDATE){this._domains.forEach(function(key,value){value.forEach(function(element,index,array){array[index].v=null})})}var temp={},extractTime=function(d){return d.t};/*jshint forin:false */for(var d in data){var date=new Date(1e3*d),domainUnit=this.getDomain(date)[0].getTime();// The current data belongs to a domain that was compressed\n// Compress the data for the two duplicate hours into the same hour\nif(0<=this.DSTDomain.indexOf(domainUnit)){// Re-assign all data to the first or the second duplicate hours\n// depending on which is visible\nif(this._domains.has(domainUnit-3600000)){domainUnit-=3600000}}// Skip if data is not relevant to current domain\nif(isNaN(d)||!data.hasOwnProperty(d)||!this._domains.has(domainUnit)||!(domainUnit>=+startDate&&domainUnit<+endDate)){continue}var subDomainsData=this._domains.get(domainUnit);if(!temp.hasOwnProperty(domainUnit)){temp[domainUnit]=subDomainsData.map(extractTime)}var index=temp[domainUnit].indexOf(this._domainType[this.options.subDomain].extractUnit(date));if(updateMode===this.RESET_SINGLE_ON_UPDATE){subDomainsData[index].v=data[d]}else{if(!isNaN(subDomainsData[index].v)){subDomainsData[index].v+=data[d]}else{subDomainsData[index].v=data[d]}}}},parseURI:function(str,startDate,endDate){\'use strict\';// Use a timestamp in seconds\nstr=str.replace(/\\{\\{t:start\\}\\}/g,startDate.getTime()/1e3);str=str.replace(/\\{\\{t:end\\}\\}/g,endDate.getTime()/1e3);// Use a string date, following the ISO-8601\nstr=str.replace(/\\{\\{d:start\\}\\}/g,startDate.toISOString());str=str.replace(/\\{\\{d:end\\}\\}/g,endDate.toISOString());return str},interpretCSV:function(data){\'use strict\';var d={},keys=Object.keys(data[0]),i,total;for(i=0,total=data.length;i<total;i+=1){d[data[i][keys[0]]]=+data[i][keys[1]]}return d},/**\n   * Handle the calendar layout and dimension\n   *\n   * Expand and shrink the container depending on its children dimension\n   * Also rearrange the children position depending on their dimension,\n   * and the legend position\n   *\n   * @return void\n   */resize:function(){\'use strict\';var parent=this,options=parent.options,legendWidth=options.displayLegend?parent.Legend.getDim("width")+options.legendMargin[1]+options.legendMargin[3]:0,legendHeight=options.displayLegend?parent.Legend.getDim("height")+options.legendMargin[0]+options.legendMargin[2]:0,graphWidth=parent.graphDim.width-options.domainGutter-options.cellPadding,graphHeight=parent.graphDim.height-options.domainGutter-options.cellPadding;this.root.transition().duration(options.animationDuration).attr("width",function(){if("middle"===options.legendVerticalPosition||"center"===options.legendVerticalPosition){return graphWidth+legendWidth}return Math.max(graphWidth,legendWidth)}).attr("height",function(){if("middle"===options.legendVerticalPosition||"center"===options.legendVerticalPosition){return Math.max(graphHeight,legendHeight)}return graphHeight+legendHeight});this.root.select(".graph").transition().duration(options.animationDuration).attr("y",function(){if("top"===options.legendVerticalPosition){return legendHeight}return 0}).attr("x",function(){if(("middle"===options.legendVerticalPosition||"center"===options.legendVerticalPosition)&&"left"===options.legendHorizontalPosition){return legendWidth}return 0})},// =========================================================================//\n// PUBLIC API                                //\n// =========================================================================//\n/**\n   * Shift the calendar forward\n   */next:function(n){\'use strict\';if(0===arguments.length){n=1}return this.loadNextDomain(n)},/**\n   * Shift the calendar backward\n   */previous:function(n){\'use strict\';if(0===arguments.length){n=1}return this.loadPreviousDomain(n)},/**\n   * Jump directly to a specific date\n   *\n   * JumpTo will scroll the calendar until the wanted domain with the specified\n   * date is visible. Unless you set reset to true, the wanted domain\n   * will not necessarily be the first (leftmost) domain of the calendar.\n   *\n   * @param Date date Jump to the domain containing that date\n   * @param bool reset Whether the wanted domain should be the first domain of the calendar\n   * @param bool True of the calendar was scrolled\n   */jumpTo:function(date,reset){\'use strict\';if(2>arguments.length){reset=!1}var domains=this.getDomainKeys(),firstDomain=domains[0],lastDomain=domains[domains.length-1];if(date<firstDomain){return this.loadPreviousDomain(this.getDomain(firstDomain,date).length)}else{if(reset){return this.loadNextDomain(this.getDomain(firstDomain,date).length)}if(date>lastDomain){return this.loadNextDomain(this.getDomain(lastDomain,date).length)}}return!1},/**\n   * Navigate back to the start date\n   *\n   * @since  3.3.8\n   * @return void\n   */rewind:function(){\'use strict\';this.jumpTo(this.options.start,!0)},/**\n   * Update the calendar with new data\n   *\n   * @param  object|string    dataSource    The calendar\'s datasource, same type as this.options.data\n   * @param  boolean|function    afterLoad    Whether to execute afterLoad() on the data. Pass directly a function\n   * if you don\'t want to use the afterLoad() callback\n   */update:function(dataSource,afterLoad,updateMode){\'use strict\';if(0===arguments.length){dataSource=this.options.data}if(2>arguments.length){afterLoad=!0}if(3>arguments.length){updateMode=this.RESET_ALL_ON_UPDATE}var domains=this.getDomainKeys(),self=this;this.getDatas(dataSource,new Date(domains[0]),this.getSubDomain(domains[domains.length-1]).pop(),function(){self.fill();self.afterUpdate()},afterLoad,updateMode)},/**\n   * Set the legend\n   *\n   * @param array legend an array of integer, representing the different threshold value\n   * @param array colorRange an array of 2 hex colors, for the minimum and maximum colors\n   */setLegend:function(){\'use strict\';var oldLegend=this.options.legend.slice(0);if(1<=arguments.length&&Array.isArray(arguments[0])){this.options.legend=arguments[0]}if(2<=arguments.length){if(Array.isArray(arguments[1])&&2<=arguments[1].length){this.options.legendColors=[arguments[1][0],arguments[1][1]]}else{this.options.legendColors=arguments[1]}}if(0<arguments.length&&!arrayEquals(oldLegend,this.options.legend)||2<=arguments.length){this.Legend.buildColors();this.fill()}this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding)},/**\n   * Remove the legend\n   *\n   * @return bool False if there is no legend to remove\n   */removeLegend:function(){\'use strict\';if(!this.options.displayLegend){return!1}this.options.displayLegend=!1;this.Legend.remove();return!0},/**\n   * Display the legend\n   *\n   * @return bool False if the legend was already displayed\n   */showLegend:function(){\'use strict\';if(this.options.displayLegend){return!1}this.options.displayLegend=!0;this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding);return!0},/**\n   * Highlight dates\n   *\n   * Add a highlight class to a set of dates\n   *\n   * @since  3.3.5\n   * @param  array Array of dates to highlight\n   * @return bool True if dates were highlighted\n   */highlight:function(args){\'use strict\';if(0<(this.options.highlight=this.expandDateSetting(args)).length){this.fill();return!0}return!1},/**\n   * Destroy the calendar\n   *\n   * Usage: cal = cal.destroy();\n   *\n   * @since  3.3.6\n   * @param function A callback function to trigger after destroying the calendar\n   * @return null\n   */destroy:function(callback){\'use strict\';this.root.transition().duration(this.options.animationDuration).attr("width",0).attr("height",0).remove().each("end",function(){if("function"==typeof callback){callback()}else if("undefined"!=typeof callback){console.log("Provided callback for destroy() is not a function.")}});return null},getSVG:function(){\'use strict\';for(var styles={".cal-heatmap-container":{},".graph":{},".graph-rect":{},"rect.highlight":{},"rect.now":{},"rect.highlight-now":{},"text.highlight":{},"text.now":{},"text.highlight-now":{},".domain-background":{},".graph-label":{},".subdomain-text":{},".q0":{},".qi":{}},j=1,total=this.options.legend.length+1;j<=total;j+=1){styles[".q"+j]={}}var root=this.root,whitelistStyles=[// SVG specific properties\n"stroke","stroke-width","stroke-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-miterlimit","fill","fill-opacity","fill-rule","marker","marker-start","marker-mid","marker-end","alignement-baseline","baseline-shift","dominant-baseline","glyph-orientation-horizontal","glyph-orientation-vertical","kerning","text-anchor","shape-rendering",// Text Specific properties\n"text-transform","font-family","font","font-size","font-weight"],filterStyles=function(attribute,property,value){if(-1!==whitelistStyles.indexOf(property)){styles[attribute][property]=value}},getElement=function(e){return root.select(e)[0][0]};/* jshint forin:false */for(var element in styles){if(!styles.hasOwnProperty(element)){continue}var dom=getElement(element);if(null===dom){continue}// The DOM Level 2 CSS way\n/* jshint maxdepth: false */if("getComputedStyle"in window){var cs=getComputedStyle(dom,null);if(0!==cs.length){for(var i=0;i<cs.length;i+=1){filterStyles(element,cs.item(i),cs.getPropertyValue(cs.item(i)))}// Opera workaround. Opera doesn"t support `item`/`length`\n// on CSSStyleDeclaration.\n}else{for(var k in cs){if(cs.hasOwnProperty(k)){filterStyles(element,k,cs[k])}}}// The IE way\n}else if("currentStyle"in dom){var css=dom.currentStyle;for(var p in css){filterStyles(element,p,css[p])}}}var string="<svg xmlns=\\"http://www.w3.org/2000/svg\\" xmlns:xlink=\\"http://www.w3.org/1999/xlink\\"><style type=\\"text/css\\"><![CDATA[ ";for(var style in styles){string+=style+" {\\n";for(var l in styles[style]){string+="\\t"+l+":"+styles[style][l]+";\\n"}string+="}\\n"}string+="]]></style>";string+=new XMLSerializer().serializeToString(this.root[0][0]);string+="</svg>";return string}};// =========================================================================//\n// DOMAIN POSITION COMPUTATION                        //\n// =========================================================================//\n/**\n * Compute the position of a domain, relative to the calendar\n */var DomainPosition=function(){\'use strict\';this.positions=d3.map()};DomainPosition.prototype.getPosition=function(d){\'use strict\';return this.positions.get(d)};DomainPosition.prototype.getPositionFromIndex=function(i){\'use strict\';var domains=this.getKeys();return this.positions.get(domains[i])};DomainPosition.prototype.getLast=function(){\'use strict\';var domains=this.getKeys();return this.positions.get(domains[domains.length-1])};DomainPosition.prototype.setPosition=function(d,dim){\'use strict\';this.positions.set(d,dim)};DomainPosition.prototype.shiftRightBy=function(exitingDomainDim){\'use strict\';this.positions.forEach(function(key,value){this.set(key,value-exitingDomainDim)});var domains=this.getKeys();this.positions.remove(domains[0])};DomainPosition.prototype.shiftLeftBy=function(enteringDomainDim){\'use strict\';this.positions.forEach(function(key,value){this.set(key,value+enteringDomainDim)});var domains=this.getKeys();this.positions.remove(domains[domains.length-1])};DomainPosition.prototype.getKeys=function(){\'use strict\';return this.positions.keys().sort(function(a,b){return parseInt(a,10)-parseInt(b,10)})};// =========================================================================//\n// LEGEND                                  //\n// =========================================================================//\nvar Legend=function(calendar){\'use strict\';this.calendar=calendar;this.computeDim();if(null!==calendar.options.legendColors){this.buildColors()}};Legend.prototype.computeDim=function(){\'use strict\';var options=this.calendar.options;// Shorter accessor for variable name mangling when minifying\nthis.dim={width:options.legendCellSize*(options.legend.length+1)+options.legendCellPadding*options.legend.length,height:options.legendCellSize}};Legend.prototype.remove=function(){\'use strict\';this.calendar.root.select(".graph-legend").remove();this.calendar.resize()};Legend.prototype.redraw=function(width){\'use strict\';if(!this.calendar.options.displayLegend){return!1}var parent=this,calendar=this.calendar,legend=calendar.root,legendItem,options=calendar.options;// Shorter accessor for variable name mangling when minifying\nthis.computeDim();var _legend=options.legend.slice(0);_legend.push(_legend[_legend.length-1]+1);var legendElement=calendar.root.select(".graph-legend");if(null!==legendElement[0][0]){legend=legendElement;legendItem=legend.select("g").selectAll("rect").data(_legend)}else{// Creating the new legend DOM if it doesn\'t already exist\nlegend="top"===options.legendVerticalPosition?legend.insert("svg",".graph"):legend.append("svg");legend.attr("x",getLegendXPosition()).attr("y",getLegendYPosition());legendItem=legend.attr("class","graph-legend").attr("height",parent.getDim("height")).attr("width",parent.getDim("width")).append("g").selectAll().data(_legend)}legendItem.enter().append("rect").call(legendCellLayout).attr("class",function(d){return calendar.Legend.getClass(d,null===calendar.legendScale)}).attr("fill-opacity",0).call(function(selection){if(null!==calendar.legendScale&&null!==options.legendColors&&options.legendColors.hasOwnProperty("base")){selection.attr("fill",options.legendColors.base)}}).append("title");legendItem.exit().transition().duration(options.animationDuration).attr("fill-opacity",0).remove();legendItem.transition().delay(function(d,i){return options.animationDuration*i/10}).call(legendCellLayout).attr("fill-opacity",1).call(function(element){element.attr("fill",function(d,i){if(null===calendar.legendScale){return""}if(0===i){return calendar.legendScale(d-1)}return calendar.legendScale(options.legend[i-1])});element.attr("class",function(d){return calendar.Legend.getClass(d,null===calendar.legendScale)})});function legendCellLayout(selection){selection.attr("width",options.legendCellSize).attr("height",options.legendCellSize).attr("rx",options.legendCellRadius).attr("ry",options.legendCellRadius).attr("x",function(d,i){return i*(options.legendCellSize+options.legendCellPadding)})}legendItem.select("title").text(function(d,i){if(0===i){return calendar.formatStringWithObject(options.legendTitleFormat.lower,{min:options.legend[i],name:options.itemName[1]})}else if(i===_legend.length-1){return calendar.formatStringWithObject(options.legendTitleFormat.upper,{max:options.legend[i-1],name:options.itemName[1]})}else{return calendar.formatStringWithObject(options.legendTitleFormat.inner,{down:options.legend[i-1],up:options.legend[i],name:options.itemName[1]})}});legendItem.on("mouseover",function(d){calendar.legendTip.show(d,this)}).on("mouseout",function(){calendar.legendTip.hide()});legend.transition().duration(options.animationDuration).attr("x",getLegendXPosition()).attr("y",getLegendYPosition()).attr("width",parent.getDim("width")).attr("height",parent.getDim("height"));legend.select("g").transition().duration(options.animationDuration).attr("transform",function(){if("vertical"===options.legendOrientation){return"rotate(90 "+options.legendCellSize/2+" "+options.legendCellSize/2+")"}return""});function getLegendXPosition(){switch(options.legendHorizontalPosition){case"right":if("center"===options.legendVerticalPosition||"middle"===options.legendVerticalPosition){return width+options.legendMargin[3]}return width-parent.getDim("width")-options.legendMargin[1];case"middle":case"center":return Math.round(width/2-parent.getDim("width")/2);default:return options.legendMargin[3];}}function getLegendYPosition(){if("bottom"===options.legendVerticalPosition){return calendar.graphDim.height+options.legendMargin[0]-options.domainGutter-options.cellPadding}return options.legendMargin[0]}calendar.resize()};/**\n * Return the dimension of the legend\n *\n * Takes into account rotation\n *\n * @param  string axis Width or height\n * @return int height or width in pixels\n */Legend.prototype.getDim=function(axis){\'use strict\';var isHorizontal="horizontal"===this.calendar.options.legendOrientation;switch(axis){case"width":return this.dim[isHorizontal?"width":"height"];case"height":return this.dim[isHorizontal?"height":"width"];}};Legend.prototype.buildColors=function(){\'use strict\';var options=this.calendar.options;// Shorter accessor for variable name mangling when minifying\nif(null===options.legendColors){this.calendar.legendScale=null;return!1}var _colorRange=[];if(Array.isArray(options.legendColors)){_colorRange=options.legendColors}else if(options.legendColors.hasOwnProperty("min")&&options.legendColors.hasOwnProperty("max")){_colorRange=[options.legendColors.min,options.legendColors.max]}else{options.legendColors=null;return!1}var _legend=options.legend.slice(0);if(0<_legend[0]){_legend.unshift(0)}else if(0>=_legend[0]){// Let\'s guess the leftmost value, it we have to add one\n_legend.unshift(_legend[0]-(_legend[_legend.length-1]-_legend[0])/_legend.length)}var colorScale;if(options.legendColors.hasOwnProperty("colorScale")){colorScale=options.legendColors.colorScale}else{colorScale=d3.scale.linear().range(_colorRange).interpolate(d3.interpolateHcl).domain([d3.min(_legend),d3.max(_legend)])}var legendColors=_legend.map(function(element){return colorScale(element)});this.calendar.legendScale=d3.scale.threshold().domain(options.legend).range(legendColors);return!0};/**\n * Return the classname on the legend for the specified value\n *\n * @param integer n Value associated to a date\n * @param bool withCssClass Whether to display the css class used to style the cell.\n *                          Disabling will allow styling directly via html fill attribute\n *\n * @return string Classname according to the legend\n */Legend.prototype.getClass=function(n,withCssClass){\'use strict\';if(null===n||isNaN(n)){return""}for(var index=[this.calendar.options.legend.length+1],i=0,total=this.calendar.options.legend.length-1;i<=total;i+=1){if(0<this.calendar.options.legend[0]&&0>n){index=["1","i"];break}if(n<=this.calendar.options.legend[i]){index=[i+1];break}}if(0===n){index.push(0)}index.unshift("");return(index.join(" r")+(withCssClass?index.join(" q"):"")).trim()};/**\n * #source http://stackoverflow.com/a/383245/805649\n */function mergeRecursive(obj1,obj2){\'use strict\';/*jshint forin:false */for(var p in obj2){try{// Property in destination object set; update its value.\nif(obj2[p].constructor===Object){obj1[p]=mergeRecursive(obj1[p],obj2[p])}else{obj1[p]=obj2[p]}}catch(e){// Property in destination object not set; create it and set its value.\nobj1[p]=obj2[p]}}return obj1}/**\n * Check if 2 arrays are equals\n *\n * @link http://stackoverflow.com/a/14853974/805649\n * @param  array array the array to compare to\n * @return bool true of the 2 arrays are equals\n */function arrayEquals(arrayA,arrayB){\'use strict\';// if the other array is a falsy value, return\nif(!arrayB||!arrayA){return!1}// compare lengths - can save a lot of time\nif(arrayA.length!==arrayB.length){return!1}for(var i=0;i<arrayA.length;i+=1){// Check if we have nested arrays\nif(arrayA[i]instanceof Array&&arrayB[i]instanceof Array){// recurse into the nested arrays\nif(!arrayEquals(arrayA[i],arrayB[i])){return!1}}else if(arrayA[i]!==arrayB[i]){// Warning - two different object instances will never be equal: {x:20} != {x:20}\nreturn!1}}return!0}/* harmony default export */ var cal_heatmap = (CalHeatMap);\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.css\nvar vendor_cal_heatmap = __webpack_require__(2245);\n\n// CONCATENATED MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/plugins/legacy-plugin-chart-calendar/src/Calendar.js\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */function convertUTC(dttm){return new Date(dttm.getUTCFullYear(),dttm.getUTCMonth(),dttm.getUTCDate(),dttm.getUTCHours(),dttm.getUTCMinutes(),dttm.getUTCSeconds())}const convertUTCTS=uts=>convertUTC(new Date(uts)).getTime(),propTypes={data:prop_types_default.a.shape({// Object hashed by metric name,\n// then hashed by timestamp (in seconds, not milliseconds) as float\n// the innermost value is count\n// e.g. { count_distinct_something: { 1535034236.0: 3 } }\ndata:prop_types_default.a.object,domain:prop_types_default.a.string,range:prop_types_default.a.number,// timestamp in milliseconds\nstart:prop_types_default.a.number,subdomain:prop_types_default.a.string}),height:prop_types_default.a.number,// eslint-disable-next-line react/sort-prop-types\ncellPadding:prop_types_default.a.number,// eslint-disable-next-line react/sort-prop-types\ncellRadius:prop_types_default.a.number,// eslint-disable-next-line react/sort-prop-types\ncellSize:prop_types_default.a.number,linearColorScheme:prop_types_default.a.string,showLegend:prop_types_default.a.bool,showMetricName:prop_types_default.a.bool,showValues:prop_types_default.a.bool,steps:prop_types_default.a.number,timeFormat:prop_types_default.a.string,valueFormat:prop_types_default.a.string,verboseMap:prop_types_default.a.object};function Calendar(element,props){const{data,height,cellPadding=3,cellRadius=0,cellSize=10,domainGranularity,linearColorScheme,showLegend,showMetricName,showValues,steps,subdomainGranularity,timeFormat,valueFormat,verboseMap}=props,valueFormatter=Object(NumberFormatterRegistrySingleton["c" /* getNumberFormatter */])(valueFormat),timeFormatter=Object(TimeFormatterRegistrySingleton["d" /* getTimeFormatter */])(timeFormat),container=Object(src_select["a" /* default */])(element).classed("superset-legacy-chart-calendar",!0).style("height",height);container.selectAll("*").remove();const div=container.append("div"),subDomainTextFormat=showValues?(date,value)=>valueFormatter(value):null,metricsData={};Object.keys(data.data).forEach(metric=>{metricsData[metric]={};Object.keys(data.data[metric]).forEach(ts=>{metricsData[metric][convertUTCTS(1e3*ts)/1e3]=data.data[metric][ts]})});Object.keys(metricsData).forEach(metric=>{const calContainer=div.append("div");if(showMetricName){calContainer.text(`Metric: ${verboseMap[metric]||metric}`)}const timestamps=metricsData[metric],extents=extent(Object.keys(timestamps),key=>timestamps[key]),step=(extents[1]-extents[0])/(steps-1),colorScale=Object(SequentialSchemeRegistrySingleton["a" /* default */])().get(linearColorScheme).createLinearScale(extents),legend=range(steps).map(i=>extents[0]+step*i),legendColors=legend.map(x=>colorScale(x)),cal=new cal_heatmap;cal.init({start:convertUTCTS(data.start),data:timestamps,itemSelector:calContainer.node(),legendVerticalPosition:"top",cellSize,cellPadding,cellRadius,legendCellSize:cellSize,legendCellPadding:2,legendCellRadius:cellRadius,tooltip:!0,domain:domainGranularity,subDomain:subdomainGranularity,range:data.range,browsing:!0,legend,legendColors:{colorScale,min:legendColors[0],max:legendColors[legendColors.length-1],empty:"white"},displayLegend:showLegend,itemName:"",valueFormatter,timeFormatter,subDomainTextFormat})})}Calendar.displayName="Calendar";Calendar.propTypes=propTypes;/* harmony default export */ var src_Calendar = (Calendar);\n// CONCATENATED MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/plugins/legacy-plugin-chart-calendar/src/ReactCalendar.jsx\nfunction _objectWithoutProperties(source,excluded){if(null==source)return{};var target=_objectWithoutPropertiesLoose(source,excluded),key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(0<=excluded.indexOf(key))continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key]}}return target}function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var target={},sourceKeys=Object.keys(source),key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(0<=excluded.indexOf(key))continue;target[key]=source[key]}return target}/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */const ReactComponent=Object(reactify["a" /* default */])(src_Calendar),Calender=(_ref)=>{let{className}=_ref,otherProps=_objectWithoutProperties(_ref,["className"]);return/*#__PURE__*/react_default.a.createElement("div",{className:className},/*#__PURE__*/react_default.a.createElement(ReactComponent,otherProps))};Calender.displayName="Calender";Calender.defaultProps={otherProps:{}};Calender.propTypes={className:prop_types_default.a.string.isRequired,otherProps:prop_types_default.a.objectOf(prop_types_default.a.any)};/* harmony default export */ var ReactCalendar = __webpack_exports__["default"] = (Object(style["c" /* styled */])(Calender)`\n  .superset-legacy-chart-calendar {\n    padding: 10px;\n    position: static !important;\n    overflow: auto !important;\n  }\n\n  .superset-legacy-chart-calendar .ch-tooltip {\n    margin-left: 20px;\n    margin-top: 5px;\n  }\n`);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjUxNi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8vVXNlcnMvZXJpa19yaXR0ZXIvcmVwb3MvZ2l0aHViLmNvbS9hcGFjaGUtc3VwZXJzZXQvc3VwZXJzZXQtdWkvcGx1Z2lucy9sZWdhY3ktcGx1Z2luLWNoYXJ0LWNhbGVuZGFyL25vZGVfbW9kdWxlcy9kMy1hcnJheS9zcmMvZXh0ZW50LmpzPzllZDYiLCJ3ZWJwYWNrOi8vLy9Vc2Vycy9lcmlrX3JpdHRlci9yZXBvcy9naXRodWIuY29tL2FwYWNoZS1zdXBlcnNldC9zdXBlcnNldC11aS9wbHVnaW5zL2xlZ2FjeS1wbHVnaW4tY2hhcnQtY2FsZW5kYXIvbm9kZV9tb2R1bGVzL2QzLWFycmF5L3NyYy9yYW5nZS5qcz83NzVhIiwid2VicGFjazovLy8vVXNlcnMvZXJpa19yaXR0ZXIvcmVwb3MvZ2l0aHViLmNvbS9hcGFjaGUtc3VwZXJzZXQvc3VwZXJzZXQtdWkvcGx1Z2lucy9sZWdhY3ktcGx1Z2luLWNoYXJ0LWNhbGVuZGFyL3NyYy92ZW5kb3IvY2FsLWhlYXRtYXAuanM/NGE2MiIsIndlYnBhY2s6Ly8vL1VzZXJzL2VyaWtfcml0dGVyL3JlcG9zL2dpdGh1Yi5jb20vYXBhY2hlLXN1cGVyc2V0L3N1cGVyc2V0LXVpL3BsdWdpbnMvbGVnYWN5LXBsdWdpbi1jaGFydC1jYWxlbmRhci9zcmMvQ2FsZW5kYXIuanM/ODg0ZiIsIndlYnBhY2s6Ly8vL1VzZXJzL2VyaWtfcml0dGVyL3JlcG9zL2dpdGh1Yi5jb20vYXBhY2hlLXN1cGVyc2V0L3N1cGVyc2V0LXVpL3BsdWdpbnMvbGVnYWN5LXBsdWdpbi1jaGFydC1jYWxlbmRhci9zcmMvUmVhY3RDYWxlbmRhci5qc3g/ODQ1NyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbih2YWx1ZXMsIHZhbHVlb2YpIHtcbiAgbGV0IG1pbjtcbiAgbGV0IG1heDtcbiAgaWYgKHZhbHVlb2YgPT09IHVuZGVmaW5lZCkge1xuICAgIGZvciAoY29uc3QgdmFsdWUgb2YgdmFsdWVzKSB7XG4gICAgICBpZiAodmFsdWUgIT0gbnVsbCkge1xuICAgICAgICBpZiAobWluID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBpZiAodmFsdWUgPj0gdmFsdWUpIG1pbiA9IG1heCA9IHZhbHVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChtaW4gPiB2YWx1ZSkgbWluID0gdmFsdWU7XG4gICAgICAgICAgaWYgKG1heCA8IHZhbHVlKSBtYXggPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBsZXQgaW5kZXggPSAtMTtcbiAgICBmb3IgKGxldCB2YWx1ZSBvZiB2YWx1ZXMpIHtcbiAgICAgIGlmICgodmFsdWUgPSB2YWx1ZW9mKHZhbHVlLCArK2luZGV4LCB2YWx1ZXMpKSAhPSBudWxsKSB7XG4gICAgICAgIGlmIChtaW4gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGlmICh2YWx1ZSA+PSB2YWx1ZSkgbWluID0gbWF4ID0gdmFsdWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKG1pbiA+IHZhbHVlKSBtaW4gPSB2YWx1ZTtcbiAgICAgICAgICBpZiAobWF4IDwgdmFsdWUpIG1heCA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBbbWluLCBtYXhdO1xufVxuIiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24oc3RhcnQsIHN0b3AsIHN0ZXApIHtcbiAgc3RhcnQgPSArc3RhcnQsIHN0b3AgPSArc3RvcCwgc3RlcCA9IChuID0gYXJndW1lbnRzLmxlbmd0aCkgPCAyID8gKHN0b3AgPSBzdGFydCwgc3RhcnQgPSAwLCAxKSA6IG4gPCAzID8gMSA6ICtzdGVwO1xuXG4gIHZhciBpID0gLTEsXG4gICAgICBuID0gTWF0aC5tYXgoMCwgTWF0aC5jZWlsKChzdG9wIC0gc3RhcnQpIC8gc3RlcCkpIHwgMCxcbiAgICAgIHJhbmdlID0gbmV3IEFycmF5KG4pO1xuXG4gIHdoaWxlICgrK2kgPCBuKSB7XG4gICAgcmFuZ2VbaV0gPSBzdGFydCArIGkgKiBzdGVwO1xuICB9XG5cbiAgcmV0dXJuIHJhbmdlO1xufVxuIiwiLy8gW0xJQ0VOU0UgVEJEXVxuLyogQ29waWVkIGFuZCBhbHRlcmVkIGZyb20gaHR0cDovL2NhbC1oZWF0bWFwLmNvbS8gLCBhbHRlcmF0aW9ucyBhcm91bmQ6XG4gKiAtIHR1bmluZyB0b29sdGlwc1xuICogLSBzdXBwb3J0aW5nIG11bHRpLWNvbG9ycyBzY2FsZXNcbiAqIC0gbGVnZW5kIGZvcm1hdFxuICogLSBVVEMgaGFuZGxpbmdcbiAqL1xuXG4vKiBlc2xpbnQtZGlzYWJsZSAqL1xuXG5pbXBvcnQgZDN0aXAgZnJvbSAnZDMtdGlwJztcbmltcG9ydCAnLi9kM3RpcC5jc3MnO1xuXG52YXIgZDMgPSB0eXBlb2YgcmVxdWlyZSA9PT0gJ2Z1bmN0aW9uJyA/IHJlcXVpcmUoJ2QzJykgOiB3aW5kb3cuZDM7XG5cbnZhciBkMyA9IHR5cGVvZiByZXF1aXJlID09PSAnZnVuY3Rpb24nID8gcmVxdWlyZSgnZDMnKSA6IHdpbmRvdy5kMztcblxudmFyIENhbEhlYXRNYXAgPSBmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHNlbGYudGlwID0gZDN0aXAoKVxuICAgIC5hdHRyKCdjbGFzcycsICdkMy10aXAnKVxuICAgIC5kaXJlY3Rpb24oJ24nKVxuICAgIC5vZmZzZXQoWy01LCAwXSlcbiAgICAuaHRtbChcbiAgICAgIGQgPT4gYFxuICAgICAgJHtzZWxmLm9wdGlvbnMudGltZUZvcm1hdHRlcihkLnQpfTogPHN0cm9uZz4ke3NlbGYub3B0aW9ucy52YWx1ZUZvcm1hdHRlcihkLnYpfTwvc3Ryb25nPlxuICAgIGAsXG4gICAgKTtcbiAgc2VsZi5sZWdlbmRUaXAgPSBkM3RpcCgpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ2QzLXRpcCcpXG4gICAgLmRpcmVjdGlvbignbicpXG4gICAgLm9mZnNldChbLTUsIDBdKVxuICAgIC5odG1sKGQgPT4gc2VsZi5vcHRpb25zLnZhbHVlRm9ybWF0dGVyKGQpKTtcblxuICB0aGlzLmFsbG93ZWREYXRhVHlwZSA9IFsnanNvbicsICdjc3YnLCAndHN2JywgJ3R4dCddO1xuXG4gIC8vIERlZmF1bHQgc2V0dGluZ3NcbiAgdGhpcy5vcHRpb25zID0ge1xuICAgIC8vIHNlbGVjdG9yIHN0cmluZyBvZiB0aGUgY29udGFpbmVyIHRvIGFwcGVuZCB0aGUgZ3JhcGggdG9cbiAgICAvLyBBY2NlcHQgYW55IHN0cmluZyB2YWx1ZSBhY2NlcHRlZCBieSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIG9yIENTUzNcbiAgICAvLyBvciBhbiBFbGVtZW50IG9iamVjdFxuICAgIGl0ZW1TZWxlY3RvcjogJyNjYWwtaGVhdG1hcCcsXG5cbiAgICAvLyBXaGV0aGVyIHRvIHBhaW50IHRoZSBjYWxlbmRhciBvbiBpbml0KClcbiAgICAvLyBVc2VkIGJ5IHRlc3RzdWl0ZSB0byByZWR1Y2UgdGVzdGluZyB0aW1lXG4gICAgcGFpbnRPbkxvYWQ6IHRydWUsXG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyBET01BSU5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAgIC8vIE51bWJlciBvZiBkb21haW4gdG8gZGlzcGxheSBvbiB0aGUgZ3JhcGhcbiAgICByYW5nZTogMTIsXG5cbiAgICAvLyBTaXplIG9mIGVhY2ggY2VsbCwgaW4gcGl4ZWxcbiAgICBjZWxsU2l6ZTogMTAsXG5cbiAgICAvLyBQYWRkaW5nIGJldHdlZW4gZWFjaCBjZWxsLCBpbiBwaXhlbFxuICAgIGNlbGxQYWRkaW5nOiAyLFxuXG4gICAgLy8gRm9yIHJvdW5kZWQgc3ViZG9tYWluIHJlY3RhbmdsZXMsIGluIHBpeGVsc1xuICAgIGNlbGxSYWRpdXM6IDAsXG5cbiAgICBkb21haW5HdXR0ZXI6IDIsXG5cbiAgICBkb21haW5NYXJnaW46IFswLCAwLCAwLCAwXSxcblxuICAgIHZhbHVlRm9ybWF0dGVyOiBkID0+IGQsXG5cbiAgICB0aW1lRm9ybWF0dGVyOiBkID0+IGQsXG5cbiAgICBkb21haW46ICdob3VyJyxcblxuICAgIHN1YkRvbWFpbjogJ21pbicsXG5cbiAgICAvLyBOdW1iZXIgb2YgY29sdW1ucyB0byBzcGxpdCB0aGUgc3ViRG9tYWlucyB0b1xuICAgIC8vIElmIG5vdCBudWxsLCB3aWxsIHRha2VzIHByZWNlZGVuY2Ugb3ZlciByb3dMaW1pdFxuICAgIGNvbExpbWl0OiBudWxsLFxuXG4gICAgLy8gTnVtYmVyIG9mIHJvd3MgdG8gc3BsaXQgdGhlIHN1YkRvbWFpbnMgdG9cbiAgICAvLyBXaWxsIGJlIGlnbm9yZWQgaWYgY29sTGltaXQgaXMgbm90IG51bGxcbiAgICByb3dMaW1pdDogbnVsbCxcblxuICAgIC8vIEZpcnN0IGRheSBvZiB0aGUgd2VlayBpcyBNb25kYXlcbiAgICAvLyAwIHRvIHN0YXJ0IHRoZSB3ZWVrIG9uIFN1bmRheVxuICAgIHdlZWtTdGFydE9uTW9uZGF5OiB0cnVlLFxuXG4gICAgLy8gU3RhcnQgZGF0ZSBvZiB0aGUgZ3JhcGhcbiAgICAvLyBAZGVmYXVsdCBub3dcbiAgICBzdGFydDogbmV3IERhdGUoKSxcblxuICAgIG1pbkRhdGU6IG51bGwsXG5cbiAgICBtYXhEYXRlOiBudWxsLFxuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gREFUQVxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gICAgLy8gRGF0YSBzb3VyY2VcbiAgICAvLyBVUkwsIHdoZXJlIHRvIGZldGNoIHRoZSBvcmlnaW5hbCBkYXRhc1xuICAgIGRhdGE6ICcnLFxuXG4gICAgLy8gRGF0YSB0eXBlXG4gICAgLy8gRGVmYXVsdDoganNvblxuICAgIGRhdGFUeXBlOiB0aGlzLmFsbG93ZWREYXRhVHlwZVswXSxcblxuICAgIC8vIFBheWxvYWQgc2VudCB3aGVuIHVzaW5nIFBPU1QgaHR0cCBtZXRob2RcbiAgICAvLyBMZWF2ZSB0byBudWxsIChkZWZhdWx0KSBmb3IgR0VUIHJlcXVlc3RcbiAgICAvLyBFeHBlY3QgYSBzdHJpbmcsIGZvcm1hdHRlZCBsaWtlIFwiYT1iO2M9ZFwiXG4gICAgZGF0YVBvc3RQYXlsb2FkOiBudWxsLFxuXG4gICAgLy8gQWRkaXRpb25hbCBoZWFkZXJzIHNlbnQgd2hlbiByZXF1ZXN0aW5nIGRhdGFcbiAgICAvLyBFeHBlY3QgYW4gb2JqZWN0IGZvcm1hdHRlZCBsaWtlOlxuICAgIC8vIHsgJ1gtQ1NSRi1UT0tFTic6ICd0b2tlbicgfVxuICAgIGRhdGFSZXF1ZXN0SGVhZGVyczogbnVsbCxcblxuICAgIC8vIFdoZXRoZXIgdG8gY29uc2lkZXIgbWlzc2luZyBkYXRlOnZhbHVlIGZyb20gdGhlIGRhdGFzb3VyY2VcbiAgICAvLyBhcyBlcXVhbCB0byAwLCBvciBqdXN0IGxlYXZlIHRoZW0gYXMgbWlzc2luZ1xuICAgIGNvbnNpZGVyTWlzc2luZ0RhdGFBc1plcm86IGZhbHNlLFxuXG4gICAgLy8gTG9hZCByZW1vdGUgZGF0YSBvbiBjYWxlbmRhciBjcmVhdGlvblxuICAgIC8vIFdoZW4gZmFsc2UsIHRoZSBjYWxlbmRhciB3aWxsIGJlIGxlZnQgZW1wdHlcbiAgICBsb2FkT25Jbml0OiB0cnVlLFxuXG4gICAgLy8gQ2FsZW5kYXIgb3JpZW50YXRpb25cbiAgICAvLyBmYWxzZTogZGlzcGxheSBkb21haW5zIHNpZGUgYnkgc2lkZVxuICAgIC8vIHRydWUgOiBkaXNwbGF5IGRvbWFpbnMgb25lIHVuZGVyIHRoZSBvdGhlclxuICAgIHZlcnRpY2FsT3JpZW50YXRpb246IGZhbHNlLFxuXG4gICAgLy8gRG9tYWluIGR5bmFtaWMgd2lkdGgvaGVpZ2h0XG4gICAgLy8gVGhlIHdpZHRoIG9uIGEgZG9tYWluIGRlcGVuZHMgb24gdGhlIG51bWJlciBvZlxuICAgIGRvbWFpbkR5bmFtaWNEaW1lbnNpb246IHRydWUsXG5cbiAgICAvLyBEb21haW4gTGFiZWwgcHJvcGVydGllc1xuICAgIGxhYmVsOiB7XG4gICAgICAvLyB2YWxpZDogdG9wLCByaWdodCwgYm90dG9tLCBsZWZ0XG4gICAgICBwb3NpdGlvbjogJ2JvdHRvbScsXG5cbiAgICAgIC8vIFZhbGlkOiBsZWZ0LCBjZW50ZXIsIHJpZ2h0XG4gICAgICAvLyBBbHNvIHZhbGlkIGFyZSB0aGUgZGlyZWN0IHN2ZyB2YWx1ZXM6IHN0YXJ0LCBtaWRkbGUsIGVuZFxuICAgICAgYWxpZ246ICdjZW50ZXInLFxuXG4gICAgICAvLyBCeSBkZWZhdWx0LCB0aGVyZSBpcyBubyBtYXJnaW4vcGFkZGluZyBhcm91bmQgdGhlIGxhYmVsXG4gICAgICBvZmZzZXQ6IHtcbiAgICAgICAgeDogMCxcbiAgICAgICAgeTogMCxcbiAgICAgIH0sXG5cbiAgICAgIHJvdGF0ZTogbnVsbCxcblxuICAgICAgLy8gVXNlZCBvbmx5IG9uIHZlcnRpY2FsIG9yaWVudGF0aW9uXG4gICAgICB3aWR0aDogMTAwLFxuXG4gICAgICAvLyBVc2VkIG9ubHkgb24gaG9yaXpvbnRhbCBvcmllbnRhdGlvblxuICAgICAgaGVpZ2h0OiBudWxsLFxuICAgIH0sXG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyBMRUdFTkRcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAgIC8vIFRocmVzaG9sZCBmb3IgdGhlIGxlZ2VuZFxuICAgIGxlZ2VuZDogWzEwLCAyMCwgMzAsIDQwXSxcblxuICAgIC8vIFdoZXRoZXIgdG8gZGlzcGxheSB0aGUgbGVnZW5kXG4gICAgZGlzcGxheUxlZ2VuZDogdHJ1ZSxcblxuICAgIGxlZ2VuZENlbGxTaXplOiAxMCxcblxuICAgIGxlZ2VuZENlbGxQYWRkaW5nOiAyLFxuXG4gICAgbGVnZW5kTWFyZ2luOiBbMCwgMCwgMCwgMF0sXG5cbiAgICAvLyBMZWdlbmQgdmVydGljYWwgcG9zaXRpb25cbiAgICAvLyB0b3A6IHBsYWNlIGxlZ2VuZCBhYm92ZSBjYWxlbmRhclxuICAgIC8vIGJvdHRvbTogcGxhY2UgbGVnZW5kIGJlbG93IHRoZSBjYWxlbmRhclxuICAgIGxlZ2VuZFZlcnRpY2FsUG9zaXRpb246ICdib3R0b20nLFxuXG4gICAgLy8gTGVnZW5kIGhvcml6b250YWwgcG9zaXRpb25cbiAgICAvLyBhY2NlcHRlZCB2YWx1ZXM6IGxlZnQsIGNlbnRlciwgcmlnaHRcbiAgICBsZWdlbmRIb3Jpem9udGFsUG9zaXRpb246ICdsZWZ0JyxcblxuICAgIC8vIExlZ2VuZCByb3RhdGlvblxuICAgIC8vIGFjY2VwdGVkIHZhbHVlczogaG9yaXpvbnRhbCwgdmVydGljYWxcbiAgICBsZWdlbmRPcmllbnRhdGlvbjogJ2hvcml6b250YWwnLFxuXG4gICAgLy8gT2JqZWN0cyBob2xkaW5nIGFsbCB0aGUgaGVhdG1hcCBkaWZmZXJlbnQgY29sb3JzXG4gICAgLy8gbnVsbCB0byBkaXNhYmxlLCBhbmQgdXNlIHRoZSBkZWZhdWx0IGNzcyBzdHlsZXNcbiAgICAvL1xuICAgIC8vIEV4YW1wbGVzOlxuICAgIC8vIGxlZ2VuZENvbG9yczoge1xuICAgIC8vICAgIG1pbjogXCJncmVlblwiLFxuICAgIC8vICAgIG1heDogXCJyZWRcIixcbiAgICAvLyAgICBlbXB0eTogXCIjZmZmZmZmXCIsXG4gICAgLy8gICAgYmFzZTogXCJncmV5XCIsXG4gICAgLy8gICAgb3ZlcmZsb3c6IFwicmVkXCIsXG4gICAgLy8gICAgY29sb3JTY2FsZXI6IG51bGwsXG4gICAgLy8gfVxuICAgIGxlZ2VuZENvbG9yczogbnVsbCxcblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vIEhJR0hMSUdIVFxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gICAgLy8gTGlzdCBvZiBkYXRlcyB0byBoaWdobGlnaHRcbiAgICAvLyBWYWxpZCB2YWx1ZXM6XG4gICAgLy8gLSBbXTogZG9uJ3QgaGlnaGxpZ2h0IGFueXRoaW5nXG4gICAgLy8gLSBcIm5vd1wiOiBoaWdobGlnaHQgdGhlIGN1cnJlbnQgZGF0ZVxuICAgIC8vIC0gYW4gYXJyYXkgb2YgRGF0ZSBvYmplY3RzOiBoaWdobGlnaHQgdGhlIHNwZWNpZmllZCBkYXRlc1xuICAgIGhpZ2hsaWdodDogW10sXG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyBURVhUIEZPUk1BVFRJTkcgLyBpMThuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgICAvLyBOYW1lIG9mIHRoZSBpdGVtcyB0byByZXByZXNlbnQgaW4gdGhlIGNhbGVuZGFyXG4gICAgaXRlbU5hbWU6IFsnaXRlbScsICdpdGVtcyddLFxuXG4gICAgLy8gRm9ybWF0dGluZyBvZiB0aGUgZG9tYWluIGxhYmVsXG4gICAgLy8gQGRlZmF1bHQ6IG51bGwsIHdpbGwgdXNlIHRoZSBmb3JtYXR0aW5nIGFjY29yZGluZyB0byBkb21haW4gdHlwZVxuICAgIC8vIEFjY2VwdCBhIHN0cmluZyB1c2VkIGFzIHNwZWNpZmllciBieSBkMy50aW1lLmZvcm1hdCgpXG4gICAgLy8gb3IgYSBmdW5jdGlvblxuICAgIC8vXG4gICAgLy8gUmVmZXIgdG8gaHR0cHM6Ly9naXRodWIuY29tL21ib3N0b2NrL2QzL3dpa2kvVGltZS1Gb3JtYXR0aW5nXG4gICAgLy8gZm9yIGFjY2VwdGVkIGRhdGUgZm9ybWF0dGluZyB1c2VkIGJ5IGQzLnRpbWUuZm9ybWF0KClcbiAgICBkb21haW5MYWJlbEZvcm1hdDogbnVsbCxcblxuICAgIC8vIEZvcm1hdHRpbmcgb2YgdGhlIHRpdGxlIGRpc3BsYXllZCB3aGVuIGhvdmVyaW5nIGEgc3ViRG9tYWluIGNlbGxcbiAgICBzdWJEb21haW5UaXRsZUZvcm1hdDoge1xuICAgICAgZW1wdHk6ICd7ZGF0ZX0nLFxuICAgICAgZmlsbGVkOiAne2NvdW50fSB7bmFtZX0ge2Nvbm5lY3Rvcn0ge2RhdGV9JyxcbiAgICB9LFxuXG4gICAgLy8gRm9ybWF0dGluZyBvZiB0aGUge2RhdGV9IHVzZWQgaW4gc3ViRG9tYWluVGl0bGVGb3JtYXRcbiAgICAvLyBAZGVmYXVsdDogbnVsbCwgd2lsbCB1c2UgdGhlIGZvcm1hdHRpbmcgYWNjb3JkaW5nIHRvIHN1YkRvbWFpbiB0eXBlXG4gICAgLy8gQWNjZXB0IGEgc3RyaW5nIHVzZWQgYXMgc3BlY2lmaWVyIGJ5IGQzLnRpbWUuZm9ybWF0KClcbiAgICAvLyBvciBhIGZ1bmN0aW9uXG4gICAgLy9cbiAgICAvLyBSZWZlciB0byBodHRwczovL2dpdGh1Yi5jb20vbWJvc3RvY2svZDMvd2lraS9UaW1lLUZvcm1hdHRpbmdcbiAgICAvLyBmb3IgYWNjZXB0ZWQgZGF0ZSBmb3JtYXR0aW5nIHVzZWQgYnkgZDMudGltZS5mb3JtYXQoKVxuICAgIHN1YkRvbWFpbkRhdGVGb3JtYXQ6IG51bGwsXG5cbiAgICAvLyBGb3JtYXR0aW5nIG9mIHRoZSB0ZXh0IGluc2lkZSBlYWNoIHN1YkRvbWFpbiBjZWxsXG4gICAgLy8gQGRlZmF1bHQ6IG51bGwsIG5vIHRleHRcbiAgICAvLyBBY2NlcHQgYSBzdHJpbmcgdXNlZCBhcyBzcGVjaWZpZXIgYnkgZDMudGltZS5mb3JtYXQoKVxuICAgIC8vIG9yIGEgZnVuY3Rpb25cbiAgICAvL1xuICAgIC8vIFJlZmVyIHRvIGh0dHBzOi8vZ2l0aHViLmNvbS9tYm9zdG9jay9kMy93aWtpL1RpbWUtRm9ybWF0dGluZ1xuICAgIC8vIGZvciBhY2NlcHRlZCBkYXRlIGZvcm1hdHRpbmcgdXNlZCBieSBkMy50aW1lLmZvcm1hdCgpXG4gICAgc3ViRG9tYWluVGV4dEZvcm1hdDogbnVsbCxcblxuICAgIC8vIEZvcm1hdHRpbmcgb2YgdGhlIHRpdGxlIGRpc3BsYXllZCB3aGVuIGhvdmVyaW5nIGEgbGVnZW5kIGNlbGxcbiAgICBsZWdlbmRUaXRsZUZvcm1hdDoge1xuICAgICAgbG93ZXI6ICdsZXNzIHRoYW4ge21pbn0ge25hbWV9JyxcbiAgICAgIGlubmVyOiAnYmV0d2VlbiB7ZG93bn0gYW5kIHt1cH0ge25hbWV9JyxcbiAgICAgIHVwcGVyOiAnbW9yZSB0aGFuIHttYXh9IHtuYW1lfScsXG4gICAgfSxcblxuICAgIC8vIEFuaW1hdGlvbiBkdXJhdGlvbiwgaW4gbXNcbiAgICBhbmltYXRpb25EdXJhdGlvbjogNTAwLFxuXG4gICAgbmV4dFNlbGVjdG9yOiBmYWxzZSxcblxuICAgIHByZXZpb3VzU2VsZWN0b3I6IGZhbHNlLFxuXG4gICAgaXRlbU5hbWVzcGFjZTogJ2NhbC1oZWF0bWFwJyxcblxuICAgIHRvb2x0aXA6IGZhbHNlLFxuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gRVZFTlRTIENBTExCQUNLXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgICAvLyBDYWxsYmFjayB3aGVuIGNsaWNraW5nIG9uIGEgdGltZSBibG9ja1xuICAgIG9uQ2xpY2s6IG51bGwsXG5cbiAgICAvLyBDYWxsYmFjayBhZnRlciBwYWludGluZyB0aGUgZW1wdHkgY2FsZW5kYXJcbiAgICAvLyBDYW4gYmUgdXNlZCB0byB0cmlnZ2VyIGFuIEFQSSBjYWxsLCBvbmNlIHRoZSBjYWxlbmRhciBpcyByZWFkeSB0byBiZSBmaWxsZWRcbiAgICBhZnRlckxvYWQ6IG51bGwsXG5cbiAgICAvLyBDYWxsYmFjayBhZnRlciBsb2FkaW5nIHRoZSBuZXh0IGRvbWFpbiBpbiB0aGUgY2FsZW5kYXJcbiAgICBhZnRlckxvYWROZXh0RG9tYWluOiBudWxsLFxuXG4gICAgLy8gQ2FsbGJhY2sgYWZ0ZXIgbG9hZGluZyB0aGUgcHJldmlvdXMgZG9tYWluIGluIHRoZSBjYWxlbmRhclxuICAgIGFmdGVyTG9hZFByZXZpb3VzRG9tYWluOiBudWxsLFxuXG4gICAgLy8gQ2FsbGJhY2sgYWZ0ZXIgZmluaXNoaW5nIGFsbCBhY3Rpb25zIG9uIHRoZSBjYWxlbmRhclxuICAgIG9uQ29tcGxldGU6IG51bGwsXG5cbiAgICAvLyBDYWxsYmFjayBhZnRlciBmZXRjaGluZyB0aGUgZGF0YXMsIGJ1dCBiZWZvcmUgYXBwbHlpbmcgdGhlbSB0byB0aGUgY2FsZW5kYXJcbiAgICAvLyBVc2VkIG1haW5seSB0byBjb252ZXJ0IHRoZSBkYXRhcyBpZiB0aGV5J3JlIG5vdCBmb3JtYXR0ZWQgbGlrZSBleHBlY3RlZFxuICAgIC8vIFRha2VzIHRoZSBmZXRjaGVkIFwiZGF0YVwiIG9iamVjdCBhcyBhcmd1bWVudCwgbXVzdCByZXR1cm4gYSBqc29uIG9iamVjdFxuICAgIC8vIGZvcm1hdHRlZCBsaWtlIHt0aW1lc3RhbXA6Y291bnQsIHRpbWVzdGFtcDI6Y291bnQyfSxcbiAgICBhZnRlckxvYWREYXRhOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSxcblxuICAgIC8vIENhbGxiYWNrIHRyaWdnZXJlZCBhZnRlciBjYWxsaW5nIGFuZCBjb21wbGV0aW5nIHVwZGF0ZSgpLlxuICAgIGFmdGVyVXBkYXRlOiBudWxsLFxuXG4gICAgLy8gQ2FsbGJhY2sgdHJpZ2dlcmVkIGFmdGVyIGNhbGxpbmcgbmV4dCgpLlxuICAgIC8vIFRoZSBgc3RhdHVzYCBhcmd1bWVudCBpcyBlcXVhbCB0byB0cnVlIGlmIHRoZXJlIGlzIG5vXG4gICAgLy8gbW9yZSBuZXh0IGRvbWFpbiB0byBsb2FkXG4gICAgLy9cbiAgICAvLyBUaGlzIGNhbGxiYWNrIGlzIGFsc28gZXhlY3V0ZWQgb25jZSwgYWZ0ZXIgY2FsbGluZyBwcmV2aW91cygpLFxuICAgIC8vIG9ubHkgd2hlbiB0aGUgbWF4IGRvbWFpbiBpcyByZWFjaGVkXG4gICAgb25NYXhEb21haW5SZWFjaGVkOiBudWxsLFxuXG4gICAgLy8gQ2FsbGJhY2sgdHJpZ2dlcmVkIGFmdGVyIGNhbGxpbmcgcHJldmlvdXMoKS5cbiAgICAvLyBUaGUgYHN0YXR1c2AgYXJndW1lbnQgaXMgZXF1YWwgdG8gdHJ1ZSBpZiB0aGVyZSBpcyBub1xuICAgIC8vIG1vcmUgcHJldmlvdXMgZG9tYWluIHRvIGxvYWRcbiAgICAvL1xuICAgIC8vIFRoaXMgY2FsbGJhY2sgaXMgYWxzbyBleGVjdXRlZCBvbmNlLCBhZnRlciBjYWxsaW5nIG5leHQoKSxcbiAgICAvLyBvbmx5IHdoZW4gdGhlIG1pbiBkb21haW4gaXMgcmVhY2hlZFxuICAgIG9uTWluRG9tYWluUmVhY2hlZDogbnVsbCxcbiAgfTtcblxuICB0aGlzLl9kb21haW5UeXBlID0ge1xuICAgIG1pbjoge1xuICAgICAgbmFtZTogJ21pbnV0ZScsXG4gICAgICBsZXZlbDogMTAsXG4gICAgICBtYXhJdGVtTnVtYmVyOiA2MCxcbiAgICAgIGRlZmF1bHRSb3dOdW1iZXI6IDEwLFxuICAgICAgZGVmYXVsdENvbHVtbk51bWJlcjogNixcbiAgICAgIHJvdzogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYuZ2V0U3ViRG9tYWluUm93TnVtYmVyKGQpO1xuICAgICAgfSxcbiAgICAgIGNvbHVtbjogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYuZ2V0U3ViRG9tYWluQ29sdW1uTnVtYmVyKGQpO1xuICAgICAgfSxcbiAgICAgIHBvc2l0aW9uOiB7XG4gICAgICAgIHg6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoZC5nZXRNaW51dGVzKCkgLyBzZWxmLl9kb21haW5UeXBlLm1pbi5yb3coZCkpO1xuICAgICAgICB9LFxuICAgICAgICB5OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHJldHVybiBkLmdldE1pbnV0ZXMoKSAlIHNlbGYuX2RvbWFpblR5cGUubWluLnJvdyhkKTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBmb3JtYXQ6IHtcbiAgICAgICAgZGF0ZTogJyVIOiVNLCAlQSAlQiAlLWUsICVZJyxcbiAgICAgICAgbGVnZW5kOiAnJyxcbiAgICAgICAgY29ubmVjdG9yOiAnYXQnLFxuICAgICAgfSxcbiAgICAgIGV4dHJhY3RVbml0OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gbmV3IERhdGUoXG4gICAgICAgICAgZC5nZXRGdWxsWWVhcigpLFxuICAgICAgICAgIGQuZ2V0TW9udGgoKSxcbiAgICAgICAgICBkLmdldERhdGUoKSxcbiAgICAgICAgICBkLmdldEhvdXJzKCksXG4gICAgICAgICAgZC5nZXRNaW51dGVzKCksXG4gICAgICAgICkuZ2V0VGltZSgpO1xuICAgICAgfSxcbiAgICB9LFxuICAgIGhvdXI6IHtcbiAgICAgIG5hbWU6ICdob3VyJyxcbiAgICAgIGxldmVsOiAyMCxcbiAgICAgIG1heEl0ZW1OdW1iZXI6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHN3aXRjaCAoc2VsZi5vcHRpb25zLmRvbWFpbikge1xuICAgICAgICAgIGNhc2UgJ2RheSc6XG4gICAgICAgICAgICByZXR1cm4gMjQ7XG4gICAgICAgICAgY2FzZSAnd2Vlayc6XG4gICAgICAgICAgICByZXR1cm4gMjQgKiA3O1xuICAgICAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgICAgIHJldHVybiAyNCAqIChzZWxmLm9wdGlvbnMuZG9tYWluRHluYW1pY0RpbWVuc2lvbiA/IHNlbGYuZ2V0RGF5Q291bnRJbk1vbnRoKGQpIDogMzEpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZGVmYXVsdFJvd051bWJlcjogNixcbiAgICAgIGRlZmF1bHRDb2x1bW5OdW1iZXI6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHN3aXRjaCAoc2VsZi5vcHRpb25zLmRvbWFpbikge1xuICAgICAgICAgIGNhc2UgJ2RheSc6XG4gICAgICAgICAgICByZXR1cm4gNDtcbiAgICAgICAgICBjYXNlICd3ZWVrJzpcbiAgICAgICAgICAgIHJldHVybiAyODtcbiAgICAgICAgICBjYXNlICdtb250aCc6XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5vcHRpb25zLmRvbWFpbkR5bmFtaWNEaW1lbnNpb24gPyBzZWxmLmdldERheUNvdW50SW5Nb250aChkKSA6IDMxO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcm93OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gc2VsZi5nZXRTdWJEb21haW5Sb3dOdW1iZXIoZCk7XG4gICAgICB9LFxuICAgICAgY29sdW1uOiBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gc2VsZi5nZXRTdWJEb21haW5Db2x1bW5OdW1iZXIoZCk7XG4gICAgICB9LFxuICAgICAgcG9zaXRpb246IHtcbiAgICAgICAgeDogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmRvbWFpbiA9PT0gJ21vbnRoJykge1xuICAgICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5jb2xMaW1pdCA+IDAgfHwgc2VsZi5vcHRpb25zLnJvd0xpbWl0ID4gMCkge1xuICAgICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihcbiAgICAgICAgICAgICAgICAoZC5nZXRIb3VycygpICsgKGQuZ2V0RGF0ZSgpIC0gMSkgKiAyNCkgLyBzZWxmLl9kb21haW5UeXBlLmhvdXIucm93KGQpLFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoZC5nZXRIb3VycygpIC8gc2VsZi5fZG9tYWluVHlwZS5ob3VyLnJvdyhkKSkgKyAoZC5nZXREYXRlKCkgLSAxKSAqIDQ7XG4gICAgICAgICAgfSBlbHNlIGlmIChzZWxmLm9wdGlvbnMuZG9tYWluID09PSAnd2VlaycpIHtcbiAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuY29sTGltaXQgPiAwIHx8IHNlbGYub3B0aW9ucy5yb3dMaW1pdCA+IDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoXG4gICAgICAgICAgICAgICAgKGQuZ2V0SG91cnMoKSArIHNlbGYuZ2V0V2Vla0RheShkKSAqIDI0KSAvIHNlbGYuX2RvbWFpblR5cGUuaG91ci5yb3coZCksXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihkLmdldEhvdXJzKCkgLyBzZWxmLl9kb21haW5UeXBlLmhvdXIucm93KGQpKSArIHNlbGYuZ2V0V2Vla0RheShkKSAqIDQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKGQuZ2V0SG91cnMoKSAvIHNlbGYuX2RvbWFpblR5cGUuaG91ci5yb3coZCkpO1xuICAgICAgICB9LFxuICAgICAgICB5OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHZhciBwID0gZC5nZXRIb3VycygpO1xuICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuY29sTGltaXQgPiAwIHx8IHNlbGYub3B0aW9ucy5yb3dMaW1pdCA+IDApIHtcbiAgICAgICAgICAgIHN3aXRjaCAoc2VsZi5vcHRpb25zLmRvbWFpbikge1xuICAgICAgICAgICAgICBjYXNlICdtb250aCc6XG4gICAgICAgICAgICAgICAgcCArPSAoZC5nZXREYXRlKCkgLSAxKSAqIDI0O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlICd3ZWVrJzpcbiAgICAgICAgICAgICAgICBwICs9IHNlbGYuZ2V0V2Vla0RheShkKSAqIDI0O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihwICUgc2VsZi5fZG9tYWluVHlwZS5ob3VyLnJvdyhkKSk7XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgZm9ybWF0OiB7XG4gICAgICAgIGRhdGU6ICclSGgsICVBICVCICUtZSwgJVknLFxuICAgICAgICBsZWdlbmQ6ICclSDowMCcsXG4gICAgICAgIGNvbm5lY3RvcjogJ2F0JyxcbiAgICAgIH0sXG4gICAgICBleHRyYWN0VW5pdDogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpLCBkLmdldERhdGUoKSwgZC5nZXRIb3VycygpKS5nZXRUaW1lKCk7XG4gICAgICB9LFxuICAgIH0sXG4gICAgZGF5OiB7XG4gICAgICBuYW1lOiAnZGF5JyxcbiAgICAgIGxldmVsOiAzMCxcbiAgICAgIG1heEl0ZW1OdW1iZXI6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHN3aXRjaCAoc2VsZi5vcHRpb25zLmRvbWFpbikge1xuICAgICAgICAgIGNhc2UgJ3dlZWsnOlxuICAgICAgICAgICAgcmV0dXJuIDc7XG4gICAgICAgICAgY2FzZSAnbW9udGgnOlxuICAgICAgICAgICAgcmV0dXJuIHNlbGYub3B0aW9ucy5kb21haW5EeW5hbWljRGltZW5zaW9uID8gc2VsZi5nZXREYXlDb3VudEluTW9udGgoZCkgOiAzMTtcbiAgICAgICAgICBjYXNlICd5ZWFyJzpcbiAgICAgICAgICAgIHJldHVybiBzZWxmLm9wdGlvbnMuZG9tYWluRHluYW1pY0RpbWVuc2lvbiA/IHNlbGYuZ2V0RGF5Q291bnRJblllYXIoZCkgOiAzNjY7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBkZWZhdWx0Q29sdW1uTnVtYmVyOiBmdW5jdGlvbiAoZCkge1xuICAgICAgICBkID0gbmV3IERhdGUoZCk7XG4gICAgICAgIHN3aXRjaCAoc2VsZi5vcHRpb25zLmRvbWFpbikge1xuICAgICAgICAgIGNhc2UgJ3dlZWsnOlxuICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgY2FzZSAnbW9udGgnOlxuICAgICAgICAgICAgcmV0dXJuIHNlbGYub3B0aW9ucy5kb21haW5EeW5hbWljRGltZW5zaW9uICYmICFzZWxmLm9wdGlvbnMudmVydGljYWxPcmllbnRhdGlvblxuICAgICAgICAgICAgICA/IHNlbGYuZ2V0V2Vla051bWJlcihuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSArIDEsIDApKSAtXG4gICAgICAgICAgICAgICAgICBzZWxmLmdldFdlZWtOdW1iZXIoZCkgK1xuICAgICAgICAgICAgICAgICAgMVxuICAgICAgICAgICAgICA6IDY7XG4gICAgICAgICAgY2FzZSAneWVhcic6XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5vcHRpb25zLmRvbWFpbkR5bmFtaWNEaW1lbnNpb25cbiAgICAgICAgICAgICAgPyBzZWxmLmdldFdlZWtOdW1iZXIobmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCAxMSwgMzEpKSAtXG4gICAgICAgICAgICAgICAgICBzZWxmLmdldFdlZWtOdW1iZXIobmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCAwKSkgK1xuICAgICAgICAgICAgICAgICAgMVxuICAgICAgICAgICAgICA6IDU0O1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZGVmYXVsdFJvd051bWJlcjogNyxcbiAgICAgIHJvdzogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYuZ2V0U3ViRG9tYWluUm93TnVtYmVyKGQpO1xuICAgICAgfSxcbiAgICAgIGNvbHVtbjogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYuZ2V0U3ViRG9tYWluQ29sdW1uTnVtYmVyKGQpO1xuICAgICAgfSxcbiAgICAgIHBvc2l0aW9uOiB7XG4gICAgICAgIHg6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgc3dpdGNoIChzZWxmLm9wdGlvbnMuZG9tYWluKSB7XG4gICAgICAgICAgICBjYXNlICd3ZWVrJzpcbiAgICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3Ioc2VsZi5nZXRXZWVrRGF5KGQpIC8gc2VsZi5fZG9tYWluVHlwZS5kYXkucm93KGQpKTtcbiAgICAgICAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5jb2xMaW1pdCA+IDAgfHwgc2VsZi5vcHRpb25zLnJvd0xpbWl0ID4gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKChkLmdldERhdGUoKSAtIDEpIC8gc2VsZi5fZG9tYWluVHlwZS5kYXkucm93KGQpKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgIHNlbGYuZ2V0V2Vla051bWJlcihkKSAtIHNlbGYuZ2V0V2Vla051bWJlcihuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSkpXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjYXNlICd5ZWFyJzpcbiAgICAgICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5jb2xMaW1pdCA+IDAgfHwgc2VsZi5vcHRpb25zLnJvd0xpbWl0ID4gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKChzZWxmLmdldERheU9mWWVhcihkKSAtIDEpIC8gc2VsZi5fZG9tYWluVHlwZS5kYXkucm93KGQpKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXRXZWVrTnVtYmVyKGQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgeTogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICB2YXIgcCA9IHNlbGYuZ2V0V2Vla0RheShkKTtcbiAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmNvbExpbWl0ID4gMCB8fCBzZWxmLm9wdGlvbnMucm93TGltaXQgPiAwKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHNlbGYub3B0aW9ucy5kb21haW4pIHtcbiAgICAgICAgICAgICAgY2FzZSAneWVhcic6XG4gICAgICAgICAgICAgICAgcCA9IHNlbGYuZ2V0RGF5T2ZZZWFyKGQpIC0gMTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSAnd2Vlayc6XG4gICAgICAgICAgICAgICAgcCA9IHNlbGYuZ2V0V2Vla0RheShkKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSAnbW9udGgnOlxuICAgICAgICAgICAgICAgIHAgPSBkLmdldERhdGUoKSAtIDE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKHAgJSBzZWxmLl9kb21haW5UeXBlLmRheS5yb3coZCkpO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIGZvcm1hdDoge1xuICAgICAgICBkYXRlOiAnJUEgJUIgJS1lLCAlWScsXG4gICAgICAgIGxlZ2VuZDogJyVlICViJyxcbiAgICAgICAgY29ubmVjdG9yOiAnb24nLFxuICAgICAgfSxcbiAgICAgIGV4dHJhY3RVbml0OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCksIGQuZ2V0RGF0ZSgpKS5nZXRUaW1lKCk7XG4gICAgICB9LFxuICAgIH0sXG4gICAgd2Vlazoge1xuICAgICAgbmFtZTogJ3dlZWsnLFxuICAgICAgbGV2ZWw6IDQwLFxuICAgICAgbWF4SXRlbU51bWJlcjogNTQsXG4gICAgICBkZWZhdWx0Q29sdW1uTnVtYmVyOiBmdW5jdGlvbiAoZCkge1xuICAgICAgICBkID0gbmV3IERhdGUoZCk7XG4gICAgICAgIHN3aXRjaCAoc2VsZi5vcHRpb25zLmRvbWFpbikge1xuICAgICAgICAgIGNhc2UgJ3llYXInOlxuICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RvbWFpblR5cGUud2Vlay5tYXhJdGVtTnVtYmVyO1xuICAgICAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgICAgIHJldHVybiBzZWxmLm9wdGlvbnMuZG9tYWluRHluYW1pY0RpbWVuc2lvblxuICAgICAgICAgICAgICA/IHNlbGYuZ2V0V2Vla051bWJlcihuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSArIDEsIDApKSAtXG4gICAgICAgICAgICAgICAgICBzZWxmLmdldFdlZWtOdW1iZXIoZClcbiAgICAgICAgICAgICAgOiA1O1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZGVmYXVsdFJvd051bWJlcjogMSxcbiAgICAgIHJvdzogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYuZ2V0U3ViRG9tYWluUm93TnVtYmVyKGQpO1xuICAgICAgfSxcbiAgICAgIGNvbHVtbjogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYuZ2V0U3ViRG9tYWluQ29sdW1uTnVtYmVyKGQpO1xuICAgICAgfSxcbiAgICAgIHBvc2l0aW9uOiB7XG4gICAgICAgIHg6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgc3dpdGNoIChzZWxmLm9wdGlvbnMuZG9tYWluKSB7XG4gICAgICAgICAgICBjYXNlICd5ZWFyJzpcbiAgICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3Ioc2VsZi5nZXRXZWVrTnVtYmVyKGQpIC8gc2VsZi5fZG9tYWluVHlwZS53ZWVrLnJvdyhkKSk7XG4gICAgICAgICAgICBjYXNlICdtb250aCc6XG4gICAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKHNlbGYuZ2V0TW9udGhXZWVrTnVtYmVyKGQpIC8gc2VsZi5fZG9tYWluVHlwZS53ZWVrLnJvdyhkKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB5OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHJldHVybiBzZWxmLmdldFdlZWtOdW1iZXIoZCkgJSBzZWxmLl9kb21haW5UeXBlLndlZWsucm93KGQpO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIGZvcm1hdDoge1xuICAgICAgICBkYXRlOiAnJUIgV2VlayAjJVcnLFxuICAgICAgICBsZWdlbmQ6ICclQiBXZWVrICMlVycsXG4gICAgICAgIGNvbm5lY3RvcjogJ2luJyxcbiAgICAgIH0sXG4gICAgICBleHRyYWN0VW5pdDogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgdmFyIGR0ID0gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCksIGQuZ2V0RGF0ZSgpKTtcbiAgICAgICAgLy8gQWNjb3JkaW5nIHRvIElTTy04NjAxLCB3ZWVrIG51bWJlciBjb21wdXRhdGlvbiBhcmUgYmFzZWQgb24gd2VlayBzdGFydGluZyBvbiBNb25kYXlcbiAgICAgICAgdmFyIHdlZWtEYXkgPSBkdC5nZXREYXkoKSAtIChzZWxmLm9wdGlvbnMud2Vla1N0YXJ0T25Nb25kYXkgPyAxIDogMCk7XG4gICAgICAgIGlmICh3ZWVrRGF5IDwgMCkge1xuICAgICAgICAgIHdlZWtEYXkgPSA2O1xuICAgICAgICB9XG4gICAgICAgIGR0LnNldERhdGUoZHQuZ2V0RGF0ZSgpIC0gd2Vla0RheSk7XG4gICAgICAgIHJldHVybiBkdC5nZXRUaW1lKCk7XG4gICAgICB9LFxuICAgIH0sXG4gICAgbW9udGg6IHtcbiAgICAgIG5hbWU6ICdtb250aCcsXG4gICAgICBsZXZlbDogNTAsXG4gICAgICBtYXhJdGVtTnVtYmVyOiAxMixcbiAgICAgIGRlZmF1bHRDb2x1bW5OdW1iZXI6IDEyLFxuICAgICAgZGVmYXVsdFJvd051bWJlcjogMSxcbiAgICAgIHJvdzogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc2VsZi5nZXRTdWJEb21haW5Sb3dOdW1iZXIoKTtcbiAgICAgIH0sXG4gICAgICBjb2x1bW46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYuZ2V0U3ViRG9tYWluQ29sdW1uTnVtYmVyKCk7XG4gICAgICB9LFxuICAgICAgcG9zaXRpb246IHtcbiAgICAgICAgeDogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihkLmdldE1vbnRoKCkgLyBzZWxmLl9kb21haW5UeXBlLm1vbnRoLnJvdyhkKSk7XG4gICAgICAgIH0sXG4gICAgICAgIHk6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgcmV0dXJuIGQuZ2V0TW9udGgoKSAlIHNlbGYuX2RvbWFpblR5cGUubW9udGgucm93KGQpO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIGZvcm1hdDoge1xuICAgICAgICBkYXRlOiAnJUIgJVknLFxuICAgICAgICBsZWdlbmQ6ICclQicsXG4gICAgICAgIGNvbm5lY3RvcjogJ2luJyxcbiAgICAgIH0sXG4gICAgICBleHRyYWN0VW5pdDogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpKS5nZXRUaW1lKCk7XG4gICAgICB9LFxuICAgIH0sXG4gICAgeWVhcjoge1xuICAgICAgbmFtZTogJ3llYXInLFxuICAgICAgbGV2ZWw6IDYwLFxuICAgICAgcm93OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzZWxmLm9wdGlvbnMucm93TGltaXQgfHwgMTtcbiAgICAgIH0sXG4gICAgICBjb2x1bW46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYub3B0aW9ucy5jb2xMaW1pdCB8fCAxO1xuICAgICAgfSxcbiAgICAgIHBvc2l0aW9uOiB7XG4gICAgICAgIHg6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgfSxcbiAgICAgICAgeTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIGZvcm1hdDoge1xuICAgICAgICBkYXRlOiAnJVknLFxuICAgICAgICBsZWdlbmQ6ICclWScsXG4gICAgICAgIGNvbm5lY3RvcjogJ2luJyxcbiAgICAgIH0sXG4gICAgICBleHRyYWN0VW5pdDogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSkuZ2V0VGltZSgpO1xuICAgICAgfSxcbiAgICB9LFxuICB9O1xuXG4gIGZvciAodmFyIHR5cGUgaW4gdGhpcy5fZG9tYWluVHlwZSkge1xuICAgIGlmICh0aGlzLl9kb21haW5UeXBlLmhhc093blByb3BlcnR5KHR5cGUpKSB7XG4gICAgICB2YXIgZCA9IHRoaXMuX2RvbWFpblR5cGVbdHlwZV07XG4gICAgICB0aGlzLl9kb21haW5UeXBlWyd4XycgKyB0eXBlXSA9IHtcbiAgICAgICAgbmFtZTogJ3hfJyArIHR5cGUsXG4gICAgICAgIGxldmVsOiBkLnR5cGUsXG4gICAgICAgIG1heEl0ZW1OdW1iZXI6IGQubWF4SXRlbU51bWJlcixcbiAgICAgICAgZGVmYXVsdFJvd051bWJlcjogZC5kZWZhdWx0Um93TnVtYmVyLFxuICAgICAgICBkZWZhdWx0Q29sdW1uTnVtYmVyOiBkLmRlZmF1bHRDb2x1bW5OdW1iZXIsXG4gICAgICAgIHJvdzogZC5jb2x1bW4sXG4gICAgICAgIGNvbHVtbjogZC5yb3csXG4gICAgICAgIHBvc2l0aW9uOiB7XG4gICAgICAgICAgeDogZC5wb3NpdGlvbi55LFxuICAgICAgICAgIHk6IGQucG9zaXRpb24ueCxcbiAgICAgICAgfSxcbiAgICAgICAgZm9ybWF0OiBkLmZvcm1hdCxcbiAgICAgICAgZXh0cmFjdFVuaXQ6IGQuZXh0cmFjdFVuaXQsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8vIFJlY29yZCB0aGUgYWRkcmVzcyBvZiB0aGUgbGFzdCBpbnNlcnRlZCBkb21haW4gd2hlbiBicm93c2luZ1xuICB0aGlzLmxhc3RJbnNlcnRlZFN2ZyA9IG51bGw7XG5cbiAgdGhpcy5fY29tcGxldGVkID0gZmFsc2U7XG5cbiAgLy8gUmVjb3JkIGFsbCB0aGUgdmFsaWQgZG9tYWluc1xuICAvLyBFYWNoIGRvbWFpbiB2YWx1ZSBpcyBhIHRpbWVzdGFtcCBpbiBtaWxsaXNlY29uZHNcbiAgdGhpcy5fZG9tYWlucyA9IGQzLm1hcCgpO1xuXG4gIHRoaXMuZ3JhcGhEaW0gPSB7XG4gICAgd2lkdGg6IDAsXG4gICAgaGVpZ2h0OiAwLFxuICB9O1xuXG4gIHRoaXMubGVnZW5kRGltID0ge1xuICAgIHdpZHRoOiAwLFxuICAgIGhlaWdodDogMCxcbiAgfTtcblxuICB0aGlzLk5BVklHQVRFX0xFRlQgPSAxO1xuICB0aGlzLk5BVklHQVRFX1JJR0hUID0gMjtcblxuICAvLyBWYXJpb3VzIHVwZGF0ZSBtb2RlIHdoZW4gdXNpbmcgdGhlIHVwZGF0ZSgpIEFQSVxuICB0aGlzLlJFU0VUX0FMTF9PTl9VUERBVEUgPSAwO1xuICB0aGlzLlJFU0VUX1NJTkdMRV9PTl9VUERBVEUgPSAxO1xuICB0aGlzLkFQUEVORF9PTl9VUERBVEUgPSAyO1xuXG4gIHRoaXMuREVGQVVMVF9MRUdFTkRfTUFSR0lOID0gMTA7XG5cbiAgdGhpcy5yb290ID0gbnVsbDtcbiAgdGhpcy50b29sdGlwID0gbnVsbDtcblxuICB0aGlzLl9tYXhEb21haW5SZWFjaGVkID0gZmFsc2U7XG4gIHRoaXMuX21pbkRvbWFpblJlYWNoZWQgPSBmYWxzZTtcblxuICB0aGlzLmRvbWFpblBvc2l0aW9uID0gbmV3IERvbWFpblBvc2l0aW9uKCk7XG4gIHRoaXMuTGVnZW5kID0gbnVsbDtcbiAgdGhpcy5sZWdlbmRTY2FsZSA9IG51bGw7XG5cbiAgLy8gTGlzdCBvZiBkb21haW5zIHRoYXQgYXJlIHNraXBwZWQgYmVjYXVzZSBvZiBEU1RcbiAgLy8gQWxsIHRpbWVzIGJlbG9uZ2luZyB0byB0aGVzZSBkb21haW5zIHNob3VsZCBiZSByZS1hc3NpZ25lZCB0byB0aGUgcHJldmlvdXMgZG9tYWluXG4gIHRoaXMuRFNURG9tYWluID0gW107XG5cbiAgLyoqXG4gICAqIERpc3BsYXkgdGhlIGdyYXBoIGZvciB0aGUgZmlyc3QgdGltZVxuICAgKiBAcmV0dXJuIGJvb2wgVHJ1ZSBpZiB0aGUgY2FsZW5kYXIgaXMgY3JlYXRlZFxuICAgKi9cbiAgdGhpcy5faW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICBzZWxmXG4gICAgICAuZ2V0RG9tYWluKHNlbGYub3B0aW9ucy5zdGFydClcbiAgICAgIC5tYXAoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIGQuZ2V0VGltZSgpO1xuICAgICAgfSlcbiAgICAgIC5tYXAoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgc2VsZi5fZG9tYWlucy5zZXQoXG4gICAgICAgICAgZCxcbiAgICAgICAgICBzZWxmLmdldFN1YkRvbWFpbihkKS5tYXAoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHQ6IHNlbGYuX2RvbWFpblR5cGVbc2VsZi5vcHRpb25zLnN1YkRvbWFpbl0uZXh0cmFjdFVuaXQoZCksIHY6IG51bGwgfTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuXG4gICAgc2VsZi5yb290ID0gZDNcbiAgICAgIC5zZWxlY3Qoc2VsZi5vcHRpb25zLml0ZW1TZWxlY3RvcilcbiAgICAgIC5hcHBlbmQoJ3N2ZycpXG4gICAgICAuYXR0cignY2xhc3MnLCAnY2FsLWhlYXRtYXAtY29udGFpbmVyJyk7XG5cbiAgICBzZWxmLnJvb3QuYXR0cigneCcsIDApLmF0dHIoJ3knLCAwKS5hcHBlbmQoJ3N2ZycpLmF0dHIoJ2NsYXNzJywgJ2dyYXBoJyk7XG5cbiAgICBzZWxmLkxlZ2VuZCA9IG5ldyBMZWdlbmQoc2VsZik7XG5cbiAgICBpZiAoc2VsZi5vcHRpb25zLnBhaW50T25Mb2FkKSB7XG4gICAgICBfaW5pdENhbGVuZGFyKCk7XG4gICAgfVxuICAgIHNlbGYucm9vdC5jYWxsKHNlbGYudGlwKTtcbiAgICBzZWxmLnJvb3QuY2FsbChzZWxmLmxlZ2VuZFRpcCk7XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfTtcblxuICBmdW5jdGlvbiBfaW5pdENhbGVuZGFyKCkge1xuICAgIHNlbGYudmVydGljYWxEb21haW5MYWJlbCA9XG4gICAgICBzZWxmLm9wdGlvbnMubGFiZWwucG9zaXRpb24gPT09ICd0b3AnIHx8IHNlbGYub3B0aW9ucy5sYWJlbC5wb3NpdGlvbiA9PT0gJ2JvdHRvbSc7XG5cbiAgICBzZWxmLmRvbWFpblZlcnRpY2FsTGFiZWxIZWlnaHQgPVxuICAgICAgc2VsZi5vcHRpb25zLmxhYmVsLmhlaWdodCA9PT0gbnVsbFxuICAgICAgICA/IE1hdGgubWF4KDI1LCBzZWxmLm9wdGlvbnMuY2VsbFNpemUgKiAyKVxuICAgICAgICA6IHNlbGYub3B0aW9ucy5sYWJlbC5oZWlnaHQ7XG4gICAgc2VsZi5kb21haW5Ib3Jpem9udGFsTGFiZWxXaWR0aCA9IDA7XG5cbiAgICBpZiAoc2VsZi5vcHRpb25zLmRvbWFpbkxhYmVsRm9ybWF0ID09PSAnJyAmJiBzZWxmLm9wdGlvbnMubGFiZWwuaGVpZ2h0ID09PSBudWxsKSB7XG4gICAgICBzZWxmLmRvbWFpblZlcnRpY2FsTGFiZWxIZWlnaHQgPSAwO1xuICAgIH1cblxuICAgIGlmICghc2VsZi52ZXJ0aWNhbERvbWFpbkxhYmVsKSB7XG4gICAgICBzZWxmLmRvbWFpblZlcnRpY2FsTGFiZWxIZWlnaHQgPSAwO1xuICAgICAgc2VsZi5kb21haW5Ib3Jpem9udGFsTGFiZWxXaWR0aCA9IHNlbGYub3B0aW9ucy5sYWJlbC53aWR0aDtcbiAgICB9XG5cbiAgICBzZWxmLnBhaW50KCk7XG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgICAvLyBBVFRBQ0hJTkcgRE9NQUlOIE5BVklHQVRJT04gRVZFTlQgICAgICAgICAgICAgICAgICAgIC8vXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4gICAgaWYgKHNlbGYub3B0aW9ucy5uZXh0U2VsZWN0b3IgIT09IGZhbHNlKSB7XG4gICAgICBkMy5zZWxlY3Qoc2VsZi5vcHRpb25zLm5leHRTZWxlY3Rvcikub24oJ2NsaWNrLicgKyBzZWxmLm9wdGlvbnMuaXRlbU5hbWVzcGFjZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICBkMy5ldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXR1cm4gc2VsZi5sb2FkTmV4dERvbWFpbigxKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChzZWxmLm9wdGlvbnMucHJldmlvdXNTZWxlY3RvciAhPT0gZmFsc2UpIHtcbiAgICAgIGQzLnNlbGVjdChzZWxmLm9wdGlvbnMucHJldmlvdXNTZWxlY3Rvcikub24oXG4gICAgICAgICdjbGljay4nICsgc2VsZi5vcHRpb25zLml0ZW1OYW1lc3BhY2UsXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBkMy5ldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIHJldHVybiBzZWxmLmxvYWRQcmV2aW91c0RvbWFpbigxKTtcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgc2VsZi5MZWdlbmQucmVkcmF3KHNlbGYuZ3JhcGhEaW0ud2lkdGggLSBzZWxmLm9wdGlvbnMuZG9tYWluR3V0dGVyIC0gc2VsZi5vcHRpb25zLmNlbGxQYWRkaW5nKTtcbiAgICBzZWxmLmFmdGVyTG9hZCgpO1xuXG4gICAgdmFyIGRvbWFpbnMgPSBzZWxmLmdldERvbWFpbktleXMoKTtcblxuICAgIC8vIEZpbGwgdGhlIGdyYXBoIHdpdGggc29tZSBkYXRhc1xuICAgIGlmIChzZWxmLm9wdGlvbnMubG9hZE9uSW5pdCkge1xuICAgICAgc2VsZi5nZXREYXRhcyhcbiAgICAgICAgc2VsZi5vcHRpb25zLmRhdGEsXG4gICAgICAgIG5ldyBEYXRlKGRvbWFpbnNbMF0pLFxuICAgICAgICBzZWxmLmdldFN1YkRvbWFpbihkb21haW5zW2RvbWFpbnMubGVuZ3RoIC0gMV0pLnBvcCgpLFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgc2VsZi5maWxsKCk7XG4gICAgICAgICAgc2VsZi5vbkNvbXBsZXRlKCk7XG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZWxmLm9uQ29tcGxldGUoKTtcbiAgICB9XG5cbiAgICBzZWxmLmNoZWNrSWZNaW5Eb21haW5Jc1JlYWNoZWQoZG9tYWluc1swXSk7XG4gICAgc2VsZi5jaGVja0lmTWF4RG9tYWluSXNSZWFjaGVkKHNlbGYuZ2V0TmV4dERvbWFpbigpLmdldFRpbWUoKSk7XG4gIH1cblxuICAvLyBSZXR1cm4gdGhlIHdpZHRoIG9mIHRoZSBkb21haW4gYmxvY2ssIHdpdGhvdXQgdGhlIGRvbWFpbiBndXR0ZXJcbiAgLy8gQHBhcmFtIGludCBkIERvbWFpbiBzdGFydCB0aW1lc3RhbXBcbiAgZnVuY3Rpb24gdyhkLCBvdXRlcikge1xuICAgIHZhciB3aWR0aCA9XG4gICAgICBzZWxmLm9wdGlvbnMuY2VsbFNpemUgKiBzZWxmLl9kb21haW5UeXBlW3NlbGYub3B0aW9ucy5zdWJEb21haW5dLmNvbHVtbihkKSArXG4gICAgICBzZWxmLm9wdGlvbnMuY2VsbFBhZGRpbmcgKiBzZWxmLl9kb21haW5UeXBlW3NlbGYub3B0aW9ucy5zdWJEb21haW5dLmNvbHVtbihkKTtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMiAmJiBvdXRlciA9PT0gdHJ1ZSkge1xuICAgICAgcmV0dXJuICh3aWR0aCArPVxuICAgICAgICBzZWxmLmRvbWFpbkhvcml6b250YWxMYWJlbFdpZHRoICtcbiAgICAgICAgc2VsZi5vcHRpb25zLmRvbWFpbkd1dHRlciArXG4gICAgICAgIHNlbGYub3B0aW9ucy5kb21haW5NYXJnaW5bMV0gK1xuICAgICAgICBzZWxmLm9wdGlvbnMuZG9tYWluTWFyZ2luWzNdKTtcbiAgICB9XG4gICAgcmV0dXJuIHdpZHRoO1xuICB9XG5cbiAgLy8gUmV0dXJuIHRoZSBoZWlnaHQgb2YgdGhlIGRvbWFpbiBibG9jaywgd2l0aG91dCB0aGUgZG9tYWluIGd1dHRlclxuICBmdW5jdGlvbiBoKGQsIG91dGVyKSB7XG4gICAgdmFyIGhlaWdodCA9XG4gICAgICBzZWxmLm9wdGlvbnMuY2VsbFNpemUgKiBzZWxmLl9kb21haW5UeXBlW3NlbGYub3B0aW9ucy5zdWJEb21haW5dLnJvdyhkKSArXG4gICAgICBzZWxmLm9wdGlvbnMuY2VsbFBhZGRpbmcgKiBzZWxmLl9kb21haW5UeXBlW3NlbGYub3B0aW9ucy5zdWJEb21haW5dLnJvdyhkKTtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMiAmJiBvdXRlciA9PT0gdHJ1ZSkge1xuICAgICAgaGVpZ2h0ICs9XG4gICAgICAgIHNlbGYub3B0aW9ucy5kb21haW5HdXR0ZXIgK1xuICAgICAgICBzZWxmLmRvbWFpblZlcnRpY2FsTGFiZWxIZWlnaHQgK1xuICAgICAgICBzZWxmLm9wdGlvbnMuZG9tYWluTWFyZ2luWzBdICtcbiAgICAgICAgc2VsZi5vcHRpb25zLmRvbWFpbk1hcmdpblsyXTtcbiAgICB9XG4gICAgcmV0dXJuIGhlaWdodDtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKlxuICAgKiBAcGFyYW0gaW50IG5hdmlnYXRpb25EaXJcbiAgICovXG4gIHRoaXMucGFpbnQgPSBmdW5jdGlvbiAobmF2aWdhdGlvbkRpcikge1xuICAgIHZhciBvcHRpb25zID0gc2VsZi5vcHRpb25zO1xuXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgIG5hdmlnYXRpb25EaXIgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBQYWludGluZyBhbGwgdGhlIGRvbWFpbnNcbiAgICB2YXIgZG9tYWluU3ZnID0gc2VsZi5yb290XG4gICAgICAuc2VsZWN0KCcuZ3JhcGgnKVxuICAgICAgLnNlbGVjdEFsbCgnLmdyYXBoLWRvbWFpbicpXG4gICAgICAuZGF0YShcbiAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciBkYXRhID0gc2VsZi5nZXREb21haW5LZXlzKCk7XG4gICAgICAgICAgcmV0dXJuIG5hdmlnYXRpb25EaXIgPT09IHNlbGYuTkFWSUdBVEVfTEVGVCA/IGRhdGEucmV2ZXJzZSgpIDogZGF0YTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICByZXR1cm4gZDtcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgdmFyIGVudGVyaW5nRG9tYWluRGltID0gMDtcbiAgICB2YXIgZXhpdGluZ0RvbWFpbkRpbSA9IDA7XG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgICAvLyBQQUlOVElORyBET01BSU4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1xuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuXG4gICAgdmFyIHN2ZyA9IGRvbWFpblN2Z1xuICAgICAgLmVudGVyKClcbiAgICAgIC5hcHBlbmQoJ3N2ZycpXG4gICAgICAuYXR0cignd2lkdGgnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gdyhkLCB0cnVlKTtcbiAgICAgIH0pXG4gICAgICAuYXR0cignaGVpZ2h0JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIGgoZCwgdHJ1ZSk7XG4gICAgICB9KVxuICAgICAgLmF0dHIoJ3gnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICBpZiAob3B0aW9ucy52ZXJ0aWNhbE9yaWVudGF0aW9uKSB7XG4gICAgICAgICAgc2VsZi5ncmFwaERpbS53aWR0aCA9IE1hdGgubWF4KHNlbGYuZ3JhcGhEaW0ud2lkdGgsIHcoZCwgdHJ1ZSkpO1xuICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBnZXREb21haW5Qb3NpdGlvbihkLCBzZWxmLmdyYXBoRGltLCAnd2lkdGgnLCB3KGQsIHRydWUpKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC5hdHRyKCd5JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMudmVydGljYWxPcmllbnRhdGlvbikge1xuICAgICAgICAgIHJldHVybiBnZXREb21haW5Qb3NpdGlvbihkLCBzZWxmLmdyYXBoRGltLCAnaGVpZ2h0JywgaChkLCB0cnVlKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2VsZi5ncmFwaERpbS5oZWlnaHQgPSBNYXRoLm1heChzZWxmLmdyYXBoRGltLmhlaWdodCwgaChkLCB0cnVlKSk7XG4gICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuYXR0cignY2xhc3MnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICB2YXIgY2xhc3NuYW1lID0gJ2dyYXBoLWRvbWFpbic7XG4gICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoZCk7XG4gICAgICAgIHN3aXRjaCAob3B0aW9ucy5kb21haW4pIHtcbiAgICAgICAgICBjYXNlICdob3VyJzpcbiAgICAgICAgICAgIGNsYXNzbmFtZSArPSAnIGhfJyArIGRhdGUuZ2V0SG91cnMoKTtcbiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovXG4gICAgICAgICAgY2FzZSAnZGF5JzpcbiAgICAgICAgICAgIGNsYXNzbmFtZSArPSAnIGRfJyArIGRhdGUuZ2V0RGF0ZSgpICsgJyBkeV8nICsgZGF0ZS5nZXREYXkoKTtcbiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovXG4gICAgICAgICAgY2FzZSAnd2Vlayc6XG4gICAgICAgICAgICBjbGFzc25hbWUgKz0gJyB3XycgKyBzZWxmLmdldFdlZWtOdW1iZXIoZGF0ZSk7XG4gICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqL1xuICAgICAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgICAgIGNsYXNzbmFtZSArPSAnIG1fJyArIChkYXRlLmdldE1vbnRoKCkgKyAxKTtcbiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovXG4gICAgICAgICAgY2FzZSAneWVhcic6XG4gICAgICAgICAgICBjbGFzc25hbWUgKz0gJyB5XycgKyBkYXRlLmdldEZ1bGxZZWFyKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNsYXNzbmFtZTtcbiAgICAgIH0pO1xuICAgIHNlbGYubGFzdEluc2VydGVkU3ZnID0gc3ZnO1xuXG4gICAgZnVuY3Rpb24gZ2V0RG9tYWluUG9zaXRpb24oZG9tYWluSW5kZXgsIGdyYXBoRGltLCBheGlzLCBkb21haW5EaW0pIHtcbiAgICAgIHZhciB0bXAgPSAwO1xuICAgICAgc3dpdGNoIChuYXZpZ2F0aW9uRGlyKSB7XG4gICAgICAgIGNhc2UgZmFsc2U6XG4gICAgICAgICAgdG1wID0gZ3JhcGhEaW1bYXhpc107XG5cbiAgICAgICAgICBncmFwaERpbVtheGlzXSArPSBkb21haW5EaW07XG4gICAgICAgICAgc2VsZi5kb21haW5Qb3NpdGlvbi5zZXRQb3NpdGlvbihkb21haW5JbmRleCwgdG1wKTtcbiAgICAgICAgICByZXR1cm4gdG1wO1xuXG4gICAgICAgIGNhc2Ugc2VsZi5OQVZJR0FURV9SSUdIVDpcbiAgICAgICAgICBzZWxmLmRvbWFpblBvc2l0aW9uLnNldFBvc2l0aW9uKGRvbWFpbkluZGV4LCBncmFwaERpbVtheGlzXSk7XG5cbiAgICAgICAgICBlbnRlcmluZ0RvbWFpbkRpbSA9IGRvbWFpbkRpbTtcbiAgICAgICAgICBleGl0aW5nRG9tYWluRGltID0gc2VsZi5kb21haW5Qb3NpdGlvbi5nZXRQb3NpdGlvbkZyb21JbmRleCgxKTtcblxuICAgICAgICAgIHNlbGYuZG9tYWluUG9zaXRpb24uc2hpZnRSaWdodEJ5KGV4aXRpbmdEb21haW5EaW0pO1xuICAgICAgICAgIHJldHVybiBncmFwaERpbVtheGlzXTtcblxuICAgICAgICBjYXNlIHNlbGYuTkFWSUdBVEVfTEVGVDpcbiAgICAgICAgICB0bXAgPSAtZG9tYWluRGltO1xuXG4gICAgICAgICAgZW50ZXJpbmdEb21haW5EaW0gPSAtdG1wO1xuICAgICAgICAgIGV4aXRpbmdEb21haW5EaW0gPSBncmFwaERpbVtheGlzXSAtIHNlbGYuZG9tYWluUG9zaXRpb24uZ2V0TGFzdCgpO1xuXG4gICAgICAgICAgc2VsZi5kb21haW5Qb3NpdGlvbi5zZXRQb3NpdGlvbihkb21haW5JbmRleCwgdG1wKTtcbiAgICAgICAgICBzZWxmLmRvbWFpblBvc2l0aW9uLnNoaWZ0TGVmdEJ5KGVudGVyaW5nRG9tYWluRGltKTtcbiAgICAgICAgICByZXR1cm4gdG1wO1xuICAgICAgfVxuICAgIH1cblxuICAgIHN2Z1xuICAgICAgLmFwcGVuZCgncmVjdCcpXG4gICAgICAuYXR0cignd2lkdGgnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gdyhkLCB0cnVlKSAtIG9wdGlvbnMuZG9tYWluR3V0dGVyIC0gb3B0aW9ucy5jZWxsUGFkZGluZztcbiAgICAgIH0pXG4gICAgICAuYXR0cignaGVpZ2h0JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIGgoZCwgdHJ1ZSkgLSBvcHRpb25zLmRvbWFpbkd1dHRlciAtIG9wdGlvbnMuY2VsbFBhZGRpbmc7XG4gICAgICB9KVxuICAgICAgLmF0dHIoJ2NsYXNzJywgJ2RvbWFpbi1iYWNrZ3JvdW5kJyk7XG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgICAvLyBQQUlOVElORyBTVUJET01BSU5TICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4gICAgdmFyIHN1YkRvbWFpblN2Z0dyb3VwID0gc3ZnXG4gICAgICAuYXBwZW5kKCdzdmcnKVxuICAgICAgLmF0dHIoJ3gnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChvcHRpb25zLmxhYmVsLnBvc2l0aW9uID09PSAnbGVmdCcpIHtcbiAgICAgICAgICByZXR1cm4gc2VsZi5kb21haW5Ib3Jpem9udGFsTGFiZWxXaWR0aCArIG9wdGlvbnMuZG9tYWluTWFyZ2luWzNdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBvcHRpb25zLmRvbWFpbk1hcmdpblszXTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC5hdHRyKCd5JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAob3B0aW9ucy5sYWJlbC5wb3NpdGlvbiA9PT0gJ3RvcCcpIHtcbiAgICAgICAgICByZXR1cm4gc2VsZi5kb21haW5WZXJ0aWNhbExhYmVsSGVpZ2h0ICsgb3B0aW9ucy5kb21haW5NYXJnaW5bMF07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIG9wdGlvbnMuZG9tYWluTWFyZ2luWzBdO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLmF0dHIoJ2NsYXNzJywgJ2dyYXBoLXN1YmRvbWFpbi1ncm91cCcpO1xuICAgIHZhciByZWN0ID0gc3ViRG9tYWluU3ZnR3JvdXBcbiAgICAgIC5zZWxlY3RBbGwoJ2cnKVxuICAgICAgLmRhdGEoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYuX2RvbWFpbnMuZ2V0KGQpO1xuICAgICAgfSlcbiAgICAgIC5lbnRlcigpXG4gICAgICAuYXBwZW5kKCdnJyk7XG4gICAgcmVjdFxuICAgICAgLmFwcGVuZCgncmVjdCcpXG4gICAgICAuYXR0cignY2xhc3MnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICdncmFwaC1yZWN0JyArXG4gICAgICAgICAgc2VsZi5nZXRIaWdobGlnaHRDbGFzc05hbWUoZC50KSArXG4gICAgICAgICAgKG9wdGlvbnMub25DbGljayAhPT0gbnVsbCA/ICcgaG92ZXJfY3Vyc29yJyA6ICcnKVxuICAgICAgICApO1xuICAgICAgfSlcbiAgICAgIC5hdHRyKCd3aWR0aCcsIG9wdGlvbnMuY2VsbFNpemUpXG4gICAgICAuYXR0cignaGVpZ2h0Jywgb3B0aW9ucy5jZWxsU2l6ZSlcbiAgICAgIC5hdHRyKCd4JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYucG9zaXRpb25TdWJEb21haW5YKGQudCk7XG4gICAgICB9KVxuICAgICAgLmF0dHIoJ3knLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gc2VsZi5wb3NpdGlvblN1YkRvbWFpblkoZC50KTtcbiAgICAgIH0pXG4gICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMub25DbGljayAhPT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiBzZWxmLm9uQ2xpY2sobmV3IERhdGUoZC50KSwgZC52KTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC5jYWxsKGZ1bmN0aW9uIChzZWxlY3Rpb24pIHtcbiAgICAgICAgaWYgKG9wdGlvbnMuY2VsbFJhZGl1cyA+IDApIHtcbiAgICAgICAgICBzZWxlY3Rpb24uYXR0cigncngnLCBvcHRpb25zLmNlbGxSYWRpdXMpLmF0dHIoJ3J5Jywgb3B0aW9ucy5jZWxsUmFkaXVzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChcbiAgICAgICAgICBzZWxmLmxlZ2VuZFNjYWxlICE9PSBudWxsICYmXG4gICAgICAgICAgb3B0aW9ucy5sZWdlbmRDb2xvcnMgIT09IG51bGwgJiZcbiAgICAgICAgICBvcHRpb25zLmxlZ2VuZENvbG9ycy5oYXNPd25Qcm9wZXJ0eSgnYmFzZScpXG4gICAgICAgICkge1xuICAgICAgICAgIHNlbGVjdGlvbi5hdHRyKCdmaWxsJywgb3B0aW9ucy5sZWdlbmRDb2xvcnMuYmFzZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0aW9ucy50b29sdGlwKSB7XG4gICAgICAgICAgc2VsZWN0aW9uXG4gICAgICAgICAgICAub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgIHNlbGYudGlwLnNob3coZCwgdGhpcyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgc2VsZi50aXAuaGlkZShkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgIC8vIEFwcGVuZGluZyBhIHRpdGxlIHRvIGVhY2ggc3ViZG9tYWluXG4gICAgaWYgKCFvcHRpb25zLnRvb2x0aXApIHtcbiAgICAgIHJlY3QuYXBwZW5kKCd0aXRsZScpLnRleHQoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYuZm9ybWF0RGF0ZShuZXcgRGF0ZShkLnQpLCBvcHRpb25zLnN1YkRvbWFpbkRhdGVGb3JtYXQpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4gICAgLy8gUEFJTlRJTkcgTEFCRUwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1xuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuICAgIGlmIChvcHRpb25zLmRvbWFpbkxhYmVsRm9ybWF0ICE9PSAnJykge1xuICAgICAgc3ZnXG4gICAgICAgIC5hcHBlbmQoJ3RleHQnKVxuICAgICAgICAuYXR0cignY2xhc3MnLCAnZ3JhcGgtbGFiZWwnKVxuICAgICAgICAuYXR0cigneScsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgdmFyIHkgPSBvcHRpb25zLmRvbWFpbk1hcmdpblswXTtcbiAgICAgICAgICBzd2l0Y2ggKG9wdGlvbnMubGFiZWwucG9zaXRpb24pIHtcbiAgICAgICAgICAgIGNhc2UgJ3RvcCc6XG4gICAgICAgICAgICAgIHkgKz0gc2VsZi5kb21haW5WZXJ0aWNhbExhYmVsSGVpZ2h0IC8gMjtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdib3R0b20nOlxuICAgICAgICAgICAgICB5ICs9IGgoZCkgKyBzZWxmLmRvbWFpblZlcnRpY2FsTGFiZWxIZWlnaHQgLyAyO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICB5ICtcbiAgICAgICAgICAgIG9wdGlvbnMubGFiZWwub2Zmc2V0LnkgKlxuICAgICAgICAgICAgICAoKG9wdGlvbnMubGFiZWwucm90YXRlID09PSAncmlnaHQnICYmIG9wdGlvbnMubGFiZWwucG9zaXRpb24gPT09ICdyaWdodCcpIHx8XG4gICAgICAgICAgICAgIChvcHRpb25zLmxhYmVsLnJvdGF0ZSA9PT0gJ2xlZnQnICYmIG9wdGlvbnMubGFiZWwucG9zaXRpb24gPT09ICdsZWZ0JylcbiAgICAgICAgICAgICAgICA/IC0xXG4gICAgICAgICAgICAgICAgOiAxKVxuICAgICAgICAgICk7XG4gICAgICAgIH0pXG4gICAgICAgIC5hdHRyKCd4JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICB2YXIgeCA9IG9wdGlvbnMuZG9tYWluTWFyZ2luWzNdO1xuICAgICAgICAgIHN3aXRjaCAob3B0aW9ucy5sYWJlbC5wb3NpdGlvbikge1xuICAgICAgICAgICAgY2FzZSAncmlnaHQnOlxuICAgICAgICAgICAgICB4ICs9IHcoZCk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnYm90dG9tJzpcbiAgICAgICAgICAgIGNhc2UgJ3RvcCc6XG4gICAgICAgICAgICAgIHggKz0gdyhkKSAvIDI7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKG9wdGlvbnMubGFiZWwuYWxpZ24gPT09ICdyaWdodCcpIHtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgIHggK1xuICAgICAgICAgICAgICBzZWxmLmRvbWFpbkhvcml6b250YWxMYWJlbFdpZHRoIC1cbiAgICAgICAgICAgICAgb3B0aW9ucy5sYWJlbC5vZmZzZXQueCAqIChvcHRpb25zLmxhYmVsLnJvdGF0ZSA9PT0gJ3JpZ2h0JyA/IC0xIDogMSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB4ICsgb3B0aW9ucy5sYWJlbC5vZmZzZXQueDtcbiAgICAgICAgfSlcbiAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHN3aXRjaCAob3B0aW9ucy5sYWJlbC5hbGlnbikge1xuICAgICAgICAgICAgY2FzZSAnc3RhcnQnOlxuICAgICAgICAgICAgY2FzZSAnbGVmdCc6XG4gICAgICAgICAgICAgIHJldHVybiAnc3RhcnQnO1xuICAgICAgICAgICAgY2FzZSAnZW5kJzpcbiAgICAgICAgICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgICAgICAgICAgcmV0dXJuICdlbmQnO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgcmV0dXJuICdtaWRkbGUnO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLmF0dHIoJ2RvbWluYW50LWJhc2VsaW5lJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBzZWxmLnZlcnRpY2FsRG9tYWluTGFiZWwgPyAnbWlkZGxlJyA6ICd0b3AnO1xuICAgICAgICB9KVxuICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHJldHVybiBzZWxmLmZvcm1hdERhdGUobmV3IERhdGUoZCksIG9wdGlvbnMuZG9tYWluTGFiZWxGb3JtYXQpO1xuICAgICAgICB9KVxuICAgICAgICAuY2FsbChkb21haW5Sb3RhdGUpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRvbWFpblJvdGF0ZShzZWxlY3Rpb24pIHtcbiAgICAgIHN3aXRjaCAob3B0aW9ucy5sYWJlbC5yb3RhdGUpIHtcbiAgICAgICAgY2FzZSAncmlnaHQnOlxuICAgICAgICAgIHNlbGVjdGlvbi5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgdmFyIHMgPSAncm90YXRlKDkwKSwgJztcbiAgICAgICAgICAgIHN3aXRjaCAob3B0aW9ucy5sYWJlbC5wb3NpdGlvbikge1xuICAgICAgICAgICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgICAgICAgICAgcyArPSAndHJhbnNsYXRlKC0nICsgdyhkKSArICcgLCAtJyArIHcoZCkgKyAnKSc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgJ2xlZnQnOlxuICAgICAgICAgICAgICAgIHMgKz0gJ3RyYW5zbGF0ZSgwLCAtJyArIHNlbGYuZG9tYWluSG9yaXpvbnRhbExhYmVsV2lkdGggKyAnKSc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBzO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdsZWZ0JzpcbiAgICAgICAgICBzZWxlY3Rpb24uYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHZhciBzID0gJ3JvdGF0ZSgyNzApLCAnO1xuICAgICAgICAgICAgc3dpdGNoIChvcHRpb25zLmxhYmVsLnBvc2l0aW9uKSB7XG4gICAgICAgICAgICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgICAgICAgICAgICBzICs9ICd0cmFuc2xhdGUoLScgKyAodyhkKSArIHNlbGYuZG9tYWluSG9yaXpvbnRhbExhYmVsV2lkdGgpICsgJyAsICcgKyB3KGQpICsgJyknO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlICdsZWZ0JzpcbiAgICAgICAgICAgICAgICBzICs9XG4gICAgICAgICAgICAgICAgICAndHJhbnNsYXRlKC0nICtcbiAgICAgICAgICAgICAgICAgIHNlbGYuZG9tYWluSG9yaXpvbnRhbExhYmVsV2lkdGggK1xuICAgICAgICAgICAgICAgICAgJyAsICcgK1xuICAgICAgICAgICAgICAgICAgc2VsZi5kb21haW5Ib3Jpem9udGFsTGFiZWxXaWR0aCArXG4gICAgICAgICAgICAgICAgICAnKSc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBzO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuICAgIC8vIFBBSU5USU5HIERPTUFJTiBTVUJET01BSU4gQ09OVEVOVCAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgICBpZiAob3B0aW9ucy5zdWJEb21haW5UZXh0Rm9ybWF0ICE9PSBudWxsKSB7XG4gICAgICByZWN0XG4gICAgICAgIC5hcHBlbmQoJ3RleHQnKVxuICAgICAgICAuYXR0cignY2xhc3MnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHJldHVybiAnc3ViZG9tYWluLXRleHQnICsgc2VsZi5nZXRIaWdobGlnaHRDbGFzc05hbWUoZC50KTtcbiAgICAgICAgfSlcbiAgICAgICAgLmF0dHIoJ3gnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHJldHVybiBzZWxmLnBvc2l0aW9uU3ViRG9tYWluWChkLnQpICsgb3B0aW9ucy5jZWxsU2l6ZSAvIDI7XG4gICAgICAgIH0pXG4gICAgICAgIC5hdHRyKCd5JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICByZXR1cm4gc2VsZi5wb3NpdGlvblN1YkRvbWFpblkoZC50KSArIG9wdGlvbnMuY2VsbFNpemUgLyAyO1xuICAgICAgICB9KVxuICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCAnbWlkZGxlJylcbiAgICAgICAgLmF0dHIoJ2RvbWluYW50LWJhc2VsaW5lJywgJ2NlbnRyYWwnKVxuICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHJldHVybiBzZWxmLmZvcm1hdERhdGUobmV3IERhdGUoZC50KSwgb3B0aW9ucy5zdWJEb21haW5UZXh0Rm9ybWF0KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4gICAgLy8gQU5JTUFUSU9OICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1xuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuXG4gICAgaWYgKG5hdmlnYXRpb25EaXIgIT09IGZhbHNlKSB7XG4gICAgICBkb21haW5TdmdcbiAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAuZHVyYXRpb24ob3B0aW9ucy5hbmltYXRpb25EdXJhdGlvbilcbiAgICAgICAgLmF0dHIoJ3gnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHJldHVybiBvcHRpb25zLnZlcnRpY2FsT3JpZW50YXRpb24gPyAwIDogc2VsZi5kb21haW5Qb3NpdGlvbi5nZXRQb3NpdGlvbihkKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmF0dHIoJ3knLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHJldHVybiBvcHRpb25zLnZlcnRpY2FsT3JpZW50YXRpb24gPyBzZWxmLmRvbWFpblBvc2l0aW9uLmdldFBvc2l0aW9uKGQpIDogMDtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgdmFyIHRlbXBXaWR0aCA9IHNlbGYuZ3JhcGhEaW0ud2lkdGg7XG4gICAgdmFyIHRlbXBIZWlnaHQgPSBzZWxmLmdyYXBoRGltLmhlaWdodDtcblxuICAgIGlmIChvcHRpb25zLnZlcnRpY2FsT3JpZW50YXRpb24pIHtcbiAgICAgIHNlbGYuZ3JhcGhEaW0uaGVpZ2h0ICs9IGVudGVyaW5nRG9tYWluRGltIC0gZXhpdGluZ0RvbWFpbkRpbTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5ncmFwaERpbS53aWR0aCArPSBlbnRlcmluZ0RvbWFpbkRpbSAtIGV4aXRpbmdEb21haW5EaW07XG4gICAgfVxuXG4gICAgLy8gQXQgdGhlIHRpbWUgb2YgZXhpdCwgZG9tYWluc1dpZHRoIGFuZCBkb21haW5zSGVpZ2h0IGFscmVhZHkgYXV0b21hdGljYWxseSBzaGlmdGVkXG4gICAgZG9tYWluU3ZnXG4gICAgICAuZXhpdCgpXG4gICAgICAudHJhbnNpdGlvbigpXG4gICAgICAuZHVyYXRpb24ob3B0aW9ucy5hbmltYXRpb25EdXJhdGlvbilcbiAgICAgIC5hdHRyKCd4JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMudmVydGljYWxPcmllbnRhdGlvbikge1xuICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN3aXRjaCAobmF2aWdhdGlvbkRpcikge1xuICAgICAgICAgICAgY2FzZSBzZWxmLk5BVklHQVRFX0xFRlQ6XG4gICAgICAgICAgICAgIHJldHVybiBNYXRoLm1pbihzZWxmLmdyYXBoRGltLndpZHRoLCB0ZW1wV2lkdGgpO1xuICAgICAgICAgICAgY2FzZSBzZWxmLk5BVklHQVRFX1JJR0hUOlxuICAgICAgICAgICAgICByZXR1cm4gLXcoZCwgdHJ1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLmF0dHIoJ3knLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICBpZiAob3B0aW9ucy52ZXJ0aWNhbE9yaWVudGF0aW9uKSB7XG4gICAgICAgICAgc3dpdGNoIChuYXZpZ2F0aW9uRGlyKSB7XG4gICAgICAgICAgICBjYXNlIHNlbGYuTkFWSUdBVEVfTEVGVDpcbiAgICAgICAgICAgICAgcmV0dXJuIE1hdGgubWluKHNlbGYuZ3JhcGhEaW0uaGVpZ2h0LCB0ZW1wSGVpZ2h0KTtcbiAgICAgICAgICAgIGNhc2Ugc2VsZi5OQVZJR0FURV9SSUdIVDpcbiAgICAgICAgICAgICAgcmV0dXJuIC1oKGQsIHRydWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC5yZW1vdmUoKTtcblxuICAgIC8vIFJlc2l6ZSB0aGUgcm9vdCBjb250YWluZXJcbiAgICBzZWxmLnJlc2l6ZSgpO1xuICB9O1xufTtcblxuQ2FsSGVhdE1hcC5wcm90b3R5cGUgPSB7XG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBhbmQgbWVyZ2UgdXNlciBzZXR0aW5ncyB3aXRoIGRlZmF1bHQgc2V0dGluZ3NcbiAgICpcbiAgICogQHBhcmFtICB7b2JqZWN0fSBzZXR0aW5ncyBVc2VyIHNldHRpbmdzXG4gICAqIEByZXR1cm4ge2Jvb2x9IEZhbHNlIGlmIHNldHRpbmdzIGNvbnRhaW5zIGVycm9yXG4gICAqL1xuICAvKiBqc2hpbnQgbWF4c3RhdGVtZW50czpmYWxzZSAqL1xuICBpbml0OiBmdW5jdGlvbiAoc2V0dGluZ3MpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgcGFyZW50ID0gdGhpcztcblxuICAgIHZhciBvcHRpb25zID0gKHBhcmVudC5vcHRpb25zID0gbWVyZ2VSZWN1cnNpdmUocGFyZW50Lm9wdGlvbnMsIHNldHRpbmdzKSk7XG5cbiAgICAvLyBGYXRhbCBlcnJvcnNcbiAgICAvLyBTdG9wIHNjcmlwdCBleGVjdXRpb24gb24gZXJyb3JcbiAgICB2YWxpZGF0ZURvbWFpblR5cGUoKTtcbiAgICB2YWxpZGF0ZVNlbGVjdG9yKG9wdGlvbnMuaXRlbVNlbGVjdG9yLCBmYWxzZSwgJ2l0ZW1TZWxlY3RvcicpO1xuXG4gICAgaWYgKHBhcmVudC5hbGxvd2VkRGF0YVR5cGUuaW5kZXhPZihvcHRpb25zLmRhdGFUeXBlKSA9PT0gLTEpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZSBkYXRhIHR5cGUgJ1wiICsgb3B0aW9ucy5kYXRhVHlwZSArIFwiJyBpcyBub3QgdmFsaWQgZGF0YSB0eXBlXCIpO1xuICAgIH1cblxuICAgIGlmIChkMy5zZWxlY3Qob3B0aW9ucy5pdGVtU2VsZWN0b3IpWzBdWzBdID09PSBudWxsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIFwiVGhlIG5vZGUgJ1wiICsgb3B0aW9ucy5pdGVtU2VsZWN0b3IgKyBcIicgc3BlY2lmaWVkIGluIGl0ZW1TZWxlY3RvciBkb2VzIG5vdCBleGlzdHNcIixcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIHZhbGlkYXRlU2VsZWN0b3Iob3B0aW9ucy5uZXh0U2VsZWN0b3IsIHRydWUsICduZXh0U2VsZWN0b3InKTtcbiAgICAgIHZhbGlkYXRlU2VsZWN0b3Iob3B0aW9ucy5wcmV2aW91c1NlbGVjdG9yLCB0cnVlLCAncHJldmlvdXNTZWxlY3RvcicpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmxvZyhlcnJvci5tZXNzYWdlKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBJZiBvdGhlciBzZXR0aW5ncyBjb250YWlucyBlcnJvciwgd2lsbCBmYWxsYmFjayB0byBkZWZhdWx0XG5cbiAgICBpZiAoIXNldHRpbmdzLmhhc093blByb3BlcnR5KCdzdWJEb21haW4nKSkge1xuICAgICAgdGhpcy5vcHRpb25zLnN1YkRvbWFpbiA9IGdldE9wdGltYWxTdWJEb21haW4oc2V0dGluZ3MuZG9tYWluKTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIG9wdGlvbnMuaXRlbU5hbWVzcGFjZSAhPT0gJ3N0cmluZycgfHwgb3B0aW9ucy5pdGVtTmFtZXNwYWNlID09PSAnJykge1xuICAgICAgY29uc29sZS5sb2coJ2l0ZW1OYW1lc3BhY2UgY2FuIG5vdCBiZSBlbXB0eSwgZmFsbGluZyBiYWNrIHRvIGNhbC1oZWF0bWFwJyk7XG4gICAgICBvcHRpb25zLml0ZW1OYW1lc3BhY2UgPSAnY2FsLWhlYXRtYXAnO1xuICAgIH1cblxuICAgIC8vIERvbid0IHRvdWNoIHRoZXNlIHNldHRpbmdzXG4gICAgdmFyIHMgPSBbXG4gICAgICAnZGF0YScsXG4gICAgICAnb25Db21wbGV0ZScsXG4gICAgICAnb25DbGljaycsXG4gICAgICAnYWZ0ZXJMb2FkJyxcbiAgICAgICdhZnRlckxvYWREYXRhJyxcbiAgICAgICdhZnRlckxvYWRQcmV2aW91c0RvbWFpbicsXG4gICAgICAnYWZ0ZXJMb2FkTmV4dERvbWFpbicsXG4gICAgICAnYWZ0ZXJVcGRhdGUnLFxuICAgIF07XG5cbiAgICBmb3IgKHZhciBrIGluIHMpIHtcbiAgICAgIGlmIChzZXR0aW5ncy5oYXNPd25Qcm9wZXJ0eShzW2tdKSkge1xuICAgICAgICBvcHRpb25zW3Nba11dID0gc2V0dGluZ3Nbc1trXV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgb3B0aW9ucy5zdWJEb21haW5EYXRlRm9ybWF0ID1cbiAgICAgIHR5cGVvZiBvcHRpb25zLnN1YkRvbWFpbkRhdGVGb3JtYXQgPT09ICdzdHJpbmcnIHx8XG4gICAgICB0eXBlb2Ygb3B0aW9ucy5zdWJEb21haW5EYXRlRm9ybWF0ID09PSAnZnVuY3Rpb24nXG4gICAgICAgID8gb3B0aW9ucy5zdWJEb21haW5EYXRlRm9ybWF0XG4gICAgICAgIDogdGhpcy5fZG9tYWluVHlwZVtvcHRpb25zLnN1YkRvbWFpbl0uZm9ybWF0LmRhdGU7XG4gICAgb3B0aW9ucy5kb21haW5MYWJlbEZvcm1hdCA9XG4gICAgICB0eXBlb2Ygb3B0aW9ucy5kb21haW5MYWJlbEZvcm1hdCA9PT0gJ3N0cmluZycgfHxcbiAgICAgIHR5cGVvZiBvcHRpb25zLmRvbWFpbkxhYmVsRm9ybWF0ID09PSAnZnVuY3Rpb24nXG4gICAgICAgID8gb3B0aW9ucy5kb21haW5MYWJlbEZvcm1hdFxuICAgICAgICA6IHRoaXMuX2RvbWFpblR5cGVbb3B0aW9ucy5kb21haW5dLmZvcm1hdC5sZWdlbmQ7XG4gICAgb3B0aW9ucy5zdWJEb21haW5UZXh0Rm9ybWF0ID1cbiAgICAgICh0eXBlb2Ygb3B0aW9ucy5zdWJEb21haW5UZXh0Rm9ybWF0ID09PSAnc3RyaW5nJyAmJiBvcHRpb25zLnN1YkRvbWFpblRleHRGb3JtYXQgIT09ICcnKSB8fFxuICAgICAgdHlwZW9mIG9wdGlvbnMuc3ViRG9tYWluVGV4dEZvcm1hdCA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICA/IG9wdGlvbnMuc3ViRG9tYWluVGV4dEZvcm1hdFxuICAgICAgICA6IG51bGw7XG4gICAgb3B0aW9ucy5kb21haW5NYXJnaW4gPSBleHBhbmRNYXJnaW5TZXR0aW5nKG9wdGlvbnMuZG9tYWluTWFyZ2luKTtcbiAgICBvcHRpb25zLmxlZ2VuZE1hcmdpbiA9IGV4cGFuZE1hcmdpblNldHRpbmcob3B0aW9ucy5sZWdlbmRNYXJnaW4pO1xuICAgIG9wdGlvbnMuaGlnaGxpZ2h0ID0gcGFyZW50LmV4cGFuZERhdGVTZXR0aW5nKG9wdGlvbnMuaGlnaGxpZ2h0KTtcbiAgICBvcHRpb25zLml0ZW1OYW1lID0gZXhwYW5kSXRlbU5hbWUob3B0aW9ucy5pdGVtTmFtZSk7XG4gICAgb3B0aW9ucy5jb2xMaW1pdCA9IHBhcnNlQ29sTGltaXQob3B0aW9ucy5jb2xMaW1pdCk7XG4gICAgb3B0aW9ucy5yb3dMaW1pdCA9IHBhcnNlUm93TGltaXQob3B0aW9ucy5yb3dMaW1pdCk7XG4gICAgaWYgKCFzZXR0aW5ncy5oYXNPd25Qcm9wZXJ0eSgnbGVnZW5kTWFyZ2luJykpIHtcbiAgICAgIGF1dG9BZGRMZWdlbmRNYXJnaW4oKTtcbiAgICB9XG4gICAgYXV0b0FsaWduTGFiZWwoKTtcblxuICAgIC8qKlxuICAgICAqIFZhbGlkYXRlIHRoYXQgYSBxdWVyeVN0cmluZyBpcyB2YWxpZFxuICAgICAqXG4gICAgICogQHBhcmFtICB7RWxlbWVudHxzdHJpbmd8Ym9vbH0gc2VsZWN0b3IgICBUaGUgcXVlcnlTdHJpbmcgdG8gdGVzdFxuICAgICAqIEBwYXJhbSAge2Jvb2x9ICBjYW5CZUZhbHNlICBXaGV0aGVyIGZhbHNlIGlzIGFuIGFjY2VwdGVkIGFuZCB2YWxpZCB2YWx1ZVxuICAgICAqIEBwYXJhbSAge3N0cmluZ30gbmFtZSAgICBOYW1lIG9mIHRoZSB0ZXN0ZWQgc2VsZWN0b3JcbiAgICAgKiBAdGhyb3dzIHtFcnJvcn0gICAgICAgIElmIHRoZSBzZWxlY3RvciBpcyBub3QgdmFsaWRcbiAgICAgKiBAcmV0dXJuIHtib29sfSAgICAgICAgVHJ1ZSBpZiB0aGUgc2VsZWN0b3IgaXMgYSB2YWxpZCBxdWVyeVN0cmluZ1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIHZhbGlkYXRlU2VsZWN0b3Ioc2VsZWN0b3IsIGNhbkJlRmFsc2UsIG5hbWUpIHtcbiAgICAgIGlmIChcbiAgICAgICAgKChjYW5CZUZhbHNlICYmIHNlbGVjdG9yID09PSBmYWxzZSkgfHxcbiAgICAgICAgICBzZWxlY3RvciBpbnN0YW5jZW9mIEVsZW1lbnQgfHxcbiAgICAgICAgICB0eXBlb2Ygc2VsZWN0b3IgPT09ICdzdHJpbmcnKSAmJlxuICAgICAgICBzZWxlY3RvciAhPT0gJydcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcignVGhlICcgKyBuYW1lICsgJyBpcyBub3QgdmFsaWQnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gdGhlIG9wdGltYWwgc3ViRG9tYWluIGZvciB0aGUgc3BlY2lmaWVkIGRvbWFpblxuICAgICAqXG4gICAgICogQHBhcmFtICB7c3RyaW5nfSBkb21haW4gYSBkb21haW4gbmFtZVxuICAgICAqIEByZXR1cm4ge3N0cmluZ30gICAgICAgIHRoZSBzdWJEb21haW4gbmFtZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdldE9wdGltYWxTdWJEb21haW4oZG9tYWluKSB7XG4gICAgICBzd2l0Y2ggKGRvbWFpbikge1xuICAgICAgICBjYXNlICd5ZWFyJzpcbiAgICAgICAgICByZXR1cm4gJ21vbnRoJztcbiAgICAgICAgY2FzZSAnbW9udGgnOlxuICAgICAgICAgIHJldHVybiAnZGF5JztcbiAgICAgICAgY2FzZSAnd2Vlayc6XG4gICAgICAgICAgcmV0dXJuICdkYXknO1xuICAgICAgICBjYXNlICdkYXknOlxuICAgICAgICAgIHJldHVybiAnaG91cic7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuICdtaW4nO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEVuc3VyZSB0aGF0IHRoZSBkb21haW4gYW5kIHN1YmRvbWFpbiBhcmUgdmFsaWRcbiAgICAgKlxuICAgICAqIEB0aHJvdyB7RXJyb3J9IHdoZW4gZG9tYWluIG9yIHN1YmRvbWFpbiBhcmUgbm90IHZhbGlkXG4gICAgICogQHJldHVybiB7Ym9vbH0gVHJ1ZSBpZiBkb21haW4gYW5kIHN1YmRvbWFpbiBhcmUgdmFsaWQgYW5kIGNvbXBhdGlibGVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB2YWxpZGF0ZURvbWFpblR5cGUoKSB7XG4gICAgICBpZiAoXG4gICAgICAgICFwYXJlbnQuX2RvbWFpblR5cGUuaGFzT3duUHJvcGVydHkob3B0aW9ucy5kb21haW4pIHx8XG4gICAgICAgIG9wdGlvbnMuZG9tYWluID09PSAnbWluJyB8fFxuICAgICAgICBvcHRpb25zLmRvbWFpbi5zdWJzdHJpbmcoMCwgMikgPT09ICd4XydcbiAgICAgICkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgZG9tYWluICdcIiArIG9wdGlvbnMuZG9tYWluICsgXCInIGlzIG5vdCB2YWxpZFwiKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFwYXJlbnQuX2RvbWFpblR5cGUuaGFzT3duUHJvcGVydHkob3B0aW9ucy5zdWJEb21haW4pIHx8IG9wdGlvbnMuc3ViRG9tYWluID09PSAneWVhcicpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlIHN1YkRvbWFpbiAnXCIgKyBvcHRpb25zLnN1YkRvbWFpbiArIFwiJyBpcyBub3QgdmFsaWRcIik7XG4gICAgICB9XG5cbiAgICAgIGlmIChwYXJlbnQuX2RvbWFpblR5cGVbb3B0aW9ucy5kb21haW5dLmxldmVsIDw9IHBhcmVudC5fZG9tYWluVHlwZVtvcHRpb25zLnN1YkRvbWFpbl0ubGV2ZWwpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiJ1wiICsgb3B0aW9ucy5zdWJEb21haW4gKyBcIicgaXMgbm90IGEgdmFsaWQgc3ViRG9tYWluIHRvICdcIiArIG9wdGlvbnMuZG9tYWluICsgXCInXCIsXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpbmUtdHVuZSB0aGUgbGFiZWwgYWxpZ25lbWVudCBkZXBlbmRpbmcgb24gaXRzIHBvc2l0aW9uXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHZvaWRcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhdXRvQWxpZ25MYWJlbCgpIHtcbiAgICAgIC8vIEF1dG8tYWxpZ24gbGFiZWwsIGRlcGVuZGluZyBvbiBpdCdzIHBvc2l0aW9uXG4gICAgICBpZiAoXG4gICAgICAgICFzZXR0aW5ncy5oYXNPd25Qcm9wZXJ0eSgnbGFiZWwnKSB8fFxuICAgICAgICAoc2V0dGluZ3MuaGFzT3duUHJvcGVydHkoJ2xhYmVsJykgJiYgIXNldHRpbmdzLmxhYmVsLmhhc093blByb3BlcnR5KCdhbGlnbicpKVxuICAgICAgKSB7XG4gICAgICAgIHN3aXRjaCAob3B0aW9ucy5sYWJlbC5wb3NpdGlvbikge1xuICAgICAgICAgIGNhc2UgJ2xlZnQnOlxuICAgICAgICAgICAgb3B0aW9ucy5sYWJlbC5hbGlnbiA9ICdyaWdodCc7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgICAgICBvcHRpb25zLmxhYmVsLmFsaWduID0gJ2xlZnQnO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIG9wdGlvbnMubGFiZWwuYWxpZ24gPSAnY2VudGVyJztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvcHRpb25zLmxhYmVsLnJvdGF0ZSA9PT0gJ2xlZnQnKSB7XG4gICAgICAgICAgb3B0aW9ucy5sYWJlbC5hbGlnbiA9ICdyaWdodCc7XG4gICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5sYWJlbC5yb3RhdGUgPT09ICdyaWdodCcpIHtcbiAgICAgICAgICBvcHRpb25zLmxhYmVsLmFsaWduID0gJ2xlZnQnO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgIXNldHRpbmdzLmhhc093blByb3BlcnR5KCdsYWJlbCcpIHx8XG4gICAgICAgIChzZXR0aW5ncy5oYXNPd25Qcm9wZXJ0eSgnbGFiZWwnKSAmJiAhc2V0dGluZ3MubGFiZWwuaGFzT3duUHJvcGVydHkoJ29mZnNldCcpKVxuICAgICAgKSB7XG4gICAgICAgIGlmIChvcHRpb25zLmxhYmVsLnBvc2l0aW9uID09PSAnbGVmdCcgfHwgb3B0aW9ucy5sYWJlbC5wb3NpdGlvbiA9PT0gJ3JpZ2h0Jykge1xuICAgICAgICAgIG9wdGlvbnMubGFiZWwub2Zmc2V0ID0ge1xuICAgICAgICAgICAgeDogMTAsXG4gICAgICAgICAgICB5OiAxNSxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSWYgbm90IHNwZWNpZmllZCwgYWRkIHNvbWUgbWFyZ2luIGFyb3VuZCB0aGUgbGVnZW5kIGRlcGVuZGluZyBvbiBpdHMgcG9zaXRpb25cbiAgICAgKlxuICAgICAqIEByZXR1cm4gdm9pZFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGF1dG9BZGRMZWdlbmRNYXJnaW4oKSB7XG4gICAgICBzd2l0Y2ggKG9wdGlvbnMubGVnZW5kVmVydGljYWxQb3NpdGlvbikge1xuICAgICAgICBjYXNlICd0b3AnOlxuICAgICAgICAgIG9wdGlvbnMubGVnZW5kTWFyZ2luWzJdID0gcGFyZW50LkRFRkFVTFRfTEVHRU5EX01BUkdJTjtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnYm90dG9tJzpcbiAgICAgICAgICBvcHRpb25zLmxlZ2VuZE1hcmdpblswXSA9IHBhcmVudC5ERUZBVUxUX0xFR0VORF9NQVJHSU47XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ21pZGRsZSc6XG4gICAgICAgIGNhc2UgJ2NlbnRlcic6XG4gICAgICAgICAgb3B0aW9ucy5sZWdlbmRNYXJnaW5bb3B0aW9ucy5sZWdlbmRIb3Jpem9udGFsUG9zaXRpb24gPT09ICdyaWdodCcgPyAzIDogMV0gPVxuICAgICAgICAgICAgcGFyZW50LkRFRkFVTFRfTEVHRU5EX01BUkdJTjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFeHBhbmQgYSBudW1iZXIgb2YgYW4gYXJyYXkgb2YgbnVtYmVycyB0byBhbiB1c2FibGUgNCB2YWx1ZXMgYXJyYXlcbiAgICAgKlxuICAgICAqIEBwYXJhbSAge2ludGVnZXJ8YXJyYXl9IHZhbHVlXG4gICAgICogQHJldHVybiB7YXJyYXl9ICAgICAgICBhcnJheVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGV4cGFuZE1hcmdpblNldHRpbmcodmFsdWUpIHtcbiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInKSB7XG4gICAgICAgIHZhbHVlID0gW3ZhbHVlXTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICBjb25zb2xlLmxvZygnTWFyZ2luIG9ubHkgdGFrZXMgYW4gaW50ZWdlciBvciBhbiBhcnJheSBvZiBpbnRlZ2VycycpO1xuICAgICAgICB2YWx1ZSA9IFswXTtcbiAgICAgIH1cblxuICAgICAgc3dpdGNoICh2YWx1ZS5sZW5ndGgpIHtcbiAgICAgICAgY2FzZSAxOlxuICAgICAgICAgIHJldHVybiBbdmFsdWVbMF0sIHZhbHVlWzBdLCB2YWx1ZVswXSwgdmFsdWVbMF1dO1xuICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgcmV0dXJuIFt2YWx1ZVswXSwgdmFsdWVbMV0sIHZhbHVlWzBdLCB2YWx1ZVsxXV07XG4gICAgICAgIGNhc2UgMzpcbiAgICAgICAgICByZXR1cm4gW3ZhbHVlWzBdLCB2YWx1ZVsxXSwgdmFsdWVbMl0sIHZhbHVlWzFdXTtcbiAgICAgICAgY2FzZSA0OlxuICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXR1cm4gdmFsdWUuc2xpY2UoMCwgNCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29udmVydCBhIHN0cmluZyB0byBhbiBhcnJheSBsaWtlIFtzaW5ndWxhci1mb3JtLCBwbHVyYWwtZm9ybV1cbiAgICAgKlxuICAgICAqIEBwYXJhbSAge3N0cmluZ3xhcnJheX0gdmFsdWUgRGF0ZSB0byBjb252ZXJ0XG4gICAgICogQHJldHVybiB7YXJyYXl9ICAgICAgIEFuIGFycmF5IGxpa2UgW3Npbmd1bGFyLWZvcm0sIHBsdXJhbC1mb3JtXVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGV4cGFuZEl0ZW1OYW1lKHZhbHVlKSB7XG4gICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICByZXR1cm4gW3ZhbHVlLCB2YWx1ZSArICh2YWx1ZSAhPT0gJycgPyAncycgOiAnJyldO1xuICAgICAgfVxuXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgIHJldHVybiBbdmFsdWVbMF0sIHZhbHVlWzBdICsgJ3MnXTtcbiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZS5sZW5ndGggPiAyKSB7XG4gICAgICAgICAgcmV0dXJuIHZhbHVlLnNsaWNlKDAsIDIpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gWydpdGVtJywgJ2l0ZW1zJ107XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcGFyc2VDb2xMaW1pdCh2YWx1ZSkge1xuICAgICAgcmV0dXJuIHZhbHVlID4gMCA/IHZhbHVlIDogbnVsbDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBwYXJzZVJvd0xpbWl0KHZhbHVlKSB7XG4gICAgICBpZiAodmFsdWUgPiAwICYmIG9wdGlvbnMuY29sTGltaXQgPiAwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdjb2xMaW1pdCBhbmQgcm93TGltaXQgYXJlIG11dHVhbGx5IGV4Y2x1c2l2ZSwgcm93TGltaXQgd2lsbCBiZSBpZ25vcmVkJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHZhbHVlID4gMCA/IHZhbHVlIDogbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5faW5pdCgpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBDb252ZXJ0IGEga2V5d29yZCBvciBhbiBhcnJheSBvZiBrZXl3b3JkL2RhdGUgdG8gYW4gYXJyYXkgb2YgZGF0ZSBvYmplY3RzXG4gICAqXG4gICAqIEBwYXJhbSAge3N0cmluZ3xhcnJheXxEYXRlfSB2YWx1ZSBEYXRhIHRvIGNvbnZlcnRcbiAgICogQHJldHVybiB7YXJyYXl9ICAgICAgIEFuIGFycmF5IG9mIERhdGVzXG4gICAqL1xuICBleHBhbmREYXRlU2V0dGluZzogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKCFBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgdmFsdWUgPSBbdmFsdWVdO1xuICAgIH1cblxuICAgIHJldHVybiB2YWx1ZVxuICAgICAgLm1hcChmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBpZiAoZGF0YSA9PT0gJ25vdycpIHtcbiAgICAgICAgICByZXR1cm4gbmV3IERhdGUoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KVxuICAgICAgLmZpbHRlcihmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gZCAhPT0gZmFsc2U7XG4gICAgICB9KTtcbiAgfSxcblxuICAvKipcbiAgICogRmlsbCB0aGUgY2FsZW5kYXIgYnkgY29sb3JpbmcgdGhlIGNlbGxzXG4gICAqXG4gICAqIEBwYXJhbSBhcnJheSBzdmcgQW4gYXJyYXkgb2YgaHRtbCBub2RlIHRvIGFwcGx5IHRoZSB0cmFuc2Zvcm1hdGlvbiB0byAob3B0aW9uYWwpXG4gICAqICAgICAgICAgICAgICAgICAgSXQncyB1c2VkIHRvIGxpbWl0IHRoZSBwYWludGluZyB0byBvbmx5IGEgc3Vic2V0IG9mIHRoZSBjYWxlbmRhclxuICAgKiBAcmV0dXJuIHZvaWRcbiAgICovXG4gIGZpbGw6IGZ1bmN0aW9uIChzdmcpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgcGFyZW50ID0gdGhpcztcbiAgICB2YXIgb3B0aW9ucyA9IHBhcmVudC5vcHRpb25zO1xuXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHN2ZyA9IHBhcmVudC5yb290LnNlbGVjdEFsbCgnLmdyYXBoLWRvbWFpbicpO1xuICAgIH1cblxuICAgIHZhciByZWN0ID0gc3ZnXG4gICAgICAuc2VsZWN0QWxsKCdzdmcnKVxuICAgICAgLnNlbGVjdEFsbCgnZycpXG4gICAgICAuZGF0YShmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gcGFyZW50Ll9kb21haW5zLmdldChkKTtcbiAgICAgIH0pO1xuICAgIC8qKlxuICAgICAqIENvbG9yaXplIHRoZSBjZWxsIHZpYSBhIHN0eWxlIGF0dHJpYnV0ZSBpZiBlbmFibGVkXG4gICAgICovXG4gICAgZnVuY3Rpb24gYWRkU3R5bGUoZWxlbWVudCkge1xuICAgICAgaWYgKHBhcmVudC5sZWdlbmRTY2FsZSA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGVsZW1lbnQuYXR0cignZmlsbCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBkLnYgPT09IG51bGwgJiZcbiAgICAgICAgICBvcHRpb25zLmhhc093blByb3BlcnR5KCdjb25zaWRlck1pc3NpbmdEYXRhQXNaZXJvJykgJiZcbiAgICAgICAgICAhb3B0aW9ucy5jb25zaWRlck1pc3NpbmdEYXRhQXNaZXJvXG4gICAgICAgICkge1xuICAgICAgICAgIGlmIChvcHRpb25zLmxlZ2VuZENvbG9ycy5oYXNPd25Qcm9wZXJ0eSgnYmFzZScpKSB7XG4gICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5sZWdlbmRDb2xvcnMuYmFzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoXG4gICAgICAgICAgb3B0aW9ucy5sZWdlbmRDb2xvcnMgIT09IG51bGwgJiZcbiAgICAgICAgICBvcHRpb25zLmxlZ2VuZENvbG9ycy5oYXNPd25Qcm9wZXJ0eSgnZW1wdHknKSAmJlxuICAgICAgICAgIChkLnYgPT09IDAgfHxcbiAgICAgICAgICAgIChkLnYgPT09IG51bGwgJiZcbiAgICAgICAgICAgICAgb3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgnY29uc2lkZXJNaXNzaW5nRGF0YUFzWmVybycpICYmXG4gICAgICAgICAgICAgIG9wdGlvbnMuY29uc2lkZXJNaXNzaW5nRGF0YUFzWmVybykpXG4gICAgICAgICkge1xuICAgICAgICAgIHJldHVybiBvcHRpb25zLmxlZ2VuZENvbG9ycy5lbXB0eTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChcbiAgICAgICAgICBkLnYgPCAwICYmXG4gICAgICAgICAgb3B0aW9ucy5sZWdlbmRbMF0gPiAwICYmXG4gICAgICAgICAgb3B0aW9ucy5sZWdlbmRDb2xvcnMgIT09IG51bGwgJiZcbiAgICAgICAgICBvcHRpb25zLmxlZ2VuZENvbG9ycy5oYXNPd25Qcm9wZXJ0eSgnb3ZlcmZsb3cnKVxuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm4gb3B0aW9ucy5sZWdlbmRDb2xvcnMub3ZlcmZsb3c7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcGFyZW50LmxlZ2VuZFNjYWxlKE1hdGgubWluKGQudiwgb3B0aW9ucy5sZWdlbmRbb3B0aW9ucy5sZWdlbmQubGVuZ3RoIC0gMV0pKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJlY3RcbiAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgIC5kdXJhdGlvbihvcHRpb25zLmFuaW1hdGlvbkR1cmF0aW9uKVxuICAgICAgLnNlbGVjdCgncmVjdCcpXG4gICAgICAuYXR0cignY2xhc3MnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICB2YXIgaHRtbENsYXNzID0gcGFyZW50LmdldEhpZ2hsaWdodENsYXNzTmFtZShkLnQpLnRyaW0oKS5zcGxpdCgnICcpO1xuICAgICAgICB2YXIgcGFzdERhdGUgPSBwYXJlbnQuZGF0ZUlzTGVzc1RoYW4oZC50LCBuZXcgRGF0ZSgpKTtcbiAgICAgICAgdmFyIHNhbWVEYXRlID0gcGFyZW50LmRhdGVJc0VxdWFsKGQudCwgbmV3IERhdGUoKSk7XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIHBhcmVudC5sZWdlbmRTY2FsZSA9PT0gbnVsbCB8fFxuICAgICAgICAgIChkLnYgPT09IG51bGwgJiZcbiAgICAgICAgICAgIG9wdGlvbnMuaGFzT3duUHJvcGVydHkoJ2NvbnNpZGVyTWlzc2luZ0RhdGFBc1plcm8nKSAmJlxuICAgICAgICAgICAgIW9wdGlvbnMuY29uc2lkZXJNaXNzaW5nRGF0YUFzWmVybyAmJlxuICAgICAgICAgICAgIW9wdGlvbnMubGVnZW5kQ29sb3JzLmhhc093blByb3BlcnR5KCdiYXNlJykpXG4gICAgICAgICkge1xuICAgICAgICAgIGh0bWxDbGFzcy5wdXNoKCdncmFwaC1yZWN0Jyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoc2FtZURhdGUpIHtcbiAgICAgICAgICBodG1sQ2xhc3MucHVzaCgnbm93Jyk7XG4gICAgICAgIH0gZWxzZSBpZiAoIXBhc3REYXRlKSB7XG4gICAgICAgICAgaHRtbENsYXNzLnB1c2goJ2Z1dHVyZScpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGQudiAhPT0gbnVsbCkge1xuICAgICAgICAgIGh0bWxDbGFzcy5wdXNoKHBhcmVudC5MZWdlbmQuZ2V0Q2xhc3MoZC52LCBwYXJlbnQubGVnZW5kU2NhbGUgPT09IG51bGwpKTtcbiAgICAgICAgfSBlbHNlIGlmIChvcHRpb25zLmNvbnNpZGVyTWlzc2luZ0RhdGFBc1plcm8gJiYgcGFzdERhdGUpIHtcbiAgICAgICAgICBodG1sQ2xhc3MucHVzaChwYXJlbnQuTGVnZW5kLmdldENsYXNzKDAsIHBhcmVudC5sZWdlbmRTY2FsZSA9PT0gbnVsbCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMub25DbGljayAhPT0gbnVsbCkge1xuICAgICAgICAgIGh0bWxDbGFzcy5wdXNoKCdob3Zlcl9jdXJzb3InKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBodG1sQ2xhc3Muam9pbignICcpO1xuICAgICAgfSlcbiAgICAgIC5jYWxsKGFkZFN0eWxlKTtcblxuICAgIHJlY3RcbiAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgIC5kdXJhdGlvbihvcHRpb25zLmFuaW1hdGlvbkR1cmF0aW9uKVxuICAgICAgLnNlbGVjdCgndGl0bGUnKVxuICAgICAgLnRleHQoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHBhcmVudC5nZXRTdWJEb21haW5UaXRsZShkKTtcbiAgICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gZm9ybWF0U3ViRG9tYWluVGV4dChlbGVtZW50KSB7XG4gICAgICBpZiAodHlwZW9mIG9wdGlvbnMuc3ViRG9tYWluVGV4dEZvcm1hdCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBlbGVtZW50LnRleHQoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICByZXR1cm4gb3B0aW9ucy5zdWJEb21haW5UZXh0Rm9ybWF0KGQudCwgZC52KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hhbmdlIHRoZSBzdWJEb21haW5UZXh0IGNsYXNzIGlmIG5lY2Vzc2FyeVxuICAgICAqIEFsc28gY2hhbmdlIHRoZSB0ZXh0LCBlLmcgd2hlbiB0ZXh0IGlzIHJlcHJlc2VudGluZyB0aGUgdmFsdWVcbiAgICAgKiBpbnN0ZWFkIG9mIHRoZSBkYXRlXG4gICAgICovXG4gICAgcmVjdFxuICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgLmR1cmF0aW9uKG9wdGlvbnMuYW5pbWF0aW9uRHVyYXRpb24pXG4gICAgICAuc2VsZWN0KCd0ZXh0JylcbiAgICAgIC5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiAnc3ViZG9tYWluLXRleHQnICsgcGFyZW50LmdldEhpZ2hsaWdodENsYXNzTmFtZShkLnQpO1xuICAgICAgfSlcbiAgICAgIC5jYWxsKGZvcm1hdFN1YkRvbWFpblRleHQpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBTcHJpbnRmIGxpa2UgZnVuY3Rpb24uXG4gICAqIFJlcGxhY2VzIHBsYWNlaG9sZGVycyB7MH0gaW4gc3RyaW5nIHdpdGggdmFsdWVzIGZyb20gcHJvdmlkZWQgb2JqZWN0LlxuICAgKlxuICAgKiBAcGFyYW0gc3RyaW5nIGZvcm1hdHRlZCBTdHJpbmcgY29udGFpbmluZyBwbGFjZWhvbGRlcnMuXG4gICAqIEBwYXJhbSBvYmplY3QgYXJncyBPYmplY3Qgd2l0aCBwcm9wZXJ0aWVzIHRvIHJlcGxhY2UgcGxhY2Vob2xkZXJzIGluIHN0cmluZy5cbiAgICpcbiAgICogQHJldHVybiBTdHJpbmdcbiAgICovXG4gIGZvcm1hdFN0cmluZ1dpdGhPYmplY3Q6IGZ1bmN0aW9uIChmb3JtYXR0ZWQsIGFyZ3MpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgZm9yICh2YXIgcHJvcCBpbiBhcmdzKSB7XG4gICAgICBpZiAoYXJncy5oYXNPd25Qcm9wZXJ0eShwcm9wKSkge1xuICAgICAgICB2YXIgcmVnZXhwID0gbmV3IFJlZ0V4cCgnXFxcXHsnICsgcHJvcCArICdcXFxcfScsICdnaScpO1xuICAgICAgICBmb3JtYXR0ZWQgPSBmb3JtYXR0ZWQucmVwbGFjZShyZWdleHAsIGFyZ3NbcHJvcF0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZm9ybWF0dGVkO1xuICB9LFxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuICAvLyBFVkVOVFMgQ0FMTEJBQ0sgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cblxuICAvKipcbiAgICogSGVscGVyIG1ldGhvZCBmb3IgdHJpZ2dlcmluZyBldmVudCBjYWxsYmFja1xuICAgKlxuICAgKiBAcGFyYW0gIHN0cmluZyAgZXZlbnROYW1lICAgICAgIE5hbWUgb2YgdGhlIGV2ZW50IHRvIHRyaWdnZXJcbiAgICogQHBhcmFtICBhcnJheSAgc3VjY2Vzc0FyZ3MgICAgIExpc3Qgb2YgYXJndW1lbnQgdG8gcGFzcyB0byB0aGUgY2FsbGJhY2tcbiAgICogQHBhcmFtICBib29sZWFuICBza2lwICAgICAgV2hldGhlciB0byBza2lwIHRoZSBldmVudCB0cmlnZ2VyaW5nXG4gICAqIEByZXR1cm4gbWl4ZWQgIFRydWUgd2hlbiB0aGUgdHJpZ2dlcmluZyB3YXMgc2tpcHBlZCwgZmFsc2Ugb24gZXJyb3IsIGVsc2UgdGhlIGNhbGxiYWNrIGZ1bmN0aW9uXG4gICAqL1xuICB0cmlnZ2VyRXZlbnQ6IGZ1bmN0aW9uIChldmVudE5hbWUsIHN1Y2Nlc3NBcmdzLCBza2lwKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKChhcmd1bWVudHMubGVuZ3RoID09PSAzICYmIHNraXApIHx8IHRoaXMub3B0aW9uc1tldmVudE5hbWVdID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHRoaXMub3B0aW9uc1tldmVudE5hbWVdID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBpZiAodHlwZW9mIHN1Y2Nlc3NBcmdzID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHN1Y2Nlc3NBcmdzID0gc3VjY2Vzc0FyZ3MoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLm9wdGlvbnNbZXZlbnROYW1lXS5hcHBseSh0aGlzLCBzdWNjZXNzQXJncyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKCdQcm92aWRlZCBjYWxsYmFjayBmb3IgJyArIGV2ZW50TmFtZSArICcgaXMgbm90IGEgZnVuY3Rpb24uJyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9LFxuXG4gIC8qKlxuICAgKiBFdmVudCB0cmlnZ2VyZWQgb24gYSBtb3VzZSBjbGljayBvbiBhIHN1YkRvbWFpbiBjZWxsXG4gICAqXG4gICAqIEBwYXJhbSAgRGF0ZSAgICBkICAgIERhdGUgb2YgdGhlIHN1YmRvbWFpbiBibG9ja1xuICAgKiBAcGFyYW0gIGludCAgICBpdGVtTmIgIE51bWJlciBvZiBpdGVtcyBpbiB0aGF0IGRhdGVcbiAgICovXG4gIG9uQ2xpY2s6IGZ1bmN0aW9uIChkLCBpdGVtTmIpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICByZXR1cm4gdGhpcy50cmlnZ2VyRXZlbnQoJ29uQ2xpY2snLCBbZCwgaXRlbU5iXSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEV2ZW50IHRyaWdnZXJlZCBhZnRlciBkcmF3aW5nIHRoZSBjYWxlbmRhciwgYnl0IGJlZm9yZSBmaWxsaW5nIGl0IHdpdGggZGF0YVxuICAgKi9cbiAgYWZ0ZXJMb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgcmV0dXJuIHRoaXMudHJpZ2dlckV2ZW50KCdhZnRlckxvYWQnKTtcbiAgfSxcblxuICAvKipcbiAgICogRXZlbnQgdHJpZ2dlcmVkIGFmdGVyIGNvbXBsZXRpbmcgZHJhd2luZyBhbmQgZmlsbGluZyB0aGUgY2FsZW5kYXJcbiAgICovXG4gIG9uQ29tcGxldGU6IGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgcmVzcG9uc2UgPSB0aGlzLnRyaWdnZXJFdmVudCgnb25Db21wbGV0ZScsIFtdLCB0aGlzLl9jb21wbGV0ZWQpO1xuICAgIHRoaXMuX2NvbXBsZXRlZCA9IHRydWU7XG4gICAgcmV0dXJuIHJlc3BvbnNlO1xuICB9LFxuXG4gIC8qKlxuICAgKiBFdmVudCB0cmlnZ2VyZWQgYWZ0ZXIgc2hpZnRpbmcgdGhlIGNhbGVuZGFyIG9uZSBkb21haW4gYmFja1xuICAgKlxuICAgKiBAcGFyYW0gIERhdGUgICAgc3RhcnQgIERvbWFpbiBzdGFydCBkYXRlXG4gICAqIEBwYXJhbSAgRGF0ZSAgICBlbmQgICAgRG9tYWluIGVuZCBkYXRlXG4gICAqL1xuICBhZnRlckxvYWRQcmV2aW91c0RvbWFpbjogZnVuY3Rpb24gKHN0YXJ0KSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHBhcmVudCA9IHRoaXM7XG4gICAgcmV0dXJuIHRoaXMudHJpZ2dlckV2ZW50KCdhZnRlckxvYWRQcmV2aW91c0RvbWFpbicsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBzdWJEb21haW4gPSBwYXJlbnQuZ2V0U3ViRG9tYWluKHN0YXJ0KTtcbiAgICAgIHJldHVybiBbc3ViRG9tYWluLnNoaWZ0KCksIHN1YkRvbWFpbi5wb3AoKV07XG4gICAgfSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEV2ZW50IHRyaWdnZXJlZCBhZnRlciBzaGlmdGluZyB0aGUgY2FsZW5kYXIgb25lIGRvbWFpbiBhYm92ZVxuICAgKlxuICAgKiBAcGFyYW0gIERhdGUgICAgc3RhcnQgIERvbWFpbiBzdGFydCBkYXRlXG4gICAqIEBwYXJhbSAgRGF0ZSAgICBlbmQgICAgRG9tYWluIGVuZCBkYXRlXG4gICAqL1xuICBhZnRlckxvYWROZXh0RG9tYWluOiBmdW5jdGlvbiAoc3RhcnQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgcGFyZW50ID0gdGhpcztcbiAgICByZXR1cm4gdGhpcy50cmlnZ2VyRXZlbnQoJ2FmdGVyTG9hZE5leHREb21haW4nLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgc3ViRG9tYWluID0gcGFyZW50LmdldFN1YkRvbWFpbihzdGFydCk7XG4gICAgICByZXR1cm4gW3N1YkRvbWFpbi5zaGlmdCgpLCBzdWJEb21haW4ucG9wKCldO1xuICAgIH0pO1xuICB9LFxuXG4gIC8qKlxuICAgKiBFdmVudCB0cmlnZ2VyZWQgYWZ0ZXIgbG9hZGluZyB0aGUgbGVmdG1vc3QgZG9tYWluIGFsbG93ZWQgYnkgbWluRGF0ZVxuICAgKlxuICAgKiBAcGFyYW0gIGJvb2xlYW4gIHJlYWNoZWQgVHJ1ZSBpZiB0aGUgbGVmdG1vc3QgZG9tYWluIHdhcyByZWFjaGVkXG4gICAqL1xuICBvbk1pbkRvbWFpblJlYWNoZWQ6IGZ1bmN0aW9uIChyZWFjaGVkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdGhpcy5fbWluRG9tYWluUmVhY2hlZCA9IHJlYWNoZWQ7XG4gICAgcmV0dXJuIHRoaXMudHJpZ2dlckV2ZW50KCdvbk1pbkRvbWFpblJlYWNoZWQnLCBbcmVhY2hlZF0pO1xuICB9LFxuXG4gIC8qKlxuICAgKiBFdmVudCB0cmlnZ2VyZWQgYWZ0ZXIgbG9hZGluZyB0aGUgcmlnaHRtb3N0IGRvbWFpbiBhbGxvd2VkIGJ5IG1heERhdGVcbiAgICpcbiAgICogQHBhcmFtICBib29sZWFuICByZWFjaGVkIFRydWUgaWYgdGhlIHJpZ2h0bW9zdCBkb21haW4gd2FzIHJlYWNoZWRcbiAgICovXG4gIG9uTWF4RG9tYWluUmVhY2hlZDogZnVuY3Rpb24gKHJlYWNoZWQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB0aGlzLl9tYXhEb21haW5SZWFjaGVkID0gcmVhY2hlZDtcbiAgICByZXR1cm4gdGhpcy50cmlnZ2VyRXZlbnQoJ29uTWF4RG9tYWluUmVhY2hlZCcsIFtyZWFjaGVkXSk7XG4gIH0sXG5cbiAgY2hlY2tJZk1pbkRvbWFpbklzUmVhY2hlZDogZnVuY3Rpb24gKGRhdGUsIHVwcGVyQm91bmQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAodGhpcy5taW5Eb21haW5Jc1JlYWNoZWQoZGF0ZSkpIHtcbiAgICAgIHRoaXMub25NaW5Eb21haW5SZWFjaGVkKHRydWUpO1xuICAgIH1cblxuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyKSB7XG4gICAgICBpZiAodGhpcy5fbWF4RG9tYWluUmVhY2hlZCAmJiAhdGhpcy5tYXhEb21haW5Jc1JlYWNoZWQodXBwZXJCb3VuZCkpIHtcbiAgICAgICAgdGhpcy5vbk1heERvbWFpblJlYWNoZWQoZmFsc2UpO1xuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICBjaGVja0lmTWF4RG9tYWluSXNSZWFjaGVkOiBmdW5jdGlvbiAoZGF0ZSwgbG93ZXJCb3VuZCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICh0aGlzLm1heERvbWFpbklzUmVhY2hlZChkYXRlKSkge1xuICAgICAgdGhpcy5vbk1heERvbWFpblJlYWNoZWQodHJ1ZSk7XG4gICAgfVxuXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHtcbiAgICAgIGlmICh0aGlzLl9taW5Eb21haW5SZWFjaGVkICYmICF0aGlzLm1pbkRvbWFpbklzUmVhY2hlZChsb3dlckJvdW5kKSkge1xuICAgICAgICB0aGlzLm9uTWluRG9tYWluUmVhY2hlZChmYWxzZSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIGFmdGVyVXBkYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgcmV0dXJuIHRoaXMudHJpZ2dlckV2ZW50KCdhZnRlclVwZGF0ZScpO1xuICB9LFxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuICAvLyBGT1JNQVRURVIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuXG4gIGZvcm1hdE51bWJlcjogZDMuZm9ybWF0KCcsZycpLFxuXG4gIGZvcm1hdERhdGU6IGZ1bmN0aW9uIChkLCBmb3JtYXQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHtcbiAgICAgIGZvcm1hdCA9ICd0aXRsZSc7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBmb3JtYXQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHJldHVybiBmb3JtYXQoZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBmID0gZDMudGltZS5mb3JtYXQoZm9ybWF0KTtcbiAgICAgIHJldHVybiBmKGQpO1xuICAgIH1cbiAgfSxcblxuICBnZXRTdWJEb21haW5UaXRsZTogZnVuY3Rpb24gKGQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAoZC52ID09PSBudWxsICYmICF0aGlzLm9wdGlvbnMuY29uc2lkZXJNaXNzaW5nRGF0YUFzWmVybykge1xuICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0U3RyaW5nV2l0aE9iamVjdCh0aGlzLm9wdGlvbnMuc3ViRG9tYWluVGl0bGVGb3JtYXQuZW1wdHksIHtcbiAgICAgICAgZGF0ZTogdGhpcy5mb3JtYXREYXRlKG5ldyBEYXRlKGQudCksIHRoaXMub3B0aW9ucy5zdWJEb21haW5EYXRlRm9ybWF0KSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgdmFsdWUgPSBkLnY7XG4gICAgICAvLyBDb25zaWRlciBudWxsIGFzIDBcbiAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCAmJiB0aGlzLm9wdGlvbnMuY29uc2lkZXJNaXNzaW5nRGF0YUFzWmVybykge1xuICAgICAgICB2YWx1ZSA9IDA7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLmZvcm1hdFN0cmluZ1dpdGhPYmplY3QodGhpcy5vcHRpb25zLnN1YkRvbWFpblRpdGxlRm9ybWF0LmZpbGxlZCwge1xuICAgICAgICBjb3VudDogdGhpcy5mb3JtYXROdW1iZXIodmFsdWUpLFxuICAgICAgICBuYW1lOiB0aGlzLm9wdGlvbnMuaXRlbU5hbWVbdmFsdWUgIT09IDEgPyAxIDogMF0sXG4gICAgICAgIGNvbm5lY3RvcjogdGhpcy5fZG9tYWluVHlwZVt0aGlzLm9wdGlvbnMuc3ViRG9tYWluXS5mb3JtYXQuY29ubmVjdG9yLFxuICAgICAgICBkYXRlOiB0aGlzLmZvcm1hdERhdGUobmV3IERhdGUoZC50KSwgdGhpcy5vcHRpb25zLnN1YkRvbWFpbkRhdGVGb3JtYXQpLFxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuICAvLyBET01BSU4gTkFWSUdBVElPTiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cblxuICAvKipcbiAgICogU2hpZnQgdGhlIGNhbGVuZGFyIG9uZSBkb21haW4gZm9yd2FyZFxuICAgKlxuICAgKiBUaGUgbmV3IGRvbWFpbiBpcyBsb2FkZWQgb25seSBpZiBpdCdzIG5vdCBiZXlvbmQgbWF4RGF0ZVxuICAgKlxuICAgKiBAcGFyYW0gaW50IG4gTnVtYmVyIG9mIGRvbWFpbnMgdG8gbG9hZFxuICAgKiBAcmV0dXJuIGJvb2wgVHJ1ZSBpZiB0aGUgbmV4dCBkb21haW4gd2FzIGxvYWRlZCwgZWxzZSBmYWxzZVxuICAgKi9cbiAgbG9hZE5leHREb21haW46IGZ1bmN0aW9uIChuKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKHRoaXMuX21heERvbWFpblJlYWNoZWQgfHwgbiA9PT0gMCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHZhciBib3VuZCA9IHRoaXMubG9hZE5ld0RvbWFpbnModGhpcy5OQVZJR0FURV9SSUdIVCwgdGhpcy5nZXREb21haW4odGhpcy5nZXROZXh0RG9tYWluKCksIG4pKTtcblxuICAgIHRoaXMuYWZ0ZXJMb2FkTmV4dERvbWFpbihib3VuZC5lbmQpO1xuICAgIHRoaXMuY2hlY2tJZk1heERvbWFpbklzUmVhY2hlZCh0aGlzLmdldE5leHREb21haW4oKS5nZXRUaW1lKCksIGJvdW5kLnN0YXJ0KTtcblxuICAgIHJldHVybiB0cnVlO1xuICB9LFxuXG4gIC8qKlxuICAgKiBTaGlmdCB0aGUgY2FsZW5kYXIgb25lIGRvbWFpbiBiYWNrd2FyZFxuICAgKlxuICAgKiBUaGUgcHJldmlvdXMgZG9tYWluIGlzIGxvYWRlZCBvbmx5IGlmIGl0J3Mgbm90IGJleW9uZCB0aGUgbWluRGF0ZVxuICAgKlxuICAgKiBAcGFyYW0gaW50IG4gTnVtYmVyIG9mIGRvbWFpbnMgdG8gbG9hZFxuICAgKiBAcmV0dXJuIGJvb2wgVHJ1ZSBpZiB0aGUgcHJldmlvdXMgZG9tYWluIHdhcyBsb2FkZWQsIGVsc2UgZmFsc2VcbiAgICovXG4gIGxvYWRQcmV2aW91c0RvbWFpbjogZnVuY3Rpb24gKG4pIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAodGhpcy5fbWluRG9tYWluUmVhY2hlZCB8fCBuID09PSAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdmFyIGJvdW5kID0gdGhpcy5sb2FkTmV3RG9tYWlucyhcbiAgICAgIHRoaXMuTkFWSUdBVEVfTEVGVCxcbiAgICAgIHRoaXMuZ2V0RG9tYWluKHRoaXMuZ2V0RG9tYWluS2V5cygpWzBdLCAtbikucmV2ZXJzZSgpLFxuICAgICk7XG5cbiAgICB0aGlzLmFmdGVyTG9hZFByZXZpb3VzRG9tYWluKGJvdW5kLnN0YXJ0KTtcbiAgICB0aGlzLmNoZWNrSWZNaW5Eb21haW5Jc1JlYWNoZWQoYm91bmQuc3RhcnQsIGJvdW5kLmVuZCk7XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSxcblxuICBsb2FkTmV3RG9tYWluczogZnVuY3Rpb24gKGRpcmVjdGlvbiwgbmV3RG9tYWlucykge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBwYXJlbnQgPSB0aGlzO1xuICAgIHZhciBiYWNrd2FyZCA9IGRpcmVjdGlvbiA9PT0gdGhpcy5OQVZJR0FURV9MRUZUO1xuICAgIHZhciBpID0gLTE7XG4gICAgdmFyIHRvdGFsID0gbmV3RG9tYWlucy5sZW5ndGg7XG4gICAgdmFyIGRvbWFpbnMgPSB0aGlzLmdldERvbWFpbktleXMoKTtcblxuICAgIGZ1bmN0aW9uIGJ1aWxkU3ViRG9tYWluKGQpIHtcbiAgICAgIHJldHVybiB7IHQ6IHBhcmVudC5fZG9tYWluVHlwZVtwYXJlbnQub3B0aW9ucy5zdWJEb21haW5dLmV4dHJhY3RVbml0KGQpLCB2OiBudWxsIH07XG4gICAgfVxuXG4gICAgLy8gUmVtb3ZlIG91dCBvZiBib3VuZCBkb21haW5zIGZyb20gbGlzdCBvZiBuZXcgZG9tYWlucyB0byBwcmVwZW5kXG4gICAgd2hpbGUgKCsraSA8IHRvdGFsKSB7XG4gICAgICBpZiAoYmFja3dhcmQgJiYgdGhpcy5taW5Eb21haW5Jc1JlYWNoZWQobmV3RG9tYWluc1tpXSkpIHtcbiAgICAgICAgbmV3RG9tYWlucyA9IG5ld0RvbWFpbnMuc2xpY2UoMCwgaSArIDEpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGlmICghYmFja3dhcmQgJiYgdGhpcy5tYXhEb21haW5Jc1JlYWNoZWQobmV3RG9tYWluc1tpXSkpIHtcbiAgICAgICAgbmV3RG9tYWlucyA9IG5ld0RvbWFpbnMuc2xpY2UoMCwgaSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIG5ld0RvbWFpbnMgPSBuZXdEb21haW5zLnNsaWNlKC10aGlzLm9wdGlvbnMucmFuZ2UpO1xuXG4gICAgZm9yIChpID0gMCwgdG90YWwgPSBuZXdEb21haW5zLmxlbmd0aDsgaSA8IHRvdGFsOyBpICs9IDEpIHtcbiAgICAgIHRoaXMuX2RvbWFpbnMuc2V0KFxuICAgICAgICBuZXdEb21haW5zW2ldLmdldFRpbWUoKSxcbiAgICAgICAgdGhpcy5nZXRTdWJEb21haW4obmV3RG9tYWluc1tpXSkubWFwKGJ1aWxkU3ViRG9tYWluKSxcbiAgICAgICk7XG5cbiAgICAgIHRoaXMuX2RvbWFpbnMucmVtb3ZlKGJhY2t3YXJkID8gZG9tYWlucy5wb3AoKSA6IGRvbWFpbnMuc2hpZnQoKSk7XG4gICAgfVxuXG4gICAgZG9tYWlucyA9IHRoaXMuZ2V0RG9tYWluS2V5cygpO1xuXG4gICAgaWYgKGJhY2t3YXJkKSB7XG4gICAgICBuZXdEb21haW5zID0gbmV3RG9tYWlucy5yZXZlcnNlKCk7XG4gICAgfVxuXG4gICAgdGhpcy5wYWludChkaXJlY3Rpb24pO1xuXG4gICAgdGhpcy5nZXREYXRhcyhcbiAgICAgIHRoaXMub3B0aW9ucy5kYXRhLFxuICAgICAgbmV3RG9tYWluc1swXSxcbiAgICAgIHRoaXMuZ2V0U3ViRG9tYWluKG5ld0RvbWFpbnNbbmV3RG9tYWlucy5sZW5ndGggLSAxXSkucG9wKCksXG4gICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHBhcmVudC5maWxsKHBhcmVudC5sYXN0SW5zZXJ0ZWRTdmcpO1xuICAgICAgfSxcbiAgICApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXJ0OiBuZXdEb21haW5zW2JhY2t3YXJkID8gMCA6IDFdLFxuICAgICAgZW5kOiBkb21haW5zW2RvbWFpbnMubGVuZ3RoIC0gMV0sXG4gICAgfTtcbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJuIHdoZXRoZXIgYSBkYXRlIGlzIGluc2lkZSB0aGUgc2NvcGUgZGV0ZXJtaW5lZCBieSBtYXhEYXRlXG4gICAqXG4gICAqIEBwYXJhbSBpbnQgZGF0ZXRpbWVzdGFtcCBUaGUgdGltZXN0YW1wIGluIG1zIHRvIHRlc3RcbiAgICogQHJldHVybiBib29sIFRydWUgaWYgdGhlIHNwZWNpZmllZCBkYXRlIGNvcnJlc3BvbmQgdG8gdGhlIGNhbGVuZGFyIHVwcGVyIGJvdW5kXG4gICAqL1xuICBtYXhEb21haW5Jc1JlYWNoZWQ6IGZ1bmN0aW9uIChkYXRldGltZXN0YW1wKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5tYXhEYXRlICE9PSBudWxsICYmIHRoaXMub3B0aW9ucy5tYXhEYXRlLmdldFRpbWUoKSA8IGRhdGV0aW1lc3RhbXA7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybiB3aGV0aGVyIGEgZGF0ZSBpcyBpbnNpZGUgdGhlIHNjb3BlIGRldGVybWluZWQgYnkgbWluRGF0ZVxuICAgKlxuICAgKiBAcGFyYW0gaW50IGRhdGV0aW1lc3RhbXAgVGhlIHRpbWVzdGFtcCBpbiBtcyB0byB0ZXN0XG4gICAqIEByZXR1cm4gYm9vbCBUcnVlIGlmIHRoZSBzcGVjaWZpZWQgZGF0ZSBjb3JyZXNwb25kIHRvIHRoZSBjYWxlbmRhciBsb3dlciBib3VuZFxuICAgKi9cbiAgbWluRG9tYWluSXNSZWFjaGVkOiBmdW5jdGlvbiAoZGF0ZXRpbWVzdGFtcCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHJldHVybiB0aGlzLm9wdGlvbnMubWluRGF0ZSAhPT0gbnVsbCAmJiB0aGlzLm9wdGlvbnMubWluRGF0ZS5nZXRUaW1lKCkgPj0gZGF0ZXRpbWVzdGFtcDtcbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJuIHRoZSBsaXN0IG9mIHRoZSBjYWxlbmRhcidzIGRvbWFpbiB0aW1lc3RhbXBcbiAgICpcbiAgICogQHJldHVybiBBcnJheSBhIHNvcnRlZCBhcnJheSBvZiB0aW1lc3RhbXBcbiAgICovXG4gIGdldERvbWFpbktleXM6IGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICByZXR1cm4gdGhpcy5fZG9tYWluc1xuICAgICAgLmtleXMoKVxuICAgICAgLm1hcChmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gcGFyc2VJbnQoZCwgMTApO1xuICAgICAgfSlcbiAgICAgIC5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgIHJldHVybiBhIC0gYjtcbiAgICAgIH0pO1xuICB9LFxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuICAvLyBQT1NJVElPTk5JTkcgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuXG4gIHBvc2l0aW9uU3ViRG9tYWluWDogZnVuY3Rpb24gKGQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgaW5kZXggPSB0aGlzLl9kb21haW5UeXBlW3RoaXMub3B0aW9ucy5zdWJEb21haW5dLnBvc2l0aW9uLngobmV3IERhdGUoZCkpO1xuICAgIHJldHVybiBpbmRleCAqIHRoaXMub3B0aW9ucy5jZWxsU2l6ZSArIGluZGV4ICogdGhpcy5vcHRpb25zLmNlbGxQYWRkaW5nO1xuICB9LFxuXG4gIHBvc2l0aW9uU3ViRG9tYWluWTogZnVuY3Rpb24gKGQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgaW5kZXggPSB0aGlzLl9kb21haW5UeXBlW3RoaXMub3B0aW9ucy5zdWJEb21haW5dLnBvc2l0aW9uLnkobmV3IERhdGUoZCkpO1xuICAgIHJldHVybiBpbmRleCAqIHRoaXMub3B0aW9ucy5jZWxsU2l6ZSArIGluZGV4ICogdGhpcy5vcHRpb25zLmNlbGxQYWRkaW5nO1xuICB9LFxuXG4gIGdldFN1YkRvbWFpbkNvbHVtbk51bWJlcjogZnVuY3Rpb24gKGQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAodGhpcy5vcHRpb25zLnJvd0xpbWl0ID4gMCkge1xuICAgICAgdmFyIGkgPSB0aGlzLl9kb21haW5UeXBlW3RoaXMub3B0aW9ucy5zdWJEb21haW5dLm1heEl0ZW1OdW1iZXI7XG4gICAgICBpZiAodHlwZW9mIGkgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgaSA9IGkoZCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gTWF0aC5jZWlsKGkgLyB0aGlzLm9wdGlvbnMucm93TGltaXQpO1xuICAgIH1cblxuICAgIHZhciBqID0gdGhpcy5fZG9tYWluVHlwZVt0aGlzLm9wdGlvbnMuc3ViRG9tYWluXS5kZWZhdWx0Q29sdW1uTnVtYmVyO1xuICAgIGlmICh0eXBlb2YgaiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgaiA9IGooZCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLm9wdGlvbnMuY29sTGltaXQgfHwgajtcbiAgfSxcblxuICBnZXRTdWJEb21haW5Sb3dOdW1iZXI6IGZ1bmN0aW9uIChkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKHRoaXMub3B0aW9ucy5jb2xMaW1pdCA+IDApIHtcbiAgICAgIHZhciBpID0gdGhpcy5fZG9tYWluVHlwZVt0aGlzLm9wdGlvbnMuc3ViRG9tYWluXS5tYXhJdGVtTnVtYmVyO1xuICAgICAgaWYgKHR5cGVvZiBpID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGkgPSBpKGQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE1hdGguY2VpbChpIC8gdGhpcy5vcHRpb25zLmNvbExpbWl0KTtcbiAgICB9XG5cbiAgICB2YXIgaiA9IHRoaXMuX2RvbWFpblR5cGVbdGhpcy5vcHRpb25zLnN1YkRvbWFpbl0uZGVmYXVsdFJvd051bWJlcjtcbiAgICBpZiAodHlwZW9mIGogPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGogPSBqKGQpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLnJvd0xpbWl0IHx8IGo7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybiBhIGNsYXNzbmFtZSBpZiB0aGUgc3BlY2lmaWVkIGRhdGUgc2hvdWxkIGJlIGhpZ2hsaWdodGVkXG4gICAqXG4gICAqIEBwYXJhbSAgdGltZXN0YW1wIGRhdGUgRGF0ZSBvZiB0aGUgY3VycmVudCBzdWJEb21haW5cbiAgICogQHJldHVybiBTdHJpbmcgdGhlIGhpZ2hsaWdodCBjbGFzc1xuICAgKi9cbiAgZ2V0SGlnaGxpZ2h0Q2xhc3NOYW1lOiBmdW5jdGlvbiAoZCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGQgPSBuZXcgRGF0ZShkKTtcblxuICAgIGlmICh0aGlzLm9wdGlvbnMuaGlnaGxpZ2h0Lmxlbmd0aCA+IDApIHtcbiAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5vcHRpb25zLmhpZ2hsaWdodCkge1xuICAgICAgICBpZiAodGhpcy5kYXRlSXNFcXVhbCh0aGlzLm9wdGlvbnMuaGlnaGxpZ2h0W2ldLCBkKSkge1xuICAgICAgICAgIHJldHVybiB0aGlzLmlzTm93KHRoaXMub3B0aW9ucy5oaWdobGlnaHRbaV0pID8gJyBoaWdobGlnaHQtbm93JyA6ICcgaGlnaGxpZ2h0JztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gJyc7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybiB3aGV0aGVyIHRoZSBzcGVjaWZpZWQgZGF0ZSBpcyBub3csXG4gICAqIGFjY29yZGluZyB0byB0aGUgdHlwZSBvZiBzdWJkb21haW5cbiAgICpcbiAgICogQHBhcmFtICBEYXRlIGQgVGhlIGRhdGUgdG8gY29tcGFyZVxuICAgKiBAcmV0dXJuIGJvb2wgVHJ1ZSBpZiB0aGUgZGF0ZSBjb3JyZXNwb25kIHRvIGEgc3ViZG9tYWluIGNlbGxcbiAgICovXG4gIGlzTm93OiBmdW5jdGlvbiAoZCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHJldHVybiB0aGlzLmRhdGVJc0VxdWFsKGQsIG5ldyBEYXRlKCkpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm4gd2hldGhlciAyIGRhdGVzIGFyZSBlcXVhbHNcbiAgICogVGhpcyBmdW5jdGlvbiBpcyBzdWJkb21haW4tYXdhcmUsXG4gICAqIGFuZCBkYXRlcyBjb21wYXJpc29uIGFyZSBkZXBlbmRlbnQgb2YgdGhlIHN1YmRvbWFpblxuICAgKlxuICAgKiBAcGFyYW0gIERhdGUgZGF0ZUEgRmlyc3QgZGF0ZSB0byBjb21wYXJlXG4gICAqIEBwYXJhbSAgRGF0ZSBkYXRlQiBTZWNvbiBkYXRlIHRvIGNvbXBhcmVcbiAgICogQHJldHVybiBib29sIHRydWUgaWYgdGhlIDIgZGF0ZXMgYXJlIGVxdWFsc1xuICAgKi9cbiAgLyoganNoaW50IG1heGNvbXBsZXhpdHk6IGZhbHNlICovXG4gIGRhdGVJc0VxdWFsOiBmdW5jdGlvbiAoZGF0ZUEsIGRhdGVCKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKCEoZGF0ZUEgaW5zdGFuY2VvZiBEYXRlKSkge1xuICAgICAgZGF0ZUEgPSBuZXcgRGF0ZShkYXRlQSk7XG4gICAgfVxuXG4gICAgaWYgKCEoZGF0ZUIgaW5zdGFuY2VvZiBEYXRlKSkge1xuICAgICAgZGF0ZUIgPSBuZXcgRGF0ZShkYXRlQik7XG4gICAgfVxuXG4gICAgc3dpdGNoICh0aGlzLm9wdGlvbnMuc3ViRG9tYWluKSB7XG4gICAgICBjYXNlICd4X21pbic6XG4gICAgICBjYXNlICdtaW4nOlxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIGRhdGVBLmdldEZ1bGxZZWFyKCkgPT09IGRhdGVCLmdldEZ1bGxZZWFyKCkgJiZcbiAgICAgICAgICBkYXRlQS5nZXRNb250aCgpID09PSBkYXRlQi5nZXRNb250aCgpICYmXG4gICAgICAgICAgZGF0ZUEuZ2V0RGF0ZSgpID09PSBkYXRlQi5nZXREYXRlKCkgJiZcbiAgICAgICAgICBkYXRlQS5nZXRIb3VycygpID09PSBkYXRlQi5nZXRIb3VycygpICYmXG4gICAgICAgICAgZGF0ZUEuZ2V0TWludXRlcygpID09PSBkYXRlQi5nZXRNaW51dGVzKClcbiAgICAgICAgKTtcbiAgICAgIGNhc2UgJ3hfaG91cic6XG4gICAgICBjYXNlICdob3VyJzpcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICBkYXRlQS5nZXRGdWxsWWVhcigpID09PSBkYXRlQi5nZXRGdWxsWWVhcigpICYmXG4gICAgICAgICAgZGF0ZUEuZ2V0TW9udGgoKSA9PT0gZGF0ZUIuZ2V0TW9udGgoKSAmJlxuICAgICAgICAgIGRhdGVBLmdldERhdGUoKSA9PT0gZGF0ZUIuZ2V0RGF0ZSgpICYmXG4gICAgICAgICAgZGF0ZUEuZ2V0SG91cnMoKSA9PT0gZGF0ZUIuZ2V0SG91cnMoKVxuICAgICAgICApO1xuICAgICAgY2FzZSAneF9kYXknOlxuICAgICAgY2FzZSAnZGF5JzpcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICBkYXRlQS5nZXRGdWxsWWVhcigpID09PSBkYXRlQi5nZXRGdWxsWWVhcigpICYmXG4gICAgICAgICAgZGF0ZUEuZ2V0TW9udGgoKSA9PT0gZGF0ZUIuZ2V0TW9udGgoKSAmJlxuICAgICAgICAgIGRhdGVBLmdldERhdGUoKSA9PT0gZGF0ZUIuZ2V0RGF0ZSgpXG4gICAgICAgICk7XG4gICAgICBjYXNlICd4X3dlZWsnOlxuICAgICAgY2FzZSAnd2Vlayc6XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgZGF0ZUEuZ2V0RnVsbFllYXIoKSA9PT0gZGF0ZUIuZ2V0RnVsbFllYXIoKSAmJlxuICAgICAgICAgIHRoaXMuZ2V0V2Vla051bWJlcihkYXRlQSkgPT09IHRoaXMuZ2V0V2Vla051bWJlcihkYXRlQilcbiAgICAgICAgKTtcbiAgICAgIGNhc2UgJ3hfbW9udGgnOlxuICAgICAgY2FzZSAnbW9udGgnOlxuICAgICAgICByZXR1cm4gZGF0ZUEuZ2V0RnVsbFllYXIoKSA9PT0gZGF0ZUIuZ2V0RnVsbFllYXIoKSAmJiBkYXRlQS5nZXRNb250aCgpID09PSBkYXRlQi5nZXRNb250aCgpO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJucyB3ZXRoZXIgb3Igbm90IGRhdGVBIGlzIGxlc3MgdGhhbiBvciBlcXVhbCB0byBkYXRlQi4gVGhpcyBmdW5jdGlvbiBpcyBzdWJkb21haW4gYXdhcmUuXG4gICAqIFBlcmZvcm1zIGF1dG9tYXRpYyBjb252ZXJzaW9uIG9mIHZhbHVlcy5cbiAgICogQHBhcmFtIGRhdGVBIG1heSBiZSBhIG51bWJlciBvciBhIERhdGVcbiAgICogQHBhcmFtIGRhdGVCIG1heSBiZSBhIG51bWJlciBvciBhIERhdGVcbiAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAqL1xuICBkYXRlSXNMZXNzVGhhbjogZnVuY3Rpb24gKGRhdGVBLCBkYXRlQikge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICghKGRhdGVBIGluc3RhbmNlb2YgRGF0ZSkpIHtcbiAgICAgIGRhdGVBID0gbmV3IERhdGUoZGF0ZUEpO1xuICAgIH1cblxuICAgIGlmICghKGRhdGVCIGluc3RhbmNlb2YgRGF0ZSkpIHtcbiAgICAgIGRhdGVCID0gbmV3IERhdGUoZGF0ZUIpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZWRNaWxsaXMoZGF0ZSwgc3ViZG9tYWluKSB7XG4gICAgICBzd2l0Y2ggKHN1YmRvbWFpbikge1xuICAgICAgICBjYXNlICd4X21pbic6XG4gICAgICAgIGNhc2UgJ21pbic6XG4gICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKFxuICAgICAgICAgICAgZGF0ZS5nZXRGdWxsWWVhcigpLFxuICAgICAgICAgICAgZGF0ZS5nZXRNb250aCgpLFxuICAgICAgICAgICAgZGF0ZS5nZXREYXRlKCksXG4gICAgICAgICAgICBkYXRlLmdldEhvdXJzKCksXG4gICAgICAgICAgICBkYXRlLmdldE1pbnV0ZXMoKSxcbiAgICAgICAgICApLmdldFRpbWUoKTtcbiAgICAgICAgY2FzZSAneF9ob3VyJzpcbiAgICAgICAgY2FzZSAnaG91cic6XG4gICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKFxuICAgICAgICAgICAgZGF0ZS5nZXRGdWxsWWVhcigpLFxuICAgICAgICAgICAgZGF0ZS5nZXRNb250aCgpLFxuICAgICAgICAgICAgZGF0ZS5nZXREYXRlKCksXG4gICAgICAgICAgICBkYXRlLmdldEhvdXJzKCksXG4gICAgICAgICAgKS5nZXRUaW1lKCk7XG4gICAgICAgIGNhc2UgJ3hfZGF5JzpcbiAgICAgICAgY2FzZSAnZGF5JzpcbiAgICAgICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLCBkYXRlLmdldE1vbnRoKCksIGRhdGUuZ2V0RGF0ZSgpKS5nZXRUaW1lKCk7XG4gICAgICAgIGNhc2UgJ3hfd2Vlayc6XG4gICAgICAgIGNhc2UgJ3dlZWsnOlxuICAgICAgICBjYXNlICd4X21vbnRoJzpcbiAgICAgICAgY2FzZSAnbW9udGgnOlxuICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIGRhdGUuZ2V0TW9udGgoKSkuZ2V0VGltZSgpO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJldHVybiBkYXRlLmdldFRpbWUoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgbm9ybWFsaXplZE1pbGxpcyhkYXRlQSwgdGhpcy5vcHRpb25zLnN1YkRvbWFpbikgPFxuICAgICAgbm9ybWFsaXplZE1pbGxpcyhkYXRlQiwgdGhpcy5vcHRpb25zLnN1YkRvbWFpbilcbiAgICApO1xuICB9LFxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuICAvLyBEQVRFIENPTVBVVEFUSU9OICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgZGF5IG9mIHRoZSB5ZWFyIGZvciB0aGUgZGF0ZVxuICAgKiBAcGFyYW0gIERhdGVcbiAgICogQHJldHVybiAgaW50IERheSBvZiB0aGUgeWVhciBbMSwzNjZdXG4gICAqL1xuICBnZXREYXlPZlllYXI6IGQzLnRpbWUuZm9ybWF0KCclaicpLFxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIHdlZWsgbnVtYmVyIG9mIHRoZSB5ZWFyXG4gICAqIE1vbmRheSBhcyB0aGUgZmlyc3QgZGF5IG9mIHRoZSB3ZWVrXG4gICAqIEByZXR1cm4gaW50ICBXZWVrIG51bWJlciBbMC01M11cbiAgICovXG4gIGdldFdlZWtOdW1iZXI6IGZ1bmN0aW9uIChkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGYgPSB0aGlzLm9wdGlvbnMud2Vla1N0YXJ0T25Nb25kYXkgPT09IHRydWUgPyBkMy50aW1lLmZvcm1hdCgnJVcnKSA6IGQzLnRpbWUuZm9ybWF0KCclVScpO1xuICAgIHJldHVybiBmKGQpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIHdlZWsgbnVtYmVyLCByZWxhdGl2ZSB0byBpdHMgbW9udGhcbiAgICpcbiAgICogQHBhcmFtICBpbnR8RGF0ZSBkIERhdGUgb3IgdGltZXN0YW1wIGluIG1pbGxpc2Vjb25kc1xuICAgKiBAcmV0dXJuIGludCBXZWVrIG51bWJlciwgcmVsYXRpdmUgdG8gdGhlIG1vbnRoIFswLTVdXG4gICAqL1xuICBnZXRNb250aFdlZWtOdW1iZXI6IGZ1bmN0aW9uIChkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKHR5cGVvZiBkID09PSAnbnVtYmVyJykge1xuICAgICAgZCA9IG5ldyBEYXRlKGQpO1xuICAgIH1cblxuICAgIHZhciBtb250aEZpcnN0V2Vla051bWJlciA9IHRoaXMuZ2V0V2Vla051bWJlcihuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSkpO1xuICAgIHJldHVybiB0aGlzLmdldFdlZWtOdW1iZXIoZCkgLSBtb250aEZpcnN0V2Vla051bWJlciAtIDE7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgbnVtYmVyIG9mIHdlZWtzIGluIHRoZSBkYXRlcycgeWVhclxuICAgKlxuICAgKiBAcGFyYW0gIGludHxEYXRlIGQgRGF0ZSBvciB0aW1lc3RhbXAgaW4gbWlsbGlzZWNvbmRzXG4gICAqIEByZXR1cm4gaW50IE51bWJlciBvZiB3ZWVrcyBpbiB0aGUgZGF0ZSdzIHllYXJcbiAgICovXG4gIGdldFdlZWtOdW1iZXJJblllYXI6IGZ1bmN0aW9uIChkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKHR5cGVvZiBkID09PSAnbnVtYmVyJykge1xuICAgICAgZCA9IG5ldyBEYXRlKGQpO1xuICAgIH1cbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJuIHRoZSBudW1iZXIgb2YgZGF5cyBpbiB0aGUgZGF0ZSdzIG1vbnRoXG4gICAqXG4gICAqIEBwYXJhbSAgaW50fERhdGUgZCBEYXRlIG9yIHRpbWVzdGFtcCBpbiBtaWxsaXNlY29uZHNcbiAgICogQHJldHVybiBpbnQgTnVtYmVyIG9mIGRheXMgaW4gdGhlIGRhdGUncyBtb250aFxuICAgKi9cbiAgZ2V0RGF5Q291bnRJbk1vbnRoOiBmdW5jdGlvbiAoZCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHJldHVybiB0aGlzLmdldEVuZE9mTW9udGgoZCkuZ2V0RGF0ZSgpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIG51bWJlciBvZiBkYXlzIGluIHRoZSBkYXRlJ3MgeWVhclxuICAgKlxuICAgKiBAcGFyYW0gIGludHxEYXRlIGQgRGF0ZSBvciB0aW1lc3RhbXAgaW4gbWlsbGlzZWNvbmRzXG4gICAqIEByZXR1cm4gaW50IE51bWJlciBvZiBkYXlzIGluIHRoZSBkYXRlJ3MgeWVhclxuICAgKi9cbiAgZ2V0RGF5Q291bnRJblllYXI6IGZ1bmN0aW9uIChkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKHR5cGVvZiBkID09PSAnbnVtYmVyJykge1xuICAgICAgZCA9IG5ldyBEYXRlKGQpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCAxLCAyOSkuZ2V0TW9udGgoKSA9PT0gMSA/IDM2NiA6IDM2NTtcbiAgfSxcblxuICAvKipcbiAgICogR2V0IHRoZSB3ZWVrZGF5IGZyb20gYSBkYXRlXG4gICAqXG4gICAqIFJldHVybiB0aGUgd2VlayBkYXkgbnVtYmVyICgwLTYpIG9mIGEgZGF0ZSxcbiAgICogZGVwZW5kaW5nIG9uIHdoZXRoZXIgdGhlIHdlZWsgc3RhcnQgb24gbW9uZGF5IG9yIHN1bmRheVxuICAgKlxuICAgKiBAcGFyYW0gIERhdGUgZFxuICAgKiBAcmV0dXJuIGludCBUaGUgd2VlayBkYXkgbnVtYmVyICgwLTYpXG4gICAqL1xuICBnZXRXZWVrRGF5OiBmdW5jdGlvbiAoZCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICh0aGlzLm9wdGlvbnMud2Vla1N0YXJ0T25Nb25kYXkgPT09IGZhbHNlKSB7XG4gICAgICByZXR1cm4gZC5nZXREYXkoKTtcbiAgICB9XG4gICAgcmV0dXJuIGQuZ2V0RGF5KCkgPT09IDAgPyA2IDogZC5nZXREYXkoKSAtIDE7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldCB0aGUgbGFzdCBkYXkgb2YgdGhlIG1vbnRoXG4gICAqIEBwYXJhbSAgRGF0ZXxpbnQgIGQgIERhdGUgb3IgdGltZXN0YW1wIGluIG1pbGxpc2Vjb25kc1xuICAgKiBAcmV0dXJuIERhdGUgICAgICBMYXN0IGRheSBvZiB0aGUgbW9udGhcbiAgICovXG4gIGdldEVuZE9mTW9udGg6IGZ1bmN0aW9uIChkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKHR5cGVvZiBkID09PSAnbnVtYmVyJykge1xuICAgICAgZCA9IG5ldyBEYXRlKGQpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCkgKyAxLCAwKTtcbiAgfSxcblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtICBEYXRlIGRhdGVcbiAgICogQHBhcmFtICBpbnQgY291bnRcbiAgICogQHBhcmFtICBzdHJpbmcgc3RlcFxuICAgKiBAcmV0dXJuIERhdGVcbiAgICovXG4gIGp1bXBEYXRlOiBmdW5jdGlvbiAoZGF0ZSwgY291bnQsIHN0ZXApIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgZCA9IG5ldyBEYXRlKGRhdGUpO1xuICAgIHN3aXRjaCAoc3RlcCkge1xuICAgICAgY2FzZSAnaG91cic6XG4gICAgICAgIGQuc2V0SG91cnMoZC5nZXRIb3VycygpICsgY291bnQpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2RheSc6XG4gICAgICAgIGQuc2V0SG91cnMoZC5nZXRIb3VycygpICsgY291bnQgKiAyNCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnd2Vlayc6XG4gICAgICAgIGQuc2V0SG91cnMoZC5nZXRIb3VycygpICsgY291bnQgKiAyNCAqIDcpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgZC5zZXRNb250aChkLmdldE1vbnRoKCkgKyBjb3VudCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAneWVhcic6XG4gICAgICAgIGQuc2V0RnVsbFllYXIoZC5nZXRGdWxsWWVhcigpICsgY291bnQpO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgRGF0ZShkKTtcbiAgfSxcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgLy8gRE9NQUlOIENPTVBVVEFUSU9OICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuXG4gIC8qKlxuICAgKiBSZXR1cm4gYWxsIHRoZSBtaW51dGVzIGJldHdlZW4gMiBkYXRlc1xuICAgKlxuICAgKiBAcGFyYW0gIERhdGUgIGQgIGRhdGUgIEEgZGF0ZVxuICAgKiBAcGFyYW0gIGludHxkYXRlICByYW5nZSAgTnVtYmVyIG9mIG1pbnV0ZXMgaW4gdGhlIHJhbmdlLCBvciBhIHN0b3AgZGF0ZVxuICAgKiBAcmV0dXJuIGFycmF5ICBBbiBhcnJheSBvZiBtaW51dGVzXG4gICAqL1xuICBnZXRNaW51dGVEb21haW46IGZ1bmN0aW9uIChkLCByYW5nZSkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBzdGFydCA9IG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpLCBkLmdldERhdGUoKSwgZC5nZXRIb3VycygpKTtcbiAgICB2YXIgc3RvcCA9IG51bGw7XG4gICAgaWYgKHJhbmdlIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgc3RvcCA9IG5ldyBEYXRlKHJhbmdlLmdldEZ1bGxZZWFyKCksIHJhbmdlLmdldE1vbnRoKCksIHJhbmdlLmdldERhdGUoKSwgcmFuZ2UuZ2V0SG91cnMoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0b3AgPSBuZXcgRGF0ZSgrc3RhcnQgKyByYW5nZSAqIDEwMDAgKiA2MCk7XG4gICAgfVxuICAgIHJldHVybiBkMy50aW1lLm1pbnV0ZXMoTWF0aC5taW4oc3RhcnQsIHN0b3ApLCBNYXRoLm1heChzdGFydCwgc3RvcCkpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm4gYWxsIHRoZSBob3VycyBiZXR3ZWVuIDIgZGF0ZXNcbiAgICpcbiAgICogQHBhcmFtICBEYXRlICBkICBBIGRhdGVcbiAgICogQHBhcmFtICBpbnR8ZGF0ZSAgcmFuZ2UgIE51bWJlciBvZiBob3VycyBpbiB0aGUgcmFuZ2UsIG9yIGEgc3RvcCBkYXRlXG4gICAqIEByZXR1cm4gYXJyYXkgIEFuIGFycmF5IG9mIGhvdXJzXG4gICAqL1xuICBnZXRIb3VyRG9tYWluOiBmdW5jdGlvbiAoZCwgcmFuZ2UpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgc3RhcnQgPSBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSwgZC5nZXREYXRlKCksIGQuZ2V0SG91cnMoKSk7XG4gICAgdmFyIHN0b3AgPSBudWxsO1xuICAgIGlmIChyYW5nZSBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgIHN0b3AgPSBuZXcgRGF0ZShyYW5nZS5nZXRGdWxsWWVhcigpLCByYW5nZS5nZXRNb250aCgpLCByYW5nZS5nZXREYXRlKCksIHJhbmdlLmdldEhvdXJzKCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdG9wID0gbmV3IERhdGUoc3RhcnQpO1xuICAgICAgc3RvcC5zZXRIb3VycyhzdG9wLmdldEhvdXJzKCkgKyByYW5nZSk7XG4gICAgfVxuXG4gICAgdmFyIGRvbWFpbnMgPSBkMy50aW1lLmhvdXJzKE1hdGgubWluKHN0YXJ0LCBzdG9wKSwgTWF0aC5tYXgoc3RhcnQsIHN0b3ApKTtcblxuICAgIC8vIFBhc3NpbmcgZnJvbSBEU1QgdG8gc3RhbmRhcmQgdGltZVxuICAgIC8vIElmIHRoZXJlIGFyZSAyNSBob3VycywgbGV0J3MgY29tcHJlc3MgdGhlIGR1cGxpY2F0ZSBob3Vyc1xuICAgIHZhciBpID0gMDtcbiAgICB2YXIgdG90YWwgPSBkb21haW5zLmxlbmd0aDtcbiAgICBmb3IgKGkgPSAwOyBpIDwgdG90YWw7IGkgKz0gMSkge1xuICAgICAgaWYgKGkgPiAwICYmIGRvbWFpbnNbaV0uZ2V0SG91cnMoKSA9PT0gZG9tYWluc1tpIC0gMV0uZ2V0SG91cnMoKSkge1xuICAgICAgICB0aGlzLkRTVERvbWFpbi5wdXNoKGRvbWFpbnNbaV0uZ2V0VGltZSgpKTtcbiAgICAgICAgZG9tYWlucy5zcGxpY2UoaSwgMSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGQzLnRpbWUuaG91cnMgaXMgcmV0dXJuaW5nIG1vcmUgaG91cnMgdGhhbiBuZWVkZWQgd2hlbiBjaGFuZ2luZ1xuICAgIC8vIGZyb20gRFNUIHRvIHN0YW5kYXJkIHRpbWUsIGJlY2F1c2UgdGhlcmUgaXMgcmVhbGx5IDIgaG91cnMgYmV0d2VlblxuICAgIC8vIDFhbSBhbmQgMmFtIVxuICAgIGlmICh0eXBlb2YgcmFuZ2UgPT09ICdudW1iZXInICYmIGRvbWFpbnMubGVuZ3RoID4gTWF0aC5hYnMocmFuZ2UpKSB7XG4gICAgICBkb21haW5zLnNwbGljZShkb21haW5zLmxlbmd0aCAtIDEsIDEpO1xuICAgIH1cblxuICAgIHJldHVybiBkb21haW5zO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm4gYWxsIHRoZSBkYXlzIGJldHdlZW4gMiBkYXRlc1xuICAgKlxuICAgKiBAcGFyYW0gIERhdGUgICAgZCAgICBBIGRhdGVcbiAgICogQHBhcmFtICBpbnR8ZGF0ZSAgcmFuZ2UgIE51bWJlciBvZiBkYXlzIGluIHRoZSByYW5nZSwgb3IgYSBzdG9wIGRhdGVcbiAgICogQHJldHVybiBhcnJheSAgQW4gYXJyYXkgb2Ygd2Vla3NcbiAgICovXG4gIGdldERheURvbWFpbjogZnVuY3Rpb24gKGQsIHJhbmdlKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHN0YXJ0ID0gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCksIGQuZ2V0RGF0ZSgpKTtcbiAgICB2YXIgc3RvcCA9IG51bGw7XG4gICAgaWYgKHJhbmdlIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgc3RvcCA9IG5ldyBEYXRlKHJhbmdlLmdldEZ1bGxZZWFyKCksIHJhbmdlLmdldE1vbnRoKCksIHJhbmdlLmdldERhdGUoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0b3AgPSBuZXcgRGF0ZShzdGFydCk7XG4gICAgICBzdG9wID0gbmV3IERhdGUoc3RvcC5zZXREYXRlKHN0b3AuZ2V0RGF0ZSgpICsgcGFyc2VJbnQocmFuZ2UsIDEwKSkpO1xuICAgIH1cblxuICAgIHJldHVybiBkMy50aW1lLmRheXMoTWF0aC5taW4oc3RhcnQsIHN0b3ApLCBNYXRoLm1heChzdGFydCwgc3RvcCkpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm4gYWxsIHRoZSB3ZWVrcyBiZXR3ZWVuIDIgZGF0ZXNcbiAgICpcbiAgICogQHBhcmFtICBEYXRlICBkICBBIGRhdGVcbiAgICogQHBhcmFtICBpbnR8ZGF0ZSAgcmFuZ2UgIE51bWJlciBvZiBtaW51dGVzIGluIHRoZSByYW5nZSwgb3IgYSBzdG9wIGRhdGVcbiAgICogQHJldHVybiBhcnJheSAgQW4gYXJyYXkgb2Ygd2Vla3NcbiAgICovXG4gIGdldFdlZWtEb21haW46IGZ1bmN0aW9uIChkLCByYW5nZSkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciB3ZWVrU3RhcnQ7XG5cbiAgICBpZiAodGhpcy5vcHRpb25zLndlZWtTdGFydE9uTW9uZGF5ID09PSBmYWxzZSkge1xuICAgICAgd2Vla1N0YXJ0ID0gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCksIGQuZ2V0RGF0ZSgpIC0gZC5nZXREYXkoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChkLmdldERheSgpID09PSAxKSB7XG4gICAgICAgIHdlZWtTdGFydCA9IG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpLCBkLmdldERhdGUoKSk7XG4gICAgICB9IGVsc2UgaWYgKGQuZ2V0RGF5KCkgPT09IDApIHtcbiAgICAgICAgd2Vla1N0YXJ0ID0gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCksIGQuZ2V0RGF0ZSgpKTtcbiAgICAgICAgd2Vla1N0YXJ0LnNldERhdGUod2Vla1N0YXJ0LmdldERhdGUoKSAtIDYpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd2Vla1N0YXJ0ID0gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCksIGQuZ2V0RGF0ZSgpIC0gZC5nZXREYXkoKSArIDEpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBlbmREYXRlID0gbmV3IERhdGUod2Vla1N0YXJ0KTtcblxuICAgIHZhciBzdG9wID0gcmFuZ2U7XG4gICAgaWYgKHR5cGVvZiByYW5nZSAhPT0gJ29iamVjdCcpIHtcbiAgICAgIHN0b3AgPSBuZXcgRGF0ZShlbmREYXRlLnNldERhdGUoZW5kRGF0ZS5nZXREYXRlKCkgKyByYW5nZSAqIDcpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLndlZWtTdGFydE9uTW9uZGF5ID09PSB0cnVlXG4gICAgICA/IGQzLnRpbWUubW9uZGF5cyhNYXRoLm1pbih3ZWVrU3RhcnQsIHN0b3ApLCBNYXRoLm1heCh3ZWVrU3RhcnQsIHN0b3ApKVxuICAgICAgOiBkMy50aW1lLnN1bmRheXMoTWF0aC5taW4od2Vla1N0YXJ0LCBzdG9wKSwgTWF0aC5tYXgod2Vla1N0YXJ0LCBzdG9wKSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybiBhbGwgdGhlIG1vbnRocyBiZXR3ZWVuIDIgZGF0ZXNcbiAgICpcbiAgICogQHBhcmFtICBEYXRlICAgIGQgICAgQSBkYXRlXG4gICAqIEBwYXJhbSAgaW50fGRhdGUgIHJhbmdlICBOdW1iZXIgb2YgbW9udGhzIGluIHRoZSByYW5nZSwgb3IgYSBzdG9wIGRhdGVcbiAgICogQHJldHVybiBhcnJheSAgQW4gYXJyYXkgb2YgbW9udGhzXG4gICAqL1xuICBnZXRNb250aERvbWFpbjogZnVuY3Rpb24gKGQsIHJhbmdlKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHN0YXJ0ID0gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCkpO1xuICAgIHZhciBzdG9wID0gbnVsbDtcbiAgICBpZiAocmFuZ2UgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICBzdG9wID0gbmV3IERhdGUocmFuZ2UuZ2V0RnVsbFllYXIoKSwgcmFuZ2UuZ2V0TW9udGgoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0b3AgPSBuZXcgRGF0ZShzdGFydCk7XG4gICAgICBzdG9wID0gc3RvcC5zZXRNb250aChzdG9wLmdldE1vbnRoKCkgKyByYW5nZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGQzLnRpbWUubW9udGhzKE1hdGgubWluKHN0YXJ0LCBzdG9wKSwgTWF0aC5tYXgoc3RhcnQsIHN0b3ApKTtcbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJuIGFsbCB0aGUgeWVhcnMgYmV0d2VlbiAyIGRhdGVzXG4gICAqXG4gICAqIEBwYXJhbSAgRGF0ZSAgZCAgZGF0ZSAgQSBkYXRlXG4gICAqIEBwYXJhbSAgaW50fGRhdGUgIHJhbmdlICBOdW1iZXIgb2YgbWludXRlcyBpbiB0aGUgcmFuZ2UsIG9yIGEgc3RvcCBkYXRlXG4gICAqIEByZXR1cm4gYXJyYXkgIEFuIGFycmF5IG9mIGhvdXJzXG4gICAqL1xuICBnZXRZZWFyRG9tYWluOiBmdW5jdGlvbiAoZCwgcmFuZ2UpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgc3RhcnQgPSBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIDApO1xuICAgIHZhciBzdG9wID0gbnVsbDtcbiAgICBpZiAocmFuZ2UgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICBzdG9wID0gbmV3IERhdGUocmFuZ2UuZ2V0RnVsbFllYXIoKSwgMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0b3AgPSBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCkgKyByYW5nZSwgMCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGQzLnRpbWUueWVhcnMoTWF0aC5taW4oc3RhcnQsIHN0b3ApLCBNYXRoLm1heChzdGFydCwgc3RvcCkpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBHZXQgYW4gYXJyYXkgb2YgZG9tYWluIHN0YXJ0IGRhdGVzXG4gICAqXG4gICAqIEBwYXJhbSAgaW50fERhdGUgZGF0ZSBBIHJhbmRvbSBkYXRlIGluY2x1ZGVkIGluIHRoZSB3YW50ZWQgZG9tYWluXG4gICAqIEBwYXJhbSAgaW50fERhdGUgcmFuZ2UgTnVtYmVyIG9mIGRhdGVzIHRvIGdldCwgb3IgYSBzdG9wIGRhdGVcbiAgICogQHJldHVybiBBcnJheSBvZiBkYXRlc1xuICAgKi9cbiAgZ2V0RG9tYWluOiBmdW5jdGlvbiAoZGF0ZSwgcmFuZ2UpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAodHlwZW9mIGRhdGUgPT09ICdudW1iZXInKSB7XG4gICAgICBkYXRlID0gbmV3IERhdGUoZGF0ZSk7XG4gICAgfVxuXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSB7XG4gICAgICByYW5nZSA9IHRoaXMub3B0aW9ucy5yYW5nZTtcbiAgICB9XG5cbiAgICBzd2l0Y2ggKHRoaXMub3B0aW9ucy5kb21haW4pIHtcbiAgICAgIGNhc2UgJ2hvdXInOlxuICAgICAgICB2YXIgZG9tYWlucyA9IHRoaXMuZ2V0SG91ckRvbWFpbihkYXRlLCByYW5nZSk7XG5cbiAgICAgICAgLy8gQ2FzZSB3aGVyZSBhbiBob3VyIGlzIG1pc3NpbmcsIHdoZW4gcGFzc2luZyBmcm9tIHN0YW5kYXJkIHRpbWUgdG8gRFNUXG4gICAgICAgIC8vIE1pc3NpbmcgaG91ciBpcyBwZXJmZWN0bHkgYWNjZXB0YWJsIGluIHN1YkRvbWFpbiwgYnV0IG5vdCBpbiBkb21haW5zXG4gICAgICAgIGlmICh0eXBlb2YgcmFuZ2UgPT09ICdudW1iZXInICYmIGRvbWFpbnMubGVuZ3RoIDwgcmFuZ2UpIHtcbiAgICAgICAgICBpZiAocmFuZ2UgPiAwKSB7XG4gICAgICAgICAgICBkb21haW5zLnB1c2godGhpcy5nZXRIb3VyRG9tYWluKGRvbWFpbnNbZG9tYWlucy5sZW5ndGggLSAxXSwgMilbMV0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkb21haW5zLnNoaWZ0KHRoaXMuZ2V0SG91ckRvbWFpbihkb21haW5zWzBdLCAtMilbMF0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZG9tYWlucztcbiAgICAgIGNhc2UgJ2RheSc6XG4gICAgICAgIHJldHVybiB0aGlzLmdldERheURvbWFpbihkYXRlLCByYW5nZSk7XG4gICAgICBjYXNlICd3ZWVrJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0V2Vla0RvbWFpbihkYXRlLCByYW5nZSk7XG4gICAgICBjYXNlICdtb250aCc6XG4gICAgICAgIHJldHVybiB0aGlzLmdldE1vbnRoRG9tYWluKGRhdGUsIHJhbmdlKTtcbiAgICAgIGNhc2UgJ3llYXInOlxuICAgICAgICByZXR1cm4gdGhpcy5nZXRZZWFyRG9tYWluKGRhdGUsIHJhbmdlKTtcbiAgICB9XG4gIH0sXG5cbiAgLyoganNoaW50IG1heGNvbXBsZXhpdHk6IGZhbHNlICovXG4gIGdldFN1YkRvbWFpbjogZnVuY3Rpb24gKGRhdGUpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAodHlwZW9mIGRhdGUgPT09ICdudW1iZXInKSB7XG4gICAgICBkYXRlID0gbmV3IERhdGUoZGF0ZSk7XG4gICAgfVxuXG4gICAgdmFyIHBhcmVudCA9IHRoaXM7XG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJuIGludFxuICAgICAqL1xuICAgIHZhciBjb21wdXRlRGF5U3ViRG9tYWluU2l6ZSA9IGZ1bmN0aW9uIChkYXRlLCBkb21haW4pIHtcbiAgICAgIHN3aXRjaCAoZG9tYWluKSB7XG4gICAgICAgIGNhc2UgJ3llYXInOlxuICAgICAgICAgIHJldHVybiBwYXJlbnQuZ2V0RGF5Q291bnRJblllYXIoZGF0ZSk7XG4gICAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgICByZXR1cm4gcGFyZW50LmdldERheUNvdW50SW5Nb250aChkYXRlKTtcbiAgICAgICAgY2FzZSAnd2Vlayc6XG4gICAgICAgICAgcmV0dXJuIDc7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEByZXR1cm4gaW50XG4gICAgICovXG4gICAgdmFyIGNvbXB1dGVNaW5TdWJEb21haW5TaXplID0gZnVuY3Rpb24gKGRhdGUsIGRvbWFpbikge1xuICAgICAgc3dpdGNoIChkb21haW4pIHtcbiAgICAgICAgY2FzZSAnaG91cic6XG4gICAgICAgICAgcmV0dXJuIDYwO1xuICAgICAgICBjYXNlICdkYXknOlxuICAgICAgICAgIHJldHVybiA2MCAqIDI0O1xuICAgICAgICBjYXNlICd3ZWVrJzpcbiAgICAgICAgICByZXR1cm4gNjAgKiAyNCAqIDc7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEByZXR1cm4gaW50XG4gICAgICovXG4gICAgdmFyIGNvbXB1dGVIb3VyU3ViRG9tYWluU2l6ZSA9IGZ1bmN0aW9uIChkYXRlLCBkb21haW4pIHtcbiAgICAgIHN3aXRjaCAoZG9tYWluKSB7XG4gICAgICAgIGNhc2UgJ2RheSc6XG4gICAgICAgICAgcmV0dXJuIDI0O1xuICAgICAgICBjYXNlICd3ZWVrJzpcbiAgICAgICAgICByZXR1cm4gMTY4O1xuICAgICAgICBjYXNlICdtb250aCc6XG4gICAgICAgICAgcmV0dXJuIHBhcmVudC5nZXREYXlDb3VudEluTW9udGgoZGF0ZSkgKiAyNDtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHJldHVybiBpbnRcbiAgICAgKi9cbiAgICB2YXIgY29tcHV0ZVdlZWtTdWJEb21haW5TaXplID0gZnVuY3Rpb24gKGRhdGUsIGRvbWFpbikge1xuICAgICAgaWYgKGRvbWFpbiA9PT0gJ21vbnRoJykge1xuICAgICAgICB2YXIgZW5kT2ZNb250aCA9IG5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgZGF0ZS5nZXRNb250aCgpICsgMSwgMCk7XG4gICAgICAgIHZhciBlbmRXZWVrTmIgPSBwYXJlbnQuZ2V0V2Vla051bWJlcihlbmRPZk1vbnRoKTtcbiAgICAgICAgdmFyIHN0YXJ0V2Vla05iID0gcGFyZW50LmdldFdlZWtOdW1iZXIobmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLCBkYXRlLmdldE1vbnRoKCkpKTtcblxuICAgICAgICBpZiAoc3RhcnRXZWVrTmIgPiBlbmRXZWVrTmIpIHtcbiAgICAgICAgICBzdGFydFdlZWtOYiA9IDA7XG4gICAgICAgICAgZW5kV2Vla05iICs9IDE7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZW5kV2Vla05iIC0gc3RhcnRXZWVrTmIgKyAxO1xuICAgICAgfSBlbHNlIGlmIChkb21haW4gPT09ICd5ZWFyJykge1xuICAgICAgICByZXR1cm4gcGFyZW50LmdldFdlZWtOdW1iZXIobmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLCAxMSwgMzEpKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgc3dpdGNoICh0aGlzLm9wdGlvbnMuc3ViRG9tYWluKSB7XG4gICAgICBjYXNlICd4X21pbic6XG4gICAgICBjYXNlICdtaW4nOlxuICAgICAgICByZXR1cm4gdGhpcy5nZXRNaW51dGVEb21haW4oZGF0ZSwgY29tcHV0ZU1pblN1YkRvbWFpblNpemUoZGF0ZSwgdGhpcy5vcHRpb25zLmRvbWFpbikpO1xuICAgICAgY2FzZSAneF9ob3VyJzpcbiAgICAgIGNhc2UgJ2hvdXInOlxuICAgICAgICByZXR1cm4gdGhpcy5nZXRIb3VyRG9tYWluKGRhdGUsIGNvbXB1dGVIb3VyU3ViRG9tYWluU2l6ZShkYXRlLCB0aGlzLm9wdGlvbnMuZG9tYWluKSk7XG4gICAgICBjYXNlICd4X2RheSc6XG4gICAgICBjYXNlICdkYXknOlxuICAgICAgICByZXR1cm4gdGhpcy5nZXREYXlEb21haW4oZGF0ZSwgY29tcHV0ZURheVN1YkRvbWFpblNpemUoZGF0ZSwgdGhpcy5vcHRpb25zLmRvbWFpbikpO1xuICAgICAgY2FzZSAneF93ZWVrJzpcbiAgICAgIGNhc2UgJ3dlZWsnOlxuICAgICAgICByZXR1cm4gdGhpcy5nZXRXZWVrRG9tYWluKGRhdGUsIGNvbXB1dGVXZWVrU3ViRG9tYWluU2l6ZShkYXRlLCB0aGlzLm9wdGlvbnMuZG9tYWluKSk7XG4gICAgICBjYXNlICd4X21vbnRoJzpcbiAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TW9udGhEb21haW4oZGF0ZSwgMTIpO1xuICAgIH1cbiAgfSxcblxuICAvKipcbiAgICogR2V0IHRoZSBuLXRoIG5leHQgZG9tYWluIGFmdGVyIHRoZSBjYWxlbmRhciBuZXdlc3QgKHJpZ2h0bW9zdCkgZG9tYWluXG4gICAqIEBwYXJhbSAgaW50IG5cbiAgICogQHJldHVybiBEYXRlIFRoZSBzdGFydCBkYXRlIG9mIHRoZSB3YW50ZWQgZG9tYWluXG4gICAqL1xuICBnZXROZXh0RG9tYWluOiBmdW5jdGlvbiAobikge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICBuID0gMTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZ2V0RG9tYWluKHRoaXMuanVtcERhdGUodGhpcy5nZXREb21haW5LZXlzKCkucG9wKCksIG4sIHRoaXMub3B0aW9ucy5kb21haW4pLCAxKVswXTtcbiAgfSxcblxuICAvKipcbiAgICogR2V0IHRoZSBuLXRoIGRvbWFpbiBiZWZvcmUgdGhlIGNhbGVuZGFyIG9sZGVzdCAobGVmdG1vc3QpIGRvbWFpblxuICAgKiBAcGFyYW0gIGludCBuXG4gICAqIEByZXR1cm4gRGF0ZSBUaGUgc3RhcnQgZGF0ZSBvZiB0aGUgd2FudGVkIGRvbWFpblxuICAgKi9cbiAgZ2V0UHJldmlvdXNEb21haW46IGZ1bmN0aW9uIChuKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgIG4gPSAxO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5nZXREb21haW4oXG4gICAgICB0aGlzLmp1bXBEYXRlKHRoaXMuZ2V0RG9tYWluS2V5cygpLnNoaWZ0KCksIC1uLCB0aGlzLm9wdGlvbnMuZG9tYWluKSxcbiAgICAgIDEsXG4gICAgKVswXTtcbiAgfSxcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgLy8gREFUQVMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG5cbiAgLyoqXG4gICAqIEZldGNoIGFuZCBpbnRlcnByZXQgZGF0YSBmcm9tIHRoZSBkYXRhc291cmNlXG4gICAqXG4gICAqIEBwYXJhbSBzdHJpbmd8b2JqZWN0IHNvdXJjZVxuICAgKiBAcGFyYW0gRGF0ZSBzdGFydERhdGVcbiAgICogQHBhcmFtIERhdGUgZW5kRGF0ZVxuICAgKiBAcGFyYW0gZnVuY3Rpb24gY2FsbGJhY2tcbiAgICogQHBhcmFtIGZ1bmN0aW9ufGJvb2xlYW4gYWZ0ZXJMb2FkIGZ1bmN0aW9uIHVzZWQgdG8gY29udmVydCB0aGUgZGF0YSBpbnRvIGEganNvbiBvYmplY3QuIFVzZSB0cnVlIHRvIHVzZSB0aGUgYWZ0ZXJMb2FkIGNhbGxiYWNrXG4gICAqIEBwYXJhbSB1cGRhdGVNb2RlXG4gICAqXG4gICAqIEByZXR1cm4gbWl4ZWRcbiAgICogLSBUcnVlIGlmIHRoZXJlIGFyZSBubyBkYXRhIHRvIGxvYWRcbiAgICogLSBGYWxzZSBpZiBkYXRhIGFyZSBsb2FkZWQgYXN5bmNocm9ub3VzbHlcbiAgICovXG4gIGdldERhdGFzOiBmdW5jdGlvbiAoc291cmNlLCBzdGFydERhdGUsIGVuZERhdGUsIGNhbGxiYWNrLCBhZnRlckxvYWQsIHVwZGF0ZU1vZGUpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCA1KSB7XG4gICAgICBhZnRlckxvYWQgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDYpIHtcbiAgICAgIHVwZGF0ZU1vZGUgPSB0aGlzLkFQUEVORF9PTl9VUERBVEU7XG4gICAgfVxuICAgIHZhciBfY2FsbGJhY2sgPSBmdW5jdGlvbiAoZXJyb3IsIGRhdGEpIHtcbiAgICAgIGlmIChhZnRlckxvYWQgIT09IGZhbHNlKSB7XG4gICAgICAgIGlmICh0eXBlb2YgYWZ0ZXJMb2FkID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgZGF0YSA9IGFmdGVyTG9hZChkYXRhKTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygc2VsZi5vcHRpb25zLmFmdGVyTG9hZERhdGEgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICBkYXRhID0gc2VsZi5vcHRpb25zLmFmdGVyTG9hZERhdGEoZGF0YSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1Byb3ZpZGVkIGNhbGxiYWNrIGZvciBhZnRlckxvYWREYXRhIGlzIG5vdCBhIGZ1bmN0aW9uLicpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHNlbGYub3B0aW9ucy5kYXRhVHlwZSA9PT0gJ2NzdicgfHwgc2VsZi5vcHRpb25zLmRhdGFUeXBlID09PSAndHN2Jykge1xuICAgICAgICBkYXRhID0gdGhpcy5pbnRlcnByZXRDU1YoZGF0YSk7XG4gICAgICB9XG4gICAgICBzZWxmLnBhcnNlRGF0YXMoZGF0YSwgdXBkYXRlTW9kZSwgc3RhcnREYXRlLCBlbmREYXRlKTtcbiAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgc3dpdGNoICh0eXBlb2Ygc291cmNlKSB7XG4gICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICBpZiAoc291cmNlID09PSAnJykge1xuICAgICAgICAgIF9jYWxsYmFjayhudWxsLCB7fSk7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIHVybCA9IHRoaXMucGFyc2VVUkkoc291cmNlLCBzdGFydERhdGUsIGVuZERhdGUpO1xuICAgICAgICAgIHZhciByZXF1ZXN0VHlwZSA9ICdHRVQnO1xuICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuZGF0YVBvc3RQYXlsb2FkICE9PSBudWxsKSB7XG4gICAgICAgICAgICByZXF1ZXN0VHlwZSA9ICdQT1NUJztcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyIHBheWxvYWQgPSBudWxsO1xuICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuZGF0YVBvc3RQYXlsb2FkICE9PSBudWxsKSB7XG4gICAgICAgICAgICBwYXlsb2FkID0gdGhpcy5wYXJzZVVSSShzZWxmLm9wdGlvbnMuZGF0YVBvc3RQYXlsb2FkLCBzdGFydERhdGUsIGVuZERhdGUpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHZhciB4aHIgPSBudWxsO1xuICAgICAgICAgIHN3aXRjaCAodGhpcy5vcHRpb25zLmRhdGFUeXBlKSB7XG4gICAgICAgICAgICBjYXNlICdqc29uJzpcbiAgICAgICAgICAgICAgeGhyID0gZDMuanNvbih1cmwpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2Nzdic6XG4gICAgICAgICAgICAgIHhociA9IGQzLmNzdih1cmwpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3Rzdic6XG4gICAgICAgICAgICAgIHhociA9IGQzLnRzdih1cmwpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3R4dCc6XG4gICAgICAgICAgICAgIHhociA9IGQzLnRleHQodXJsLCAndGV4dC9wbGFpbicpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBqc2hpbnQgbWF4ZGVwdGg6NVxuICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuZGF0YVJlcXVlc3RIZWFkZXJzICE9PSBudWxsKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBoZWFkZXIgaW4gc2VsZi5vcHRpb25zLmRhdGFSZXF1ZXN0SGVhZGVycykge1xuICAgICAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmRhdGFSZXF1ZXN0SGVhZGVycy5oYXNPd25Qcm9wZXJ0eShoZWFkZXIpKSB7XG4gICAgICAgICAgICAgICAgeGhyLmhlYWRlcihoZWFkZXIsIHNlbGYub3B0aW9ucy5kYXRhUmVxdWVzdEhlYWRlcnNbaGVhZGVyXSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICB4aHIuc2VuZChyZXF1ZXN0VHlwZSwgcGF5bG9hZCwgX2NhbGxiYWNrKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICBpZiAoc291cmNlID09PSBPYmplY3Qoc291cmNlKSkge1xuICAgICAgICAgIF9jYWxsYmFjayhudWxsLCBzb3VyY2UpO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgLyogZmFsbHMgdGhyb3VnaCAqL1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgX2NhbGxiYWNrKG51bGwsIHt9KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9LFxuXG4gIC8qKlxuICAgKiBQb3B1bGF0ZSB0aGUgY2FsZW5kYXIgaW50ZXJuYWwgZGF0YVxuICAgKlxuICAgKiBAcGFyYW0gb2JqZWN0IGRhdGFcbiAgICogQHBhcmFtIGNvbnN0YW50IHVwZGF0ZU1vZGVcbiAgICogQHBhcmFtIERhdGUgc3RhcnREYXRlXG4gICAqIEBwYXJhbSBEYXRlIGVuZERhdGVcbiAgICpcbiAgICogQHJldHVybiB2b2lkXG4gICAqL1xuICBwYXJzZURhdGFzOiBmdW5jdGlvbiAoZGF0YSwgdXBkYXRlTW9kZSwgc3RhcnREYXRlLCBlbmREYXRlKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKHVwZGF0ZU1vZGUgPT09IHRoaXMuUkVTRVRfQUxMX09OX1VQREFURSkge1xuICAgICAgdGhpcy5fZG9tYWlucy5mb3JFYWNoKGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICAgIHZhbHVlLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQsIGluZGV4LCBhcnJheSkge1xuICAgICAgICAgIGFycmF5W2luZGV4XS52ID0gbnVsbDtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB2YXIgdGVtcCA9IHt9O1xuXG4gICAgdmFyIGV4dHJhY3RUaW1lID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgIHJldHVybiBkLnQ7XG4gICAgfTtcblxuICAgIC8qanNoaW50IGZvcmluOmZhbHNlICovXG4gICAgZm9yICh2YXIgZCBpbiBkYXRhKSB7XG4gICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKGQgKiAxMDAwKTtcbiAgICAgIHZhciBkb21haW5Vbml0ID0gdGhpcy5nZXREb21haW4oZGF0ZSlbMF0uZ2V0VGltZSgpO1xuICAgICAgLy8gVGhlIGN1cnJlbnQgZGF0YSBiZWxvbmdzIHRvIGEgZG9tYWluIHRoYXQgd2FzIGNvbXByZXNzZWRcbiAgICAgIC8vIENvbXByZXNzIHRoZSBkYXRhIGZvciB0aGUgdHdvIGR1cGxpY2F0ZSBob3VycyBpbnRvIHRoZSBzYW1lIGhvdXJcbiAgICAgIGlmICh0aGlzLkRTVERvbWFpbi5pbmRleE9mKGRvbWFpblVuaXQpID49IDApIHtcbiAgICAgICAgLy8gUmUtYXNzaWduIGFsbCBkYXRhIHRvIHRoZSBmaXJzdCBvciB0aGUgc2Vjb25kIGR1cGxpY2F0ZSBob3Vyc1xuICAgICAgICAvLyBkZXBlbmRpbmcgb24gd2hpY2ggaXMgdmlzaWJsZVxuICAgICAgICBpZiAodGhpcy5fZG9tYWlucy5oYXMoZG9tYWluVW5pdCAtIDM2MDAgKiAxMDAwKSkge1xuICAgICAgICAgIGRvbWFpblVuaXQgLT0gMzYwMCAqIDEwMDA7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gU2tpcCBpZiBkYXRhIGlzIG5vdCByZWxldmFudCB0byBjdXJyZW50IGRvbWFpblxuICAgICAgaWYgKFxuICAgICAgICBpc05hTihkKSB8fFxuICAgICAgICAhZGF0YS5oYXNPd25Qcm9wZXJ0eShkKSB8fFxuICAgICAgICAhdGhpcy5fZG9tYWlucy5oYXMoZG9tYWluVW5pdCkgfHxcbiAgICAgICAgIShkb21haW5Vbml0ID49ICtzdGFydERhdGUgJiYgZG9tYWluVW5pdCA8ICtlbmREYXRlKVxuICAgICAgKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICB2YXIgc3ViRG9tYWluc0RhdGEgPSB0aGlzLl9kb21haW5zLmdldChkb21haW5Vbml0KTtcblxuICAgICAgaWYgKCF0ZW1wLmhhc093blByb3BlcnR5KGRvbWFpblVuaXQpKSB7XG4gICAgICAgIHRlbXBbZG9tYWluVW5pdF0gPSBzdWJEb21haW5zRGF0YS5tYXAoZXh0cmFjdFRpbWUpO1xuICAgICAgfVxuXG4gICAgICB2YXIgaW5kZXggPSB0ZW1wW2RvbWFpblVuaXRdLmluZGV4T2YoXG4gICAgICAgIHRoaXMuX2RvbWFpblR5cGVbdGhpcy5vcHRpb25zLnN1YkRvbWFpbl0uZXh0cmFjdFVuaXQoZGF0ZSksXG4gICAgICApO1xuXG4gICAgICBpZiAodXBkYXRlTW9kZSA9PT0gdGhpcy5SRVNFVF9TSU5HTEVfT05fVVBEQVRFKSB7XG4gICAgICAgIHN1YkRvbWFpbnNEYXRhW2luZGV4XS52ID0gZGF0YVtkXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICghaXNOYU4oc3ViRG9tYWluc0RhdGFbaW5kZXhdLnYpKSB7XG4gICAgICAgICAgc3ViRG9tYWluc0RhdGFbaW5kZXhdLnYgKz0gZGF0YVtkXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzdWJEb21haW5zRGF0YVtpbmRleF0udiA9IGRhdGFbZF07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgcGFyc2VVUkk6IGZ1bmN0aW9uIChzdHIsIHN0YXJ0RGF0ZSwgZW5kRGF0ZSkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIC8vIFVzZSBhIHRpbWVzdGFtcCBpbiBzZWNvbmRzXG4gICAgc3RyID0gc3RyLnJlcGxhY2UoL1xce1xce3Q6c3RhcnRcXH1cXH0vZywgc3RhcnREYXRlLmdldFRpbWUoKSAvIDEwMDApO1xuICAgIHN0ciA9IHN0ci5yZXBsYWNlKC9cXHtcXHt0OmVuZFxcfVxcfS9nLCBlbmREYXRlLmdldFRpbWUoKSAvIDEwMDApO1xuXG4gICAgLy8gVXNlIGEgc3RyaW5nIGRhdGUsIGZvbGxvd2luZyB0aGUgSVNPLTg2MDFcbiAgICBzdHIgPSBzdHIucmVwbGFjZSgvXFx7XFx7ZDpzdGFydFxcfVxcfS9nLCBzdGFydERhdGUudG9JU09TdHJpbmcoKSk7XG4gICAgc3RyID0gc3RyLnJlcGxhY2UoL1xce1xce2Q6ZW5kXFx9XFx9L2csIGVuZERhdGUudG9JU09TdHJpbmcoKSk7XG5cbiAgICByZXR1cm4gc3RyO1xuICB9LFxuXG4gIGludGVycHJldENTVjogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgZCA9IHt9O1xuICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMoZGF0YVswXSk7XG4gICAgdmFyIGksIHRvdGFsO1xuICAgIGZvciAoaSA9IDAsIHRvdGFsID0gZGF0YS5sZW5ndGg7IGkgPCB0b3RhbDsgaSArPSAxKSB7XG4gICAgICBkW2RhdGFbaV1ba2V5c1swXV1dID0gK2RhdGFbaV1ba2V5c1sxXV07XG4gICAgfVxuICAgIHJldHVybiBkO1xuICB9LFxuXG4gIC8qKlxuICAgKiBIYW5kbGUgdGhlIGNhbGVuZGFyIGxheW91dCBhbmQgZGltZW5zaW9uXG4gICAqXG4gICAqIEV4cGFuZCBhbmQgc2hyaW5rIHRoZSBjb250YWluZXIgZGVwZW5kaW5nIG9uIGl0cyBjaGlsZHJlbiBkaW1lbnNpb25cbiAgICogQWxzbyByZWFycmFuZ2UgdGhlIGNoaWxkcmVuIHBvc2l0aW9uIGRlcGVuZGluZyBvbiB0aGVpciBkaW1lbnNpb24sXG4gICAqIGFuZCB0aGUgbGVnZW5kIHBvc2l0aW9uXG4gICAqXG4gICAqIEByZXR1cm4gdm9pZFxuICAgKi9cbiAgcmVzaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHBhcmVudCA9IHRoaXM7XG4gICAgdmFyIG9wdGlvbnMgPSBwYXJlbnQub3B0aW9ucztcbiAgICB2YXIgbGVnZW5kV2lkdGggPSBvcHRpb25zLmRpc3BsYXlMZWdlbmRcbiAgICAgID8gcGFyZW50LkxlZ2VuZC5nZXREaW0oJ3dpZHRoJykgKyBvcHRpb25zLmxlZ2VuZE1hcmdpblsxXSArIG9wdGlvbnMubGVnZW5kTWFyZ2luWzNdXG4gICAgICA6IDA7XG4gICAgdmFyIGxlZ2VuZEhlaWdodCA9IG9wdGlvbnMuZGlzcGxheUxlZ2VuZFxuICAgICAgPyBwYXJlbnQuTGVnZW5kLmdldERpbSgnaGVpZ2h0JykgKyBvcHRpb25zLmxlZ2VuZE1hcmdpblswXSArIG9wdGlvbnMubGVnZW5kTWFyZ2luWzJdXG4gICAgICA6IDA7XG5cbiAgICB2YXIgZ3JhcGhXaWR0aCA9IHBhcmVudC5ncmFwaERpbS53aWR0aCAtIG9wdGlvbnMuZG9tYWluR3V0dGVyIC0gb3B0aW9ucy5jZWxsUGFkZGluZztcbiAgICB2YXIgZ3JhcGhIZWlnaHQgPSBwYXJlbnQuZ3JhcGhEaW0uaGVpZ2h0IC0gb3B0aW9ucy5kb21haW5HdXR0ZXIgLSBvcHRpb25zLmNlbGxQYWRkaW5nO1xuXG4gICAgdGhpcy5yb290XG4gICAgICAudHJhbnNpdGlvbigpXG4gICAgICAuZHVyYXRpb24ob3B0aW9ucy5hbmltYXRpb25EdXJhdGlvbilcbiAgICAgIC5hdHRyKCd3aWR0aCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIG9wdGlvbnMubGVnZW5kVmVydGljYWxQb3NpdGlvbiA9PT0gJ21pZGRsZScgfHxcbiAgICAgICAgICBvcHRpb25zLmxlZ2VuZFZlcnRpY2FsUG9zaXRpb24gPT09ICdjZW50ZXInXG4gICAgICAgICkge1xuICAgICAgICAgIHJldHVybiBncmFwaFdpZHRoICsgbGVnZW5kV2lkdGg7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KGdyYXBoV2lkdGgsIGxlZ2VuZFdpZHRoKTtcbiAgICAgIH0pXG4gICAgICAuYXR0cignaGVpZ2h0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgb3B0aW9ucy5sZWdlbmRWZXJ0aWNhbFBvc2l0aW9uID09PSAnbWlkZGxlJyB8fFxuICAgICAgICAgIG9wdGlvbnMubGVnZW5kVmVydGljYWxQb3NpdGlvbiA9PT0gJ2NlbnRlcidcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuIE1hdGgubWF4KGdyYXBoSGVpZ2h0LCBsZWdlbmRIZWlnaHQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBncmFwaEhlaWdodCArIGxlZ2VuZEhlaWdodDtcbiAgICAgIH0pO1xuXG4gICAgdGhpcy5yb290XG4gICAgICAuc2VsZWN0KCcuZ3JhcGgnKVxuICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgLmR1cmF0aW9uKG9wdGlvbnMuYW5pbWF0aW9uRHVyYXRpb24pXG4gICAgICAuYXR0cigneScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMubGVnZW5kVmVydGljYWxQb3NpdGlvbiA9PT0gJ3RvcCcpIHtcbiAgICAgICAgICByZXR1cm4gbGVnZW5kSGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfSlcbiAgICAgIC5hdHRyKCd4JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgKG9wdGlvbnMubGVnZW5kVmVydGljYWxQb3NpdGlvbiA9PT0gJ21pZGRsZScgfHxcbiAgICAgICAgICAgIG9wdGlvbnMubGVnZW5kVmVydGljYWxQb3NpdGlvbiA9PT0gJ2NlbnRlcicpICYmXG4gICAgICAgICAgb3B0aW9ucy5sZWdlbmRIb3Jpem9udGFsUG9zaXRpb24gPT09ICdsZWZ0J1xuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm4gbGVnZW5kV2lkdGg7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9KTtcbiAgfSxcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgLy8gUFVCTElDIEFQSSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG5cbiAgLyoqXG4gICAqIFNoaWZ0IHRoZSBjYWxlbmRhciBmb3J3YXJkXG4gICAqL1xuICBuZXh0OiBmdW5jdGlvbiAobikge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICBuID0gMTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMubG9hZE5leHREb21haW4obik7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFNoaWZ0IHRoZSBjYWxlbmRhciBiYWNrd2FyZFxuICAgKi9cbiAgcHJldmlvdXM6IGZ1bmN0aW9uIChuKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgIG4gPSAxO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5sb2FkUHJldmlvdXNEb21haW4obik7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEp1bXAgZGlyZWN0bHkgdG8gYSBzcGVjaWZpYyBkYXRlXG4gICAqXG4gICAqIEp1bXBUbyB3aWxsIHNjcm9sbCB0aGUgY2FsZW5kYXIgdW50aWwgdGhlIHdhbnRlZCBkb21haW4gd2l0aCB0aGUgc3BlY2lmaWVkXG4gICAqIGRhdGUgaXMgdmlzaWJsZS4gVW5sZXNzIHlvdSBzZXQgcmVzZXQgdG8gdHJ1ZSwgdGhlIHdhbnRlZCBkb21haW5cbiAgICogd2lsbCBub3QgbmVjZXNzYXJpbHkgYmUgdGhlIGZpcnN0IChsZWZ0bW9zdCkgZG9tYWluIG9mIHRoZSBjYWxlbmRhci5cbiAgICpcbiAgICogQHBhcmFtIERhdGUgZGF0ZSBKdW1wIHRvIHRoZSBkb21haW4gY29udGFpbmluZyB0aGF0IGRhdGVcbiAgICogQHBhcmFtIGJvb2wgcmVzZXQgV2hldGhlciB0aGUgd2FudGVkIGRvbWFpbiBzaG91bGQgYmUgdGhlIGZpcnN0IGRvbWFpbiBvZiB0aGUgY2FsZW5kYXJcbiAgICogQHBhcmFtIGJvb2wgVHJ1ZSBvZiB0aGUgY2FsZW5kYXIgd2FzIHNjcm9sbGVkXG4gICAqL1xuICBqdW1wVG86IGZ1bmN0aW9uIChkYXRlLCByZXNldCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikge1xuICAgICAgcmVzZXQgPSBmYWxzZTtcbiAgICB9XG4gICAgdmFyIGRvbWFpbnMgPSB0aGlzLmdldERvbWFpbktleXMoKTtcbiAgICB2YXIgZmlyc3REb21haW4gPSBkb21haW5zWzBdO1xuICAgIHZhciBsYXN0RG9tYWluID0gZG9tYWluc1tkb21haW5zLmxlbmd0aCAtIDFdO1xuXG4gICAgaWYgKGRhdGUgPCBmaXJzdERvbWFpbikge1xuICAgICAgcmV0dXJuIHRoaXMubG9hZFByZXZpb3VzRG9tYWluKHRoaXMuZ2V0RG9tYWluKGZpcnN0RG9tYWluLCBkYXRlKS5sZW5ndGgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAocmVzZXQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZE5leHREb21haW4odGhpcy5nZXREb21haW4oZmlyc3REb21haW4sIGRhdGUpLmxlbmd0aCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChkYXRlID4gbGFzdERvbWFpbikge1xuICAgICAgICByZXR1cm4gdGhpcy5sb2FkTmV4dERvbWFpbih0aGlzLmdldERvbWFpbihsYXN0RG9tYWluLCBkYXRlKS5sZW5ndGgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcblxuICAvKipcbiAgICogTmF2aWdhdGUgYmFjayB0byB0aGUgc3RhcnQgZGF0ZVxuICAgKlxuICAgKiBAc2luY2UgIDMuMy44XG4gICAqIEByZXR1cm4gdm9pZFxuICAgKi9cbiAgcmV3aW5kOiBmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdGhpcy5qdW1wVG8odGhpcy5vcHRpb25zLnN0YXJ0LCB0cnVlKTtcbiAgfSxcblxuICAvKipcbiAgICogVXBkYXRlIHRoZSBjYWxlbmRhciB3aXRoIG5ldyBkYXRhXG4gICAqXG4gICAqIEBwYXJhbSAgb2JqZWN0fHN0cmluZyAgICBkYXRhU291cmNlICAgIFRoZSBjYWxlbmRhcidzIGRhdGFzb3VyY2UsIHNhbWUgdHlwZSBhcyB0aGlzLm9wdGlvbnMuZGF0YVxuICAgKiBAcGFyYW0gIGJvb2xlYW58ZnVuY3Rpb24gICAgYWZ0ZXJMb2FkICAgIFdoZXRoZXIgdG8gZXhlY3V0ZSBhZnRlckxvYWQoKSBvbiB0aGUgZGF0YS4gUGFzcyBkaXJlY3RseSBhIGZ1bmN0aW9uXG4gICAqIGlmIHlvdSBkb24ndCB3YW50IHRvIHVzZSB0aGUgYWZ0ZXJMb2FkKCkgY2FsbGJhY2tcbiAgICovXG4gIHVwZGF0ZTogZnVuY3Rpb24gKGRhdGFTb3VyY2UsIGFmdGVyTG9hZCwgdXBkYXRlTW9kZSkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICBkYXRhU291cmNlID0gdGhpcy5vcHRpb25zLmRhdGE7XG4gICAgfVxuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikge1xuICAgICAgYWZ0ZXJMb2FkID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAzKSB7XG4gICAgICB1cGRhdGVNb2RlID0gdGhpcy5SRVNFVF9BTExfT05fVVBEQVRFO1xuICAgIH1cblxuICAgIHZhciBkb21haW5zID0gdGhpcy5nZXREb21haW5LZXlzKCk7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHRoaXMuZ2V0RGF0YXMoXG4gICAgICBkYXRhU291cmNlLFxuICAgICAgbmV3IERhdGUoZG9tYWluc1swXSksXG4gICAgICB0aGlzLmdldFN1YkRvbWFpbihkb21haW5zW2RvbWFpbnMubGVuZ3RoIC0gMV0pLnBvcCgpLFxuICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICBzZWxmLmZpbGwoKTtcbiAgICAgICAgc2VsZi5hZnRlclVwZGF0ZSgpO1xuICAgICAgfSxcbiAgICAgIGFmdGVyTG9hZCxcbiAgICAgIHVwZGF0ZU1vZGUsXG4gICAgKTtcbiAgfSxcblxuICAvKipcbiAgICogU2V0IHRoZSBsZWdlbmRcbiAgICpcbiAgICogQHBhcmFtIGFycmF5IGxlZ2VuZCBhbiBhcnJheSBvZiBpbnRlZ2VyLCByZXByZXNlbnRpbmcgdGhlIGRpZmZlcmVudCB0aHJlc2hvbGQgdmFsdWVcbiAgICogQHBhcmFtIGFycmF5IGNvbG9yUmFuZ2UgYW4gYXJyYXkgb2YgMiBoZXggY29sb3JzLCBmb3IgdGhlIG1pbmltdW0gYW5kIG1heGltdW0gY29sb3JzXG4gICAqL1xuICBzZXRMZWdlbmQ6IGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgb2xkTGVnZW5kID0gdGhpcy5vcHRpb25zLmxlZ2VuZC5zbGljZSgwKTtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+PSAxICYmIEFycmF5LmlzQXJyYXkoYXJndW1lbnRzWzBdKSkge1xuICAgICAgdGhpcy5vcHRpb25zLmxlZ2VuZCA9IGFyZ3VtZW50c1swXTtcbiAgICB9XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPj0gMikge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYXJndW1lbnRzWzFdKSAmJiBhcmd1bWVudHNbMV0ubGVuZ3RoID49IDIpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmxlZ2VuZENvbG9ycyA9IFthcmd1bWVudHNbMV1bMF0sIGFyZ3VtZW50c1sxXVsxXV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm9wdGlvbnMubGVnZW5kQ29sb3JzID0gYXJndW1lbnRzWzFdO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChcbiAgICAgIChhcmd1bWVudHMubGVuZ3RoID4gMCAmJiAhYXJyYXlFcXVhbHMob2xkTGVnZW5kLCB0aGlzLm9wdGlvbnMubGVnZW5kKSkgfHxcbiAgICAgIGFyZ3VtZW50cy5sZW5ndGggPj0gMlxuICAgICkge1xuICAgICAgdGhpcy5MZWdlbmQuYnVpbGRDb2xvcnMoKTtcbiAgICAgIHRoaXMuZmlsbCgpO1xuICAgIH1cblxuICAgIHRoaXMuTGVnZW5kLnJlZHJhdyh0aGlzLmdyYXBoRGltLndpZHRoIC0gdGhpcy5vcHRpb25zLmRvbWFpbkd1dHRlciAtIHRoaXMub3B0aW9ucy5jZWxsUGFkZGluZyk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJlbW92ZSB0aGUgbGVnZW5kXG4gICAqXG4gICAqIEByZXR1cm4gYm9vbCBGYWxzZSBpZiB0aGVyZSBpcyBubyBsZWdlbmQgdG8gcmVtb3ZlXG4gICAqL1xuICByZW1vdmVMZWdlbmQ6IGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAoIXRoaXMub3B0aW9ucy5kaXNwbGF5TGVnZW5kKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHRoaXMub3B0aW9ucy5kaXNwbGF5TGVnZW5kID0gZmFsc2U7XG4gICAgdGhpcy5MZWdlbmQucmVtb3ZlKCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG5cbiAgLyoqXG4gICAqIERpc3BsYXkgdGhlIGxlZ2VuZFxuICAgKlxuICAgKiBAcmV0dXJuIGJvb2wgRmFsc2UgaWYgdGhlIGxlZ2VuZCB3YXMgYWxyZWFkeSBkaXNwbGF5ZWRcbiAgICovXG4gIHNob3dMZWdlbmQ6IGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAodGhpcy5vcHRpb25zLmRpc3BsYXlMZWdlbmQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5vcHRpb25zLmRpc3BsYXlMZWdlbmQgPSB0cnVlO1xuICAgIHRoaXMuTGVnZW5kLnJlZHJhdyh0aGlzLmdyYXBoRGltLndpZHRoIC0gdGhpcy5vcHRpb25zLmRvbWFpbkd1dHRlciAtIHRoaXMub3B0aW9ucy5jZWxsUGFkZGluZyk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEhpZ2hsaWdodCBkYXRlc1xuICAgKlxuICAgKiBBZGQgYSBoaWdobGlnaHQgY2xhc3MgdG8gYSBzZXQgb2YgZGF0ZXNcbiAgICpcbiAgICogQHNpbmNlICAzLjMuNVxuICAgKiBAcGFyYW0gIGFycmF5IEFycmF5IG9mIGRhdGVzIHRvIGhpZ2hsaWdodFxuICAgKiBAcmV0dXJuIGJvb2wgVHJ1ZSBpZiBkYXRlcyB3ZXJlIGhpZ2hsaWdodGVkXG4gICAqL1xuICBoaWdobGlnaHQ6IGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKCh0aGlzLm9wdGlvbnMuaGlnaGxpZ2h0ID0gdGhpcy5leHBhbmREYXRlU2V0dGluZyhhcmdzKSkubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5maWxsKCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuXG4gIC8qKlxuICAgKiBEZXN0cm95IHRoZSBjYWxlbmRhclxuICAgKlxuICAgKiBVc2FnZTogY2FsID0gY2FsLmRlc3Ryb3koKTtcbiAgICpcbiAgICogQHNpbmNlICAzLjMuNlxuICAgKiBAcGFyYW0gZnVuY3Rpb24gQSBjYWxsYmFjayBmdW5jdGlvbiB0byB0cmlnZ2VyIGFmdGVyIGRlc3Ryb3lpbmcgdGhlIGNhbGVuZGFyXG4gICAqIEByZXR1cm4gbnVsbFxuICAgKi9cbiAgZGVzdHJveTogZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdGhpcy5yb290XG4gICAgICAudHJhbnNpdGlvbigpXG4gICAgICAuZHVyYXRpb24odGhpcy5vcHRpb25zLmFuaW1hdGlvbkR1cmF0aW9uKVxuICAgICAgLmF0dHIoJ3dpZHRoJywgMClcbiAgICAgIC5hdHRyKCdoZWlnaHQnLCAwKVxuICAgICAgLnJlbW92ZSgpXG4gICAgICAuZWFjaCgnZW5kJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgY2FsbGJhY2sgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1Byb3ZpZGVkIGNhbGxiYWNrIGZvciBkZXN0cm95KCkgaXMgbm90IGEgZnVuY3Rpb24uJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgcmV0dXJuIG51bGw7XG4gIH0sXG5cbiAgZ2V0U1ZHOiBmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHN0eWxlcyA9IHtcbiAgICAgICcuY2FsLWhlYXRtYXAtY29udGFpbmVyJzoge30sXG4gICAgICAnLmdyYXBoJzoge30sXG4gICAgICAnLmdyYXBoLXJlY3QnOiB7fSxcbiAgICAgICdyZWN0LmhpZ2hsaWdodCc6IHt9LFxuICAgICAgJ3JlY3Qubm93Jzoge30sXG4gICAgICAncmVjdC5oaWdobGlnaHQtbm93Jzoge30sXG4gICAgICAndGV4dC5oaWdobGlnaHQnOiB7fSxcbiAgICAgICd0ZXh0Lm5vdyc6IHt9LFxuICAgICAgJ3RleHQuaGlnaGxpZ2h0LW5vdyc6IHt9LFxuICAgICAgJy5kb21haW4tYmFja2dyb3VuZCc6IHt9LFxuICAgICAgJy5ncmFwaC1sYWJlbCc6IHt9LFxuICAgICAgJy5zdWJkb21haW4tdGV4dCc6IHt9LFxuICAgICAgJy5xMCc6IHt9LFxuICAgICAgJy5xaSc6IHt9LFxuICAgIH07XG5cbiAgICBmb3IgKHZhciBqID0gMSwgdG90YWwgPSB0aGlzLm9wdGlvbnMubGVnZW5kLmxlbmd0aCArIDE7IGogPD0gdG90YWw7IGogKz0gMSkge1xuICAgICAgc3R5bGVzWycucScgKyBqXSA9IHt9O1xuICAgIH1cblxuICAgIHZhciByb290ID0gdGhpcy5yb290O1xuXG4gICAgdmFyIHdoaXRlbGlzdFN0eWxlcyA9IFtcbiAgICAgIC8vIFNWRyBzcGVjaWZpYyBwcm9wZXJ0aWVzXG4gICAgICAnc3Ryb2tlJyxcbiAgICAgICdzdHJva2Utd2lkdGgnLFxuICAgICAgJ3N0cm9rZS1vcGFjaXR5JyxcbiAgICAgICdzdHJva2UtZGFzaGFycmF5JyxcbiAgICAgICdzdHJva2UtZGFzaG9mZnNldCcsXG4gICAgICAnc3Ryb2tlLWxpbmVjYXAnLFxuICAgICAgJ3N0cm9rZS1taXRlcmxpbWl0JyxcbiAgICAgICdmaWxsJyxcbiAgICAgICdmaWxsLW9wYWNpdHknLFxuICAgICAgJ2ZpbGwtcnVsZScsXG4gICAgICAnbWFya2VyJyxcbiAgICAgICdtYXJrZXItc3RhcnQnLFxuICAgICAgJ21hcmtlci1taWQnLFxuICAgICAgJ21hcmtlci1lbmQnLFxuICAgICAgJ2FsaWduZW1lbnQtYmFzZWxpbmUnLFxuICAgICAgJ2Jhc2VsaW5lLXNoaWZ0JyxcbiAgICAgICdkb21pbmFudC1iYXNlbGluZScsXG4gICAgICAnZ2x5cGgtb3JpZW50YXRpb24taG9yaXpvbnRhbCcsXG4gICAgICAnZ2x5cGgtb3JpZW50YXRpb24tdmVydGljYWwnLFxuICAgICAgJ2tlcm5pbmcnLFxuICAgICAgJ3RleHQtYW5jaG9yJyxcbiAgICAgICdzaGFwZS1yZW5kZXJpbmcnLFxuXG4gICAgICAvLyBUZXh0IFNwZWNpZmljIHByb3BlcnRpZXNcbiAgICAgICd0ZXh0LXRyYW5zZm9ybScsXG4gICAgICAnZm9udC1mYW1pbHknLFxuICAgICAgJ2ZvbnQnLFxuICAgICAgJ2ZvbnQtc2l6ZScsXG4gICAgICAnZm9udC13ZWlnaHQnLFxuICAgIF07XG5cbiAgICB2YXIgZmlsdGVyU3R5bGVzID0gZnVuY3Rpb24gKGF0dHJpYnV0ZSwgcHJvcGVydHksIHZhbHVlKSB7XG4gICAgICBpZiAod2hpdGVsaXN0U3R5bGVzLmluZGV4T2YocHJvcGVydHkpICE9PSAtMSkge1xuICAgICAgICBzdHlsZXNbYXR0cmlidXRlXVtwcm9wZXJ0eV0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIGdldEVsZW1lbnQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIHJvb3Quc2VsZWN0KGUpWzBdWzBdO1xuICAgIH07XG5cbiAgICAvKiBqc2hpbnQgZm9yaW46ZmFsc2UgKi9cbiAgICBmb3IgKHZhciBlbGVtZW50IGluIHN0eWxlcykge1xuICAgICAgaWYgKCFzdHlsZXMuaGFzT3duUHJvcGVydHkoZWxlbWVudCkpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIHZhciBkb20gPSBnZXRFbGVtZW50KGVsZW1lbnQpO1xuXG4gICAgICBpZiAoZG9tID09PSBudWxsKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBUaGUgRE9NIExldmVsIDIgQ1NTIHdheVxuICAgICAgLyoganNoaW50IG1heGRlcHRoOiBmYWxzZSAqL1xuICAgICAgaWYgKCdnZXRDb21wdXRlZFN0eWxlJyBpbiB3aW5kb3cpIHtcbiAgICAgICAgdmFyIGNzID0gZ2V0Q29tcHV0ZWRTdHlsZShkb20sIG51bGwpO1xuICAgICAgICBpZiAoY3MubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgZmlsdGVyU3R5bGVzKGVsZW1lbnQsIGNzLml0ZW0oaSksIGNzLmdldFByb3BlcnR5VmFsdWUoY3MuaXRlbShpKSkpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIE9wZXJhIHdvcmthcm91bmQuIE9wZXJhIGRvZXNuXCJ0IHN1cHBvcnQgYGl0ZW1gL2BsZW5ndGhgXG4gICAgICAgICAgLy8gb24gQ1NTU3R5bGVEZWNsYXJhdGlvbi5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmb3IgKHZhciBrIGluIGNzKSB7XG4gICAgICAgICAgICBpZiAoY3MuaGFzT3duUHJvcGVydHkoaykpIHtcbiAgICAgICAgICAgICAgZmlsdGVyU3R5bGVzKGVsZW1lbnQsIGssIGNzW2tdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUaGUgSUUgd2F5XG4gICAgICB9IGVsc2UgaWYgKCdjdXJyZW50U3R5bGUnIGluIGRvbSkge1xuICAgICAgICB2YXIgY3NzID0gZG9tLmN1cnJlbnRTdHlsZTtcbiAgICAgICAgZm9yICh2YXIgcCBpbiBjc3MpIHtcbiAgICAgICAgICBmaWx0ZXJTdHlsZXMoZWxlbWVudCwgcCwgY3NzW3BdKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBzdHJpbmcgPVxuICAgICAgJzxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiICcgK1xuICAgICAgJ3htbG5zOnhsaW5rPVwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGlua1wiPjxzdHlsZSB0eXBlPVwidGV4dC9jc3NcIj48IVtDREFUQVsgJztcblxuICAgIGZvciAodmFyIHN0eWxlIGluIHN0eWxlcykge1xuICAgICAgc3RyaW5nICs9IHN0eWxlICsgJyB7XFxuJztcbiAgICAgIGZvciAodmFyIGwgaW4gc3R5bGVzW3N0eWxlXSkge1xuICAgICAgICBzdHJpbmcgKz0gJ1xcdCcgKyBsICsgJzonICsgc3R5bGVzW3N0eWxlXVtsXSArICc7XFxuJztcbiAgICAgIH1cbiAgICAgIHN0cmluZyArPSAnfVxcbic7XG4gICAgfVxuXG4gICAgc3RyaW5nICs9ICddXT48L3N0eWxlPic7XG4gICAgc3RyaW5nICs9IG5ldyBYTUxTZXJpYWxpemVyKCkuc2VyaWFsaXplVG9TdHJpbmcodGhpcy5yb290WzBdWzBdKTtcbiAgICBzdHJpbmcgKz0gJzwvc3ZnPic7XG5cbiAgICByZXR1cm4gc3RyaW5nO1xuICB9LFxufTtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4vLyBET01BSU4gUE9TSVRJT04gQ09NUFVUQVRJT04gICAgICAgICAgICAgICAgICAgICAgICAvL1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG5cbi8qKlxuICogQ29tcHV0ZSB0aGUgcG9zaXRpb24gb2YgYSBkb21haW4sIHJlbGF0aXZlIHRvIHRoZSBjYWxlbmRhclxuICovXG52YXIgRG9tYWluUG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB0aGlzLnBvc2l0aW9ucyA9IGQzLm1hcCgpO1xufTtcblxuRG9tYWluUG9zaXRpb24ucHJvdG90eXBlLmdldFBvc2l0aW9uID0gZnVuY3Rpb24gKGQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHJldHVybiB0aGlzLnBvc2l0aW9ucy5nZXQoZCk7XG59O1xuXG5Eb21haW5Qb3NpdGlvbi5wcm90b3R5cGUuZ2V0UG9zaXRpb25Gcm9tSW5kZXggPSBmdW5jdGlvbiAoaSkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdmFyIGRvbWFpbnMgPSB0aGlzLmdldEtleXMoKTtcbiAgcmV0dXJuIHRoaXMucG9zaXRpb25zLmdldChkb21haW5zW2ldKTtcbn07XG5cbkRvbWFpblBvc2l0aW9uLnByb3RvdHlwZS5nZXRMYXN0ID0gZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdmFyIGRvbWFpbnMgPSB0aGlzLmdldEtleXMoKTtcbiAgcmV0dXJuIHRoaXMucG9zaXRpb25zLmdldChkb21haW5zW2RvbWFpbnMubGVuZ3RoIC0gMV0pO1xufTtcblxuRG9tYWluUG9zaXRpb24ucHJvdG90eXBlLnNldFBvc2l0aW9uID0gZnVuY3Rpb24gKGQsIGRpbSkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdGhpcy5wb3NpdGlvbnMuc2V0KGQsIGRpbSk7XG59O1xuXG5Eb21haW5Qb3NpdGlvbi5wcm90b3R5cGUuc2hpZnRSaWdodEJ5ID0gZnVuY3Rpb24gKGV4aXRpbmdEb21haW5EaW0pIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHRoaXMucG9zaXRpb25zLmZvckVhY2goZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICB0aGlzLnNldChrZXksIHZhbHVlIC0gZXhpdGluZ0RvbWFpbkRpbSk7XG4gIH0pO1xuXG4gIHZhciBkb21haW5zID0gdGhpcy5nZXRLZXlzKCk7XG4gIHRoaXMucG9zaXRpb25zLnJlbW92ZShkb21haW5zWzBdKTtcbn07XG5cbkRvbWFpblBvc2l0aW9uLnByb3RvdHlwZS5zaGlmdExlZnRCeSA9IGZ1bmN0aW9uIChlbnRlcmluZ0RvbWFpbkRpbSkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdGhpcy5wb3NpdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgIHRoaXMuc2V0KGtleSwgdmFsdWUgKyBlbnRlcmluZ0RvbWFpbkRpbSk7XG4gIH0pO1xuXG4gIHZhciBkb21haW5zID0gdGhpcy5nZXRLZXlzKCk7XG4gIHRoaXMucG9zaXRpb25zLnJlbW92ZShkb21haW5zW2RvbWFpbnMubGVuZ3RoIC0gMV0pO1xufTtcblxuRG9tYWluUG9zaXRpb24ucHJvdG90eXBlLmdldEtleXMgPSBmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICByZXR1cm4gdGhpcy5wb3NpdGlvbnMua2V5cygpLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICByZXR1cm4gcGFyc2VJbnQoYSwgMTApIC0gcGFyc2VJbnQoYiwgMTApO1xuICB9KTtcbn07XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuLy8gTEVHRU5EICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cblxudmFyIExlZ2VuZCA9IGZ1bmN0aW9uIChjYWxlbmRhcikge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdGhpcy5jYWxlbmRhciA9IGNhbGVuZGFyO1xuICB0aGlzLmNvbXB1dGVEaW0oKTtcblxuICBpZiAoY2FsZW5kYXIub3B0aW9ucy5sZWdlbmRDb2xvcnMgIT09IG51bGwpIHtcbiAgICB0aGlzLmJ1aWxkQ29sb3JzKCk7XG4gIH1cbn07XG5cbkxlZ2VuZC5wcm90b3R5cGUuY29tcHV0ZURpbSA9IGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHZhciBvcHRpb25zID0gdGhpcy5jYWxlbmRhci5vcHRpb25zOyAvLyBTaG9ydGVyIGFjY2Vzc29yIGZvciB2YXJpYWJsZSBuYW1lIG1hbmdsaW5nIHdoZW4gbWluaWZ5aW5nXG4gIHRoaXMuZGltID0ge1xuICAgIHdpZHRoOlxuICAgICAgb3B0aW9ucy5sZWdlbmRDZWxsU2l6ZSAqIChvcHRpb25zLmxlZ2VuZC5sZW5ndGggKyAxKSArXG4gICAgICBvcHRpb25zLmxlZ2VuZENlbGxQYWRkaW5nICogb3B0aW9ucy5sZWdlbmQubGVuZ3RoLFxuICAgIGhlaWdodDogb3B0aW9ucy5sZWdlbmRDZWxsU2l6ZSxcbiAgfTtcbn07XG5cbkxlZ2VuZC5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdGhpcy5jYWxlbmRhci5yb290LnNlbGVjdCgnLmdyYXBoLWxlZ2VuZCcpLnJlbW92ZSgpO1xuICB0aGlzLmNhbGVuZGFyLnJlc2l6ZSgpO1xufTtcblxuTGVnZW5kLnByb3RvdHlwZS5yZWRyYXcgPSBmdW5jdGlvbiAod2lkdGgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGlmICghdGhpcy5jYWxlbmRhci5vcHRpb25zLmRpc3BsYXlMZWdlbmQpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICB2YXIgcGFyZW50ID0gdGhpcztcbiAgdmFyIGNhbGVuZGFyID0gdGhpcy5jYWxlbmRhcjtcbiAgdmFyIGxlZ2VuZCA9IGNhbGVuZGFyLnJvb3Q7XG4gIHZhciBsZWdlbmRJdGVtO1xuICB2YXIgb3B0aW9ucyA9IGNhbGVuZGFyLm9wdGlvbnM7IC8vIFNob3J0ZXIgYWNjZXNzb3IgZm9yIHZhcmlhYmxlIG5hbWUgbWFuZ2xpbmcgd2hlbiBtaW5pZnlpbmdcblxuICB0aGlzLmNvbXB1dGVEaW0oKTtcblxuICB2YXIgX2xlZ2VuZCA9IG9wdGlvbnMubGVnZW5kLnNsaWNlKDApO1xuICBfbGVnZW5kLnB1c2goX2xlZ2VuZFtfbGVnZW5kLmxlbmd0aCAtIDFdICsgMSk7XG5cbiAgdmFyIGxlZ2VuZEVsZW1lbnQgPSBjYWxlbmRhci5yb290LnNlbGVjdCgnLmdyYXBoLWxlZ2VuZCcpO1xuICBpZiAobGVnZW5kRWxlbWVudFswXVswXSAhPT0gbnVsbCkge1xuICAgIGxlZ2VuZCA9IGxlZ2VuZEVsZW1lbnQ7XG4gICAgbGVnZW5kSXRlbSA9IGxlZ2VuZC5zZWxlY3QoJ2cnKS5zZWxlY3RBbGwoJ3JlY3QnKS5kYXRhKF9sZWdlbmQpO1xuICB9IGVsc2Uge1xuICAgIC8vIENyZWF0aW5nIHRoZSBuZXcgbGVnZW5kIERPTSBpZiBpdCBkb2Vzbid0IGFscmVhZHkgZXhpc3RcbiAgICBsZWdlbmQgPVxuICAgICAgb3B0aW9ucy5sZWdlbmRWZXJ0aWNhbFBvc2l0aW9uID09PSAndG9wJ1xuICAgICAgICA/IGxlZ2VuZC5pbnNlcnQoJ3N2ZycsICcuZ3JhcGgnKVxuICAgICAgICA6IGxlZ2VuZC5hcHBlbmQoJ3N2ZycpO1xuXG4gICAgbGVnZW5kLmF0dHIoJ3gnLCBnZXRMZWdlbmRYUG9zaXRpb24oKSkuYXR0cigneScsIGdldExlZ2VuZFlQb3NpdGlvbigpKTtcblxuICAgIGxlZ2VuZEl0ZW0gPSBsZWdlbmRcbiAgICAgIC5hdHRyKCdjbGFzcycsICdncmFwaC1sZWdlbmQnKVxuICAgICAgLmF0dHIoJ2hlaWdodCcsIHBhcmVudC5nZXREaW0oJ2hlaWdodCcpKVxuICAgICAgLmF0dHIoJ3dpZHRoJywgcGFyZW50LmdldERpbSgnd2lkdGgnKSlcbiAgICAgIC5hcHBlbmQoJ2cnKVxuICAgICAgLnNlbGVjdEFsbCgpXG4gICAgICAuZGF0YShfbGVnZW5kKTtcbiAgfVxuXG4gIGxlZ2VuZEl0ZW1cbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5jYWxsKGxlZ2VuZENlbGxMYXlvdXQpXG4gICAgLmF0dHIoJ2NsYXNzJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgIHJldHVybiBjYWxlbmRhci5MZWdlbmQuZ2V0Q2xhc3MoZCwgY2FsZW5kYXIubGVnZW5kU2NhbGUgPT09IG51bGwpO1xuICAgIH0pXG4gICAgLmF0dHIoJ2ZpbGwtb3BhY2l0eScsIDApXG4gICAgLmNhbGwoZnVuY3Rpb24gKHNlbGVjdGlvbikge1xuICAgICAgaWYgKFxuICAgICAgICBjYWxlbmRhci5sZWdlbmRTY2FsZSAhPT0gbnVsbCAmJlxuICAgICAgICBvcHRpb25zLmxlZ2VuZENvbG9ycyAhPT0gbnVsbCAmJlxuICAgICAgICBvcHRpb25zLmxlZ2VuZENvbG9ycy5oYXNPd25Qcm9wZXJ0eSgnYmFzZScpXG4gICAgICApIHtcbiAgICAgICAgc2VsZWN0aW9uLmF0dHIoJ2ZpbGwnLCBvcHRpb25zLmxlZ2VuZENvbG9ycy5iYXNlKTtcbiAgICAgIH1cbiAgICB9KVxuICAgIC5hcHBlbmQoJ3RpdGxlJyk7XG5cbiAgbGVnZW5kSXRlbVxuICAgIC5leGl0KClcbiAgICAudHJhbnNpdGlvbigpXG4gICAgLmR1cmF0aW9uKG9wdGlvbnMuYW5pbWF0aW9uRHVyYXRpb24pXG4gICAgLmF0dHIoJ2ZpbGwtb3BhY2l0eScsIDApXG4gICAgLnJlbW92ZSgpO1xuXG4gIGxlZ2VuZEl0ZW1cbiAgICAudHJhbnNpdGlvbigpXG4gICAgLmRlbGF5KGZ1bmN0aW9uIChkLCBpKSB7XG4gICAgICByZXR1cm4gKG9wdGlvbnMuYW5pbWF0aW9uRHVyYXRpb24gKiBpKSAvIDEwO1xuICAgIH0pXG4gICAgLmNhbGwobGVnZW5kQ2VsbExheW91dClcbiAgICAuYXR0cignZmlsbC1vcGFjaXR5JywgMSlcbiAgICAuY2FsbChmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgZWxlbWVudC5hdHRyKCdmaWxsJywgZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgaWYgKGNhbGVuZGFyLmxlZ2VuZFNjYWxlID09PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGkgPT09IDApIHtcbiAgICAgICAgICByZXR1cm4gY2FsZW5kYXIubGVnZW5kU2NhbGUoZCAtIDEpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjYWxlbmRhci5sZWdlbmRTY2FsZShvcHRpb25zLmxlZ2VuZFtpIC0gMV0pO1xuICAgICAgfSk7XG5cbiAgICAgIGVsZW1lbnQuYXR0cignY2xhc3MnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gY2FsZW5kYXIuTGVnZW5kLmdldENsYXNzKGQsIGNhbGVuZGFyLmxlZ2VuZFNjYWxlID09PSBudWxsKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gIGZ1bmN0aW9uIGxlZ2VuZENlbGxMYXlvdXQoc2VsZWN0aW9uKSB7XG4gICAgc2VsZWN0aW9uXG4gICAgICAuYXR0cignd2lkdGgnLCBvcHRpb25zLmxlZ2VuZENlbGxTaXplKVxuICAgICAgLmF0dHIoJ2hlaWdodCcsIG9wdGlvbnMubGVnZW5kQ2VsbFNpemUpXG4gICAgICAuYXR0cigncngnLCBvcHRpb25zLmxlZ2VuZENlbGxSYWRpdXMpXG4gICAgICAuYXR0cigncnknLCBvcHRpb25zLmxlZ2VuZENlbGxSYWRpdXMpXG4gICAgICAuYXR0cigneCcsIGZ1bmN0aW9uIChkLCBpKSB7XG4gICAgICAgIHJldHVybiBpICogKG9wdGlvbnMubGVnZW5kQ2VsbFNpemUgKyBvcHRpb25zLmxlZ2VuZENlbGxQYWRkaW5nKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgbGVnZW5kSXRlbS5zZWxlY3QoJ3RpdGxlJykudGV4dChmdW5jdGlvbiAoZCwgaSkge1xuICAgIGlmIChpID09PSAwKSB7XG4gICAgICByZXR1cm4gY2FsZW5kYXIuZm9ybWF0U3RyaW5nV2l0aE9iamVjdChvcHRpb25zLmxlZ2VuZFRpdGxlRm9ybWF0Lmxvd2VyLCB7XG4gICAgICAgIG1pbjogb3B0aW9ucy5sZWdlbmRbaV0sXG4gICAgICAgIG5hbWU6IG9wdGlvbnMuaXRlbU5hbWVbMV0sXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGkgPT09IF9sZWdlbmQubGVuZ3RoIC0gMSkge1xuICAgICAgcmV0dXJuIGNhbGVuZGFyLmZvcm1hdFN0cmluZ1dpdGhPYmplY3Qob3B0aW9ucy5sZWdlbmRUaXRsZUZvcm1hdC51cHBlciwge1xuICAgICAgICBtYXg6IG9wdGlvbnMubGVnZW5kW2kgLSAxXSxcbiAgICAgICAgbmFtZTogb3B0aW9ucy5pdGVtTmFtZVsxXSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gY2FsZW5kYXIuZm9ybWF0U3RyaW5nV2l0aE9iamVjdChvcHRpb25zLmxlZ2VuZFRpdGxlRm9ybWF0LmlubmVyLCB7XG4gICAgICAgIGRvd246IG9wdGlvbnMubGVnZW5kW2kgLSAxXSxcbiAgICAgICAgdXA6IG9wdGlvbnMubGVnZW5kW2ldLFxuICAgICAgICBuYW1lOiBvcHRpb25zLml0ZW1OYW1lWzFdLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbiAgbGVnZW5kSXRlbVxuICAgIC5vbignbW91c2VvdmVyJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgIGNhbGVuZGFyLmxlZ2VuZFRpcC5zaG93KGQsIHRoaXMpO1xuICAgIH0pXG4gICAgLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNhbGVuZGFyLmxlZ2VuZFRpcC5oaWRlKCk7XG4gICAgfSk7XG5cbiAgbGVnZW5kXG4gICAgLnRyYW5zaXRpb24oKVxuICAgIC5kdXJhdGlvbihvcHRpb25zLmFuaW1hdGlvbkR1cmF0aW9uKVxuICAgIC5hdHRyKCd4JywgZ2V0TGVnZW5kWFBvc2l0aW9uKCkpXG4gICAgLmF0dHIoJ3knLCBnZXRMZWdlbmRZUG9zaXRpb24oKSlcbiAgICAuYXR0cignd2lkdGgnLCBwYXJlbnQuZ2V0RGltKCd3aWR0aCcpKVxuICAgIC5hdHRyKCdoZWlnaHQnLCBwYXJlbnQuZ2V0RGltKCdoZWlnaHQnKSk7XG5cbiAgbGVnZW5kXG4gICAgLnNlbGVjdCgnZycpXG4gICAgLnRyYW5zaXRpb24oKVxuICAgIC5kdXJhdGlvbihvcHRpb25zLmFuaW1hdGlvbkR1cmF0aW9uKVxuICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAob3B0aW9ucy5sZWdlbmRPcmllbnRhdGlvbiA9PT0gJ3ZlcnRpY2FsJykge1xuICAgICAgICByZXR1cm4gJ3JvdGF0ZSg5MCAnICsgb3B0aW9ucy5sZWdlbmRDZWxsU2l6ZSAvIDIgKyAnICcgKyBvcHRpb25zLmxlZ2VuZENlbGxTaXplIC8gMiArICcpJztcbiAgICAgIH1cbiAgICAgIHJldHVybiAnJztcbiAgICB9KTtcblxuICBmdW5jdGlvbiBnZXRMZWdlbmRYUG9zaXRpb24oKSB7XG4gICAgc3dpdGNoIChvcHRpb25zLmxlZ2VuZEhvcml6b250YWxQb3NpdGlvbikge1xuICAgICAgY2FzZSAncmlnaHQnOlxuICAgICAgICBpZiAoXG4gICAgICAgICAgb3B0aW9ucy5sZWdlbmRWZXJ0aWNhbFBvc2l0aW9uID09PSAnY2VudGVyJyB8fFxuICAgICAgICAgIG9wdGlvbnMubGVnZW5kVmVydGljYWxQb3NpdGlvbiA9PT0gJ21pZGRsZSdcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuIHdpZHRoICsgb3B0aW9ucy5sZWdlbmRNYXJnaW5bM107XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHdpZHRoIC0gcGFyZW50LmdldERpbSgnd2lkdGgnKSAtIG9wdGlvbnMubGVnZW5kTWFyZ2luWzFdO1xuICAgICAgY2FzZSAnbWlkZGxlJzpcbiAgICAgIGNhc2UgJ2NlbnRlcic6XG4gICAgICAgIHJldHVybiBNYXRoLnJvdW5kKHdpZHRoIC8gMiAtIHBhcmVudC5nZXREaW0oJ3dpZHRoJykgLyAyKTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBvcHRpb25zLmxlZ2VuZE1hcmdpblszXTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBnZXRMZWdlbmRZUG9zaXRpb24oKSB7XG4gICAgaWYgKG9wdGlvbnMubGVnZW5kVmVydGljYWxQb3NpdGlvbiA9PT0gJ2JvdHRvbScpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIGNhbGVuZGFyLmdyYXBoRGltLmhlaWdodCArXG4gICAgICAgIG9wdGlvbnMubGVnZW5kTWFyZ2luWzBdIC1cbiAgICAgICAgb3B0aW9ucy5kb21haW5HdXR0ZXIgLVxuICAgICAgICBvcHRpb25zLmNlbGxQYWRkaW5nXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gb3B0aW9ucy5sZWdlbmRNYXJnaW5bMF07XG4gIH1cblxuICBjYWxlbmRhci5yZXNpemUoKTtcbn07XG5cbi8qKlxuICogUmV0dXJuIHRoZSBkaW1lbnNpb24gb2YgdGhlIGxlZ2VuZFxuICpcbiAqIFRha2VzIGludG8gYWNjb3VudCByb3RhdGlvblxuICpcbiAqIEBwYXJhbSAgc3RyaW5nIGF4aXMgV2lkdGggb3IgaGVpZ2h0XG4gKiBAcmV0dXJuIGludCBoZWlnaHQgb3Igd2lkdGggaW4gcGl4ZWxzXG4gKi9cbkxlZ2VuZC5wcm90b3R5cGUuZ2V0RGltID0gZnVuY3Rpb24gKGF4aXMpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHZhciBpc0hvcml6b250YWwgPSB0aGlzLmNhbGVuZGFyLm9wdGlvbnMubGVnZW5kT3JpZW50YXRpb24gPT09ICdob3Jpem9udGFsJztcblxuICBzd2l0Y2ggKGF4aXMpIHtcbiAgICBjYXNlICd3aWR0aCc6XG4gICAgICByZXR1cm4gdGhpcy5kaW1baXNIb3Jpem9udGFsID8gJ3dpZHRoJyA6ICdoZWlnaHQnXTtcbiAgICBjYXNlICdoZWlnaHQnOlxuICAgICAgcmV0dXJuIHRoaXMuZGltW2lzSG9yaXpvbnRhbCA/ICdoZWlnaHQnIDogJ3dpZHRoJ107XG4gIH1cbn07XG5cbkxlZ2VuZC5wcm90b3R5cGUuYnVpbGRDb2xvcnMgPSBmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB2YXIgb3B0aW9ucyA9IHRoaXMuY2FsZW5kYXIub3B0aW9uczsgLy8gU2hvcnRlciBhY2Nlc3NvciBmb3IgdmFyaWFibGUgbmFtZSBtYW5nbGluZyB3aGVuIG1pbmlmeWluZ1xuXG4gIGlmIChvcHRpb25zLmxlZ2VuZENvbG9ycyA9PT0gbnVsbCkge1xuICAgIHRoaXMuY2FsZW5kYXIubGVnZW5kU2NhbGUgPSBudWxsO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHZhciBfY29sb3JSYW5nZSA9IFtdO1xuXG4gIGlmIChBcnJheS5pc0FycmF5KG9wdGlvbnMubGVnZW5kQ29sb3JzKSkge1xuICAgIF9jb2xvclJhbmdlID0gb3B0aW9ucy5sZWdlbmRDb2xvcnM7XG4gIH0gZWxzZSBpZiAoXG4gICAgb3B0aW9ucy5sZWdlbmRDb2xvcnMuaGFzT3duUHJvcGVydHkoJ21pbicpICYmXG4gICAgb3B0aW9ucy5sZWdlbmRDb2xvcnMuaGFzT3duUHJvcGVydHkoJ21heCcpXG4gICkge1xuICAgIF9jb2xvclJhbmdlID0gW29wdGlvbnMubGVnZW5kQ29sb3JzLm1pbiwgb3B0aW9ucy5sZWdlbmRDb2xvcnMubWF4XTtcbiAgfSBlbHNlIHtcbiAgICBvcHRpb25zLmxlZ2VuZENvbG9ycyA9IG51bGw7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgdmFyIF9sZWdlbmQgPSBvcHRpb25zLmxlZ2VuZC5zbGljZSgwKTtcblxuICBpZiAoX2xlZ2VuZFswXSA+IDApIHtcbiAgICBfbGVnZW5kLnVuc2hpZnQoMCk7XG4gIH0gZWxzZSBpZiAoX2xlZ2VuZFswXSA8PSAwKSB7XG4gICAgLy8gTGV0J3MgZ3Vlc3MgdGhlIGxlZnRtb3N0IHZhbHVlLCBpdCB3ZSBoYXZlIHRvIGFkZCBvbmVcbiAgICBfbGVnZW5kLnVuc2hpZnQoX2xlZ2VuZFswXSAtIChfbGVnZW5kW19sZWdlbmQubGVuZ3RoIC0gMV0gLSBfbGVnZW5kWzBdKSAvIF9sZWdlbmQubGVuZ3RoKTtcbiAgfVxuICB2YXIgY29sb3JTY2FsZTtcbiAgaWYgKG9wdGlvbnMubGVnZW5kQ29sb3JzLmhhc093blByb3BlcnR5KCdjb2xvclNjYWxlJykpIHtcbiAgICBjb2xvclNjYWxlID0gb3B0aW9ucy5sZWdlbmRDb2xvcnMuY29sb3JTY2FsZTtcbiAgfSBlbHNlIHtcbiAgICBjb2xvclNjYWxlID0gZDMuc2NhbGVcbiAgICAgIC5saW5lYXIoKVxuICAgICAgLnJhbmdlKF9jb2xvclJhbmdlKVxuICAgICAgLmludGVycG9sYXRlKGQzLmludGVycG9sYXRlSGNsKVxuICAgICAgLmRvbWFpbihbZDMubWluKF9sZWdlbmQpLCBkMy5tYXgoX2xlZ2VuZCldKTtcbiAgfVxuXG4gIHZhciBsZWdlbmRDb2xvcnMgPSBfbGVnZW5kLm1hcChmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgIHJldHVybiBjb2xvclNjYWxlKGVsZW1lbnQpO1xuICB9KTtcbiAgdGhpcy5jYWxlbmRhci5sZWdlbmRTY2FsZSA9IGQzLnNjYWxlLnRocmVzaG9sZCgpLmRvbWFpbihvcHRpb25zLmxlZ2VuZCkucmFuZ2UobGVnZW5kQ29sb3JzKTtcblxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbi8qKlxuICogUmV0dXJuIHRoZSBjbGFzc25hbWUgb24gdGhlIGxlZ2VuZCBmb3IgdGhlIHNwZWNpZmllZCB2YWx1ZVxuICpcbiAqIEBwYXJhbSBpbnRlZ2VyIG4gVmFsdWUgYXNzb2NpYXRlZCB0byBhIGRhdGVcbiAqIEBwYXJhbSBib29sIHdpdGhDc3NDbGFzcyBXaGV0aGVyIHRvIGRpc3BsYXkgdGhlIGNzcyBjbGFzcyB1c2VkIHRvIHN0eWxlIHRoZSBjZWxsLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgIERpc2FibGluZyB3aWxsIGFsbG93IHN0eWxpbmcgZGlyZWN0bHkgdmlhIGh0bWwgZmlsbCBhdHRyaWJ1dGVcbiAqXG4gKiBAcmV0dXJuIHN0cmluZyBDbGFzc25hbWUgYWNjb3JkaW5nIHRvIHRoZSBsZWdlbmRcbiAqL1xuTGVnZW5kLnByb3RvdHlwZS5nZXRDbGFzcyA9IGZ1bmN0aW9uIChuLCB3aXRoQ3NzQ2xhc3MpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGlmIChuID09PSBudWxsIHx8IGlzTmFOKG4pKSB7XG4gICAgcmV0dXJuICcnO1xuICB9XG5cbiAgdmFyIGluZGV4ID0gW3RoaXMuY2FsZW5kYXIub3B0aW9ucy5sZWdlbmQubGVuZ3RoICsgMV07XG5cbiAgZm9yICh2YXIgaSA9IDAsIHRvdGFsID0gdGhpcy5jYWxlbmRhci5vcHRpb25zLmxlZ2VuZC5sZW5ndGggLSAxOyBpIDw9IHRvdGFsOyBpICs9IDEpIHtcbiAgICBpZiAodGhpcy5jYWxlbmRhci5vcHRpb25zLmxlZ2VuZFswXSA+IDAgJiYgbiA8IDApIHtcbiAgICAgIGluZGV4ID0gWycxJywgJ2knXTtcbiAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIGlmIChuIDw9IHRoaXMuY2FsZW5kYXIub3B0aW9ucy5sZWdlbmRbaV0pIHtcbiAgICAgIGluZGV4ID0gW2kgKyAxXTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIGlmIChuID09PSAwKSB7XG4gICAgaW5kZXgucHVzaCgwKTtcbiAgfVxuXG4gIGluZGV4LnVuc2hpZnQoJycpO1xuICByZXR1cm4gKGluZGV4LmpvaW4oJyByJykgKyAod2l0aENzc0NsYXNzID8gaW5kZXguam9pbignIHEnKSA6ICcnKSkudHJpbSgpO1xufTtcblxuLyoqXG4gKiAjc291cmNlIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzM4MzI0NS84MDU2NDlcbiAqL1xuZnVuY3Rpb24gbWVyZ2VSZWN1cnNpdmUob2JqMSwgb2JqMikge1xuICAndXNlIHN0cmljdCc7XG5cbiAgLypqc2hpbnQgZm9yaW46ZmFsc2UgKi9cbiAgZm9yICh2YXIgcCBpbiBvYmoyKSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFByb3BlcnR5IGluIGRlc3RpbmF0aW9uIG9iamVjdCBzZXQ7IHVwZGF0ZSBpdHMgdmFsdWUuXG4gICAgICBpZiAob2JqMltwXS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7XG4gICAgICAgIG9iajFbcF0gPSBtZXJnZVJlY3Vyc2l2ZShvYmoxW3BdLCBvYmoyW3BdKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9iajFbcF0gPSBvYmoyW3BdO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8vIFByb3BlcnR5IGluIGRlc3RpbmF0aW9uIG9iamVjdCBub3Qgc2V0OyBjcmVhdGUgaXQgYW5kIHNldCBpdHMgdmFsdWUuXG4gICAgICBvYmoxW3BdID0gb2JqMltwXTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gb2JqMTtcbn1cblxuLyoqXG4gKiBDaGVjayBpZiAyIGFycmF5cyBhcmUgZXF1YWxzXG4gKlxuICogQGxpbmsgaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMTQ4NTM5NzQvODA1NjQ5XG4gKiBAcGFyYW0gIGFycmF5IGFycmF5IHRoZSBhcnJheSB0byBjb21wYXJlIHRvXG4gKiBAcmV0dXJuIGJvb2wgdHJ1ZSBvZiB0aGUgMiBhcnJheXMgYXJlIGVxdWFsc1xuICovXG5mdW5jdGlvbiBhcnJheUVxdWFscyhhcnJheUEsIGFycmF5Qikge1xuICAndXNlIHN0cmljdCc7XG5cbiAgLy8gaWYgdGhlIG90aGVyIGFycmF5IGlzIGEgZmFsc3kgdmFsdWUsIHJldHVyblxuICBpZiAoIWFycmF5QiB8fCAhYXJyYXlBKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLy8gY29tcGFyZSBsZW5ndGhzIC0gY2FuIHNhdmUgYSBsb3Qgb2YgdGltZVxuICBpZiAoYXJyYXlBLmxlbmd0aCAhPT0gYXJyYXlCLmxlbmd0aCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXlBLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgLy8gQ2hlY2sgaWYgd2UgaGF2ZSBuZXN0ZWQgYXJyYXlzXG4gICAgaWYgKGFycmF5QVtpXSBpbnN0YW5jZW9mIEFycmF5ICYmIGFycmF5QltpXSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAvLyByZWN1cnNlIGludG8gdGhlIG5lc3RlZCBhcnJheXNcbiAgICAgIGlmICghYXJyYXlFcXVhbHMoYXJyYXlBW2ldLCBhcnJheUJbaV0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGFycmF5QVtpXSAhPT0gYXJyYXlCW2ldKSB7XG4gICAgICAvLyBXYXJuaW5nIC0gdHdvIGRpZmZlcmVudCBvYmplY3QgaW5zdGFuY2VzIHdpbGwgbmV2ZXIgYmUgZXF1YWw6IHt4OjIwfSAhPSB7eDoyMH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59XG5cbmV4cG9ydCBkZWZhdWx0IENhbEhlYXRNYXA7XG4iLCIvKipcbiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuICogZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbiAqIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbiAqIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4gKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbiAqIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IHsgZXh0ZW50IGFzIGQzRXh0ZW50LCByYW5nZSBhcyBkM1JhbmdlIH0gZnJvbSAnZDMtYXJyYXknO1xuaW1wb3J0IHsgc2VsZWN0IGFzIGQzU2VsZWN0IH0gZnJvbSAnZDMtc2VsZWN0aW9uJztcbmltcG9ydCB7XG4gIGdldE51bWJlckZvcm1hdHRlcixcbiAgZ2V0VGltZUZvcm1hdHRlcixcbiAgZ2V0U2VxdWVudGlhbFNjaGVtZVJlZ2lzdHJ5LFxufSBmcm9tICdAc3VwZXJzZXQtdWkvY29yZSc7XG5pbXBvcnQgQ2FsSGVhdE1hcCBmcm9tICcuL3ZlbmRvci9jYWwtaGVhdG1hcCc7XG5pbXBvcnQgJy4vdmVuZG9yL2NhbC1oZWF0bWFwLmNzcyc7XG5cbmZ1bmN0aW9uIGNvbnZlcnRVVEMoZHR0bSkge1xuICByZXR1cm4gbmV3IERhdGUoXG4gICAgZHR0bS5nZXRVVENGdWxsWWVhcigpLFxuICAgIGR0dG0uZ2V0VVRDTW9udGgoKSxcbiAgICBkdHRtLmdldFVUQ0RhdGUoKSxcbiAgICBkdHRtLmdldFVUQ0hvdXJzKCksXG4gICAgZHR0bS5nZXRVVENNaW51dGVzKCksXG4gICAgZHR0bS5nZXRVVENTZWNvbmRzKCksXG4gICk7XG59XG5cbmNvbnN0IGNvbnZlcnRVVENUUyA9IHV0cyA9PiBjb252ZXJ0VVRDKG5ldyBEYXRlKHV0cykpLmdldFRpbWUoKTtcblxuY29uc3QgcHJvcFR5cGVzID0ge1xuICBkYXRhOiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgIC8vIE9iamVjdCBoYXNoZWQgYnkgbWV0cmljIG5hbWUsXG4gICAgLy8gdGhlbiBoYXNoZWQgYnkgdGltZXN0YW1wIChpbiBzZWNvbmRzLCBub3QgbWlsbGlzZWNvbmRzKSBhcyBmbG9hdFxuICAgIC8vIHRoZSBpbm5lcm1vc3QgdmFsdWUgaXMgY291bnRcbiAgICAvLyBlLmcuIHsgY291bnRfZGlzdGluY3Rfc29tZXRoaW5nOiB7IDE1MzUwMzQyMzYuMDogMyB9IH1cbiAgICBkYXRhOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIGRvbWFpbjogUHJvcFR5cGVzLnN0cmluZyxcbiAgICByYW5nZTogUHJvcFR5cGVzLm51bWJlcixcbiAgICAvLyB0aW1lc3RhbXAgaW4gbWlsbGlzZWNvbmRzXG4gICAgc3RhcnQ6IFByb3BUeXBlcy5udW1iZXIsXG4gICAgc3ViZG9tYWluOiBQcm9wVHlwZXMuc3RyaW5nLFxuICB9KSxcbiAgaGVpZ2h0OiBQcm9wVHlwZXMubnVtYmVyLFxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3Qvc29ydC1wcm9wLXR5cGVzXG4gIGNlbGxQYWRkaW5nOiBQcm9wVHlwZXMubnVtYmVyLFxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3Qvc29ydC1wcm9wLXR5cGVzXG4gIGNlbGxSYWRpdXM6IFByb3BUeXBlcy5udW1iZXIsXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9zb3J0LXByb3AtdHlwZXNcbiAgY2VsbFNpemU6IFByb3BUeXBlcy5udW1iZXIsXG4gIGxpbmVhckNvbG9yU2NoZW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBzaG93TGVnZW5kOiBQcm9wVHlwZXMuYm9vbCxcbiAgc2hvd01ldHJpY05hbWU6IFByb3BUeXBlcy5ib29sLFxuICBzaG93VmFsdWVzOiBQcm9wVHlwZXMuYm9vbCxcbiAgc3RlcHM6IFByb3BUeXBlcy5udW1iZXIsXG4gIHRpbWVGb3JtYXQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gIHZhbHVlRm9ybWF0OiBQcm9wVHlwZXMuc3RyaW5nLFxuICB2ZXJib3NlTWFwOiBQcm9wVHlwZXMub2JqZWN0LFxufTtcblxuZnVuY3Rpb24gQ2FsZW5kYXIoZWxlbWVudCwgcHJvcHMpIHtcbiAgY29uc3Qge1xuICAgIGRhdGEsXG4gICAgaGVpZ2h0LFxuICAgIGNlbGxQYWRkaW5nID0gMyxcbiAgICBjZWxsUmFkaXVzID0gMCxcbiAgICBjZWxsU2l6ZSA9IDEwLFxuICAgIGRvbWFpbkdyYW51bGFyaXR5LFxuICAgIGxpbmVhckNvbG9yU2NoZW1lLFxuICAgIHNob3dMZWdlbmQsXG4gICAgc2hvd01ldHJpY05hbWUsXG4gICAgc2hvd1ZhbHVlcyxcbiAgICBzdGVwcyxcbiAgICBzdWJkb21haW5HcmFudWxhcml0eSxcbiAgICB0aW1lRm9ybWF0LFxuICAgIHZhbHVlRm9ybWF0LFxuICAgIHZlcmJvc2VNYXAsXG4gIH0gPSBwcm9wcztcblxuICBjb25zdCB2YWx1ZUZvcm1hdHRlciA9IGdldE51bWJlckZvcm1hdHRlcih2YWx1ZUZvcm1hdCk7XG4gIGNvbnN0IHRpbWVGb3JtYXR0ZXIgPSBnZXRUaW1lRm9ybWF0dGVyKHRpbWVGb3JtYXQpO1xuXG4gIGNvbnN0IGNvbnRhaW5lciA9IGQzU2VsZWN0KGVsZW1lbnQpXG4gICAgLmNsYXNzZWQoJ3N1cGVyc2V0LWxlZ2FjeS1jaGFydC1jYWxlbmRhcicsIHRydWUpXG4gICAgLnN0eWxlKCdoZWlnaHQnLCBoZWlnaHQpO1xuICBjb250YWluZXIuc2VsZWN0QWxsKCcqJykucmVtb3ZlKCk7XG4gIGNvbnN0IGRpdiA9IGNvbnRhaW5lci5hcHBlbmQoJ2RpdicpO1xuXG4gIGNvbnN0IHN1YkRvbWFpblRleHRGb3JtYXQgPSBzaG93VmFsdWVzID8gKGRhdGUsIHZhbHVlKSA9PiB2YWx1ZUZvcm1hdHRlcih2YWx1ZSkgOiBudWxsO1xuXG4gIC8vIFRyaWNrIHRvIGNvbnZlcnQgYWxsIHRpbWVzdGFtcHMgdG8gVVRDXG4gIC8vIFRPRE86IFZlcmlmeSBpZiB0aGlzIGNvbnZlcnNpb24gaXMgcmVhbGx5IG5lY2Vzc2FyeVxuICAvLyBzaW5jZSBhbGwgdGltZXN0YW1wcyBzaG91bGQgYWx3YXlzIGJlIGluIFVUQy5cbiAgY29uc3QgbWV0cmljc0RhdGEgPSB7fTtcbiAgT2JqZWN0LmtleXMoZGF0YS5kYXRhKS5mb3JFYWNoKG1ldHJpYyA9PiB7XG4gICAgbWV0cmljc0RhdGFbbWV0cmljXSA9IHt9O1xuICAgIE9iamVjdC5rZXlzKGRhdGEuZGF0YVttZXRyaWNdKS5mb3JFYWNoKHRzID0+IHtcbiAgICAgIG1ldHJpY3NEYXRhW21ldHJpY11bY29udmVydFVUQ1RTKHRzICogMTAwMCkgLyAxMDAwXSA9IGRhdGEuZGF0YVttZXRyaWNdW3RzXTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgT2JqZWN0LmtleXMobWV0cmljc0RhdGEpLmZvckVhY2gobWV0cmljID0+IHtcbiAgICBjb25zdCBjYWxDb250YWluZXIgPSBkaXYuYXBwZW5kKCdkaXYnKTtcbiAgICBpZiAoc2hvd01ldHJpY05hbWUpIHtcbiAgICAgIGNhbENvbnRhaW5lci50ZXh0KGBNZXRyaWM6ICR7dmVyYm9zZU1hcFttZXRyaWNdIHx8IG1ldHJpY31gKTtcbiAgICB9XG4gICAgY29uc3QgdGltZXN0YW1wcyA9IG1ldHJpY3NEYXRhW21ldHJpY107XG4gICAgY29uc3QgZXh0ZW50cyA9IGQzRXh0ZW50KE9iamVjdC5rZXlzKHRpbWVzdGFtcHMpLCBrZXkgPT4gdGltZXN0YW1wc1trZXldKTtcbiAgICBjb25zdCBzdGVwID0gKGV4dGVudHNbMV0gLSBleHRlbnRzWzBdKSAvIChzdGVwcyAtIDEpO1xuICAgIGNvbnN0IGNvbG9yU2NhbGUgPSBnZXRTZXF1ZW50aWFsU2NoZW1lUmVnaXN0cnkoKVxuICAgICAgLmdldChsaW5lYXJDb2xvclNjaGVtZSlcbiAgICAgIC5jcmVhdGVMaW5lYXJTY2FsZShleHRlbnRzKTtcblxuICAgIGNvbnN0IGxlZ2VuZCA9IGQzUmFuZ2Uoc3RlcHMpLm1hcChpID0+IGV4dGVudHNbMF0gKyBzdGVwICogaSk7XG4gICAgY29uc3QgbGVnZW5kQ29sb3JzID0gbGVnZW5kLm1hcCh4ID0+IGNvbG9yU2NhbGUoeCkpO1xuXG4gICAgY29uc3QgY2FsID0gbmV3IENhbEhlYXRNYXAoKTtcbiAgICBjYWwuaW5pdCh7XG4gICAgICBzdGFydDogY29udmVydFVUQ1RTKGRhdGEuc3RhcnQpLFxuICAgICAgZGF0YTogdGltZXN0YW1wcyxcbiAgICAgIGl0ZW1TZWxlY3RvcjogY2FsQ29udGFpbmVyLm5vZGUoKSxcbiAgICAgIGxlZ2VuZFZlcnRpY2FsUG9zaXRpb246ICd0b3AnLFxuICAgICAgY2VsbFNpemUsXG4gICAgICBjZWxsUGFkZGluZyxcbiAgICAgIGNlbGxSYWRpdXMsXG4gICAgICBsZWdlbmRDZWxsU2l6ZTogY2VsbFNpemUsXG4gICAgICBsZWdlbmRDZWxsUGFkZGluZzogMixcbiAgICAgIGxlZ2VuZENlbGxSYWRpdXM6IGNlbGxSYWRpdXMsXG4gICAgICB0b29sdGlwOiB0cnVlLFxuICAgICAgZG9tYWluOiBkb21haW5HcmFudWxhcml0eSxcbiAgICAgIHN1YkRvbWFpbjogc3ViZG9tYWluR3JhbnVsYXJpdHksXG4gICAgICByYW5nZTogZGF0YS5yYW5nZSxcbiAgICAgIGJyb3dzaW5nOiB0cnVlLFxuICAgICAgbGVnZW5kLFxuICAgICAgbGVnZW5kQ29sb3JzOiB7XG4gICAgICAgIGNvbG9yU2NhbGUsXG4gICAgICAgIG1pbjogbGVnZW5kQ29sb3JzWzBdLFxuICAgICAgICBtYXg6IGxlZ2VuZENvbG9yc1tsZWdlbmRDb2xvcnMubGVuZ3RoIC0gMV0sXG4gICAgICAgIGVtcHR5OiAnd2hpdGUnLFxuICAgICAgfSxcbiAgICAgIGRpc3BsYXlMZWdlbmQ6IHNob3dMZWdlbmQsXG4gICAgICBpdGVtTmFtZTogJycsXG4gICAgICB2YWx1ZUZvcm1hdHRlcixcbiAgICAgIHRpbWVGb3JtYXR0ZXIsXG4gICAgICBzdWJEb21haW5UZXh0Rm9ybWF0LFxuICAgIH0pO1xuICB9KTtcbn1cblxuQ2FsZW5kYXIuZGlzcGxheU5hbWUgPSAnQ2FsZW5kYXInO1xuQ2FsZW5kYXIucHJvcFR5cGVzID0gcHJvcFR5cGVzO1xuXG5leHBvcnQgZGVmYXVsdCBDYWxlbmRhcjtcbiIsIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IHsgcmVhY3RpZnksIHN0eWxlZCB9IGZyb20gJ0BzdXBlcnNldC11aS9jb3JlJztcbmltcG9ydCBDb21wb25lbnQgZnJvbSAnLi9DYWxlbmRhcic7XG5cbmNvbnN0IFJlYWN0Q29tcG9uZW50ID0gcmVhY3RpZnkoQ29tcG9uZW50KTtcblxuY29uc3QgQ2FsZW5kZXIgPSAoeyBjbGFzc05hbWUsIC4uLm90aGVyUHJvcHMgfSkgPT4gKFxuICA8ZGl2IGNsYXNzTmFtZT17Y2xhc3NOYW1lfT5cbiAgICA8UmVhY3RDb21wb25lbnQgey4uLm90aGVyUHJvcHN9IC8+XG4gIDwvZGl2PlxuKTtcblxuQ2FsZW5kZXIuZGVmYXVsdFByb3BzID0ge1xuICBvdGhlclByb3BzOiB7fSxcbn07XG5cbkNhbGVuZGVyLnByb3BUeXBlcyA9IHtcbiAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gIG90aGVyUHJvcHM6IFByb3BUeXBlcy5vYmplY3RPZihQcm9wVHlwZXMuYW55KSxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHN0eWxlZChDYWxlbmRlcilgXG4gIC5zdXBlcnNldC1sZWdhY3ktY2hhcnQtY2FsZW5kYXIge1xuICAgIHBhZGRpbmc6IDEwcHg7XG4gICAgcG9zaXRpb246IHN0YXRpYyAhaW1wb3J0YW50O1xuICAgIG92ZXJmbG93OiBhdXRvICFpbXBvcnRhbnQ7XG4gIH1cblxuICAuc3VwZXJzZXQtbGVnYWN5LWNoYXJ0LWNhbGVuZGFyIC5jaC10b29sdGlwIHtcbiAgICBtYXJnaW4tbGVmdDogMjBweDtcbiAgICBtYXJnaW4tdG9wOiA1cHg7XG4gIH1cbmA7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDWkE7QUFDQTs7Ozs7QUFPQTtBQW1CQTtBQU5BO0FBa0JBO0FBRUE7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUdBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFHQTtBQUdBO0FBZUE7QUFDQTtBQUdBO0FBQ0E7QUFHQTtBQUNBO0FBR0E7QUFDQTtBQU9BO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUdBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBR0E7QUFFQTtBQUdBO0FBQ0E7QUFHQTtBQVFBO0FBR0E7QUFJQTtBQUNBO0FBRUE7QUFDQTtBQUdBO0FBU0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUdBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUVBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBT0E7QUFXQTtBQUNBO0FBRUE7QUFDQTtBQUdBO0FBQ0E7QUFHQTtBQUdBO0FBR0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBa1BBO0FBc0ZBO0FBS0E7QUFDQTtBQWdCQTtBQWlCQTtBQUNBOzs7QUFNQTtBQXVEQTtBQUNBO0FBQ0E7QUF1QkE7QUFtQkE7QUFDQTtBQWVBOzs7O0FBbUJBO0FBQUE7QUFxSEE7QUFDQTtBQXRIQTtBQThMQTtBQU9BO0FBQ0E7QUFDQTtBQXlHQTtBQUNBO0FBQ0E7QUFvQkE7QUFDQTtBQUVBO0FBc0JBO0FBK0JBOzs7OztBQUlBO0FBZ0JBO0FBQ0E7Ozs7O0FBNEhBOzs7O0FBNUhBO0FBdUJBO0FBVUE7Ozs7O0FBbU5BO0FBM0ZBOzs7O0FBL0VBOzs7Ozs7OztBQVdBOzs7OztBQWtCQTs7Ozs7QUErR0E7Ozs7O0FBcUVBOzs7Ozs7QUE2QkE7O0FBMkRBOzs7O0FBNERBOzs7Ozs7OztBQW1CQTtBQVlBO0FBQ0E7QUFFQTs7Ozs7OztBQVFBOzs7OztBQXdCQTs7QUFTQTs7QUFTQTs7Ozs7QUFjQTs7Ozs7QUFnQkE7Ozs7QUFlQTs7OztBQVlBO0FBMENBO0FBQ0E7QUFFQTtBQTJCQTtBQWNBO0FBQ0E7QUFFQTs7Ozs7OztBQVFBOzs7Ozs7O0FBdUJBO0FBZ0NBOzs7OztBQW1EQTs7Ozs7QUFZQTs7OztBQVdBO0FBY0E7QUFDQTtBQUVBOzs7OztBQXdEQTs7Ozs7O0FBc0JBOzs7Ozs7OztBQTk0QkE7Ozs7OztBQXU5QkE7QUFrREE7QUFDQTtBQUVBOzs7O0FBS0E7Ozs7QUFPQTs7Ozs7QUFhQTs7Ozs7QUFpQkE7Ozs7O0FBY0E7Ozs7O0FBWUE7Ozs7Ozs7O0FBa0JBOzs7O0FBY0E7Ozs7OztBQWdCQTtBQXlCQTtBQUNBO0FBRUE7Ozs7OztBQU9BOzs7Ozs7QUFvQkE7QUFlQTtBQUdBO0FBU0E7QUFDQTtBQUNBOzs7Ozs7QUFjQTs7Ozs7O0FBc0JBOzs7Ozs7QUFxQ0E7Ozs7OztBQXNCQTs7Ozs7O0FBcUJBO0FBZ0JBO0FBQ0E7O0FBMkZBOzs7O0FBd0JBOzs7O0FBY0E7QUFhQTtBQUNBO0FBRUE7Ozs7Ozs7Ozs7Ozs7QUFjQTtBQTZEQTs7Ozs7Ozs7O0FBaUNBO0FBc0JBO0FBQ0E7QUFFQTtBQUNBO0FBTUE7QUFtQ0E7QUFJQTs7Ozs7Ozs7QUEyQkE7QUE0REE7QUFDQTtBQUVBOztBQUdBOztBQVlBOzs7Ozs7Ozs7O0FBb0JBOzs7OztBQStCQTs7Ozs7O0FBYUE7Ozs7O0FBa0NBOzs7O0FBK0JBOzs7O0FBZ0JBOzs7Ozs7OztBQW9CQTs7Ozs7Ozs7QUFtQkE7QUFnREE7QUF3QkE7QUE4QkE7QUFTQTtBQUNBO0FBU0E7QUE2QkE7QUFDQTtBQUVBOztBQUdBO0FBK0RBO0FBQ0E7QUFFQTtBQWVBO0FBNEJBO0FBV0E7Ozs7Ozs7QUFvS0E7QUFrQkE7QUF5QkE7Ozs7Ozs7O0FBOEJBOztBQWdDQTtBQU9BO0FBT0E7Ozs7OztBQWNBO0FBSUE7QUFLQTtBQU1BO0FBRUE7QUFLQTs7Ozs7QUM1c0hBOzs7Ozs7Ozs7Ozs7Ozs7OztBQWtCQTtBQTJCQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBS0E7QUFFQTtBQUVBOztBQzdEQTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFrQkE7Ozs7Ozs7Ozs7O0FBc0JBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///2516\n')}}]);