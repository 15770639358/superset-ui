(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{1288:function(module,__webpack_exports__,__webpack_require__){"use strict";eval('/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return reactify; });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(0);\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);\n\nfunction reactify(renderFn, callbacks) {\n    class ReactifiedComponent extends react__WEBPACK_IMPORTED_MODULE_0___default.a.Component {\n        constructor(props) {\n            super(props);\n            this.setContainerRef = this.setContainerRef.bind(this);\n        }\n        componentDidMount() {\n            this.execute();\n        }\n        componentDidUpdate() {\n            this.execute();\n        }\n        componentWillUnmount() {\n            this.container = undefined;\n            if (callbacks === null || callbacks === void 0 ? void 0 : callbacks.componentWillUnmount) {\n                callbacks.componentWillUnmount.bind(this)();\n            }\n        }\n        setContainerRef(ref) {\n            this.container = ref;\n        }\n        execute() {\n            if (this.container) {\n                renderFn(this.container, this.props);\n            }\n        }\n        render() {\n            const { id, className } = this.props;\n            return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div", { ref: this.setContainerRef, id: id, className: className });\n        }\n    }\n    const ReactifiedClass = ReactifiedComponent;\n    if (renderFn.displayName) {\n        ReactifiedClass.displayName = renderFn.displayName;\n    }\n    // eslint-disable-next-line react/forbid-foreign-prop-types\n    if (renderFn.propTypes) {\n        ReactifiedClass.propTypes = Object.assign(Object.assign({}, ReactifiedClass.propTypes), renderFn.propTypes);\n    }\n    if (renderFn.defaultProps) {\n        ReactifiedClass.defaultProps = renderFn.defaultProps;\n    }\n    return ReactifiedComponent;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTI4OC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi9zdXBlcnNldC11aS1jaGFydC9zcmMvY29tcG9uZW50cy9yZWFjdGlmeS50c3g/NTZmNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG4vLyBUT0RPOiBOb3RlIHRoYXQgaWQgYW5kIGNsYXNzTmFtZSBjYW4gY29sbGlkZSBiZXR3ZWVuIFByb3BzIGFuZCBSZWFjdGlmeVByb3BzXG4vLyBsZWFkaW5nIHRvIChsaWtlbHkpIHVuZXhwZWN0ZWQgYmVoYXZpb3JzLiBXZSBzaG91bGQgZWl0aGVyIHJlcXVpcmUgUHJvcHMgdG8gbm90XG4vLyBjb250YWluIGFuIGlkL2NsYXNzTmFtZSwgb3Igbm90IGNvbWJpbmUgdGhlbSAodmlhIGludGVyc2VjdGlvbiksIGluc3RlYWQgcHJlZmVycmluZ1xuLy8gd3JhcHBpbmcgKGNvbXBvc2l0aW9uKS4gQXMgYW4gZXhhbXBsZTpcbi8vIGludGVyZmFjZSBNeVByb3BzIHtcbi8vICAgaWQ6IG51bWJlcjtcbi8vIH1cbi8vIGZ1bmN0aW9uIG15UmVuZGVyKGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQsIHByb3BzOiBSZWFkb25seTxNeVByb3BzPik6IHZvaWQge1xuLy8gICBwcm9wcy5pZCAvLyB1bnVzYWJsZTogaWQgaXMgc3RyaW5nICYgbnVtYmVyXG4vLyB9XG4vLyBuZXcgKHJlYWN0aWZ5KG15UmVuZGVyKSkoeyBpZDogNSB9KTsgLy8gZXJyb3I6IGlkIGhhcyB0byBiZSBzdHJpbmcgJiBudW1iZXJcblxuZXhwb3J0IHR5cGUgUmVhY3RpZnlQcm9wcyA9IHtcbiAgaWQ/OiBzdHJpbmc7XG4gIGNsYXNzTmFtZT86IHN0cmluZztcbn07XG5cbi8vIFRPRE86IGFkZCBtb3JlIFJlYWN0IGxpZmVjeWNsZSBjYWxsYmFja3MgYXMgbmVlZGVkXG5leHBvcnQgdHlwZSBMaWZlQ3ljbGVDYWxsYmFja3MgPSB7XG4gIGNvbXBvbmVudFdpbGxVbm1vdW50PzogKCkgPT4gdm9pZDtcbn07XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVuZGVyRnVuY1R5cGU8UHJvcHM+IHtcbiAgKGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQsIHByb3BzOiBSZWFkb25seTxQcm9wcyAmIFJlYWN0aWZ5UHJvcHM+KTogdm9pZDtcbiAgZGlzcGxheU5hbWU/OiBzdHJpbmc7XG4gIGRlZmF1bHRQcm9wcz86IFBhcnRpYWw8UHJvcHMgJiBSZWFjdGlmeVByb3BzPjtcbiAgcHJvcFR5cGVzPzogUmVhY3QuV2Vha1ZhbGlkYXRpb25NYXA8UHJvcHMgJiBSZWFjdGlmeVByb3BzPjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gcmVhY3RpZnk8UHJvcHMgZXh0ZW5kcyBvYmplY3Q+KFxuICByZW5kZXJGbjogUmVuZGVyRnVuY1R5cGU8UHJvcHM+LFxuICBjYWxsYmFja3M/OiBMaWZlQ3ljbGVDYWxsYmFja3MsXG4pOiBSZWFjdC5Db21wb25lbnRDbGFzczxQcm9wcyAmIFJlYWN0aWZ5UHJvcHM+IHtcbiAgY2xhc3MgUmVhY3RpZmllZENvbXBvbmVudCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxQcm9wcyAmIFJlYWN0aWZ5UHJvcHM+IHtcbiAgICBjb250YWluZXI/OiBIVE1MRGl2RWxlbWVudDtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBQcm9wcyAmIFJlYWN0aWZ5UHJvcHMpIHtcbiAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgIHRoaXMuc2V0Q29udGFpbmVyUmVmID0gdGhpcy5zZXRDb250YWluZXJSZWYuYmluZCh0aGlzKTtcbiAgICB9XG5cbiAgICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgIHRoaXMuZXhlY3V0ZSgpO1xuICAgIH1cblxuICAgIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICAgIHRoaXMuZXhlY3V0ZSgpO1xuICAgIH1cblxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgdGhpcy5jb250YWluZXIgPSB1bmRlZmluZWQ7XG4gICAgICBpZiAoY2FsbGJhY2tzPy5jb21wb25lbnRXaWxsVW5tb3VudCkge1xuICAgICAgICBjYWxsYmFja3MuY29tcG9uZW50V2lsbFVubW91bnQuYmluZCh0aGlzKSgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHNldENvbnRhaW5lclJlZihyZWY6IEhUTUxEaXZFbGVtZW50KSB7XG4gICAgICB0aGlzLmNvbnRhaW5lciA9IHJlZjtcbiAgICB9XG5cbiAgICBleGVjdXRlKCkge1xuICAgICAgaWYgKHRoaXMuY29udGFpbmVyKSB7XG4gICAgICAgIHJlbmRlckZuKHRoaXMuY29udGFpbmVyLCB0aGlzLnByb3BzKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICBjb25zdCB7IGlkLCBjbGFzc05hbWUgfSA9IHRoaXMucHJvcHM7XG5cbiAgICAgIHJldHVybiA8ZGl2IHJlZj17dGhpcy5zZXRDb250YWluZXJSZWZ9IGlkPXtpZH0gY2xhc3NOYW1lPXtjbGFzc05hbWV9IC8+O1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IFJlYWN0aWZpZWRDbGFzczogUmVhY3QuQ29tcG9uZW50Q2xhc3M8UHJvcHMgJiBSZWFjdGlmeVByb3BzPiA9IFJlYWN0aWZpZWRDb21wb25lbnQ7XG5cbiAgaWYgKHJlbmRlckZuLmRpc3BsYXlOYW1lKSB7XG4gICAgUmVhY3RpZmllZENsYXNzLmRpc3BsYXlOYW1lID0gcmVuZGVyRm4uZGlzcGxheU5hbWU7XG4gIH1cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L2ZvcmJpZC1mb3JlaWduLXByb3AtdHlwZXNcbiAgaWYgKHJlbmRlckZuLnByb3BUeXBlcykge1xuICAgIFJlYWN0aWZpZWRDbGFzcy5wcm9wVHlwZXMgPSB7IC4uLlJlYWN0aWZpZWRDbGFzcy5wcm9wVHlwZXMsIC4uLnJlbmRlckZuLnByb3BUeXBlcyB9O1xuICB9XG4gIGlmIChyZW5kZXJGbi5kZWZhdWx0UHJvcHMpIHtcbiAgICBSZWFjdGlmaWVkQ2xhc3MuZGVmYXVsdFByb3BzID0gcmVuZGVyRm4uZGVmYXVsdFByb3BzO1xuICB9XG5cbiAgcmV0dXJuIFJlYWN0aWZpZWRDb21wb25lbnQ7XG59XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBK0JBO0FBSUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///1288\n')},1325:function(module,exports,__webpack_require__){"use strict";eval("\nvar $ = __webpack_require__(12);\nvar isArray = __webpack_require__(186);\n\nvar nativeReverse = [].reverse;\nvar test = [1, 2];\n\n// `Array.prototype.reverse` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.reverse\n// fix for Safari 12.0 bug\n// https://bugs.webkit.org/show_bug.cgi?id=188794\n$({ target: 'Array', proto: true, forced: String(test) === String(test.reverse()) }, {\n  reverse: function reverse() {\n    // eslint-disable-next-line no-self-assign\n    if (isArray(this)) this.length = this.length;\n    return nativeReverse.call(this);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTMyNS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8vVXNlcnMvZXJpa19yaXR0ZXIvcmVwb3MvZ2l0aHViLmNvbS9hcGFjaGUtc3VwZXJzZXQvc3VwZXJzZXQtdWkvbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5yZXZlcnNlLmpzPzFjMjYiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyICQgPSByZXF1aXJlKCcuLi9pbnRlcm5hbHMvZXhwb3J0Jyk7XG52YXIgaXNBcnJheSA9IHJlcXVpcmUoJy4uL2ludGVybmFscy9pcy1hcnJheScpO1xuXG52YXIgbmF0aXZlUmV2ZXJzZSA9IFtdLnJldmVyc2U7XG52YXIgdGVzdCA9IFsxLCAyXTtcblxuLy8gYEFycmF5LnByb3RvdHlwZS5yZXZlcnNlYCBtZXRob2Rcbi8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5yZXZlcnNlXG4vLyBmaXggZm9yIFNhZmFyaSAxMi4wIGJ1Z1xuLy8gaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTE4ODc5NFxuJCh7IHRhcmdldDogJ0FycmF5JywgcHJvdG86IHRydWUsIGZvcmNlZDogU3RyaW5nKHRlc3QpID09PSBTdHJpbmcodGVzdC5yZXZlcnNlKCkpIH0sIHtcbiAgcmV2ZXJzZTogZnVuY3Rpb24gcmV2ZXJzZSgpIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1hc3NpZ25cbiAgICBpZiAoaXNBcnJheSh0aGlzKSkgdGhpcy5sZW5ndGggPSB0aGlzLmxlbmd0aDtcbiAgICByZXR1cm4gbmF0aXZlUmV2ZXJzZS5jYWxsKHRoaXMpO1xuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///1325\n")},1676:function(module,exports,__webpack_require__){eval("var api = __webpack_require__(235);\n            var content = __webpack_require__(1677);\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.i, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTY3Ni5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8vVXNlcnMvZXJpa19yaXR0ZXIvcmVwb3MvZ2l0aHViLmNvbS9hcGFjaGUtc3VwZXJzZXQvc3VwZXJzZXQtdWkvcGx1Z2lucy9sZWdhY3ktcGx1Z2luLWNoYXJ0LWNhbGVuZGFyL3NyYy92ZW5kb3IvY2FsLWhlYXRtYXAuY3NzPzU4NDAiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwaSA9IHJlcXVpcmUoXCIhLi4vLi4vLi4vLi4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvaW5qZWN0U3R5bGVzSW50b1N0eWxlVGFnLmpzXCIpO1xuICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSByZXF1aXJlKFwiISEuLi8uLi8uLi8uLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L2Nqcy5qcz8/cmVmLS02LTEhLi4vLi4vLi4vLi4vbm9kZV9tb2R1bGVzL3Bvc3Rjc3MtbG9hZGVyL3NyYy9pbmRleC5qcz8/cG9zdGNzcyEuL2NhbC1oZWF0bWFwLmNzc1wiKTtcblxuICAgICAgICAgICAgY29udGVudCA9IGNvbnRlbnQuX19lc01vZHVsZSA/IGNvbnRlbnQuZGVmYXVsdCA6IGNvbnRlbnQ7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29udGVudCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgY29udGVudCA9IFtbbW9kdWxlLmlkLCBjb250ZW50LCAnJ11dO1xuICAgICAgICAgICAgfVxuXG52YXIgb3B0aW9ucyA9IHt9O1xuXG5vcHRpb25zLmluc2VydCA9IFwiaGVhZFwiO1xub3B0aW9ucy5zaW5nbGV0b24gPSBmYWxzZTtcblxudmFyIHVwZGF0ZSA9IGFwaShjb250ZW50LCBvcHRpb25zKTtcblxudmFyIGV4cG9ydGVkID0gY29udGVudC5sb2NhbHMgPyBjb250ZW50LmxvY2FscyA6IHt9O1xuXG5cblxubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRlZDsiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///1676\n")},1677:function(module,exports,__webpack_require__){eval('// Imports\nvar ___CSS_LOADER_API_IMPORT___ = __webpack_require__(236);\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.i, "/* [LICENSE TBD] */\\n/* Cal-HeatMap CSS */\\n\\n.cal-heatmap-container {\\n  display: block;\\n}\\n\\n.cal-heatmap-container .graph-label {\\n  fill: #999;\\n  font-size: 10px;\\n}\\n\\n.cal-heatmap-container .graph,\\n.cal-heatmap-container .graph-legend rect {\\n  shape-rendering: crispedges;\\n}\\n\\n.cal-heatmap-container .graph-rect {\\n  fill: #ededed;\\n}\\n\\n.cal-heatmap-container .graph-subdomain-group rect:hover {\\n  stroke: #000;\\n  stroke-width: 1px;\\n}\\n\\n.cal-heatmap-container .subdomain-text {\\n  font-size: 8px;\\n  fill: #999;\\n  pointer-events: none;\\n}\\n\\n.cal-heatmap-container .hover_cursor:hover {\\n  cursor: pointer;\\n}\\n\\n.cal-heatmap-container .qi {\\n  background-color: #999;\\n  fill: #999;\\n}\\n\\n/*\\nRemove comment to apply this style to date with value equal to 0\\n.q0\\n{\\n  background-color: #fff;\\n  fill: #fff;\\n  stroke: #ededed\\n}\\n*/\\n\\n.cal-heatmap-container .q1 {\\n  background-color: #dae289;\\n  fill: #dae289;\\n}\\n\\n.cal-heatmap-container .q2 {\\n  background-color: #cedb9c;\\n  fill: #9cc069;\\n}\\n\\n.cal-heatmap-container .q3 {\\n  background-color: #b5cf6b;\\n  fill: #669d45;\\n}\\n\\n.cal-heatmap-container .q4 {\\n  background-color: #637939;\\n  fill: #637939;\\n}\\n\\n.cal-heatmap-container .q5 {\\n  background-color: #3b6427;\\n  fill: #3b6427;\\n}\\n\\n.cal-heatmap-container rect.highlight {\\n  stroke: #444;\\n  stroke-width: 1;\\n}\\n\\n.cal-heatmap-container text.highlight {\\n  fill: #444;\\n}\\n\\n.cal-heatmap-container rect.highlight-now {\\n  stroke: red;\\n}\\n\\n.cal-heatmap-container text.highlight-now {\\n  fill: red;\\n  font-weight: 800;\\n}\\n\\n.cal-heatmap-container .domain-background {\\n  fill: none;\\n  shape-rendering: crispedges;\\n}\\n\\n.ch-tooltip {\\n  padding: 10px;\\n  background: #222;\\n  color: #bbb;\\n  font-size: 12px;\\n  line-height: 1.4;\\n  width: 140px;\\n  position: absolute;\\n  z-index: 99999;\\n  text-align: center;\\n  border-radius: 2px;\\n  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);\\n  display: none;\\n  box-sizing: border-box;\\n}\\n\\n.ch-tooltip::after {\\n  position: absolute;\\n  width: 0;\\n  height: 0;\\n  border-color: transparent;\\n  border-style: solid;\\n  content: \'\';\\n  padding: 0;\\n  display: block;\\n  bottom: -6px;\\n  left: 50%;\\n  margin-left: -6px;\\n  border-width: 6px 6px 0;\\n  border-top-color: #222;\\n}\\n", ""]);\n// Exports\nmodule.exports = exports;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTY3Ny5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8vVXNlcnMvZXJpa19yaXR0ZXIvcmVwb3MvZ2l0aHViLmNvbS9hcGFjaGUtc3VwZXJzZXQvc3VwZXJzZXQtdWkvcGx1Z2lucy9sZWdhY3ktcGx1Z2luLWNoYXJ0LWNhbGVuZGFyL3NyYy92ZW5kb3IvY2FsLWhlYXRtYXAuY3NzPzRmM2IiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gSW1wb3J0c1xudmFyIF9fX0NTU19MT0FERVJfQVBJX0lNUE9SVF9fXyA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L3J1bnRpbWUvYXBpLmpzXCIpO1xuZXhwb3J0cyA9IF9fX0NTU19MT0FERVJfQVBJX0lNUE9SVF9fXyhmYWxzZSk7XG4vLyBNb2R1bGVcbmV4cG9ydHMucHVzaChbbW9kdWxlLmlkLCBcIi8qIFtMSUNFTlNFIFRCRF0gKi9cXG4vKiBDYWwtSGVhdE1hcCBDU1MgKi9cXG5cXG4uY2FsLWhlYXRtYXAtY29udGFpbmVyIHtcXG4gIGRpc3BsYXk6IGJsb2NrO1xcbn1cXG5cXG4uY2FsLWhlYXRtYXAtY29udGFpbmVyIC5ncmFwaC1sYWJlbCB7XFxuICBmaWxsOiAjOTk5O1xcbiAgZm9udC1zaXplOiAxMHB4O1xcbn1cXG5cXG4uY2FsLWhlYXRtYXAtY29udGFpbmVyIC5ncmFwaCxcXG4uY2FsLWhlYXRtYXAtY29udGFpbmVyIC5ncmFwaC1sZWdlbmQgcmVjdCB7XFxuICBzaGFwZS1yZW5kZXJpbmc6IGNyaXNwZWRnZXM7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgLmdyYXBoLXJlY3Qge1xcbiAgZmlsbDogI2VkZWRlZDtcXG59XFxuXFxuLmNhbC1oZWF0bWFwLWNvbnRhaW5lciAuZ3JhcGgtc3ViZG9tYWluLWdyb3VwIHJlY3Q6aG92ZXIge1xcbiAgc3Ryb2tlOiAjMDAwO1xcbiAgc3Ryb2tlLXdpZHRoOiAxcHg7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgLnN1YmRvbWFpbi10ZXh0IHtcXG4gIGZvbnQtc2l6ZTogOHB4O1xcbiAgZmlsbDogIzk5OTtcXG4gIHBvaW50ZXItZXZlbnRzOiBub25lO1xcbn1cXG5cXG4uY2FsLWhlYXRtYXAtY29udGFpbmVyIC5ob3Zlcl9jdXJzb3I6aG92ZXIge1xcbiAgY3Vyc29yOiBwb2ludGVyO1xcbn1cXG5cXG4uY2FsLWhlYXRtYXAtY29udGFpbmVyIC5xaSB7XFxuICBiYWNrZ3JvdW5kLWNvbG9yOiAjOTk5O1xcbiAgZmlsbDogIzk5OTtcXG59XFxuXFxuLypcXG5SZW1vdmUgY29tbWVudCB0byBhcHBseSB0aGlzIHN0eWxlIHRvIGRhdGUgd2l0aCB2YWx1ZSBlcXVhbCB0byAwXFxuLnEwXFxue1xcbiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjtcXG4gIGZpbGw6ICNmZmY7XFxuICBzdHJva2U6ICNlZGVkZWRcXG59XFxuKi9cXG5cXG4uY2FsLWhlYXRtYXAtY29udGFpbmVyIC5xMSB7XFxuICBiYWNrZ3JvdW5kLWNvbG9yOiAjZGFlMjg5O1xcbiAgZmlsbDogI2RhZTI4OTtcXG59XFxuXFxuLmNhbC1oZWF0bWFwLWNvbnRhaW5lciAucTIge1xcbiAgYmFja2dyb3VuZC1jb2xvcjogI2NlZGI5YztcXG4gIGZpbGw6ICM5Y2MwNjk7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgLnEzIHtcXG4gIGJhY2tncm91bmQtY29sb3I6ICNiNWNmNmI7XFxuICBmaWxsOiAjNjY5ZDQ1O1xcbn1cXG5cXG4uY2FsLWhlYXRtYXAtY29udGFpbmVyIC5xNCB7XFxuICBiYWNrZ3JvdW5kLWNvbG9yOiAjNjM3OTM5O1xcbiAgZmlsbDogIzYzNzkzOTtcXG59XFxuXFxuLmNhbC1oZWF0bWFwLWNvbnRhaW5lciAucTUge1xcbiAgYmFja2dyb3VuZC1jb2xvcjogIzNiNjQyNztcXG4gIGZpbGw6ICMzYjY0Mjc7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgcmVjdC5oaWdobGlnaHQge1xcbiAgc3Ryb2tlOiAjNDQ0O1xcbiAgc3Ryb2tlLXdpZHRoOiAxO1xcbn1cXG5cXG4uY2FsLWhlYXRtYXAtY29udGFpbmVyIHRleHQuaGlnaGxpZ2h0IHtcXG4gIGZpbGw6ICM0NDQ7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgcmVjdC5oaWdobGlnaHQtbm93IHtcXG4gIHN0cm9rZTogcmVkO1xcbn1cXG5cXG4uY2FsLWhlYXRtYXAtY29udGFpbmVyIHRleHQuaGlnaGxpZ2h0LW5vdyB7XFxuICBmaWxsOiByZWQ7XFxuICBmb250LXdlaWdodDogODAwO1xcbn1cXG5cXG4uY2FsLWhlYXRtYXAtY29udGFpbmVyIC5kb21haW4tYmFja2dyb3VuZCB7XFxuICBmaWxsOiBub25lO1xcbiAgc2hhcGUtcmVuZGVyaW5nOiBjcmlzcGVkZ2VzO1xcbn1cXG5cXG4uY2gtdG9vbHRpcCB7XFxuICBwYWRkaW5nOiAxMHB4O1xcbiAgYmFja2dyb3VuZDogIzIyMjtcXG4gIGNvbG9yOiAjYmJiO1xcbiAgZm9udC1zaXplOiAxMnB4O1xcbiAgbGluZS1oZWlnaHQ6IDEuNDtcXG4gIHdpZHRoOiAxNDBweDtcXG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcXG4gIHotaW5kZXg6IDk5OTk5O1xcbiAgdGV4dC1hbGlnbjogY2VudGVyO1xcbiAgYm9yZGVyLXJhZGl1czogMnB4O1xcbiAgYm94LXNoYWRvdzogMnB4IDJweCAycHggcmdiYSgwLCAwLCAwLCAwLjIpO1xcbiAgZGlzcGxheTogbm9uZTtcXG4gIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XFxufVxcblxcbi5jaC10b29sdGlwOjphZnRlciB7XFxuICBwb3NpdGlvbjogYWJzb2x1dGU7XFxuICB3aWR0aDogMDtcXG4gIGhlaWdodDogMDtcXG4gIGJvcmRlci1jb2xvcjogdHJhbnNwYXJlbnQ7XFxuICBib3JkZXItc3R5bGU6IHNvbGlkO1xcbiAgY29udGVudDogJyc7XFxuICBwYWRkaW5nOiAwO1xcbiAgZGlzcGxheTogYmxvY2s7XFxuICBib3R0b206IC02cHg7XFxuICBsZWZ0OiA1MCU7XFxuICBtYXJnaW4tbGVmdDogLTZweDtcXG4gIGJvcmRlci13aWR0aDogNnB4IDZweCAwO1xcbiAgYm9yZGVyLXRvcC1jb2xvcjogIzIyMjtcXG59XFxuXCIsIFwiXCJdKTtcbi8vIEV4cG9ydHNcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0cztcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///1677\n')},1678:function(module,exports,__webpack_require__){eval("var DESCRIPTORS = __webpack_require__(42);\nvar global = __webpack_require__(22);\nvar isForced = __webpack_require__(240);\nvar inheritIfRequired = __webpack_require__(414);\nvar defineProperty = __webpack_require__(46).f;\nvar getOwnPropertyNames = __webpack_require__(239).f;\nvar isRegExp = __webpack_require__(412);\nvar getFlags = __webpack_require__(411);\nvar stickyHelpers = __webpack_require__(651);\nvar redefine = __webpack_require__(78);\nvar fails = __webpack_require__(23);\nvar setInternalState = __webpack_require__(108).set;\nvar setSpecies = __webpack_require__(413);\nvar wellKnownSymbol = __webpack_require__(28);\n\nvar MATCH = wellKnownSymbol('match');\nvar NativeRegExp = global.RegExp;\nvar RegExpPrototype = NativeRegExp.prototype;\nvar re1 = /a/g;\nvar re2 = /a/g;\n\n// \"new\" should create a new object, old webkit bug\nvar CORRECT_NEW = new NativeRegExp(re1) !== re1;\n\nvar UNSUPPORTED_Y = stickyHelpers.UNSUPPORTED_Y;\n\nvar FORCED = DESCRIPTORS && isForced('RegExp', (!CORRECT_NEW || UNSUPPORTED_Y || fails(function () {\n  re2[MATCH] = false;\n  // RegExp constructor can alter flags and IsRegExp works correct with @@match\n  return NativeRegExp(re1) != re1 || NativeRegExp(re2) == re2 || NativeRegExp(re1, 'i') != '/a/i';\n})));\n\n// `RegExp` constructor\n// https://tc39.github.io/ecma262/#sec-regexp-constructor\nif (FORCED) {\n  var RegExpWrapper = function RegExp(pattern, flags) {\n    var thisIsRegExp = this instanceof RegExpWrapper;\n    var patternIsRegExp = isRegExp(pattern);\n    var flagsAreUndefined = flags === undefined;\n    var sticky;\n\n    if (!thisIsRegExp && patternIsRegExp && pattern.constructor === RegExpWrapper && flagsAreUndefined) {\n      return pattern;\n    }\n\n    if (CORRECT_NEW) {\n      if (patternIsRegExp && !flagsAreUndefined) pattern = pattern.source;\n    } else if (pattern instanceof RegExpWrapper) {\n      if (flagsAreUndefined) flags = getFlags.call(pattern);\n      pattern = pattern.source;\n    }\n\n    if (UNSUPPORTED_Y) {\n      sticky = !!flags && flags.indexOf('y') > -1;\n      if (sticky) flags = flags.replace(/y/g, '');\n    }\n\n    var result = inheritIfRequired(\n      CORRECT_NEW ? new NativeRegExp(pattern, flags) : NativeRegExp(pattern, flags),\n      thisIsRegExp ? this : RegExpPrototype,\n      RegExpWrapper\n    );\n\n    if (UNSUPPORTED_Y && sticky) setInternalState(result, { sticky: sticky });\n\n    return result;\n  };\n  var proxy = function (key) {\n    key in RegExpWrapper || defineProperty(RegExpWrapper, key, {\n      configurable: true,\n      get: function () { return NativeRegExp[key]; },\n      set: function (it) { NativeRegExp[key] = it; }\n    });\n  };\n  var keys = getOwnPropertyNames(NativeRegExp);\n  var index = 0;\n  while (keys.length > index) proxy(keys[index++]);\n  RegExpPrototype.constructor = RegExpWrapper;\n  RegExpWrapper.prototype = RegExpPrototype;\n  redefine(global, 'RegExp', RegExpWrapper);\n}\n\n// https://tc39.github.io/ecma262/#sec-get-regexp-@@species\nsetSpecies('RegExp');\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTY3OC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8vVXNlcnMvZXJpa19yaXR0ZXIvcmVwb3MvZ2l0aHViLmNvbS9hcGFjaGUtc3VwZXJzZXQvc3VwZXJzZXQtdWkvbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuY29uc3RydWN0b3IuanM/YTlkYSJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgREVTQ1JJUFRPUlMgPSByZXF1aXJlKCcuLi9pbnRlcm5hbHMvZGVzY3JpcHRvcnMnKTtcbnZhciBnbG9iYWwgPSByZXF1aXJlKCcuLi9pbnRlcm5hbHMvZ2xvYmFsJyk7XG52YXIgaXNGb3JjZWQgPSByZXF1aXJlKCcuLi9pbnRlcm5hbHMvaXMtZm9yY2VkJyk7XG52YXIgaW5oZXJpdElmUmVxdWlyZWQgPSByZXF1aXJlKCcuLi9pbnRlcm5hbHMvaW5oZXJpdC1pZi1yZXF1aXJlZCcpO1xudmFyIGRlZmluZVByb3BlcnR5ID0gcmVxdWlyZSgnLi4vaW50ZXJuYWxzL29iamVjdC1kZWZpbmUtcHJvcGVydHknKS5mO1xudmFyIGdldE93blByb3BlcnR5TmFtZXMgPSByZXF1aXJlKCcuLi9pbnRlcm5hbHMvb2JqZWN0LWdldC1vd24tcHJvcGVydHktbmFtZXMnKS5mO1xudmFyIGlzUmVnRXhwID0gcmVxdWlyZSgnLi4vaW50ZXJuYWxzL2lzLXJlZ2V4cCcpO1xudmFyIGdldEZsYWdzID0gcmVxdWlyZSgnLi4vaW50ZXJuYWxzL3JlZ2V4cC1mbGFncycpO1xudmFyIHN0aWNreUhlbHBlcnMgPSByZXF1aXJlKCcuLi9pbnRlcm5hbHMvcmVnZXhwLXN0aWNreS1oZWxwZXJzJyk7XG52YXIgcmVkZWZpbmUgPSByZXF1aXJlKCcuLi9pbnRlcm5hbHMvcmVkZWZpbmUnKTtcbnZhciBmYWlscyA9IHJlcXVpcmUoJy4uL2ludGVybmFscy9mYWlscycpO1xudmFyIHNldEludGVybmFsU3RhdGUgPSByZXF1aXJlKCcuLi9pbnRlcm5hbHMvaW50ZXJuYWwtc3RhdGUnKS5zZXQ7XG52YXIgc2V0U3BlY2llcyA9IHJlcXVpcmUoJy4uL2ludGVybmFscy9zZXQtc3BlY2llcycpO1xudmFyIHdlbGxLbm93blN5bWJvbCA9IHJlcXVpcmUoJy4uL2ludGVybmFscy93ZWxsLWtub3duLXN5bWJvbCcpO1xuXG52YXIgTUFUQ0ggPSB3ZWxsS25vd25TeW1ib2woJ21hdGNoJyk7XG52YXIgTmF0aXZlUmVnRXhwID0gZ2xvYmFsLlJlZ0V4cDtcbnZhciBSZWdFeHBQcm90b3R5cGUgPSBOYXRpdmVSZWdFeHAucHJvdG90eXBlO1xudmFyIHJlMSA9IC9hL2c7XG52YXIgcmUyID0gL2EvZztcblxuLy8gXCJuZXdcIiBzaG91bGQgY3JlYXRlIGEgbmV3IG9iamVjdCwgb2xkIHdlYmtpdCBidWdcbnZhciBDT1JSRUNUX05FVyA9IG5ldyBOYXRpdmVSZWdFeHAocmUxKSAhPT0gcmUxO1xuXG52YXIgVU5TVVBQT1JURURfWSA9IHN0aWNreUhlbHBlcnMuVU5TVVBQT1JURURfWTtcblxudmFyIEZPUkNFRCA9IERFU0NSSVBUT1JTICYmIGlzRm9yY2VkKCdSZWdFeHAnLCAoIUNPUlJFQ1RfTkVXIHx8IFVOU1VQUE9SVEVEX1kgfHwgZmFpbHMoZnVuY3Rpb24gKCkge1xuICByZTJbTUFUQ0hdID0gZmFsc2U7XG4gIC8vIFJlZ0V4cCBjb25zdHJ1Y3RvciBjYW4gYWx0ZXIgZmxhZ3MgYW5kIElzUmVnRXhwIHdvcmtzIGNvcnJlY3Qgd2l0aCBAQG1hdGNoXG4gIHJldHVybiBOYXRpdmVSZWdFeHAocmUxKSAhPSByZTEgfHwgTmF0aXZlUmVnRXhwKHJlMikgPT0gcmUyIHx8IE5hdGl2ZVJlZ0V4cChyZTEsICdpJykgIT0gJy9hL2knO1xufSkpKTtcblxuLy8gYFJlZ0V4cGAgY29uc3RydWN0b3Jcbi8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLXJlZ2V4cC1jb25zdHJ1Y3RvclxuaWYgKEZPUkNFRCkge1xuICB2YXIgUmVnRXhwV3JhcHBlciA9IGZ1bmN0aW9uIFJlZ0V4cChwYXR0ZXJuLCBmbGFncykge1xuICAgIHZhciB0aGlzSXNSZWdFeHAgPSB0aGlzIGluc3RhbmNlb2YgUmVnRXhwV3JhcHBlcjtcbiAgICB2YXIgcGF0dGVybklzUmVnRXhwID0gaXNSZWdFeHAocGF0dGVybik7XG4gICAgdmFyIGZsYWdzQXJlVW5kZWZpbmVkID0gZmxhZ3MgPT09IHVuZGVmaW5lZDtcbiAgICB2YXIgc3RpY2t5O1xuXG4gICAgaWYgKCF0aGlzSXNSZWdFeHAgJiYgcGF0dGVybklzUmVnRXhwICYmIHBhdHRlcm4uY29uc3RydWN0b3IgPT09IFJlZ0V4cFdyYXBwZXIgJiYgZmxhZ3NBcmVVbmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBwYXR0ZXJuO1xuICAgIH1cblxuICAgIGlmIChDT1JSRUNUX05FVykge1xuICAgICAgaWYgKHBhdHRlcm5Jc1JlZ0V4cCAmJiAhZmxhZ3NBcmVVbmRlZmluZWQpIHBhdHRlcm4gPSBwYXR0ZXJuLnNvdXJjZTtcbiAgICB9IGVsc2UgaWYgKHBhdHRlcm4gaW5zdGFuY2VvZiBSZWdFeHBXcmFwcGVyKSB7XG4gICAgICBpZiAoZmxhZ3NBcmVVbmRlZmluZWQpIGZsYWdzID0gZ2V0RmxhZ3MuY2FsbChwYXR0ZXJuKTtcbiAgICAgIHBhdHRlcm4gPSBwYXR0ZXJuLnNvdXJjZTtcbiAgICB9XG5cbiAgICBpZiAoVU5TVVBQT1JURURfWSkge1xuICAgICAgc3RpY2t5ID0gISFmbGFncyAmJiBmbGFncy5pbmRleE9mKCd5JykgPiAtMTtcbiAgICAgIGlmIChzdGlja3kpIGZsYWdzID0gZmxhZ3MucmVwbGFjZSgveS9nLCAnJyk7XG4gICAgfVxuXG4gICAgdmFyIHJlc3VsdCA9IGluaGVyaXRJZlJlcXVpcmVkKFxuICAgICAgQ09SUkVDVF9ORVcgPyBuZXcgTmF0aXZlUmVnRXhwKHBhdHRlcm4sIGZsYWdzKSA6IE5hdGl2ZVJlZ0V4cChwYXR0ZXJuLCBmbGFncyksXG4gICAgICB0aGlzSXNSZWdFeHAgPyB0aGlzIDogUmVnRXhwUHJvdG90eXBlLFxuICAgICAgUmVnRXhwV3JhcHBlclxuICAgICk7XG5cbiAgICBpZiAoVU5TVVBQT1JURURfWSAmJiBzdGlja3kpIHNldEludGVybmFsU3RhdGUocmVzdWx0LCB7IHN0aWNreTogc3RpY2t5IH0pO1xuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcbiAgdmFyIHByb3h5ID0gZnVuY3Rpb24gKGtleSkge1xuICAgIGtleSBpbiBSZWdFeHBXcmFwcGVyIHx8IGRlZmluZVByb3BlcnR5KFJlZ0V4cFdyYXBwZXIsIGtleSwge1xuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBOYXRpdmVSZWdFeHBba2V5XTsgfSxcbiAgICAgIHNldDogZnVuY3Rpb24gKGl0KSB7IE5hdGl2ZVJlZ0V4cFtrZXldID0gaXQ7IH1cbiAgICB9KTtcbiAgfTtcbiAgdmFyIGtleXMgPSBnZXRPd25Qcm9wZXJ0eU5hbWVzKE5hdGl2ZVJlZ0V4cCk7XG4gIHZhciBpbmRleCA9IDA7XG4gIHdoaWxlIChrZXlzLmxlbmd0aCA+IGluZGV4KSBwcm94eShrZXlzW2luZGV4KytdKTtcbiAgUmVnRXhwUHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUmVnRXhwV3JhcHBlcjtcbiAgUmVnRXhwV3JhcHBlci5wcm90b3R5cGUgPSBSZWdFeHBQcm90b3R5cGU7XG4gIHJlZGVmaW5lKGdsb2JhbCwgJ1JlZ0V4cCcsIFJlZ0V4cFdyYXBwZXIpO1xufVxuXG4vLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1nZXQtcmVnZXhwLUBAc3BlY2llc1xuc2V0U3BlY2llcygnUmVnRXhwJyk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///1678\n")},1679:function(module,exports,__webpack_require__){eval("var api = __webpack_require__(235);\n            var content = __webpack_require__(1680);\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.i, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTY3OS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8vVXNlcnMvZXJpa19yaXR0ZXIvcmVwb3MvZ2l0aHViLmNvbS9hcGFjaGUtc3VwZXJzZXQvc3VwZXJzZXQtdWkvcGx1Z2lucy9sZWdhY3ktcGx1Z2luLWNoYXJ0LWNhbGVuZGFyL3NyYy92ZW5kb3IvZDN0aXAuY3NzPzM4ODAiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwaSA9IHJlcXVpcmUoXCIhLi4vLi4vLi4vLi4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvaW5qZWN0U3R5bGVzSW50b1N0eWxlVGFnLmpzXCIpO1xuICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSByZXF1aXJlKFwiISEuLi8uLi8uLi8uLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L2Nqcy5qcz8/cmVmLS02LTEhLi4vLi4vLi4vLi4vbm9kZV9tb2R1bGVzL3Bvc3Rjc3MtbG9hZGVyL3NyYy9pbmRleC5qcz8/cG9zdGNzcyEuL2QzdGlwLmNzc1wiKTtcblxuICAgICAgICAgICAgY29udGVudCA9IGNvbnRlbnQuX19lc01vZHVsZSA/IGNvbnRlbnQuZGVmYXVsdCA6IGNvbnRlbnQ7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29udGVudCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgY29udGVudCA9IFtbbW9kdWxlLmlkLCBjb250ZW50LCAnJ11dO1xuICAgICAgICAgICAgfVxuXG52YXIgb3B0aW9ucyA9IHt9O1xuXG5vcHRpb25zLmluc2VydCA9IFwiaGVhZFwiO1xub3B0aW9ucy5zaW5nbGV0b24gPSBmYWxzZTtcblxudmFyIHVwZGF0ZSA9IGFwaShjb250ZW50LCBvcHRpb25zKTtcblxudmFyIGV4cG9ydGVkID0gY29udGVudC5sb2NhbHMgPyBjb250ZW50LmxvY2FscyA6IHt9O1xuXG5cblxubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRlZDsiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///1679\n")},1680:function(module,exports,__webpack_require__){eval("// Imports\nvar ___CSS_LOADER_API_IMPORT___ = __webpack_require__(236);\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.i, \"/**\\n * Licensed to the Apache Software Foundation (ASF) under one\\n * or more contributor license agreements.  See the NOTICE file\\n * distributed with this work for additional information\\n * regarding copyright ownership.  The ASF licenses this file\\n * to you under the Apache License, Version 2.0 (the\\n * \\\"License\\\"); you may not use this file except in compliance\\n * with the License.  You may obtain a copy of the License at\\n *\\n *   http://www.apache.org/licenses/LICENSE-2.0\\n *\\n * Unless required by applicable law or agreed to in writing,\\n * software distributed under the License is distributed on an\\n * \\\"AS IS\\\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\\n * KIND, either express or implied.  See the License for the\\n * specific language governing permissions and limitations\\n * under the License.\\n */\\n/* from d3-tip */\\n.d3-tip {\\n  line-height: 1;\\n  padding: 12px;\\n  background: rgba(0, 0, 0, 0.8);\\n  color: #fff;\\n  border-radius: 2px;\\n  pointer-events: none;\\n  z-index: 1000;\\n}\\n\\n/* Creates a small triangle extender for the tooltip */\\n.d3-tip:after {\\n  box-sizing: border-box;\\n  display: inline;\\n  font-size: 10px;\\n  width: 100%;\\n  line-height: 1;\\n  color: rgba(0, 0, 0, 0.8);\\n  position: absolute;\\n  pointer-events: none;\\n}\\n\\n/* Northward tooltips */\\n.d3-tip.n:after {\\n  content: '\\\\25BC';\\n  margin: -1px 0 0 0;\\n  top: 100%;\\n  left: 0;\\n  text-align: center;\\n}\\n\\n/* Eastward tooltips */\\n.d3-tip.e:after {\\n  content: '\\\\25C0';\\n  margin: -4px 0 0 0;\\n  top: 50%;\\n  left: -8px;\\n}\\n\\n/* Southward tooltips */\\n.d3-tip.s:after {\\n  content: '\\\\25B2';\\n  margin: 0 0 1px 0;\\n  top: -8px;\\n  left: 0;\\n  text-align: center;\\n}\\n\\n/* Westward tooltips */\\n.d3-tip.w:after {\\n  content: '\\\\25B6';\\n  margin: -4px 0 0 -1px;\\n  top: 50%;\\n  left: 100%;\\n}\\n\", \"\"]);\n// Exports\nmodule.exports = exports;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTY4MC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8vVXNlcnMvZXJpa19yaXR0ZXIvcmVwb3MvZ2l0aHViLmNvbS9hcGFjaGUtc3VwZXJzZXQvc3VwZXJzZXQtdWkvcGx1Z2lucy9sZWdhY3ktcGx1Z2luLWNoYXJ0LWNhbGVuZGFyL3NyYy92ZW5kb3IvZDN0aXAuY3NzP2YxNWEiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gSW1wb3J0c1xudmFyIF9fX0NTU19MT0FERVJfQVBJX0lNUE9SVF9fXyA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L3J1bnRpbWUvYXBpLmpzXCIpO1xuZXhwb3J0cyA9IF9fX0NTU19MT0FERVJfQVBJX0lNUE9SVF9fXyhmYWxzZSk7XG4vLyBNb2R1bGVcbmV4cG9ydHMucHVzaChbbW9kdWxlLmlkLCBcIi8qKlxcbiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxcbiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXFxuICogXFxcIkxpY2Vuc2VcXFwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcXG4gKlxcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXFxuICpcXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXFxuICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cXG4gKiBcXFwiQVMgSVNcXFwiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcXG4gKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXFxuICogdW5kZXIgdGhlIExpY2Vuc2UuXFxuICovXFxuLyogZnJvbSBkMy10aXAgKi9cXG4uZDMtdGlwIHtcXG4gIGxpbmUtaGVpZ2h0OiAxO1xcbiAgcGFkZGluZzogMTJweDtcXG4gIGJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC44KTtcXG4gIGNvbG9yOiAjZmZmO1xcbiAgYm9yZGVyLXJhZGl1czogMnB4O1xcbiAgcG9pbnRlci1ldmVudHM6IG5vbmU7XFxuICB6LWluZGV4OiAxMDAwO1xcbn1cXG5cXG4vKiBDcmVhdGVzIGEgc21hbGwgdHJpYW5nbGUgZXh0ZW5kZXIgZm9yIHRoZSB0b29sdGlwICovXFxuLmQzLXRpcDphZnRlciB7XFxuICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xcbiAgZGlzcGxheTogaW5saW5lO1xcbiAgZm9udC1zaXplOiAxMHB4O1xcbiAgd2lkdGg6IDEwMCU7XFxuICBsaW5lLWhlaWdodDogMTtcXG4gIGNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuOCk7XFxuICBwb3NpdGlvbjogYWJzb2x1dGU7XFxuICBwb2ludGVyLWV2ZW50czogbm9uZTtcXG59XFxuXFxuLyogTm9ydGh3YXJkIHRvb2x0aXBzICovXFxuLmQzLXRpcC5uOmFmdGVyIHtcXG4gIGNvbnRlbnQ6ICdcXFxcMjVCQyc7XFxuICBtYXJnaW46IC0xcHggMCAwIDA7XFxuICB0b3A6IDEwMCU7XFxuICBsZWZ0OiAwO1xcbiAgdGV4dC1hbGlnbjogY2VudGVyO1xcbn1cXG5cXG4vKiBFYXN0d2FyZCB0b29sdGlwcyAqL1xcbi5kMy10aXAuZTphZnRlciB7XFxuICBjb250ZW50OiAnXFxcXDI1QzAnO1xcbiAgbWFyZ2luOiAtNHB4IDAgMCAwO1xcbiAgdG9wOiA1MCU7XFxuICBsZWZ0OiAtOHB4O1xcbn1cXG5cXG4vKiBTb3V0aHdhcmQgdG9vbHRpcHMgKi9cXG4uZDMtdGlwLnM6YWZ0ZXIge1xcbiAgY29udGVudDogJ1xcXFwyNUIyJztcXG4gIG1hcmdpbjogMCAwIDFweCAwO1xcbiAgdG9wOiAtOHB4O1xcbiAgbGVmdDogMDtcXG4gIHRleHQtYWxpZ246IGNlbnRlcjtcXG59XFxuXFxuLyogV2VzdHdhcmQgdG9vbHRpcHMgKi9cXG4uZDMtdGlwLnc6YWZ0ZXIge1xcbiAgY29udGVudDogJ1xcXFwyNUI2JztcXG4gIG1hcmdpbjogLTRweCAwIDAgLTFweDtcXG4gIHRvcDogNTAlO1xcbiAgbGVmdDogMTAwJTtcXG59XFxuXCIsIFwiXCJdKTtcbi8vIEV4cG9ydHNcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0cztcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///1680\n")},2304:function(module,__webpack_exports__,__webpack_require__){"use strict";eval('// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/node_modules/react/index.js\nvar react = __webpack_require__(0);\nvar react_default = /*#__PURE__*/__webpack_require__.n(react);\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/node_modules/prop-types/index.js\nvar prop_types = __webpack_require__(6);\nvar prop_types_default = /*#__PURE__*/__webpack_require__.n(prop_types);\n\n// EXTERNAL MODULE: ../superset-ui-chart/src/components/reactify.tsx\nvar reactify = __webpack_require__(1288);\n\n// EXTERNAL MODULE: ../superset-ui-style/src/index.ts\nvar src = __webpack_require__(149);\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/node_modules/d3-array/src/extent.js\nvar extent = __webpack_require__(290);\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/node_modules/d3-array/src/range.js\nvar range = __webpack_require__(283);\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/node_modules/d3-selection/src/select.js\nvar src_select = __webpack_require__(420);\n\n// EXTERNAL MODULE: ../superset-ui-color/src/SequentialSchemeRegistrySingleton.ts\nvar SequentialSchemeRegistrySingleton = __webpack_require__(398);\n\n// EXTERNAL MODULE: ../superset-ui-number-format/src/NumberFormatterRegistrySingleton.ts + 2 modules\nvar NumberFormatterRegistrySingleton = __webpack_require__(103);\n\n// EXTERNAL MODULE: ../superset-ui-time-format/src/TimeFormatterRegistrySingleton.ts + 5 modules\nvar TimeFormatterRegistrySingleton = __webpack_require__(100);\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/node_modules/core-js/modules/es.array.reverse.js\nvar es_array_reverse = __webpack_require__(1325);\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/node_modules/core-js/modules/es.regexp.constructor.js\nvar es_regexp_constructor = __webpack_require__(1678);\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/node_modules/core-js/modules/es.regexp.to-string.js\nvar es_regexp_to_string = __webpack_require__(77);\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/node_modules/core-js/modules/es.string.replace.js\nvar es_string_replace = __webpack_require__(187);\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/node_modules/core-js/modules/es.string.split.js\nvar es_string_split = __webpack_require__(409);\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/node_modules/core-js/modules/es.string.trim.js\nvar es_string_trim = __webpack_require__(653);\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/node_modules/core-js/modules/web.dom-collections.iterator.js\nvar web_dom_collections_iterator = __webpack_require__(30);\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/node_modules/d3-tip/index.js\nvar d3_tip = __webpack_require__(416);\n\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/plugins/legacy-plugin-chart-calendar/src/vendor/d3tip.css\nvar d3tip = __webpack_require__(1679);\n\n// CONCATENATED MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.js\n// [LICENSE TBD]\n/* Copied and altered from http://cal-heatmap.com/ , alterations around:\n * - tuning tooltips\n * - supporting multi-colors scales\n * - legend format\n * - UTC handling\n */ /* eslint-disable */var d3= true?__webpack_require__(107):undefined,d3= true?__webpack_require__(107):undefined,CalHeatMap=function(){\'use strict\';var self=this;self.tip=Object(d3_tip["a" /* default */])().attr("class","d3-tip").direction("n").offset([-5,0]).html(d=>"\\n      ".concat(self.options.timeFormatter(d.t),": <strong>").concat(self.options.valueFormatter(d.v),"</strong>\\n    "));self.legendTip=Object(d3_tip["a" /* default */])().attr("class","d3-tip").direction("n").offset([-5,0]).html(d=>self.options.valueFormatter(d));this.allowedDataType=["json","csv","tsv","txt"];// Default settings\nthis.options={// selector string of the container to append the graph to\n// Accept any string value accepted by document.querySelector or CSS3\n// or an Element object\nitemSelector:"#cal-heatmap",// Whether to paint the calendar on init()\n// Used by testsuite to reduce testing time\npaintOnLoad:!0,// ================================================\n// DOMAIN\n// ================================================\n// Number of domain to display on the graph\nrange:12,// Size of each cell, in pixel\ncellSize:10,// Padding between each cell, in pixel\ncellPadding:2,// For rounded subdomain rectangles, in pixels\ncellRadius:0,domainGutter:2,domainMargin:[0,0,0,0],valueFormatter:d=>d,timeFormatter:d=>d,domain:"hour",subDomain:"min",// Number of columns to split the subDomains to\n// If not null, will takes precedence over rowLimit\ncolLimit:null,// Number of rows to split the subDomains to\n// Will be ignored if colLimit is not null\nrowLimit:null,// First day of the week is Monday\n// 0 to start the week on Sunday\nweekStartOnMonday:!0,// Start date of the graph\n// @default now\nstart:new Date,minDate:null,maxDate:null,// ================================================\n// DATA\n// ================================================\n// Data source\n// URL, where to fetch the original datas\ndata:"",// Data type\n// Default: json\ndataType:this.allowedDataType[0],// Payload sent when using POST http method\n// Leave to null (default) for GET request\n// Expect a string, formatted like "a=b;c=d"\ndataPostPayload:null,// Additional headers sent when requesting data\n// Expect an object formatted like:\n// { \'X-CSRF-TOKEN\': \'token\' }\ndataRequestHeaders:null,// Whether to consider missing date:value from the datasource\n// as equal to 0, or just leave them as missing\nconsiderMissingDataAsZero:!1,// Load remote data on calendar creation\n// When false, the calendar will be left empty\nloadOnInit:!0,// Calendar orientation\n// false: display domains side by side\n// true : display domains one under the other\nverticalOrientation:!1,// Domain dynamic width/height\n// The width on a domain depends on the number of\ndomainDynamicDimension:!0,// Domain Label properties\nlabel:{// valid: top, right, bottom, left\nposition:"bottom",// Valid: left, center, right\n// Also valid are the direct svg values: start, middle, end\nalign:"center",// By default, there is no margin/padding around the label\noffset:{x:0,y:0},rotate:null,// Used only on vertical orientation\nwidth:100,// Used only on horizontal orientation\nheight:null},// ================================================\n// LEGEND\n// ================================================\n// Threshold for the legend\nlegend:[10,20,30,40],// Whether to display the legend\ndisplayLegend:!0,legendCellSize:10,legendCellPadding:2,legendMargin:[0,0,0,0],// Legend vertical position\n// top: place legend above calendar\n// bottom: place legend below the calendar\nlegendVerticalPosition:"bottom",// Legend horizontal position\n// accepted values: left, center, right\nlegendHorizontalPosition:"left",// Legend rotation\n// accepted values: horizontal, vertical\nlegendOrientation:"horizontal",// Objects holding all the heatmap different colors\n// null to disable, and use the default css styles\n//\n// Examples:\n// legendColors: {\n//    min: "green",\n//    max: "red",\n//    empty: "#ffffff",\n//    base: "grey",\n//    overflow: "red",\n//    colorScaler: null,\n// }\nlegendColors:null,// ================================================\n// HIGHLIGHT\n// ================================================\n// List of dates to highlight\n// Valid values:\n// - []: don\'t highlight anything\n// - "now": highlight the current date\n// - an array of Date objects: highlight the specified dates\nhighlight:[],// ================================================\n// TEXT FORMATTING / i18n\n// ================================================\n// Name of the items to represent in the calendar\nitemName:["item","items"],// Formatting of the domain label\n// @default: null, will use the formatting according to domain type\n// Accept a string used as specifier by d3.time.format()\n// or a function\n//\n// Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n// for accepted date formatting used by d3.time.format()\ndomainLabelFormat:null,// Formatting of the title displayed when hovering a subDomain cell\nsubDomainTitleFormat:{empty:"{date}",filled:"{count} {name} {connector} {date}"},// Formatting of the {date} used in subDomainTitleFormat\n// @default: null, will use the formatting according to subDomain type\n// Accept a string used as specifier by d3.time.format()\n// or a function\n//\n// Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n// for accepted date formatting used by d3.time.format()\nsubDomainDateFormat:null,// Formatting of the text inside each subDomain cell\n// @default: null, no text\n// Accept a string used as specifier by d3.time.format()\n// or a function\n//\n// Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n// for accepted date formatting used by d3.time.format()\nsubDomainTextFormat:null,// Formatting of the title displayed when hovering a legend cell\nlegendTitleFormat:{lower:"less than {min} {name}",inner:"between {down} and {up} {name}",upper:"more than {max} {name}"},// Animation duration, in ms\nanimationDuration:500,nextSelector:!1,previousSelector:!1,itemNamespace:"cal-heatmap",tooltip:!1,// ================================================\n// EVENTS CALLBACK\n// ================================================\n// Callback when clicking on a time block\nonClick:null,// Callback after painting the empty calendar\n// Can be used to trigger an API call, once the calendar is ready to be filled\nafterLoad:null,// Callback after loading the next domain in the calendar\nafterLoadNextDomain:null,// Callback after loading the previous domain in the calendar\nafterLoadPreviousDomain:null,// Callback after finishing all actions on the calendar\nonComplete:null,// Callback after fetching the datas, but before applying them to the calendar\n// Used mainly to convert the datas if they\'re not formatted like expected\n// Takes the fetched "data" object as argument, must return a json object\n// formatted like {timestamp:count, timestamp2:count2},\nafterLoadData:function afterLoadData(data){return data},// Callback triggered after calling and completing update().\nafterUpdate:null,// Callback triggered after calling next().\n// The `status` argument is equal to true if there is no\n// more next domain to load\n//\n// This callback is also executed once, after calling previous(),\n// only when the max domain is reached\nonMaxDomainReached:null,// Callback triggered after calling previous().\n// The `status` argument is equal to true if there is no\n// more previous domain to load\n//\n// This callback is also executed once, after calling next(),\n// only when the min domain is reached\nonMinDomainReached:null};this._domainType={min:{name:"minute",level:10,maxItemNumber:60,defaultRowNumber:10,defaultColumnNumber:6,row:function row(d){return self.getSubDomainRowNumber(d)},column:function column(d){return self.getSubDomainColumnNumber(d)},position:{x:function x(d){return Math.floor(d.getMinutes()/self._domainType.min.row(d))},y:function y(d){return d.getMinutes()%self._domainType.min.row(d)}},format:{date:"%H:%M, %A %B %-e, %Y",legend:"",connector:"at"},extractUnit:function extractUnit(d){return new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours(),d.getMinutes()).getTime()}},hour:{name:"hour",level:20,maxItemNumber:function maxItemNumber(d){switch(self.options.domain){case"day":return 24;case"week":return 168;case"month":return 24*(self.options.domainDynamicDimension?self.getDayCountInMonth(d):31);}},defaultRowNumber:6,defaultColumnNumber:function defaultColumnNumber(d){switch(self.options.domain){case"day":return 4;case"week":return 28;case"month":return self.options.domainDynamicDimension?self.getDayCountInMonth(d):31;}},row:function row(d){return self.getSubDomainRowNumber(d)},column:function column(d){return self.getSubDomainColumnNumber(d)},position:{x:function x(d){if("month"===self.options.domain){if(0<self.options.colLimit||0<self.options.rowLimit){return Math.floor((d.getHours()+24*(d.getDate()-1))/self._domainType.hour.row(d))}return Math.floor(d.getHours()/self._domainType.hour.row(d))+4*(d.getDate()-1)}else if("week"===self.options.domain){if(0<self.options.colLimit||0<self.options.rowLimit){return Math.floor((d.getHours()+24*self.getWeekDay(d))/self._domainType.hour.row(d))}return Math.floor(d.getHours()/self._domainType.hour.row(d))+4*self.getWeekDay(d)}return Math.floor(d.getHours()/self._domainType.hour.row(d))},y:function y(d){var p=d.getHours();if(0<self.options.colLimit||0<self.options.rowLimit){switch(self.options.domain){case"month":p+=24*(d.getDate()-1);break;case"week":p+=24*self.getWeekDay(d);break;}}return Math.floor(p%self._domainType.hour.row(d))}},format:{date:"%Hh, %A %B %-e, %Y",legend:"%H:00",connector:"at"},extractUnit:function extractUnit(d){return new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours()).getTime()}},day:{name:"day",level:30,maxItemNumber:function maxItemNumber(d){switch(self.options.domain){case"week":return 7;case"month":return self.options.domainDynamicDimension?self.getDayCountInMonth(d):31;case"year":return self.options.domainDynamicDimension?self.getDayCountInYear(d):366;}},defaultColumnNumber:function defaultColumnNumber(d){d=new Date(d);switch(self.options.domain){case"week":return 1;case"month":return self.options.domainDynamicDimension&&!self.options.verticalOrientation?self.getWeekNumber(new Date(d.getFullYear(),d.getMonth()+1,0))-self.getWeekNumber(d)+1:6;case"year":return self.options.domainDynamicDimension?self.getWeekNumber(new Date(d.getFullYear(),11,31))-self.getWeekNumber(new Date(d.getFullYear(),0))+1:54;}},defaultRowNumber:7,row:function row(d){return self.getSubDomainRowNumber(d)},column:function column(d){return self.getSubDomainColumnNumber(d)},position:{x:function x(d){switch(self.options.domain){case"week":return Math.floor(self.getWeekDay(d)/self._domainType.day.row(d));case"month":if(0<self.options.colLimit||0<self.options.rowLimit){return Math.floor((d.getDate()-1)/self._domainType.day.row(d))}return self.getWeekNumber(d)-self.getWeekNumber(new Date(d.getFullYear(),d.getMonth()));case"year":if(0<self.options.colLimit||0<self.options.rowLimit){return Math.floor((self.getDayOfYear(d)-1)/self._domainType.day.row(d))}return self.getWeekNumber(d);}},y:function y(d){var p=self.getWeekDay(d);if(0<self.options.colLimit||0<self.options.rowLimit){switch(self.options.domain){case"year":p=self.getDayOfYear(d)-1;break;case"week":p=self.getWeekDay(d);break;case"month":p=d.getDate()-1;break;}}return Math.floor(p%self._domainType.day.row(d))}},format:{date:"%A %B %-e, %Y",legend:"%e %b",connector:"on"},extractUnit:function extractUnit(d){return new Date(d.getFullYear(),d.getMonth(),d.getDate()).getTime()}},week:{name:"week",level:40,maxItemNumber:54,defaultColumnNumber:function defaultColumnNumber(d){d=new Date(d);switch(self.options.domain){case"year":return self._domainType.week.maxItemNumber;case"month":return self.options.domainDynamicDimension?self.getWeekNumber(new Date(d.getFullYear(),d.getMonth()+1,0))-self.getWeekNumber(d):5;}},defaultRowNumber:1,row:function row(d){return self.getSubDomainRowNumber(d)},column:function column(d){return self.getSubDomainColumnNumber(d)},position:{x:function x(d){switch(self.options.domain){case"year":return Math.floor(self.getWeekNumber(d)/self._domainType.week.row(d));case"month":return Math.floor(self.getMonthWeekNumber(d)/self._domainType.week.row(d));}},y:function y(d){return self.getWeekNumber(d)%self._domainType.week.row(d)}},format:{date:"%B Week #%W",legend:"%B Week #%W",connector:"in"},extractUnit:function extractUnit(d){var dt=new Date(d.getFullYear(),d.getMonth(),d.getDate()),weekDay=dt.getDay()-(self.options.weekStartOnMonday?1:0);// According to ISO-8601, week number computation are based on week starting on Monday\nif(0>weekDay){weekDay=6}dt.setDate(dt.getDate()-weekDay);return dt.getTime()}},month:{name:"month",level:50,maxItemNumber:12,defaultColumnNumber:12,defaultRowNumber:1,row:function row(){return self.getSubDomainRowNumber()},column:function column(){return self.getSubDomainColumnNumber()},position:{x:function x(d){return Math.floor(d.getMonth()/self._domainType.month.row(d))},y:function y(d){return d.getMonth()%self._domainType.month.row(d)}},format:{date:"%B %Y",legend:"%B",connector:"in"},extractUnit:function extractUnit(d){return new Date(d.getFullYear(),d.getMonth()).getTime()}},year:{name:"year",level:60,row:function row(){return self.options.rowLimit||1},column:function column(){return self.options.colLimit||1},position:{x:function x(){return 1},y:function y(){return 1}},format:{date:"%Y",legend:"%Y",connector:"in"},extractUnit:function extractUnit(d){return new Date(d.getFullYear()).getTime()}}};for(var type in this._domainType){if(this._domainType.hasOwnProperty(type)){var d=this._domainType[type];this._domainType["x_"+type]={name:"x_"+type,level:d.type,maxItemNumber:d.maxItemNumber,defaultRowNumber:d.defaultRowNumber,defaultColumnNumber:d.defaultColumnNumber,row:d.column,column:d.row,position:{x:d.position.y,y:d.position.x},format:d.format,extractUnit:d.extractUnit}}}// Record the address of the last inserted domain when browsing\nthis.lastInsertedSvg=null;this._completed=!1;// Record all the valid domains\n// Each domain value is a timestamp in milliseconds\nthis._domains=d3.map();this.graphDim={width:0,height:0};this.legendDim={width:0,height:0};this.NAVIGATE_LEFT=1;this.NAVIGATE_RIGHT=2;// Various update mode when using the update() API\nthis.RESET_ALL_ON_UPDATE=0;this.RESET_SINGLE_ON_UPDATE=1;this.APPEND_ON_UPDATE=2;this.DEFAULT_LEGEND_MARGIN=10;this.root=null;this.tooltip=null;this._maxDomainReached=!1;this._minDomainReached=!1;this.domainPosition=new DomainPosition;this.Legend=null;this.legendScale=null;// List of domains that are skipped because of DST\n// All times belonging to these domains should be re-assigned to the previous domain\nthis.DSTDomain=[];/**\n   * Display the graph for the first time\n   * @return bool True if the calendar is created\n   */this._init=function(){self.getDomain(self.options.start).map(function(d){return d.getTime()}).map(function(d){self._domains.set(d,self.getSubDomain(d).map(function(d){return{t:self._domainType[self.options.subDomain].extractUnit(d),v:null}}))});self.root=d3.select(self.options.itemSelector).append("svg").attr("class","cal-heatmap-container");self.root.attr("x",0).attr("y",0).append("svg").attr("class","graph");self.Legend=new Legend(self);if(self.options.paintOnLoad){_initCalendar()}self.root.call(self.tip);self.root.call(self.legendTip);return!0};function _initCalendar(){self.verticalDomainLabel="top"===self.options.label.position||"bottom"===self.options.label.position;self.domainVerticalLabelHeight=null===self.options.label.height?Math.max(25,2*self.options.cellSize):self.options.label.height;self.domainHorizontalLabelWidth=0;if(""===self.options.domainLabelFormat&&null===self.options.label.height){self.domainVerticalLabelHeight=0}if(!self.verticalDomainLabel){self.domainVerticalLabelHeight=0;self.domainHorizontalLabelWidth=self.options.label.width}self.paint();// =========================================================================//\n// ATTACHING DOMAIN NAVIGATION EVENT                    //\n// =========================================================================//\nif(!1!==self.options.nextSelector){d3.select(self.options.nextSelector).on("click."+self.options.itemNamespace,function(){d3.event.preventDefault();return self.loadNextDomain(1)})}if(!1!==self.options.previousSelector){d3.select(self.options.previousSelector).on("click."+self.options.itemNamespace,function(){d3.event.preventDefault();return self.loadPreviousDomain(1)})}self.Legend.redraw(self.graphDim.width-self.options.domainGutter-self.options.cellPadding);self.afterLoad();var domains=self.getDomainKeys();// Fill the graph with some datas\nif(self.options.loadOnInit){self.getDatas(self.options.data,new Date(domains[0]),self.getSubDomain(domains[domains.length-1]).pop(),function(){self.fill();self.onComplete()})}else{self.onComplete()}self.checkIfMinDomainIsReached(domains[0]);self.checkIfMaxDomainIsReached(self.getNextDomain().getTime())}// Return the width of the domain block, without the domain gutter\n// @param int d Domain start timestamp\nfunction w(d,outer){var width=self.options.cellSize*self._domainType[self.options.subDomain].column(d)+self.options.cellPadding*self._domainType[self.options.subDomain].column(d);if(2===arguments.length&&!0===outer){return width+=self.domainHorizontalLabelWidth+self.options.domainGutter+self.options.domainMargin[1]+self.options.domainMargin[3]}return width}// Return the height of the domain block, without the domain gutter\nfunction h(d,outer){var height=self.options.cellSize*self._domainType[self.options.subDomain].row(d)+self.options.cellPadding*self._domainType[self.options.subDomain].row(d);if(2===arguments.length&&!0===outer){height+=self.options.domainGutter+self.domainVerticalLabelHeight+self.options.domainMargin[0]+self.options.domainMargin[2]}return height}/**\n   *\n   *\n   * @param int navigationDir\n   */this.paint=function(navigationDir){var options=self.options;if(0===arguments.length){navigationDir=!1}// Painting all the domains\nvar domainSvg=self.root.select(".graph").selectAll(".graph-domain").data(function(){var data=self.getDomainKeys();return navigationDir===self.NAVIGATE_LEFT?data.reverse():data},function(d){return d}),enteringDomainDim=0,exitingDomainDim=0,svg=domainSvg.enter().append("svg").attr("width",function(d){return w(d,!0)}).attr("height",function(d){return h(d,!0)}).attr("x",function(d){if(options.verticalOrientation){self.graphDim.width=Math.max(self.graphDim.width,w(d,!0));return 0}else{return getDomainPosition(d,self.graphDim,"width",w(d,!0))}}).attr("y",function(d){if(options.verticalOrientation){return getDomainPosition(d,self.graphDim,"height",h(d,!0))}else{self.graphDim.height=Math.max(self.graphDim.height,h(d,!0));return 0}}).attr("class",function(d){var classname="graph-domain",date=new Date(d);switch(options.domain){case"hour":classname+=" h_"+date.getHours();/* falls through */case"day":classname+=" d_"+date.getDate()+" dy_"+date.getDay();/* falls through */case"week":classname+=" w_"+self.getWeekNumber(date);/* falls through */case"month":classname+=" m_"+(date.getMonth()+1);/* falls through */case"year":classname+=" y_"+date.getFullYear();}return classname});self.lastInsertedSvg=svg;function getDomainPosition(domainIndex,graphDim,axis,domainDim){var tmp=0;switch(navigationDir){case!1:tmp=graphDim[axis];graphDim[axis]+=domainDim;self.domainPosition.setPosition(domainIndex,tmp);return tmp;case self.NAVIGATE_RIGHT:self.domainPosition.setPosition(domainIndex,graphDim[axis]);enteringDomainDim=domainDim;exitingDomainDim=self.domainPosition.getPositionFromIndex(1);self.domainPosition.shiftRightBy(exitingDomainDim);return graphDim[axis];case self.NAVIGATE_LEFT:tmp=-domainDim;enteringDomainDim=-tmp;exitingDomainDim=graphDim[axis]-self.domainPosition.getLast();self.domainPosition.setPosition(domainIndex,tmp);self.domainPosition.shiftLeftBy(enteringDomainDim);return tmp;}}svg.append("rect").attr("width",function(d){return w(d,!0)-options.domainGutter-options.cellPadding}).attr("height",function(d){return h(d,!0)-options.domainGutter-options.cellPadding}).attr("class","domain-background");// =========================================================================//\n// PAINTING SUBDOMAINS                            //\n// =========================================================================//\nvar subDomainSvgGroup=svg.append("svg").attr("x",function(){if("left"===options.label.position){return self.domainHorizontalLabelWidth+options.domainMargin[3]}else{return options.domainMargin[3]}}).attr("y",function(){if("top"===options.label.position){return self.domainVerticalLabelHeight+options.domainMargin[0]}else{return options.domainMargin[0]}}).attr("class","graph-subdomain-group"),rect=subDomainSvgGroup.selectAll("g").data(function(d){return self._domains.get(d)}).enter().append("g");rect.append("rect").attr("class",function(d){return"graph-rect"+self.getHighlightClassName(d.t)+(null!==options.onClick?" hover_cursor":"")}).attr("width",options.cellSize).attr("height",options.cellSize).attr("x",function(d){return self.positionSubDomainX(d.t)}).attr("y",function(d){return self.positionSubDomainY(d.t)}).on("click",function(d){if(null!==options.onClick){return self.onClick(new Date(d.t),d.v)}}).call(function(selection){if(0<options.cellRadius){selection.attr("rx",options.cellRadius).attr("ry",options.cellRadius)}if(null!==self.legendScale&&null!==options.legendColors&&options.legendColors.hasOwnProperty("base")){selection.attr("fill",options.legendColors.base)}if(options.tooltip){selection.on("mouseover",function(d){self.tip.show(d,this)}).on("mouseout",function(){self.tip.hide(d)})}});// Appending a title to each subdomain\nif(!options.tooltip){rect.append("title").text(function(d){return self.formatDate(new Date(d.t),options.subDomainDateFormat)})}// =========================================================================//\n// PAINTING LABEL                              //\n// =========================================================================//\nif(""!==options.domainLabelFormat){svg.append("text").attr("class","graph-label").attr("y",function(d){var y=options.domainMargin[0];switch(options.label.position){case"top":y+=self.domainVerticalLabelHeight/2;break;case"bottom":y+=h(d)+self.domainVerticalLabelHeight/2;}return y+options.label.offset.y*("right"===options.label.rotate&&"right"===options.label.position||"left"===options.label.rotate&&"left"===options.label.position?-1:1)}).attr("x",function(d){var x=options.domainMargin[3];switch(options.label.position){case"right":x+=w(d);break;case"bottom":case"top":x+=w(d)/2;}if("right"===options.label.align){return x+self.domainHorizontalLabelWidth-options.label.offset.x*("right"===options.label.rotate?-1:1)}return x+options.label.offset.x}).attr("text-anchor",function(){switch(options.label.align){case"start":case"left":return"start";case"end":case"right":return"end";default:return"middle";}}).attr("dominant-baseline",function(){return self.verticalDomainLabel?"middle":"top"}).text(function(d){return self.formatDate(new Date(d),options.domainLabelFormat)}).call(domainRotate)}function domainRotate(selection){switch(options.label.rotate){case"right":selection.attr("transform",function(d){var s="rotate(90), ";switch(options.label.position){case"right":s+="translate(-"+w(d)+" , -"+w(d)+")";break;case"left":s+="translate(0, -"+self.domainHorizontalLabelWidth+")";break;}return s});break;case"left":selection.attr("transform",function(d){var s="rotate(270), ";switch(options.label.position){case"right":s+="translate(-"+(w(d)+self.domainHorizontalLabelWidth)+" , "+w(d)+")";break;case"left":s+="translate(-"+self.domainHorizontalLabelWidth+" , "+self.domainHorizontalLabelWidth+")";break;}return s});break;}}// =========================================================================//\n// PAINTING DOMAIN SUBDOMAIN CONTENT                    //\n// =========================================================================//\nif(null!==options.subDomainTextFormat){rect.append("text").attr("class",function(d){return"subdomain-text"+self.getHighlightClassName(d.t)}).attr("x",function(d){return self.positionSubDomainX(d.t)+options.cellSize/2}).attr("y",function(d){return self.positionSubDomainY(d.t)+options.cellSize/2}).attr("text-anchor","middle").attr("dominant-baseline","central").text(function(d){return self.formatDate(new Date(d.t),options.subDomainTextFormat)})}// =========================================================================//\n// ANIMATION                                //\n// =========================================================================//\nif(!1!==navigationDir){domainSvg.transition().duration(options.animationDuration).attr("x",function(d){return options.verticalOrientation?0:self.domainPosition.getPosition(d)}).attr("y",function(d){return options.verticalOrientation?self.domainPosition.getPosition(d):0})}var tempWidth=self.graphDim.width,tempHeight=self.graphDim.height;if(options.verticalOrientation){self.graphDim.height+=enteringDomainDim-exitingDomainDim}else{self.graphDim.width+=enteringDomainDim-exitingDomainDim}// At the time of exit, domainsWidth and domainsHeight already automatically shifted\ndomainSvg.exit().transition().duration(options.animationDuration).attr("x",function(d){if(options.verticalOrientation){return 0}else{switch(navigationDir){case self.NAVIGATE_LEFT:return Math.min(self.graphDim.width,tempWidth);case self.NAVIGATE_RIGHT:return-w(d,!0);}}}).attr("y",function(d){if(options.verticalOrientation){switch(navigationDir){case self.NAVIGATE_LEFT:return Math.min(self.graphDim.height,tempHeight);case self.NAVIGATE_RIGHT:return-h(d,!0);}}else{return 0}}).remove();// Resize the root container\nself.resize()}};CalHeatMap.prototype={/**\n   * Validate and merge user settings with default settings\n   *\n   * @param  {object} settings User settings\n   * @return {bool} False if settings contains error\n   */ /* jshint maxstatements:false */init:function init(settings){\'use strict\';var parent=this,options=parent.options=mergeRecursive(parent.options,settings);// Fatal errors\n// Stop script execution on error\n(/**\n     * Ensure that the domain and subdomain are valid\n     *\n     * @throw {Error} when domain or subdomain are not valid\n     * @return {bool} True if domain and subdomain are valid and compatible\n     */function(){if(!parent._domainType.hasOwnProperty(options.domain)||"min"===options.domain||"x_"===options.domain.substring(0,2)){throw new Error("The domain \'"+options.domain+"\' is not valid")}if(!parent._domainType.hasOwnProperty(options.subDomain)||"year"===options.subDomain){throw new Error("The subDomain \'"+options.subDomain+"\' is not valid")}if(parent._domainType[options.domain].level<=parent._domainType[options.subDomain].level){throw new Error("\'"+options.subDomain+"\' is not a valid subDomain to \'"+options.domain+"\'")}return!0}/**\n     * Fine-tune the label alignement depending on its position\n     *\n     * @return void\n     */)();validateSelector(options.itemSelector,!1,"itemSelector");if(-1===parent.allowedDataType.indexOf(options.dataType)){throw new Error("The data type \'"+options.dataType+"\' is not valid data type")}if(null===d3.select(options.itemSelector)[0][0]){throw new Error("The node \'"+options.itemSelector+"\' specified in itemSelector does not exists")}try{validateSelector(options.nextSelector,!0,"nextSelector");validateSelector(options.previousSelector,!0,"previousSelector")}catch(error){console.log(error.message);return!1}// If other settings contains error, will fallback to default\nif(!settings.hasOwnProperty("subDomain")){this.options.subDomain=getOptimalSubDomain(settings.domain)}if("string"!=typeof options.itemNamespace||""===options.itemNamespace){console.log("itemNamespace can not be empty, falling back to cal-heatmap");options.itemNamespace="cal-heatmap"}// Don\'t touch these settings\nvar s=["data","onComplete","onClick","afterLoad","afterLoadData","afterLoadPreviousDomain","afterLoadNextDomain","afterUpdate"];for(var k in s){if(settings.hasOwnProperty(s[k])){options[s[k]]=settings[s[k]]}}options.subDomainDateFormat="string"==typeof options.subDomainDateFormat||"function"==typeof options.subDomainDateFormat?options.subDomainDateFormat:this._domainType[options.subDomain].format.date;options.domainLabelFormat="string"==typeof options.domainLabelFormat||"function"==typeof options.domainLabelFormat?options.domainLabelFormat:this._domainType[options.domain].format.legend;options.subDomainTextFormat="string"==typeof options.subDomainTextFormat&&""!==options.subDomainTextFormat||"function"==typeof options.subDomainTextFormat?options.subDomainTextFormat:null;options.domainMargin=expandMarginSetting(options.domainMargin);options.legendMargin=expandMarginSetting(options.legendMargin);options.highlight=parent.expandDateSetting(options.highlight);options.itemName=/**\n     * Convert a string to an array like [singular-form, plural-form]\n     *\n     * @param  {string|array} value Date to convert\n     * @return {array}       An array like [singular-form, plural-form]\n     */function(value){if("string"==typeof value){return[value,value+(""!==value?"s":"")]}if(Array.isArray(value)){if(1===value.length){return[value[0],value[0]+"s"]}else if(2<value.length){return value.slice(0,2)}return value}return["item","items"]}(options.itemName);options.colLimit=function(value){return 0<value?value:null}(options.colLimit);options.rowLimit=function(value){if(0<value&&0<options.colLimit){console.log("colLimit and rowLimit are mutually exclusive, rowLimit will be ignored");return null}return 0<value?value:null}(options.rowLimit);if(!settings.hasOwnProperty("legendMargin")){autoAddLegendMargin()}(function(){// Auto-align label, depending on it\'s position\nif(!settings.hasOwnProperty("label")||settings.hasOwnProperty("label")&&!settings.label.hasOwnProperty("align")){switch(options.label.position){case"left":options.label.align="right";break;case"right":options.label.align="left";break;default:options.label.align="center";}if("left"===options.label.rotate){options.label.align="right"}else if("right"===options.label.rotate){options.label.align="left"}}if(!settings.hasOwnProperty("label")||settings.hasOwnProperty("label")&&!settings.label.hasOwnProperty("offset")){if("left"===options.label.position||"right"===options.label.position){options.label.offset={x:10,y:15}}}}/**\n     * If not specified, add some margin around the legend depending on its position\n     *\n     * @return void\n     */)();/**\n     * Validate that a queryString is valid\n     *\n     * @param  {Element|string|bool} selector   The queryString to test\n     * @param  {bool}  canBeFalse  Whether false is an accepted and valid value\n     * @param  {string} name    Name of the tested selector\n     * @throws {Error}        If the selector is not valid\n     * @return {bool}        True if the selector is a valid queryString\n     */function validateSelector(selector,canBeFalse,name){if((canBeFalse&&!1===selector||selector instanceof Element||"string"==typeof selector)&&""!==selector){return!0}throw new Error("The "+name+" is not valid")}/**\n     * Return the optimal subDomain for the specified domain\n     *\n     * @param  {string} domain a domain name\n     * @return {string}        the subDomain name\n     */function getOptimalSubDomain(domain){switch(domain){case"year":return"month";case"month":return"day";case"week":return"day";case"day":return"hour";default:return"min";}}function autoAddLegendMargin(){switch(options.legendVerticalPosition){case"top":options.legendMargin[2]=parent.DEFAULT_LEGEND_MARGIN;break;case"bottom":options.legendMargin[0]=parent.DEFAULT_LEGEND_MARGIN;break;case"middle":case"center":options.legendMargin["right"===options.legendHorizontalPosition?3:1]=parent.DEFAULT_LEGEND_MARGIN;}}/**\n     * Expand a number of an array of numbers to an usable 4 values array\n     *\n     * @param  {integer|array} value\n     * @return {array}        array\n     */function expandMarginSetting(value){if("number"==typeof value){value=[value]}if(!Array.isArray(value)){console.log("Margin only takes an integer or an array of integers");value=[0]}switch(value.length){case 1:return[value[0],value[0],value[0],value[0]];case 2:return[value[0],value[1],value[0],value[1]];case 3:return[value[0],value[1],value[2],value[1]];case 4:return value;default:return value.slice(0,4);}}return this._init()},/**\n   * Convert a keyword or an array of keyword/date to an array of date objects\n   *\n   * @param  {string|array|Date} value Data to convert\n   * @return {array}       An array of Dates\n   */expandDateSetting:function expandDateSetting(value){\'use strict\';if(!Array.isArray(value)){value=[value]}return value.map(function(data){if("now"===data){return new Date}if(data instanceof Date){return data}return!1}).filter(function(d){return!1!==d})},/**\n   * Fill the calendar by coloring the cells\n   *\n   * @param array svg An array of html node to apply the transformation to (optional)\n   *                  It\'s used to limit the painting to only a subset of the calendar\n   * @return void\n   */fill:function fill(svg){\'use strict\';var parent=this,options=parent.options;if(0===arguments.length){svg=parent.root.selectAll(".graph-domain")}var rect=svg.selectAll("svg").selectAll("g").data(function(d){return parent._domains.get(d)});/**\n     * Colorize the cell via a style attribute if enabled\n     */rect.transition().duration(options.animationDuration).select("rect").attr("class",function(d){var htmlClass=parent.getHighlightClassName(d.t).trim().split(" "),pastDate=parent.dateIsLessThan(d.t,new Date),sameDate=parent.dateIsEqual(d.t,new Date);if(null===parent.legendScale||null===d.v&&options.hasOwnProperty("considerMissingDataAsZero")&&!options.considerMissingDataAsZero&&!options.legendColors.hasOwnProperty("base")){htmlClass.push("graph-rect")}if(sameDate){htmlClass.push("now")}else if(!pastDate){htmlClass.push("future")}if(null!==d.v){htmlClass.push(parent.Legend.getClass(d.v,null===parent.legendScale))}else if(options.considerMissingDataAsZero&&pastDate){htmlClass.push(parent.Legend.getClass(0,null===parent.legendScale))}if(null!==options.onClick){htmlClass.push("hover_cursor")}return htmlClass.join(" ")}).call(function(element){if(null===parent.legendScale){return!1}element.attr("fill",function(d){if(null===d.v&&options.hasOwnProperty("considerMissingDataAsZero")&&!options.considerMissingDataAsZero){if(options.legendColors.hasOwnProperty("base")){return options.legendColors.base}}if(null!==options.legendColors&&options.legendColors.hasOwnProperty("empty")&&(0===d.v||null===d.v&&options.hasOwnProperty("considerMissingDataAsZero")&&options.considerMissingDataAsZero)){return options.legendColors.empty}if(0>d.v&&0<options.legend[0]&&null!==options.legendColors&&options.legendColors.hasOwnProperty("overflow")){return options.legendColors.overflow}return parent.legendScale(Math.min(d.v,options.legend[options.legend.length-1]))})});rect.transition().duration(options.animationDuration).select("title").text(function(d){return parent.getSubDomainTitle(d)});/**\n     * Change the subDomainText class if necessary\n     * Also change the text, e.g when text is representing the value\n     * instead of the date\n     */rect.transition().duration(options.animationDuration).select("text").attr("class",function(d){return"subdomain-text"+parent.getHighlightClassName(d.t)}).call(function(element){if("function"==typeof options.subDomainTextFormat){element.text(function(d){return options.subDomainTextFormat(d.t,d.v)})}})},/**\n   * Sprintf like function.\n   * Replaces placeholders {0} in string with values from provided object.\n   *\n   * @param string formatted String containing placeholders.\n   * @param object args Object with properties to replace placeholders in string.\n   *\n   * @return String\n   */formatStringWithObject:function formatStringWithObject(formatted,args){\'use strict\';for(var prop in args){if(args.hasOwnProperty(prop)){var regexp=new RegExp("\\\\{"+prop+"\\\\}","gi");formatted=formatted.replace(regexp,args[prop])}}return formatted},// =========================================================================//\n// EVENTS CALLBACK                              //\n// =========================================================================//\n/**\n   * Helper method for triggering event callback\n   *\n   * @param  string  eventName       Name of the event to trigger\n   * @param  array  successArgs     List of argument to pass to the callback\n   * @param  boolean  skip      Whether to skip the event triggering\n   * @return mixed  True when the triggering was skipped, false on error, else the callback function\n   */triggerEvent:function triggerEvent(eventName,successArgs,skip){\'use strict\';if(3===arguments.length&&skip||null===this.options[eventName]){return!0}if("function"==typeof this.options[eventName]){if("function"==typeof successArgs){successArgs=successArgs()}return this.options[eventName].apply(this,successArgs)}else{console.log("Provided callback for "+eventName+" is not a function.");return!1}},/**\n   * Event triggered on a mouse click on a subDomain cell\n   *\n   * @param  Date    d    Date of the subdomain block\n   * @param  int    itemNb  Number of items in that date\n   */onClick:function onClick(d,itemNb){\'use strict\';return this.triggerEvent("onClick",[d,itemNb])},/**\n   * Event triggered after drawing the calendar, byt before filling it with data\n   */afterLoad:function afterLoad(){\'use strict\';return this.triggerEvent("afterLoad")},/**\n   * Event triggered after completing drawing and filling the calendar\n   */onComplete:function onComplete(){\'use strict\';var response=this.triggerEvent("onComplete",[],this._completed);this._completed=!0;return response},/**\n   * Event triggered after shifting the calendar one domain back\n   *\n   * @param  Date    start  Domain start date\n   * @param  Date    end    Domain end date\n   */afterLoadPreviousDomain:function afterLoadPreviousDomain(start){\'use strict\';var parent=this;return this.triggerEvent("afterLoadPreviousDomain",function(){var subDomain=parent.getSubDomain(start);return[subDomain.shift(),subDomain.pop()]})},/**\n   * Event triggered after shifting the calendar one domain above\n   *\n   * @param  Date    start  Domain start date\n   * @param  Date    end    Domain end date\n   */afterLoadNextDomain:function afterLoadNextDomain(start){\'use strict\';var parent=this;return this.triggerEvent("afterLoadNextDomain",function(){var subDomain=parent.getSubDomain(start);return[subDomain.shift(),subDomain.pop()]})},/**\n   * Event triggered after loading the leftmost domain allowed by minDate\n   *\n   * @param  boolean  reached True if the leftmost domain was reached\n   */onMinDomainReached:function onMinDomainReached(reached){\'use strict\';this._minDomainReached=reached;return this.triggerEvent("onMinDomainReached",[reached])},/**\n   * Event triggered after loading the rightmost domain allowed by maxDate\n   *\n   * @param  boolean  reached True if the rightmost domain was reached\n   */onMaxDomainReached:function onMaxDomainReached(reached){\'use strict\';this._maxDomainReached=reached;return this.triggerEvent("onMaxDomainReached",[reached])},checkIfMinDomainIsReached:function checkIfMinDomainIsReached(date,upperBound){\'use strict\';if(this.minDomainIsReached(date)){this.onMinDomainReached(!0)}if(2===arguments.length){if(this._maxDomainReached&&!this.maxDomainIsReached(upperBound)){this.onMaxDomainReached(!1)}}},checkIfMaxDomainIsReached:function checkIfMaxDomainIsReached(date,lowerBound){\'use strict\';if(this.maxDomainIsReached(date)){this.onMaxDomainReached(!0)}if(2===arguments.length){if(this._minDomainReached&&!this.minDomainIsReached(lowerBound)){this.onMinDomainReached(!1)}}},afterUpdate:function afterUpdate(){\'use strict\';return this.triggerEvent("afterUpdate")},// =========================================================================//\n// FORMATTER                                //\n// =========================================================================//\nformatNumber:d3.format(",g"),formatDate:function formatDate(d,format){\'use strict\';if(2>arguments.length){format="title"}if("function"==typeof format){return format(d)}else{var f=d3.time.format(format);return f(d)}},getSubDomainTitle:function getSubDomainTitle(d){\'use strict\';if(null===d.v&&!this.options.considerMissingDataAsZero){return this.formatStringWithObject(this.options.subDomainTitleFormat.empty,{date:this.formatDate(new Date(d.t),this.options.subDomainDateFormat)})}else{var value=d.v;// Consider null as 0\nif(null===value&&this.options.considerMissingDataAsZero){value=0}return this.formatStringWithObject(this.options.subDomainTitleFormat.filled,{count:this.formatNumber(value),name:this.options.itemName[1!==value?1:0],connector:this._domainType[this.options.subDomain].format.connector,date:this.formatDate(new Date(d.t),this.options.subDomainDateFormat)})}},// =========================================================================//\n// DOMAIN NAVIGATION                            //\n// =========================================================================//\n/**\n   * Shift the calendar one domain forward\n   *\n   * The new domain is loaded only if it\'s not beyond maxDate\n   *\n   * @param int n Number of domains to load\n   * @return bool True if the next domain was loaded, else false\n   */loadNextDomain:function loadNextDomain(n){\'use strict\';if(this._maxDomainReached||0===n){return!1}var bound=this.loadNewDomains(this.NAVIGATE_RIGHT,this.getDomain(this.getNextDomain(),n));this.afterLoadNextDomain(bound.end);this.checkIfMaxDomainIsReached(this.getNextDomain().getTime(),bound.start);return!0},/**\n   * Shift the calendar one domain backward\n   *\n   * The previous domain is loaded only if it\'s not beyond the minDate\n   *\n   * @param int n Number of domains to load\n   * @return bool True if the previous domain was loaded, else false\n   */loadPreviousDomain:function loadPreviousDomain(n){\'use strict\';if(this._minDomainReached||0===n){return!1}var bound=this.loadNewDomains(this.NAVIGATE_LEFT,this.getDomain(this.getDomainKeys()[0],-n).reverse());this.afterLoadPreviousDomain(bound.start);this.checkIfMinDomainIsReached(bound.start,bound.end);return!0},loadNewDomains:function loadNewDomains(direction,newDomains){\'use strict\';var parent=this,backward=direction===this.NAVIGATE_LEFT,i=-1,total=newDomains.length,domains=this.getDomainKeys();function buildSubDomain(d){return{t:parent._domainType[parent.options.subDomain].extractUnit(d),v:null}}// Remove out of bound domains from list of new domains to prepend\nwhile(++i<total){if(backward&&this.minDomainIsReached(newDomains[i])){newDomains=newDomains.slice(0,i+1);break}if(!backward&&this.maxDomainIsReached(newDomains[i])){newDomains=newDomains.slice(0,i);break}}newDomains=newDomains.slice(-this.options.range);for(i=0,total=newDomains.length;i<total;i++){this._domains.set(newDomains[i].getTime(),this.getSubDomain(newDomains[i]).map(buildSubDomain));this._domains.remove(backward?domains.pop():domains.shift())}domains=this.getDomainKeys();if(backward){newDomains=newDomains.reverse()}this.paint(direction);this.getDatas(this.options.data,newDomains[0],this.getSubDomain(newDomains[newDomains.length-1]).pop(),function(){parent.fill(parent.lastInsertedSvg)});return{start:newDomains[backward?0:1],end:domains[domains.length-1]}},/**\n   * Return whether a date is inside the scope determined by maxDate\n   *\n   * @param int datetimestamp The timestamp in ms to test\n   * @return bool True if the specified date correspond to the calendar upper bound\n   */maxDomainIsReached:function maxDomainIsReached(datetimestamp){\'use strict\';return null!==this.options.maxDate&&this.options.maxDate.getTime()<datetimestamp},/**\n   * Return whether a date is inside the scope determined by minDate\n   *\n   * @param int datetimestamp The timestamp in ms to test\n   * @return bool True if the specified date correspond to the calendar lower bound\n   */minDomainIsReached:function minDomainIsReached(datetimestamp){\'use strict\';return null!==this.options.minDate&&this.options.minDate.getTime()>=datetimestamp},/**\n   * Return the list of the calendar\'s domain timestamp\n   *\n   * @return Array a sorted array of timestamp\n   */getDomainKeys:function getDomainKeys(){\'use strict\';return this._domains.keys().map(function(d){return parseInt(d,10)}).sort(function(a,b){return a-b})},// =========================================================================//\n// POSITIONNING                                //\n// =========================================================================//\npositionSubDomainX:function positionSubDomainX(d){\'use strict\';var index=this._domainType[this.options.subDomain].position.x(new Date(d));return index*this.options.cellSize+index*this.options.cellPadding},positionSubDomainY:function positionSubDomainY(d){\'use strict\';var index=this._domainType[this.options.subDomain].position.y(new Date(d));return index*this.options.cellSize+index*this.options.cellPadding},getSubDomainColumnNumber:function getSubDomainColumnNumber(d){\'use strict\';if(0<this.options.rowLimit){var i=this._domainType[this.options.subDomain].maxItemNumber;if("function"==typeof i){i=i(d)}return Math.ceil(i/this.options.rowLimit)}var j=this._domainType[this.options.subDomain].defaultColumnNumber;if("function"==typeof j){j=j(d)}return this.options.colLimit||j},getSubDomainRowNumber:function getSubDomainRowNumber(d){\'use strict\';if(0<this.options.colLimit){var i=this._domainType[this.options.subDomain].maxItemNumber;if("function"==typeof i){i=i(d)}return Math.ceil(i/this.options.colLimit)}var j=this._domainType[this.options.subDomain].defaultRowNumber;if("function"==typeof j){j=j(d)}return this.options.rowLimit||j},/**\n   * Return a classname if the specified date should be highlighted\n   *\n   * @param  timestamp date Date of the current subDomain\n   * @return String the highlight class\n   */getHighlightClassName:function getHighlightClassName(d){\'use strict\';d=new Date(d);if(0<this.options.highlight.length){for(var i in this.options.highlight){if(this.dateIsEqual(this.options.highlight[i],d)){return this.isNow(this.options.highlight[i])?" highlight-now":" highlight"}}}return""},/**\n   * Return whether the specified date is now,\n   * according to the type of subdomain\n   *\n   * @param  Date d The date to compare\n   * @return bool True if the date correspond to a subdomain cell\n   */isNow:function isNow(d){\'use strict\';return this.dateIsEqual(d,new Date)},/**\n   * Return whether 2 dates are equals\n   * This function is subdomain-aware,\n   * and dates comparison are dependent of the subdomain\n   *\n   * @param  Date dateA First date to compare\n   * @param  Date dateB Secon date to compare\n   * @return bool true if the 2 dates are equals\n   */ /* jshint maxcomplexity: false */dateIsEqual:function dateIsEqual(dateA,dateB){\'use strict\';if(!(dateA instanceof Date)){dateA=new Date(dateA)}if(!(dateB instanceof Date)){dateB=new Date(dateB)}switch(this.options.subDomain){case"x_min":case"min":return dateA.getFullYear()===dateB.getFullYear()&&dateA.getMonth()===dateB.getMonth()&&dateA.getDate()===dateB.getDate()&&dateA.getHours()===dateB.getHours()&&dateA.getMinutes()===dateB.getMinutes();case"x_hour":case"hour":return dateA.getFullYear()===dateB.getFullYear()&&dateA.getMonth()===dateB.getMonth()&&dateA.getDate()===dateB.getDate()&&dateA.getHours()===dateB.getHours();case"x_day":case"day":return dateA.getFullYear()===dateB.getFullYear()&&dateA.getMonth()===dateB.getMonth()&&dateA.getDate()===dateB.getDate();case"x_week":case"week":return dateA.getFullYear()===dateB.getFullYear()&&this.getWeekNumber(dateA)===this.getWeekNumber(dateB);case"x_month":case"month":return dateA.getFullYear()===dateB.getFullYear()&&dateA.getMonth()===dateB.getMonth();default:return!1;}},/**\n   * Returns wether or not dateA is less than or equal to dateB. This function is subdomain aware.\n   * Performs automatic conversion of values.\n   * @param dateA may be a number or a Date\n   * @param dateB may be a number or a Date\n   * @returns {boolean}\n   */dateIsLessThan:function dateIsLessThan(dateA,dateB){\'use strict\';if(!(dateA instanceof Date)){dateA=new Date(dateA)}if(!(dateB instanceof Date)){dateB=new Date(dateB)}function normalizedMillis(date,subdomain){switch(subdomain){case"x_min":case"min":return new Date(date.getFullYear(),date.getMonth(),date.getDate(),date.getHours(),date.getMinutes()).getTime();case"x_hour":case"hour":return new Date(date.getFullYear(),date.getMonth(),date.getDate(),date.getHours()).getTime();case"x_day":case"day":return new Date(date.getFullYear(),date.getMonth(),date.getDate()).getTime();case"x_week":case"week":case"x_month":case"month":return new Date(date.getFullYear(),date.getMonth()).getTime();default:return date.getTime();}}return normalizedMillis(dateA,this.options.subDomain)<normalizedMillis(dateB,this.options.subDomain)},// =========================================================================//\n// DATE COMPUTATION                              //\n// =========================================================================//\n/**\n   * Return the day of the year for the date\n   * @param  Date\n   * @return  int Day of the year [1,366]\n   */getDayOfYear:d3.time.format("%j"),/**\n   * Return the week number of the year\n   * Monday as the first day of the week\n   * @return int  Week number [0-53]\n   */getWeekNumber:function getWeekNumber(d){\'use strict\';var f=!0===this.options.weekStartOnMonday?d3.time.format("%W"):d3.time.format("%U");return f(d)},/**\n   * Return the week number, relative to its month\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Week number, relative to the month [0-5]\n   */getMonthWeekNumber:function getMonthWeekNumber(d){\'use strict\';if("number"==typeof d){d=new Date(d)}var monthFirstWeekNumber=this.getWeekNumber(new Date(d.getFullYear(),d.getMonth()));return this.getWeekNumber(d)-monthFirstWeekNumber-1},/**\n   * Return the number of weeks in the dates\' year\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of weeks in the date\'s year\n   */getWeekNumberInYear:function getWeekNumberInYear(d){\'use strict\';if("number"==typeof d){d=new Date(d)}},/**\n   * Return the number of days in the date\'s month\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of days in the date\'s month\n   */getDayCountInMonth:function getDayCountInMonth(d){\'use strict\';return this.getEndOfMonth(d).getDate()},/**\n   * Return the number of days in the date\'s year\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of days in the date\'s year\n   */getDayCountInYear:function getDayCountInYear(d){\'use strict\';if("number"==typeof d){d=new Date(d)}return 1===new Date(d.getFullYear(),1,29).getMonth()?366:365},/**\n   * Get the weekday from a date\n   *\n   * Return the week day number (0-6) of a date,\n   * depending on whether the week start on monday or sunday\n   *\n   * @param  Date d\n   * @return int The week day number (0-6)\n   */getWeekDay:function getWeekDay(d){\'use strict\';if(!1===this.options.weekStartOnMonday){return d.getDay()}return 0===d.getDay()?6:d.getDay()-1},/**\n   * Get the last day of the month\n   * @param  Date|int  d  Date or timestamp in milliseconds\n   * @return Date      Last day of the month\n   */getEndOfMonth:function getEndOfMonth(d){\'use strict\';if("number"==typeof d){d=new Date(d)}return new Date(d.getFullYear(),d.getMonth()+1,0)},/**\n   *\n   * @param  Date date\n   * @param  int count\n   * @param  string step\n   * @return Date\n   */jumpDate:function jumpDate(date,count,step){\'use strict\';var d=new Date(date);switch(step){case"hour":d.setHours(d.getHours()+count);break;case"day":d.setHours(d.getHours()+24*count);break;case"week":d.setHours(d.getHours()+7*(24*count));break;case"month":d.setMonth(d.getMonth()+count);break;case"year":d.setFullYear(d.getFullYear()+count);}return new Date(d)},// =========================================================================//\n// DOMAIN COMPUTATION                            //\n// =========================================================================//\n/**\n   * Return all the minutes between 2 dates\n   *\n   * @param  Date  d  date  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of minutes\n   */getMinuteDomain:function getMinuteDomain(d,range){\'use strict\';var start=new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours()),stop=null;if(range instanceof Date){stop=new Date(range.getFullYear(),range.getMonth(),range.getDate(),range.getHours())}else{stop=new Date(+start+60*(1e3*range))}return d3.time.minutes(Math.min(start,stop),Math.max(start,stop))},/**\n   * Return all the hours between 2 dates\n   *\n   * @param  Date  d  A date\n   * @param  int|date  range  Number of hours in the range, or a stop date\n   * @return array  An array of hours\n   */getHourDomain:function getHourDomain(d,range){\'use strict\';var start=new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours()),stop=null;if(range instanceof Date){stop=new Date(range.getFullYear(),range.getMonth(),range.getDate(),range.getHours())}else{stop=new Date(start);stop.setHours(stop.getHours()+range)}var domains=d3.time.hours(Math.min(start,stop),Math.max(start,stop)),i=0,total=domains.length;// Passing from DST to standard time\n// If there are 25 hours, let\'s compress the duplicate hours\nfor(i=0;i<total;i++){if(0<i&&domains[i].getHours()===domains[i-1].getHours()){this.DSTDomain.push(domains[i].getTime());domains.splice(i,1);break}}// d3.time.hours is returning more hours than needed when changing\n// from DST to standard time, because there is really 2 hours between\n// 1am and 2am!\nif("number"==typeof range&&domains.length>Math.abs(range)){domains.splice(domains.length-1,1)}return domains},/**\n   * Return all the days between 2 dates\n   *\n   * @param  Date    d    A date\n   * @param  int|date  range  Number of days in the range, or a stop date\n   * @return array  An array of weeks\n   */getDayDomain:function getDayDomain(d,range){\'use strict\';var start=new Date(d.getFullYear(),d.getMonth(),d.getDate()),stop=null;if(range instanceof Date){stop=new Date(range.getFullYear(),range.getMonth(),range.getDate())}else{stop=new Date(start);stop=new Date(stop.setDate(stop.getDate()+parseInt(range,10)))}return d3.time.days(Math.min(start,stop),Math.max(start,stop))},/**\n   * Return all the weeks between 2 dates\n   *\n   * @param  Date  d  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of weeks\n   */getWeekDomain:function getWeekDomain(d,range){\'use strict\';var weekStart;if(!1===this.options.weekStartOnMonday){weekStart=new Date(d.getFullYear(),d.getMonth(),d.getDate()-d.getDay())}else{if(1===d.getDay()){weekStart=new Date(d.getFullYear(),d.getMonth(),d.getDate())}else if(0===d.getDay()){weekStart=new Date(d.getFullYear(),d.getMonth(),d.getDate());weekStart.setDate(weekStart.getDate()-6)}else{weekStart=new Date(d.getFullYear(),d.getMonth(),d.getDate()-d.getDay()+1)}}var endDate=new Date(weekStart),stop=range;if("object"!=typeof range){stop=new Date(endDate.setDate(endDate.getDate()+7*range))}return!0===this.options.weekStartOnMonday?d3.time.mondays(Math.min(weekStart,stop),Math.max(weekStart,stop)):d3.time.sundays(Math.min(weekStart,stop),Math.max(weekStart,stop))},/**\n   * Return all the months between 2 dates\n   *\n   * @param  Date    d    A date\n   * @param  int|date  range  Number of months in the range, or a stop date\n   * @return array  An array of months\n   */getMonthDomain:function getMonthDomain(d,range){\'use strict\';var start=new Date(d.getFullYear(),d.getMonth()),stop=null;if(range instanceof Date){stop=new Date(range.getFullYear(),range.getMonth())}else{stop=new Date(start);stop=stop.setMonth(stop.getMonth()+range)}return d3.time.months(Math.min(start,stop),Math.max(start,stop))},/**\n   * Return all the years between 2 dates\n   *\n   * @param  Date  d  date  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of hours\n   */getYearDomain:function getYearDomain(d,range){\'use strict\';var start=new Date(d.getFullYear(),0),stop=null;if(range instanceof Date){stop=new Date(range.getFullYear(),0)}else{stop=new Date(d.getFullYear()+range,0)}return d3.time.years(Math.min(start,stop),Math.max(start,stop))},/**\n   * Get an array of domain start dates\n   *\n   * @param  int|Date date A random date included in the wanted domain\n   * @param  int|Date range Number of dates to get, or a stop date\n   * @return Array of dates\n   */getDomain:function getDomain(date,range){\'use strict\';if("number"==typeof date){date=new Date(date)}if(2>arguments.length){range=this.options.range}switch(this.options.domain){case"hour":var domains=this.getHourDomain(date,range);// Case where an hour is missing, when passing from standard time to DST\n// Missing hour is perfectly acceptabl in subDomain, but not in domains\nif("number"==typeof range&&domains.length<range){if(0<range){domains.push(this.getHourDomain(domains[domains.length-1],2)[1])}else{domains.shift(this.getHourDomain(domains[0],-2)[0])}}return domains;case"day":return this.getDayDomain(date,range);case"week":return this.getWeekDomain(date,range);case"month":return this.getMonthDomain(date,range);case"year":return this.getYearDomain(date,range);}},/* jshint maxcomplexity: false */getSubDomain:function getSubDomain(date){\'use strict\';if("number"==typeof date){date=new Date(date)}var parent=this,computeDaySubDomainSize=function(date,domain){switch(domain){case"year":return parent.getDayCountInYear(date);case"month":return parent.getDayCountInMonth(date);case"week":return 7;}},computeMinSubDomainSize=function(date,domain){switch(domain){case"hour":return 60;case"day":return 1440;case"week":return 10080;}},computeHourSubDomainSize=function(date,domain){switch(domain){case"day":return 24;case"week":return 168;case"month":return 24*parent.getDayCountInMonth(date);}},computeWeekSubDomainSize=function(date,domain){if("month"===domain){var endOfMonth=new Date(date.getFullYear(),date.getMonth()+1,0),endWeekNb=parent.getWeekNumber(endOfMonth),startWeekNb=parent.getWeekNumber(new Date(date.getFullYear(),date.getMonth()));if(startWeekNb>endWeekNb){startWeekNb=0;endWeekNb++}return endWeekNb-startWeekNb+1}else if("year"===domain){return parent.getWeekNumber(new Date(date.getFullYear(),11,31))}};/**\n     * @return int\n     */switch(this.options.subDomain){case"x_min":case"min":return this.getMinuteDomain(date,computeMinSubDomainSize(date,this.options.domain));case"x_hour":case"hour":return this.getHourDomain(date,computeHourSubDomainSize(date,this.options.domain));case"x_day":case"day":return this.getDayDomain(date,computeDaySubDomainSize(date,this.options.domain));case"x_week":case"week":return this.getWeekDomain(date,computeWeekSubDomainSize(date,this.options.domain));case"x_month":case"month":return this.getMonthDomain(date,12);}},/**\n   * Get the n-th next domain after the calendar newest (rightmost) domain\n   * @param  int n\n   * @return Date The start date of the wanted domain\n   */getNextDomain:function getNextDomain(n){\'use strict\';if(0===arguments.length){n=1}return this.getDomain(this.jumpDate(this.getDomainKeys().pop(),n,this.options.domain),1)[0]},/**\n   * Get the n-th domain before the calendar oldest (leftmost) domain\n   * @param  int n\n   * @return Date The start date of the wanted domain\n   */getPreviousDomain:function getPreviousDomain(n){\'use strict\';if(0===arguments.length){n=1}return this.getDomain(this.jumpDate(this.getDomainKeys().shift(),-n,this.options.domain),1)[0]},// =========================================================================//\n// DATAS                                  //\n// =========================================================================//\n/**\n   * Fetch and interpret data from the datasource\n   *\n   * @param string|object source\n   * @param Date startDate\n   * @param Date endDate\n   * @param function callback\n   * @param function|boolean afterLoad function used to convert the data into a json object. Use true to use the afterLoad callback\n   * @param updateMode\n   *\n   * @return mixed\n   * - True if there are no data to load\n   * - False if data are loaded asynchronously\n   */getDatas:function getDatas(source,startDate,endDate,callback,afterLoad,updateMode){\'use strict\';var self=this;if(5>arguments.length){afterLoad=!0}if(6>arguments.length){updateMode=this.APPEND_ON_UPDATE}var _callback=function(error,data){if(!1!==afterLoad){if("function"==typeof afterLoad){data=afterLoad(data)}else if("function"==typeof self.options.afterLoadData){data=self.options.afterLoadData(data)}else{console.log("Provided callback for afterLoadData is not a function.")}}else if("csv"===self.options.dataType||"tsv"===self.options.dataType){data=this.interpretCSV(data)}self.parseDatas(data,updateMode,startDate,endDate);if("function"==typeof callback){callback()}};switch(typeof source){case"string":if(""===source){_callback(null,{});return!0}else{var url=this.parseURI(source,startDate,endDate),requestType="GET";if(null!==self.options.dataPostPayload){requestType="POST"}var payload=null;if(null!==self.options.dataPostPayload){payload=this.parseURI(self.options.dataPostPayload,startDate,endDate)}var xhr=null;switch(this.options.dataType){case"json":xhr=d3.json(url);break;case"csv":xhr=d3.csv(url);break;case"tsv":xhr=d3.tsv(url);break;case"txt":xhr=d3.text(url,"text/plain");break;}// jshint maxdepth:5\nif(null!==self.options.dataRequestHeaders){for(var header in self.options.dataRequestHeaders){if(self.options.dataRequestHeaders.hasOwnProperty(header)){xhr.header(header,self.options.dataRequestHeaders[header])}}}xhr.send(requestType,payload,_callback)}return!1;case"object":if(source===Object(source)){_callback(null,source);return!1}/* falls through */default:_callback(null,{});return!0;}},/**\n   * Populate the calendar internal data\n   *\n   * @param object data\n   * @param constant updateMode\n   * @param Date startDate\n   * @param Date endDate\n   *\n   * @return void\n   */parseDatas:function parseDatas(data,updateMode,startDate,endDate){\'use strict\';if(updateMode===this.RESET_ALL_ON_UPDATE){this._domains.forEach(function(key,value){value.forEach(function(element,index,array){array[index].v=null})})}var temp={},extractTime=function(d){return d.t};/*jshint forin:false */for(var d in data){var date=new Date(1e3*d),domainUnit=this.getDomain(date)[0].getTime();// The current data belongs to a domain that was compressed\n// Compress the data for the two duplicate hours into the same hour\nif(0<=this.DSTDomain.indexOf(domainUnit)){// Re-assign all data to the first or the second duplicate hours\n// depending on which is visible\nif(this._domains.has(domainUnit-3600000)){domainUnit-=3600000}}// Skip if data is not relevant to current domain\nif(isNaN(d)||!data.hasOwnProperty(d)||!this._domains.has(domainUnit)||!(domainUnit>=+startDate&&domainUnit<+endDate)){continue}var subDomainsData=this._domains.get(domainUnit);if(!temp.hasOwnProperty(domainUnit)){temp[domainUnit]=subDomainsData.map(extractTime)}var index=temp[domainUnit].indexOf(this._domainType[this.options.subDomain].extractUnit(date));if(updateMode===this.RESET_SINGLE_ON_UPDATE){subDomainsData[index].v=data[d]}else{if(!isNaN(subDomainsData[index].v)){subDomainsData[index].v+=data[d]}else{subDomainsData[index].v=data[d]}}}},parseURI:function parseURI(str,startDate,endDate){\'use strict\';// Use a timestamp in seconds\nstr=str.replace(/\\{\\{t:start\\}\\}/g,startDate.getTime()/1e3);str=str.replace(/\\{\\{t:end\\}\\}/g,endDate.getTime()/1e3);// Use a string date, following the ISO-8601\nstr=str.replace(/\\{\\{d:start\\}\\}/g,startDate.toISOString());str=str.replace(/\\{\\{d:end\\}\\}/g,endDate.toISOString());return str},interpretCSV:function interpretCSV(data){\'use strict\';var d={},keys=Object.keys(data[0]),i,total;for(i=0,total=data.length;i<total;i++){d[data[i][keys[0]]]=+data[i][keys[1]]}return d},/**\n   * Handle the calendar layout and dimension\n   *\n   * Expand and shrink the container depending on its children dimension\n   * Also rearrange the children position depending on their dimension,\n   * and the legend position\n   *\n   * @return void\n   */resize:function resize(){\'use strict\';var parent=this,options=parent.options,legendWidth=options.displayLegend?parent.Legend.getDim("width")+options.legendMargin[1]+options.legendMargin[3]:0,legendHeight=options.displayLegend?parent.Legend.getDim("height")+options.legendMargin[0]+options.legendMargin[2]:0,graphWidth=parent.graphDim.width-options.domainGutter-options.cellPadding,graphHeight=parent.graphDim.height-options.domainGutter-options.cellPadding;this.root.transition().duration(options.animationDuration).attr("width",function(){if("middle"===options.legendVerticalPosition||"center"===options.legendVerticalPosition){return graphWidth+legendWidth}return Math.max(graphWidth,legendWidth)}).attr("height",function(){if("middle"===options.legendVerticalPosition||"center"===options.legendVerticalPosition){return Math.max(graphHeight,legendHeight)}return graphHeight+legendHeight});this.root.select(".graph").transition().duration(options.animationDuration).attr("y",function(){if("top"===options.legendVerticalPosition){return legendHeight}return 0}).attr("x",function(){if(("middle"===options.legendVerticalPosition||"center"===options.legendVerticalPosition)&&"left"===options.legendHorizontalPosition){return legendWidth}return 0})},// =========================================================================//\n// PUBLIC API                                //\n// =========================================================================//\n/**\n   * Shift the calendar forward\n   */next:function next(n){\'use strict\';if(0===arguments.length){n=1}return this.loadNextDomain(n)},/**\n   * Shift the calendar backward\n   */previous:function previous(n){\'use strict\';if(0===arguments.length){n=1}return this.loadPreviousDomain(n)},/**\n   * Jump directly to a specific date\n   *\n   * JumpTo will scroll the calendar until the wanted domain with the specified\n   * date is visible. Unless you set reset to true, the wanted domain\n   * will not necessarily be the first (leftmost) domain of the calendar.\n   *\n   * @param Date date Jump to the domain containing that date\n   * @param bool reset Whether the wanted domain should be the first domain of the calendar\n   * @param bool True of the calendar was scrolled\n   */jumpTo:function jumpTo(date,reset){\'use strict\';if(2>arguments.length){reset=!1}var domains=this.getDomainKeys(),firstDomain=domains[0],lastDomain=domains[domains.length-1];if(date<firstDomain){return this.loadPreviousDomain(this.getDomain(firstDomain,date).length)}else{if(reset){return this.loadNextDomain(this.getDomain(firstDomain,date).length)}if(date>lastDomain){return this.loadNextDomain(this.getDomain(lastDomain,date).length)}}return!1},/**\n   * Navigate back to the start date\n   *\n   * @since  3.3.8\n   * @return void\n   */rewind:function rewind(){\'use strict\';this.jumpTo(this.options.start,!0)},/**\n   * Update the calendar with new data\n   *\n   * @param  object|string    dataSource    The calendar\'s datasource, same type as this.options.data\n   * @param  boolean|function    afterLoad    Whether to execute afterLoad() on the data. Pass directly a function\n   * if you don\'t want to use the afterLoad() callback\n   */update:function update(dataSource,afterLoad,updateMode){\'use strict\';if(0===arguments.length){dataSource=this.options.data}if(2>arguments.length){afterLoad=!0}if(3>arguments.length){updateMode=this.RESET_ALL_ON_UPDATE}var domains=this.getDomainKeys(),self=this;this.getDatas(dataSource,new Date(domains[0]),this.getSubDomain(domains[domains.length-1]).pop(),function(){self.fill();self.afterUpdate()},afterLoad,updateMode)},/**\n   * Set the legend\n   *\n   * @param array legend an array of integer, representing the different threshold value\n   * @param array colorRange an array of 2 hex colors, for the minimum and maximum colors\n   */setLegend:function setLegend(){\'use strict\';var oldLegend=this.options.legend.slice(0);if(1<=arguments.length&&Array.isArray(arguments[0])){this.options.legend=arguments[0]}if(2<=arguments.length){if(Array.isArray(arguments[1])&&2<=arguments[1].length){this.options.legendColors=[arguments[1][0],arguments[1][1]]}else{this.options.legendColors=arguments[1]}}if(0<arguments.length&&!arrayEquals(oldLegend,this.options.legend)||2<=arguments.length){this.Legend.buildColors();this.fill()}this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding)},/**\n   * Remove the legend\n   *\n   * @return bool False if there is no legend to remove\n   */removeLegend:function removeLegend(){\'use strict\';if(!this.options.displayLegend){return!1}this.options.displayLegend=!1;this.Legend.remove();return!0},/**\n   * Display the legend\n   *\n   * @return bool False if the legend was already displayed\n   */showLegend:function showLegend(){\'use strict\';if(this.options.displayLegend){return!1}this.options.displayLegend=!0;this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding);return!0},/**\n   * Highlight dates\n   *\n   * Add a highlight class to a set of dates\n   *\n   * @since  3.3.5\n   * @param  array Array of dates to highlight\n   * @return bool True if dates were highlighted\n   */highlight:function highlight(args){\'use strict\';if(0<(this.options.highlight=this.expandDateSetting(args)).length){this.fill();return!0}return!1},/**\n   * Destroy the calendar\n   *\n   * Usage: cal = cal.destroy();\n   *\n   * @since  3.3.6\n   * @param function A callback function to trigger after destroying the calendar\n   * @return null\n   */destroy:function destroy(callback){\'use strict\';this.root.transition().duration(this.options.animationDuration).attr("width",0).attr("height",0).remove().each("end",function(){if("function"==typeof callback){callback()}else if("undefined"!=typeof callback){console.log("Provided callback for destroy() is not a function.")}});return null},getSVG:function getSVG(){\'use strict\';for(var styles={".cal-heatmap-container":{},".graph":{},".graph-rect":{},"rect.highlight":{},"rect.now":{},"rect.highlight-now":{},"text.highlight":{},"text.now":{},"text.highlight-now":{},".domain-background":{},".graph-label":{},".subdomain-text":{},".q0":{},".qi":{}},j=1,total=this.options.legend.length+1;j<=total;j++){styles[".q"+j]={}}var root=this.root,whitelistStyles=[// SVG specific properties\n"stroke","stroke-width","stroke-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-miterlimit","fill","fill-opacity","fill-rule","marker","marker-start","marker-mid","marker-end","alignement-baseline","baseline-shift","dominant-baseline","glyph-orientation-horizontal","glyph-orientation-vertical","kerning","text-anchor","shape-rendering",// Text Specific properties\n"text-transform","font-family","font","font-size","font-weight"],filterStyles=function(attribute,property,value){if(-1!==whitelistStyles.indexOf(property)){styles[attribute][property]=value}},getElement=function(e){return root.select(e)[0][0]};/* jshint forin:false */for(var element in styles){if(!styles.hasOwnProperty(element)){continue}var dom=getElement(element);if(null===dom){continue}// The DOM Level 2 CSS way\n/* jshint maxdepth: false */if("getComputedStyle"in window){var cs=getComputedStyle(dom,null);if(0!==cs.length){for(var i=0;i<cs.length;i++){filterStyles(element,cs.item(i),cs.getPropertyValue(cs.item(i)))}// Opera workaround. Opera doesn"t support `item`/`length`\n// on CSSStyleDeclaration.\n}else{for(var k in cs){if(cs.hasOwnProperty(k)){filterStyles(element,k,cs[k])}}}// The IE way\n}else if("currentStyle"in dom){var css=dom.currentStyle;for(var p in css){filterStyles(element,p,css[p])}}}var string="<svg xmlns=\\"http://www.w3.org/2000/svg\\" xmlns:xlink=\\"http://www.w3.org/1999/xlink\\"><style type=\\"text/css\\"><![CDATA[ ";for(var style in styles){string+=style+" {\\n";for(var l in styles[style]){string+="\\t"+l+":"+styles[style][l]+";\\n"}string+="}\\n"}string+="]]></style>";string+=new XMLSerializer().serializeToString(this.root[0][0]);string+="</svg>";return string}};// =========================================================================//\n// DOMAIN POSITION COMPUTATION                        //\n// =========================================================================//\n/**\n * Compute the position of a domain, relative to the calendar\n */var DomainPosition=function(){\'use strict\';this.positions=d3.map()};DomainPosition.prototype.getPosition=function(d){\'use strict\';return this.positions.get(d)};DomainPosition.prototype.getPositionFromIndex=function(i){\'use strict\';var domains=this.getKeys();return this.positions.get(domains[i])};DomainPosition.prototype.getLast=function(){\'use strict\';var domains=this.getKeys();return this.positions.get(domains[domains.length-1])};DomainPosition.prototype.setPosition=function(d,dim){\'use strict\';this.positions.set(d,dim)};DomainPosition.prototype.shiftRightBy=function(exitingDomainDim){\'use strict\';this.positions.forEach(function(key,value){this.set(key,value-exitingDomainDim)});var domains=this.getKeys();this.positions.remove(domains[0])};DomainPosition.prototype.shiftLeftBy=function(enteringDomainDim){\'use strict\';this.positions.forEach(function(key,value){this.set(key,value+enteringDomainDim)});var domains=this.getKeys();this.positions.remove(domains[domains.length-1])};DomainPosition.prototype.getKeys=function(){\'use strict\';return this.positions.keys().sort(function(a,b){return parseInt(a,10)-parseInt(b,10)})};// =========================================================================//\n// LEGEND                                  //\n// =========================================================================//\nvar Legend=function(calendar){\'use strict\';this.calendar=calendar;this.computeDim();if(null!==calendar.options.legendColors){this.buildColors()}};Legend.prototype.computeDim=function(){\'use strict\';var options=this.calendar.options;// Shorter accessor for variable name mangling when minifying\nthis.dim={width:options.legendCellSize*(options.legend.length+1)+options.legendCellPadding*options.legend.length,height:options.legendCellSize}};Legend.prototype.remove=function(){\'use strict\';this.calendar.root.select(".graph-legend").remove();this.calendar.resize()};Legend.prototype.redraw=function(width){\'use strict\';if(!this.calendar.options.displayLegend){return!1}var parent=this,calendar=this.calendar,legend=calendar.root,legendItem,options=calendar.options;// Shorter accessor for variable name mangling when minifying\nthis.computeDim();var _legend=options.legend.slice(0);_legend.push(_legend[_legend.length-1]+1);var legendElement=calendar.root.select(".graph-legend");if(null!==legendElement[0][0]){legend=legendElement;legendItem=legend.select("g").selectAll("rect").data(_legend)}else{// Creating the new legend DOM if it doesn\'t already exist\nlegend="top"===options.legendVerticalPosition?legend.insert("svg",".graph"):legend.append("svg");legend.attr("x",getLegendXPosition()).attr("y",getLegendYPosition());legendItem=legend.attr("class","graph-legend").attr("height",parent.getDim("height")).attr("width",parent.getDim("width")).append("g").selectAll().data(_legend)}legendItem.enter().append("rect").call(legendCellLayout).attr("class",function(d){return calendar.Legend.getClass(d,null===calendar.legendScale)}).attr("fill-opacity",0).call(function(selection){if(null!==calendar.legendScale&&null!==options.legendColors&&options.legendColors.hasOwnProperty("base")){selection.attr("fill",options.legendColors.base)}}).append("title");legendItem.exit().transition().duration(options.animationDuration).attr("fill-opacity",0).remove();legendItem.transition().delay(function(d,i){return options.animationDuration*i/10}).call(legendCellLayout).attr("fill-opacity",1).call(function(element){element.attr("fill",function(d,i){if(null===calendar.legendScale){return""}if(0===i){return calendar.legendScale(d-1)}return calendar.legendScale(options.legend[i-1])});element.attr("class",function(d){return calendar.Legend.getClass(d,null===calendar.legendScale)})});function legendCellLayout(selection){selection.attr("width",options.legendCellSize).attr("height",options.legendCellSize).attr("rx",options.legendCellRadius).attr("ry",options.legendCellRadius).attr("x",function(d,i){return i*(options.legendCellSize+options.legendCellPadding)})}legendItem.select("title").text(function(d,i){if(0===i){return calendar.formatStringWithObject(options.legendTitleFormat.lower,{min:options.legend[i],name:options.itemName[1]})}else if(i===_legend.length-1){return calendar.formatStringWithObject(options.legendTitleFormat.upper,{max:options.legend[i-1],name:options.itemName[1]})}else{return calendar.formatStringWithObject(options.legendTitleFormat.inner,{down:options.legend[i-1],up:options.legend[i],name:options.itemName[1]})}});legendItem.on("mouseover",function(d){calendar.legendTip.show(d,this)}).on("mouseout",function(){calendar.legendTip.hide()});legend.transition().duration(options.animationDuration).attr("x",getLegendXPosition()).attr("y",getLegendYPosition()).attr("width",parent.getDim("width")).attr("height",parent.getDim("height"));legend.select("g").transition().duration(options.animationDuration).attr("transform",function(){if("vertical"===options.legendOrientation){return"rotate(90 "+options.legendCellSize/2+" "+options.legendCellSize/2+")"}return""});function getLegendXPosition(){switch(options.legendHorizontalPosition){case"right":if("center"===options.legendVerticalPosition||"middle"===options.legendVerticalPosition){return width+options.legendMargin[3]}return width-parent.getDim("width")-options.legendMargin[1];case"middle":case"center":return Math.round(width/2-parent.getDim("width")/2);default:return options.legendMargin[3];}}function getLegendYPosition(){if("bottom"===options.legendVerticalPosition){return calendar.graphDim.height+options.legendMargin[0]-options.domainGutter-options.cellPadding}return options.legendMargin[0]}calendar.resize()};/**\n * Return the dimension of the legend\n *\n * Takes into account rotation\n *\n * @param  string axis Width or height\n * @return int height or width in pixels\n */Legend.prototype.getDim=function(axis){\'use strict\';var isHorizontal="horizontal"===this.calendar.options.legendOrientation;switch(axis){case"width":return this.dim[isHorizontal?"width":"height"];case"height":return this.dim[isHorizontal?"height":"width"];}};Legend.prototype.buildColors=function(){\'use strict\';var options=this.calendar.options;// Shorter accessor for variable name mangling when minifying\nif(null===options.legendColors){this.calendar.legendScale=null;return!1}var _colorRange=[];if(Array.isArray(options.legendColors)){_colorRange=options.legendColors}else if(options.legendColors.hasOwnProperty("min")&&options.legendColors.hasOwnProperty("max")){_colorRange=[options.legendColors.min,options.legendColors.max]}else{options.legendColors=null;return!1}var _legend=options.legend.slice(0);if(0<_legend[0]){_legend.unshift(0)}else if(0>=_legend[0]){// Let\'s guess the leftmost value, it we have to add one\n_legend.unshift(_legend[0]-(_legend[_legend.length-1]-_legend[0])/_legend.length)}var colorScale;if(options.legendColors.hasOwnProperty("colorScale")){colorScale=options.legendColors.colorScale}else{colorScale=d3.scale.linear().range(_colorRange).interpolate(d3.interpolateHcl).domain([d3.min(_legend),d3.max(_legend)])}var legendColors=_legend.map(function(element){return colorScale(element)});this.calendar.legendScale=d3.scale.threshold().domain(options.legend).range(legendColors);return!0};/**\n * Return the classname on the legend for the specified value\n *\n * @param integer n Value associated to a date\n * @param bool withCssClass Whether to display the css class used to style the cell.\n *                          Disabling will allow styling directly via html fill attribute\n *\n * @return string Classname according to the legend\n */Legend.prototype.getClass=function(n,withCssClass){\'use strict\';if(null===n||isNaN(n)){return""}for(var index=[this.calendar.options.legend.length+1],i=0,total=this.calendar.options.legend.length-1;i<=total;i++){if(0<this.calendar.options.legend[0]&&0>n){index=["1","i"];break}if(n<=this.calendar.options.legend[i]){index=[i+1];break}}if(0===n){index.push(0)}index.unshift("");return(index.join(" r")+(withCssClass?index.join(" q"):"")).trim()};/**\n * #source http://stackoverflow.com/a/383245/805649\n */function mergeRecursive(obj1,obj2){\'use strict\';/*jshint forin:false */for(var p in obj2){try{// Property in destination object set; update its value.\nif(obj2[p].constructor===Object){obj1[p]=mergeRecursive(obj1[p],obj2[p])}else{obj1[p]=obj2[p]}}catch(e){// Property in destination object not set; create it and set its value.\nobj1[p]=obj2[p]}}return obj1}/**\n * Check if 2 arrays are equals\n *\n * @link http://stackoverflow.com/a/14853974/805649\n * @param  array array the array to compare to\n * @return bool true of the 2 arrays are equals\n */function arrayEquals(arrayA,arrayB){\'use strict\';// if the other array is a falsy value, return\nif(!arrayB||!arrayA){return!1}// compare lengths - can save a lot of time\nif(arrayA.length!==arrayB.length){return!1}for(var i=0;i<arrayA.length;i++){// Check if we have nested arrays\nif(arrayA[i]instanceof Array&&arrayB[i]instanceof Array){// recurse into the nested arrays\nif(!arrayEquals(arrayA[i],arrayB[i])){return!1}}else if(arrayA[i]!==arrayB[i]){// Warning - two different object instances will never be equal: {x:20} != {x:20}\nreturn!1}}return!0}/* harmony default export */ var cal_heatmap = (CalHeatMap);\n// EXTERNAL MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.css\nvar vendor_cal_heatmap = __webpack_require__(1676);\n\n// CONCATENATED MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/plugins/legacy-plugin-chart-calendar/src/Calendar.js\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */function convertUTC(dttm){return new Date(dttm.getUTCFullYear(),dttm.getUTCMonth(),dttm.getUTCDate(),dttm.getUTCHours(),dttm.getUTCMinutes(),dttm.getUTCSeconds())}const convertUTCTS=uts=>convertUTC(new Date(uts)).getTime(),propTypes={data:prop_types_default.a.shape({// Object hashed by metric name,\n// then hashed by timestamp (in seconds, not milliseconds) as float\n// the innermost value is count\n// e.g. { count_distinct_something: { 1535034236.0: 3 } }\ndata:prop_types_default.a.object,domain:prop_types_default.a.string,range:prop_types_default.a.number,// timestamp in milliseconds\nstart:prop_types_default.a.number,subdomain:prop_types_default.a.string}),height:prop_types_default.a.number,// eslint-disable-next-line react/sort-prop-types\ncellPadding:prop_types_default.a.number,// eslint-disable-next-line react/sort-prop-types\ncellRadius:prop_types_default.a.number,// eslint-disable-next-line react/sort-prop-types\ncellSize:prop_types_default.a.number,linearColorScheme:prop_types_default.a.string,showLegend:prop_types_default.a.bool,showMetricName:prop_types_default.a.bool,showValues:prop_types_default.a.bool,steps:prop_types_default.a.number,timeFormat:prop_types_default.a.string,valueFormat:prop_types_default.a.string,verboseMap:prop_types_default.a.object};function Calendar(element,props){const{data,height,cellPadding=3,cellRadius=0,cellSize=10,domainGranularity,linearColorScheme,showLegend,showMetricName,showValues,steps,subdomainGranularity,timeFormat,valueFormat,verboseMap}=props,valueFormatter=Object(NumberFormatterRegistrySingleton["c" /* getNumberFormatter */])(valueFormat),timeFormatter=Object(TimeFormatterRegistrySingleton["d" /* getTimeFormatter */])(timeFormat),container=Object(src_select["a" /* default */])(element).classed("superset-legacy-chart-calendar",!0).style("height",height);container.selectAll("*").remove();const div=container.append("div"),subDomainTextFormat=showValues?(date,value)=>valueFormatter(value):null,metricsData={};Object.keys(data.data).forEach(metric=>{metricsData[metric]={};Object.keys(data.data[metric]).forEach(ts=>{metricsData[metric][convertUTCTS(1e3*ts)/1e3]=data.data[metric][ts]})});Object.keys(metricsData).forEach(metric=>{const calContainer=div.append("div");if(showMetricName){calContainer.text("Metric: ".concat(verboseMap[metric]||metric))}const timestamps=metricsData[metric],extents=Object(extent["a" /* default */])(Object.keys(timestamps),key=>timestamps[key]),step=(extents[1]-extents[0])/(steps-1),colorScale=Object(SequentialSchemeRegistrySingleton["a" /* default */])().get(linearColorScheme).createLinearScale(extents),legend=Object(range["a" /* default */])(steps).map(i=>extents[0]+step*i),legendColors=legend.map(x=>colorScale(x)),cal=new cal_heatmap;cal.init({start:convertUTCTS(data.start),data:timestamps,itemSelector:calContainer.node(),legendVerticalPosition:"top",cellSize,cellPadding,cellRadius,legendCellSize:cellSize,legendCellPadding:2,legendCellRadius:cellRadius,tooltip:!0,domain:domainGranularity,subDomain:subdomainGranularity,range:data.range,browsing:!0,legend,legendColors:{colorScale,min:legendColors[0],max:legendColors[legendColors.length-1],empty:"white"},displayLegend:showLegend,itemName:"",valueFormatter,timeFormatter,subDomainTextFormat})})}Calendar.displayName="Calendar";Calendar.propTypes=propTypes;/* harmony default export */ var src_Calendar = (Calendar);\n// CONCATENATED MODULE: /Users/erik_ritter/repos/github.com/apache-superset/superset-ui/plugins/legacy-plugin-chart-calendar/src/ReactCalendar.jsx\nfunction _templateObject(){const data=_taggedTemplateLiteral(["\\n  .superset-legacy-chart-calendar {\\n    padding: 10px;\\n    position: static !important;\\n    overflow: auto !important;\\n  }\\n\\n  .superset-legacy-chart-calendar .ch-tooltip {\\n    margin-left: 20px;\\n    margin-top: 5px;\\n  }\\n"]);_templateObject=function(){return data};return data}function _taggedTemplateLiteral(strings,raw){if(!raw){raw=strings.slice(0)}return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}function _objectWithoutProperties(source,excluded){if(null==source)return{};var target=_objectWithoutPropertiesLoose(source,excluded),key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(0<=excluded.indexOf(key))continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key]}}return target}function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var target={},sourceKeys=Object.keys(source),key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(0<=excluded.indexOf(key))continue;target[key]=source[key]}return target}/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */const ReactComponent=Object(reactify["a" /* default */])(src_Calendar),Calender=(_ref)=>{let{className}=_ref,otherProps=_objectWithoutProperties(_ref,["className"]);return/*#__PURE__*/react_default.a.createElement("div",{className:className},/*#__PURE__*/react_default.a.createElement(ReactComponent,otherProps))};Calender.displayName="Calender";Calender.defaultProps={otherProps:{}};Calender.propTypes={className:prop_types_default.a.string.isRequired,otherProps:prop_types_default.a.objectOf(prop_types_default.a.any)};/* harmony default export */ var ReactCalendar = __webpack_exports__["default"] = (Object(src["a" /* default */])(Calender)(_templateObject()));//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjMwNC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8vVXNlcnMvZXJpa19yaXR0ZXIvcmVwb3MvZ2l0aHViLmNvbS9hcGFjaGUtc3VwZXJzZXQvc3VwZXJzZXQtdWkvcGx1Z2lucy9sZWdhY3ktcGx1Z2luLWNoYXJ0LWNhbGVuZGFyL3NyYy92ZW5kb3IvY2FsLWhlYXRtYXAuanM/NGE2MiIsIndlYnBhY2s6Ly8vL1VzZXJzL2VyaWtfcml0dGVyL3JlcG9zL2dpdGh1Yi5jb20vYXBhY2hlLXN1cGVyc2V0L3N1cGVyc2V0LXVpL3BsdWdpbnMvbGVnYWN5LXBsdWdpbi1jaGFydC1jYWxlbmRhci9zcmMvQ2FsZW5kYXIuanM/ODg0ZiIsIndlYnBhY2s6Ly8vL1VzZXJzL2VyaWtfcml0dGVyL3JlcG9zL2dpdGh1Yi5jb20vYXBhY2hlLXN1cGVyc2V0L3N1cGVyc2V0LXVpL3BsdWdpbnMvbGVnYWN5LXBsdWdpbi1jaGFydC1jYWxlbmRhci9zcmMvUmVhY3RDYWxlbmRhci5qc3g/ODQ1NyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBbTElDRU5TRSBUQkRdXG4vKiBDb3BpZWQgYW5kIGFsdGVyZWQgZnJvbSBodHRwOi8vY2FsLWhlYXRtYXAuY29tLyAsIGFsdGVyYXRpb25zIGFyb3VuZDpcbiAqIC0gdHVuaW5nIHRvb2x0aXBzXG4gKiAtIHN1cHBvcnRpbmcgbXVsdGktY29sb3JzIHNjYWxlc1xuICogLSBsZWdlbmQgZm9ybWF0XG4gKiAtIFVUQyBoYW5kbGluZ1xuICovXG5cbi8qIGVzbGludC1kaXNhYmxlICovXG5cbmltcG9ydCBkM3RpcCBmcm9tICdkMy10aXAnO1xuaW1wb3J0ICcuL2QzdGlwLmNzcyc7XG5cbnZhciBkMyA9IHR5cGVvZiByZXF1aXJlID09PSAnZnVuY3Rpb24nID8gcmVxdWlyZSgnZDMnKSA6IHdpbmRvdy5kMztcblxudmFyIGQzID0gdHlwZW9mIHJlcXVpcmUgPT09ICdmdW5jdGlvbicgPyByZXF1aXJlKCdkMycpIDogd2luZG93LmQzO1xuXG52YXIgQ2FsSGVhdE1hcCA9IGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHZhciBzZWxmID0gdGhpcztcbiAgc2VsZi50aXAgPSBkM3RpcCgpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ2QzLXRpcCcpXG4gICAgLmRpcmVjdGlvbignbicpXG4gICAgLm9mZnNldChbLTUsIDBdKVxuICAgIC5odG1sKFxuICAgICAgZCA9PiBgXG4gICAgICAke3NlbGYub3B0aW9ucy50aW1lRm9ybWF0dGVyKGQudCl9OiA8c3Ryb25nPiR7c2VsZi5vcHRpb25zLnZhbHVlRm9ybWF0dGVyKGQudil9PC9zdHJvbmc+XG4gICAgYCxcbiAgICApO1xuICBzZWxmLmxlZ2VuZFRpcCA9IGQzdGlwKClcbiAgICAuYXR0cignY2xhc3MnLCAnZDMtdGlwJylcbiAgICAuZGlyZWN0aW9uKCduJylcbiAgICAub2Zmc2V0KFstNSwgMF0pXG4gICAgLmh0bWwoZCA9PiBzZWxmLm9wdGlvbnMudmFsdWVGb3JtYXR0ZXIoZCkpO1xuXG4gIHRoaXMuYWxsb3dlZERhdGFUeXBlID0gWydqc29uJywgJ2NzdicsICd0c3YnLCAndHh0J107XG5cbiAgLy8gRGVmYXVsdCBzZXR0aW5nc1xuICB0aGlzLm9wdGlvbnMgPSB7XG4gICAgLy8gc2VsZWN0b3Igc3RyaW5nIG9mIHRoZSBjb250YWluZXIgdG8gYXBwZW5kIHRoZSBncmFwaCB0b1xuICAgIC8vIEFjY2VwdCBhbnkgc3RyaW5nIHZhbHVlIGFjY2VwdGVkIGJ5IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Igb3IgQ1NTM1xuICAgIC8vIG9yIGFuIEVsZW1lbnQgb2JqZWN0XG4gICAgaXRlbVNlbGVjdG9yOiAnI2NhbC1oZWF0bWFwJyxcblxuICAgIC8vIFdoZXRoZXIgdG8gcGFpbnQgdGhlIGNhbGVuZGFyIG9uIGluaXQoKVxuICAgIC8vIFVzZWQgYnkgdGVzdHN1aXRlIHRvIHJlZHVjZSB0ZXN0aW5nIHRpbWVcbiAgICBwYWludE9uTG9hZDogdHJ1ZSxcblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vIERPTUFJTlxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gICAgLy8gTnVtYmVyIG9mIGRvbWFpbiB0byBkaXNwbGF5IG9uIHRoZSBncmFwaFxuICAgIHJhbmdlOiAxMixcblxuICAgIC8vIFNpemUgb2YgZWFjaCBjZWxsLCBpbiBwaXhlbFxuICAgIGNlbGxTaXplOiAxMCxcblxuICAgIC8vIFBhZGRpbmcgYmV0d2VlbiBlYWNoIGNlbGwsIGluIHBpeGVsXG4gICAgY2VsbFBhZGRpbmc6IDIsXG5cbiAgICAvLyBGb3Igcm91bmRlZCBzdWJkb21haW4gcmVjdGFuZ2xlcywgaW4gcGl4ZWxzXG4gICAgY2VsbFJhZGl1czogMCxcblxuICAgIGRvbWFpbkd1dHRlcjogMixcblxuICAgIGRvbWFpbk1hcmdpbjogWzAsIDAsIDAsIDBdLFxuXG4gICAgdmFsdWVGb3JtYXR0ZXI6IGQgPT4gZCxcblxuICAgIHRpbWVGb3JtYXR0ZXI6IGQgPT4gZCxcblxuICAgIGRvbWFpbjogJ2hvdXInLFxuXG4gICAgc3ViRG9tYWluOiAnbWluJyxcblxuICAgIC8vIE51bWJlciBvZiBjb2x1bW5zIHRvIHNwbGl0IHRoZSBzdWJEb21haW5zIHRvXG4gICAgLy8gSWYgbm90IG51bGwsIHdpbGwgdGFrZXMgcHJlY2VkZW5jZSBvdmVyIHJvd0xpbWl0XG4gICAgY29sTGltaXQ6IG51bGwsXG5cbiAgICAvLyBOdW1iZXIgb2Ygcm93cyB0byBzcGxpdCB0aGUgc3ViRG9tYWlucyB0b1xuICAgIC8vIFdpbGwgYmUgaWdub3JlZCBpZiBjb2xMaW1pdCBpcyBub3QgbnVsbFxuICAgIHJvd0xpbWl0OiBudWxsLFxuXG4gICAgLy8gRmlyc3QgZGF5IG9mIHRoZSB3ZWVrIGlzIE1vbmRheVxuICAgIC8vIDAgdG8gc3RhcnQgdGhlIHdlZWsgb24gU3VuZGF5XG4gICAgd2Vla1N0YXJ0T25Nb25kYXk6IHRydWUsXG5cbiAgICAvLyBTdGFydCBkYXRlIG9mIHRoZSBncmFwaFxuICAgIC8vIEBkZWZhdWx0IG5vd1xuICAgIHN0YXJ0OiBuZXcgRGF0ZSgpLFxuXG4gICAgbWluRGF0ZTogbnVsbCxcblxuICAgIG1heERhdGU6IG51bGwsXG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyBEQVRBXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgICAvLyBEYXRhIHNvdXJjZVxuICAgIC8vIFVSTCwgd2hlcmUgdG8gZmV0Y2ggdGhlIG9yaWdpbmFsIGRhdGFzXG4gICAgZGF0YTogJycsXG5cbiAgICAvLyBEYXRhIHR5cGVcbiAgICAvLyBEZWZhdWx0OiBqc29uXG4gICAgZGF0YVR5cGU6IHRoaXMuYWxsb3dlZERhdGFUeXBlWzBdLFxuXG4gICAgLy8gUGF5bG9hZCBzZW50IHdoZW4gdXNpbmcgUE9TVCBodHRwIG1ldGhvZFxuICAgIC8vIExlYXZlIHRvIG51bGwgKGRlZmF1bHQpIGZvciBHRVQgcmVxdWVzdFxuICAgIC8vIEV4cGVjdCBhIHN0cmluZywgZm9ybWF0dGVkIGxpa2UgXCJhPWI7Yz1kXCJcbiAgICBkYXRhUG9zdFBheWxvYWQ6IG51bGwsXG5cbiAgICAvLyBBZGRpdGlvbmFsIGhlYWRlcnMgc2VudCB3aGVuIHJlcXVlc3RpbmcgZGF0YVxuICAgIC8vIEV4cGVjdCBhbiBvYmplY3QgZm9ybWF0dGVkIGxpa2U6XG4gICAgLy8geyAnWC1DU1JGLVRPS0VOJzogJ3Rva2VuJyB9XG4gICAgZGF0YVJlcXVlc3RIZWFkZXJzOiBudWxsLFxuXG4gICAgLy8gV2hldGhlciB0byBjb25zaWRlciBtaXNzaW5nIGRhdGU6dmFsdWUgZnJvbSB0aGUgZGF0YXNvdXJjZVxuICAgIC8vIGFzIGVxdWFsIHRvIDAsIG9yIGp1c3QgbGVhdmUgdGhlbSBhcyBtaXNzaW5nXG4gICAgY29uc2lkZXJNaXNzaW5nRGF0YUFzWmVybzogZmFsc2UsXG5cbiAgICAvLyBMb2FkIHJlbW90ZSBkYXRhIG9uIGNhbGVuZGFyIGNyZWF0aW9uXG4gICAgLy8gV2hlbiBmYWxzZSwgdGhlIGNhbGVuZGFyIHdpbGwgYmUgbGVmdCBlbXB0eVxuICAgIGxvYWRPbkluaXQ6IHRydWUsXG5cbiAgICAvLyBDYWxlbmRhciBvcmllbnRhdGlvblxuICAgIC8vIGZhbHNlOiBkaXNwbGF5IGRvbWFpbnMgc2lkZSBieSBzaWRlXG4gICAgLy8gdHJ1ZSA6IGRpc3BsYXkgZG9tYWlucyBvbmUgdW5kZXIgdGhlIG90aGVyXG4gICAgdmVydGljYWxPcmllbnRhdGlvbjogZmFsc2UsXG5cbiAgICAvLyBEb21haW4gZHluYW1pYyB3aWR0aC9oZWlnaHRcbiAgICAvLyBUaGUgd2lkdGggb24gYSBkb21haW4gZGVwZW5kcyBvbiB0aGUgbnVtYmVyIG9mXG4gICAgZG9tYWluRHluYW1pY0RpbWVuc2lvbjogdHJ1ZSxcblxuICAgIC8vIERvbWFpbiBMYWJlbCBwcm9wZXJ0aWVzXG4gICAgbGFiZWw6IHtcbiAgICAgIC8vIHZhbGlkOiB0b3AsIHJpZ2h0LCBib3R0b20sIGxlZnRcbiAgICAgIHBvc2l0aW9uOiAnYm90dG9tJyxcblxuICAgICAgLy8gVmFsaWQ6IGxlZnQsIGNlbnRlciwgcmlnaHRcbiAgICAgIC8vIEFsc28gdmFsaWQgYXJlIHRoZSBkaXJlY3Qgc3ZnIHZhbHVlczogc3RhcnQsIG1pZGRsZSwgZW5kXG4gICAgICBhbGlnbjogJ2NlbnRlcicsXG5cbiAgICAgIC8vIEJ5IGRlZmF1bHQsIHRoZXJlIGlzIG5vIG1hcmdpbi9wYWRkaW5nIGFyb3VuZCB0aGUgbGFiZWxcbiAgICAgIG9mZnNldDoge1xuICAgICAgICB4OiAwLFxuICAgICAgICB5OiAwLFxuICAgICAgfSxcblxuICAgICAgcm90YXRlOiBudWxsLFxuXG4gICAgICAvLyBVc2VkIG9ubHkgb24gdmVydGljYWwgb3JpZW50YXRpb25cbiAgICAgIHdpZHRoOiAxMDAsXG5cbiAgICAgIC8vIFVzZWQgb25seSBvbiBob3Jpem9udGFsIG9yaWVudGF0aW9uXG4gICAgICBoZWlnaHQ6IG51bGwsXG4gICAgfSxcblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vIExFR0VORFxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gICAgLy8gVGhyZXNob2xkIGZvciB0aGUgbGVnZW5kXG4gICAgbGVnZW5kOiBbMTAsIDIwLCAzMCwgNDBdLFxuXG4gICAgLy8gV2hldGhlciB0byBkaXNwbGF5IHRoZSBsZWdlbmRcbiAgICBkaXNwbGF5TGVnZW5kOiB0cnVlLFxuXG4gICAgbGVnZW5kQ2VsbFNpemU6IDEwLFxuXG4gICAgbGVnZW5kQ2VsbFBhZGRpbmc6IDIsXG5cbiAgICBsZWdlbmRNYXJnaW46IFswLCAwLCAwLCAwXSxcblxuICAgIC8vIExlZ2VuZCB2ZXJ0aWNhbCBwb3NpdGlvblxuICAgIC8vIHRvcDogcGxhY2UgbGVnZW5kIGFib3ZlIGNhbGVuZGFyXG4gICAgLy8gYm90dG9tOiBwbGFjZSBsZWdlbmQgYmVsb3cgdGhlIGNhbGVuZGFyXG4gICAgbGVnZW5kVmVydGljYWxQb3NpdGlvbjogJ2JvdHRvbScsXG5cbiAgICAvLyBMZWdlbmQgaG9yaXpvbnRhbCBwb3NpdGlvblxuICAgIC8vIGFjY2VwdGVkIHZhbHVlczogbGVmdCwgY2VudGVyLCByaWdodFxuICAgIGxlZ2VuZEhvcml6b250YWxQb3NpdGlvbjogJ2xlZnQnLFxuXG4gICAgLy8gTGVnZW5kIHJvdGF0aW9uXG4gICAgLy8gYWNjZXB0ZWQgdmFsdWVzOiBob3Jpem9udGFsLCB2ZXJ0aWNhbFxuICAgIGxlZ2VuZE9yaWVudGF0aW9uOiAnaG9yaXpvbnRhbCcsXG5cbiAgICAvLyBPYmplY3RzIGhvbGRpbmcgYWxsIHRoZSBoZWF0bWFwIGRpZmZlcmVudCBjb2xvcnNcbiAgICAvLyBudWxsIHRvIGRpc2FibGUsIGFuZCB1c2UgdGhlIGRlZmF1bHQgY3NzIHN0eWxlc1xuICAgIC8vXG4gICAgLy8gRXhhbXBsZXM6XG4gICAgLy8gbGVnZW5kQ29sb3JzOiB7XG4gICAgLy8gICAgbWluOiBcImdyZWVuXCIsXG4gICAgLy8gICAgbWF4OiBcInJlZFwiLFxuICAgIC8vICAgIGVtcHR5OiBcIiNmZmZmZmZcIixcbiAgICAvLyAgICBiYXNlOiBcImdyZXlcIixcbiAgICAvLyAgICBvdmVyZmxvdzogXCJyZWRcIixcbiAgICAvLyAgICBjb2xvclNjYWxlcjogbnVsbCxcbiAgICAvLyB9XG4gICAgbGVnZW5kQ29sb3JzOiBudWxsLFxuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gSElHSExJR0hUXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgICAvLyBMaXN0IG9mIGRhdGVzIHRvIGhpZ2hsaWdodFxuICAgIC8vIFZhbGlkIHZhbHVlczpcbiAgICAvLyAtIFtdOiBkb24ndCBoaWdobGlnaHQgYW55dGhpbmdcbiAgICAvLyAtIFwibm93XCI6IGhpZ2hsaWdodCB0aGUgY3VycmVudCBkYXRlXG4gICAgLy8gLSBhbiBhcnJheSBvZiBEYXRlIG9iamVjdHM6IGhpZ2hsaWdodCB0aGUgc3BlY2lmaWVkIGRhdGVzXG4gICAgaGlnaGxpZ2h0OiBbXSxcblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vIFRFWFQgRk9STUFUVElORyAvIGkxOG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAgIC8vIE5hbWUgb2YgdGhlIGl0ZW1zIHRvIHJlcHJlc2VudCBpbiB0aGUgY2FsZW5kYXJcbiAgICBpdGVtTmFtZTogWydpdGVtJywgJ2l0ZW1zJ10sXG5cbiAgICAvLyBGb3JtYXR0aW5nIG9mIHRoZSBkb21haW4gbGFiZWxcbiAgICAvLyBAZGVmYXVsdDogbnVsbCwgd2lsbCB1c2UgdGhlIGZvcm1hdHRpbmcgYWNjb3JkaW5nIHRvIGRvbWFpbiB0eXBlXG4gICAgLy8gQWNjZXB0IGEgc3RyaW5nIHVzZWQgYXMgc3BlY2lmaWVyIGJ5IGQzLnRpbWUuZm9ybWF0KClcbiAgICAvLyBvciBhIGZ1bmN0aW9uXG4gICAgLy9cbiAgICAvLyBSZWZlciB0byBodHRwczovL2dpdGh1Yi5jb20vbWJvc3RvY2svZDMvd2lraS9UaW1lLUZvcm1hdHRpbmdcbiAgICAvLyBmb3IgYWNjZXB0ZWQgZGF0ZSBmb3JtYXR0aW5nIHVzZWQgYnkgZDMudGltZS5mb3JtYXQoKVxuICAgIGRvbWFpbkxhYmVsRm9ybWF0OiBudWxsLFxuXG4gICAgLy8gRm9ybWF0dGluZyBvZiB0aGUgdGl0bGUgZGlzcGxheWVkIHdoZW4gaG92ZXJpbmcgYSBzdWJEb21haW4gY2VsbFxuICAgIHN1YkRvbWFpblRpdGxlRm9ybWF0OiB7XG4gICAgICBlbXB0eTogJ3tkYXRlfScsXG4gICAgICBmaWxsZWQ6ICd7Y291bnR9IHtuYW1lfSB7Y29ubmVjdG9yfSB7ZGF0ZX0nLFxuICAgIH0sXG5cbiAgICAvLyBGb3JtYXR0aW5nIG9mIHRoZSB7ZGF0ZX0gdXNlZCBpbiBzdWJEb21haW5UaXRsZUZvcm1hdFxuICAgIC8vIEBkZWZhdWx0OiBudWxsLCB3aWxsIHVzZSB0aGUgZm9ybWF0dGluZyBhY2NvcmRpbmcgdG8gc3ViRG9tYWluIHR5cGVcbiAgICAvLyBBY2NlcHQgYSBzdHJpbmcgdXNlZCBhcyBzcGVjaWZpZXIgYnkgZDMudGltZS5mb3JtYXQoKVxuICAgIC8vIG9yIGEgZnVuY3Rpb25cbiAgICAvL1xuICAgIC8vIFJlZmVyIHRvIGh0dHBzOi8vZ2l0aHViLmNvbS9tYm9zdG9jay9kMy93aWtpL1RpbWUtRm9ybWF0dGluZ1xuICAgIC8vIGZvciBhY2NlcHRlZCBkYXRlIGZvcm1hdHRpbmcgdXNlZCBieSBkMy50aW1lLmZvcm1hdCgpXG4gICAgc3ViRG9tYWluRGF0ZUZvcm1hdDogbnVsbCxcblxuICAgIC8vIEZvcm1hdHRpbmcgb2YgdGhlIHRleHQgaW5zaWRlIGVhY2ggc3ViRG9tYWluIGNlbGxcbiAgICAvLyBAZGVmYXVsdDogbnVsbCwgbm8gdGV4dFxuICAgIC8vIEFjY2VwdCBhIHN0cmluZyB1c2VkIGFzIHNwZWNpZmllciBieSBkMy50aW1lLmZvcm1hdCgpXG4gICAgLy8gb3IgYSBmdW5jdGlvblxuICAgIC8vXG4gICAgLy8gUmVmZXIgdG8gaHR0cHM6Ly9naXRodWIuY29tL21ib3N0b2NrL2QzL3dpa2kvVGltZS1Gb3JtYXR0aW5nXG4gICAgLy8gZm9yIGFjY2VwdGVkIGRhdGUgZm9ybWF0dGluZyB1c2VkIGJ5IGQzLnRpbWUuZm9ybWF0KClcbiAgICBzdWJEb21haW5UZXh0Rm9ybWF0OiBudWxsLFxuXG4gICAgLy8gRm9ybWF0dGluZyBvZiB0aGUgdGl0bGUgZGlzcGxheWVkIHdoZW4gaG92ZXJpbmcgYSBsZWdlbmQgY2VsbFxuICAgIGxlZ2VuZFRpdGxlRm9ybWF0OiB7XG4gICAgICBsb3dlcjogJ2xlc3MgdGhhbiB7bWlufSB7bmFtZX0nLFxuICAgICAgaW5uZXI6ICdiZXR3ZWVuIHtkb3dufSBhbmQge3VwfSB7bmFtZX0nLFxuICAgICAgdXBwZXI6ICdtb3JlIHRoYW4ge21heH0ge25hbWV9JyxcbiAgICB9LFxuXG4gICAgLy8gQW5pbWF0aW9uIGR1cmF0aW9uLCBpbiBtc1xuICAgIGFuaW1hdGlvbkR1cmF0aW9uOiA1MDAsXG5cbiAgICBuZXh0U2VsZWN0b3I6IGZhbHNlLFxuXG4gICAgcHJldmlvdXNTZWxlY3RvcjogZmFsc2UsXG5cbiAgICBpdGVtTmFtZXNwYWNlOiAnY2FsLWhlYXRtYXAnLFxuXG4gICAgdG9vbHRpcDogZmFsc2UsXG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyBFVkVOVFMgQ0FMTEJBQ0tcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAgIC8vIENhbGxiYWNrIHdoZW4gY2xpY2tpbmcgb24gYSB0aW1lIGJsb2NrXG4gICAgb25DbGljazogbnVsbCxcblxuICAgIC8vIENhbGxiYWNrIGFmdGVyIHBhaW50aW5nIHRoZSBlbXB0eSBjYWxlbmRhclxuICAgIC8vIENhbiBiZSB1c2VkIHRvIHRyaWdnZXIgYW4gQVBJIGNhbGwsIG9uY2UgdGhlIGNhbGVuZGFyIGlzIHJlYWR5IHRvIGJlIGZpbGxlZFxuICAgIGFmdGVyTG9hZDogbnVsbCxcblxuICAgIC8vIENhbGxiYWNrIGFmdGVyIGxvYWRpbmcgdGhlIG5leHQgZG9tYWluIGluIHRoZSBjYWxlbmRhclxuICAgIGFmdGVyTG9hZE5leHREb21haW46IG51bGwsXG5cbiAgICAvLyBDYWxsYmFjayBhZnRlciBsb2FkaW5nIHRoZSBwcmV2aW91cyBkb21haW4gaW4gdGhlIGNhbGVuZGFyXG4gICAgYWZ0ZXJMb2FkUHJldmlvdXNEb21haW46IG51bGwsXG5cbiAgICAvLyBDYWxsYmFjayBhZnRlciBmaW5pc2hpbmcgYWxsIGFjdGlvbnMgb24gdGhlIGNhbGVuZGFyXG4gICAgb25Db21wbGV0ZTogbnVsbCxcblxuICAgIC8vIENhbGxiYWNrIGFmdGVyIGZldGNoaW5nIHRoZSBkYXRhcywgYnV0IGJlZm9yZSBhcHBseWluZyB0aGVtIHRvIHRoZSBjYWxlbmRhclxuICAgIC8vIFVzZWQgbWFpbmx5IHRvIGNvbnZlcnQgdGhlIGRhdGFzIGlmIHRoZXkncmUgbm90IGZvcm1hdHRlZCBsaWtlIGV4cGVjdGVkXG4gICAgLy8gVGFrZXMgdGhlIGZldGNoZWQgXCJkYXRhXCIgb2JqZWN0IGFzIGFyZ3VtZW50LCBtdXN0IHJldHVybiBhIGpzb24gb2JqZWN0XG4gICAgLy8gZm9ybWF0dGVkIGxpa2Uge3RpbWVzdGFtcDpjb3VudCwgdGltZXN0YW1wMjpjb3VudDJ9LFxuICAgIGFmdGVyTG9hZERhdGE6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9LFxuXG4gICAgLy8gQ2FsbGJhY2sgdHJpZ2dlcmVkIGFmdGVyIGNhbGxpbmcgYW5kIGNvbXBsZXRpbmcgdXBkYXRlKCkuXG4gICAgYWZ0ZXJVcGRhdGU6IG51bGwsXG5cbiAgICAvLyBDYWxsYmFjayB0cmlnZ2VyZWQgYWZ0ZXIgY2FsbGluZyBuZXh0KCkuXG4gICAgLy8gVGhlIGBzdGF0dXNgIGFyZ3VtZW50IGlzIGVxdWFsIHRvIHRydWUgaWYgdGhlcmUgaXMgbm9cbiAgICAvLyBtb3JlIG5leHQgZG9tYWluIHRvIGxvYWRcbiAgICAvL1xuICAgIC8vIFRoaXMgY2FsbGJhY2sgaXMgYWxzbyBleGVjdXRlZCBvbmNlLCBhZnRlciBjYWxsaW5nIHByZXZpb3VzKCksXG4gICAgLy8gb25seSB3aGVuIHRoZSBtYXggZG9tYWluIGlzIHJlYWNoZWRcbiAgICBvbk1heERvbWFpblJlYWNoZWQ6IG51bGwsXG5cbiAgICAvLyBDYWxsYmFjayB0cmlnZ2VyZWQgYWZ0ZXIgY2FsbGluZyBwcmV2aW91cygpLlxuICAgIC8vIFRoZSBgc3RhdHVzYCBhcmd1bWVudCBpcyBlcXVhbCB0byB0cnVlIGlmIHRoZXJlIGlzIG5vXG4gICAgLy8gbW9yZSBwcmV2aW91cyBkb21haW4gdG8gbG9hZFxuICAgIC8vXG4gICAgLy8gVGhpcyBjYWxsYmFjayBpcyBhbHNvIGV4ZWN1dGVkIG9uY2UsIGFmdGVyIGNhbGxpbmcgbmV4dCgpLFxuICAgIC8vIG9ubHkgd2hlbiB0aGUgbWluIGRvbWFpbiBpcyByZWFjaGVkXG4gICAgb25NaW5Eb21haW5SZWFjaGVkOiBudWxsLFxuICB9O1xuXG4gIHRoaXMuX2RvbWFpblR5cGUgPSB7XG4gICAgbWluOiB7XG4gICAgICBuYW1lOiAnbWludXRlJyxcbiAgICAgIGxldmVsOiAxMCxcbiAgICAgIG1heEl0ZW1OdW1iZXI6IDYwLFxuICAgICAgZGVmYXVsdFJvd051bWJlcjogMTAsXG4gICAgICBkZWZhdWx0Q29sdW1uTnVtYmVyOiA2LFxuICAgICAgcm93OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gc2VsZi5nZXRTdWJEb21haW5Sb3dOdW1iZXIoZCk7XG4gICAgICB9LFxuICAgICAgY29sdW1uOiBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gc2VsZi5nZXRTdWJEb21haW5Db2x1bW5OdW1iZXIoZCk7XG4gICAgICB9LFxuICAgICAgcG9zaXRpb246IHtcbiAgICAgICAgeDogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihkLmdldE1pbnV0ZXMoKSAvIHNlbGYuX2RvbWFpblR5cGUubWluLnJvdyhkKSk7XG4gICAgICAgIH0sXG4gICAgICAgIHk6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgcmV0dXJuIGQuZ2V0TWludXRlcygpICUgc2VsZi5fZG9tYWluVHlwZS5taW4ucm93KGQpO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIGZvcm1hdDoge1xuICAgICAgICBkYXRlOiAnJUg6JU0sICVBICVCICUtZSwgJVknLFxuICAgICAgICBsZWdlbmQ6ICcnLFxuICAgICAgICBjb25uZWN0b3I6ICdhdCcsXG4gICAgICB9LFxuICAgICAgZXh0cmFjdFVuaXQ6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0ZShcbiAgICAgICAgICBkLmdldEZ1bGxZZWFyKCksXG4gICAgICAgICAgZC5nZXRNb250aCgpLFxuICAgICAgICAgIGQuZ2V0RGF0ZSgpLFxuICAgICAgICAgIGQuZ2V0SG91cnMoKSxcbiAgICAgICAgICBkLmdldE1pbnV0ZXMoKSxcbiAgICAgICAgKS5nZXRUaW1lKCk7XG4gICAgICB9LFxuICAgIH0sXG4gICAgaG91cjoge1xuICAgICAgbmFtZTogJ2hvdXInLFxuICAgICAgbGV2ZWw6IDIwLFxuICAgICAgbWF4SXRlbU51bWJlcjogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgc3dpdGNoIChzZWxmLm9wdGlvbnMuZG9tYWluKSB7XG4gICAgICAgICAgY2FzZSAnZGF5JzpcbiAgICAgICAgICAgIHJldHVybiAyNDtcbiAgICAgICAgICBjYXNlICd3ZWVrJzpcbiAgICAgICAgICAgIHJldHVybiAyNCAqIDc7XG4gICAgICAgICAgY2FzZSAnbW9udGgnOlxuICAgICAgICAgICAgcmV0dXJuIDI0ICogKHNlbGYub3B0aW9ucy5kb21haW5EeW5hbWljRGltZW5zaW9uID8gc2VsZi5nZXREYXlDb3VudEluTW9udGgoZCkgOiAzMSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBkZWZhdWx0Um93TnVtYmVyOiA2LFxuICAgICAgZGVmYXVsdENvbHVtbk51bWJlcjogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgc3dpdGNoIChzZWxmLm9wdGlvbnMuZG9tYWluKSB7XG4gICAgICAgICAgY2FzZSAnZGF5JzpcbiAgICAgICAgICAgIHJldHVybiA0O1xuICAgICAgICAgIGNhc2UgJ3dlZWsnOlxuICAgICAgICAgICAgcmV0dXJuIDI4O1xuICAgICAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgICAgIHJldHVybiBzZWxmLm9wdGlvbnMuZG9tYWluRHluYW1pY0RpbWVuc2lvbiA/IHNlbGYuZ2V0RGF5Q291bnRJbk1vbnRoKGQpIDogMzE7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByb3c6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmdldFN1YkRvbWFpblJvd051bWJlcihkKTtcbiAgICAgIH0sXG4gICAgICBjb2x1bW46IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmdldFN1YkRvbWFpbkNvbHVtbk51bWJlcihkKTtcbiAgICAgIH0sXG4gICAgICBwb3NpdGlvbjoge1xuICAgICAgICB4OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuZG9tYWluID09PSAnbW9udGgnKSB7XG4gICAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmNvbExpbWl0ID4gMCB8fCBzZWxmLm9wdGlvbnMucm93TGltaXQgPiAwKSB7XG4gICAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKFxuICAgICAgICAgICAgICAgIChkLmdldEhvdXJzKCkgKyAoZC5nZXREYXRlKCkgLSAxKSAqIDI0KSAvIHNlbGYuX2RvbWFpblR5cGUuaG91ci5yb3coZCksXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihkLmdldEhvdXJzKCkgLyBzZWxmLl9kb21haW5UeXBlLmhvdXIucm93KGQpKSArIChkLmdldERhdGUoKSAtIDEpICogNDtcbiAgICAgICAgICB9IGVsc2UgaWYgKHNlbGYub3B0aW9ucy5kb21haW4gPT09ICd3ZWVrJykge1xuICAgICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5jb2xMaW1pdCA+IDAgfHwgc2VsZi5vcHRpb25zLnJvd0xpbWl0ID4gMCkge1xuICAgICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihcbiAgICAgICAgICAgICAgICAoZC5nZXRIb3VycygpICsgc2VsZi5nZXRXZWVrRGF5KGQpICogMjQpIC8gc2VsZi5fZG9tYWluVHlwZS5ob3VyLnJvdyhkKSxcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKGQuZ2V0SG91cnMoKSAvIHNlbGYuX2RvbWFpblR5cGUuaG91ci5yb3coZCkpICsgc2VsZi5nZXRXZWVrRGF5KGQpICogNDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoZC5nZXRIb3VycygpIC8gc2VsZi5fZG9tYWluVHlwZS5ob3VyLnJvdyhkKSk7XG4gICAgICAgIH0sXG4gICAgICAgIHk6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgdmFyIHAgPSBkLmdldEhvdXJzKCk7XG4gICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5jb2xMaW1pdCA+IDAgfHwgc2VsZi5vcHRpb25zLnJvd0xpbWl0ID4gMCkge1xuICAgICAgICAgICAgc3dpdGNoIChzZWxmLm9wdGlvbnMuZG9tYWluKSB7XG4gICAgICAgICAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgICAgICAgICBwICs9IChkLmdldERhdGUoKSAtIDEpICogMjQ7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgJ3dlZWsnOlxuICAgICAgICAgICAgICAgIHAgKz0gc2VsZi5nZXRXZWVrRGF5KGQpICogMjQ7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKHAgJSBzZWxmLl9kb21haW5UeXBlLmhvdXIucm93KGQpKTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBmb3JtYXQ6IHtcbiAgICAgICAgZGF0ZTogJyVIaCwgJUEgJUIgJS1lLCAlWScsXG4gICAgICAgIGxlZ2VuZDogJyVIOjAwJyxcbiAgICAgICAgY29ubmVjdG9yOiAnYXQnLFxuICAgICAgfSxcbiAgICAgIGV4dHJhY3RVbml0OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCksIGQuZ2V0RGF0ZSgpLCBkLmdldEhvdXJzKCkpLmdldFRpbWUoKTtcbiAgICAgIH0sXG4gICAgfSxcbiAgICBkYXk6IHtcbiAgICAgIG5hbWU6ICdkYXknLFxuICAgICAgbGV2ZWw6IDMwLFxuICAgICAgbWF4SXRlbU51bWJlcjogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgc3dpdGNoIChzZWxmLm9wdGlvbnMuZG9tYWluKSB7XG4gICAgICAgICAgY2FzZSAnd2Vlayc6XG4gICAgICAgICAgICByZXR1cm4gNztcbiAgICAgICAgICBjYXNlICdtb250aCc6XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5vcHRpb25zLmRvbWFpbkR5bmFtaWNEaW1lbnNpb24gPyBzZWxmLmdldERheUNvdW50SW5Nb250aChkKSA6IDMxO1xuICAgICAgICAgIGNhc2UgJ3llYXInOlxuICAgICAgICAgICAgcmV0dXJuIHNlbGYub3B0aW9ucy5kb21haW5EeW5hbWljRGltZW5zaW9uID8gc2VsZi5nZXREYXlDb3VudEluWWVhcihkKSA6IDM2NjtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRlZmF1bHRDb2x1bW5OdW1iZXI6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIGQgPSBuZXcgRGF0ZShkKTtcbiAgICAgICAgc3dpdGNoIChzZWxmLm9wdGlvbnMuZG9tYWluKSB7XG4gICAgICAgICAgY2FzZSAnd2Vlayc6XG4gICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICBjYXNlICdtb250aCc6XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5vcHRpb25zLmRvbWFpbkR5bmFtaWNEaW1lbnNpb24gJiYgIXNlbGYub3B0aW9ucy52ZXJ0aWNhbE9yaWVudGF0aW9uXG4gICAgICAgICAgICAgID8gc2VsZi5nZXRXZWVrTnVtYmVyKG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpICsgMSwgMCkpIC1cbiAgICAgICAgICAgICAgICAgIHNlbGYuZ2V0V2Vla051bWJlcihkKSArXG4gICAgICAgICAgICAgICAgICAxXG4gICAgICAgICAgICAgIDogNjtcbiAgICAgICAgICBjYXNlICd5ZWFyJzpcbiAgICAgICAgICAgIHJldHVybiBzZWxmLm9wdGlvbnMuZG9tYWluRHluYW1pY0RpbWVuc2lvblxuICAgICAgICAgICAgICA/IHNlbGYuZ2V0V2Vla051bWJlcihuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIDExLCAzMSkpIC1cbiAgICAgICAgICAgICAgICAgIHNlbGYuZ2V0V2Vla051bWJlcihuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIDApKSArXG4gICAgICAgICAgICAgICAgICAxXG4gICAgICAgICAgICAgIDogNTQ7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBkZWZhdWx0Um93TnVtYmVyOiA3LFxuICAgICAgcm93OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gc2VsZi5nZXRTdWJEb21haW5Sb3dOdW1iZXIoZCk7XG4gICAgICB9LFxuICAgICAgY29sdW1uOiBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gc2VsZi5nZXRTdWJEb21haW5Db2x1bW5OdW1iZXIoZCk7XG4gICAgICB9LFxuICAgICAgcG9zaXRpb246IHtcbiAgICAgICAgeDogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICBzd2l0Y2ggKHNlbGYub3B0aW9ucy5kb21haW4pIHtcbiAgICAgICAgICAgIGNhc2UgJ3dlZWsnOlxuICAgICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihzZWxmLmdldFdlZWtEYXkoZCkgLyBzZWxmLl9kb21haW5UeXBlLmRheS5yb3coZCkpO1xuICAgICAgICAgICAgY2FzZSAnbW9udGgnOlxuICAgICAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmNvbExpbWl0ID4gMCB8fCBzZWxmLm9wdGlvbnMucm93TGltaXQgPiAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoKGQuZ2V0RGF0ZSgpIC0gMSkgLyBzZWxmLl9kb21haW5UeXBlLmRheS5yb3coZCkpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgc2VsZi5nZXRXZWVrTnVtYmVyKGQpIC0gc2VsZi5nZXRXZWVrTnVtYmVyKG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpKSlcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGNhc2UgJ3llYXInOlxuICAgICAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmNvbExpbWl0ID4gMCB8fCBzZWxmLm9wdGlvbnMucm93TGltaXQgPiAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoKHNlbGYuZ2V0RGF5T2ZZZWFyKGQpIC0gMSkgLyBzZWxmLl9kb21haW5UeXBlLmRheS5yb3coZCkpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJldHVybiBzZWxmLmdldFdlZWtOdW1iZXIoZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB5OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHZhciBwID0gc2VsZi5nZXRXZWVrRGF5KGQpO1xuICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuY29sTGltaXQgPiAwIHx8IHNlbGYub3B0aW9ucy5yb3dMaW1pdCA+IDApIHtcbiAgICAgICAgICAgIHN3aXRjaCAoc2VsZi5vcHRpb25zLmRvbWFpbikge1xuICAgICAgICAgICAgICBjYXNlICd5ZWFyJzpcbiAgICAgICAgICAgICAgICBwID0gc2VsZi5nZXREYXlPZlllYXIoZCkgLSAxO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlICd3ZWVrJzpcbiAgICAgICAgICAgICAgICBwID0gc2VsZi5nZXRXZWVrRGF5KGQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlICdtb250aCc6XG4gICAgICAgICAgICAgICAgcCA9IGQuZ2V0RGF0ZSgpIC0gMTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IocCAlIHNlbGYuX2RvbWFpblR5cGUuZGF5LnJvdyhkKSk7XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgZm9ybWF0OiB7XG4gICAgICAgIGRhdGU6ICclQSAlQiAlLWUsICVZJyxcbiAgICAgICAgbGVnZW5kOiAnJWUgJWInLFxuICAgICAgICBjb25uZWN0b3I6ICdvbicsXG4gICAgICB9LFxuICAgICAgZXh0cmFjdFVuaXQ6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSwgZC5nZXREYXRlKCkpLmdldFRpbWUoKTtcbiAgICAgIH0sXG4gICAgfSxcbiAgICB3ZWVrOiB7XG4gICAgICBuYW1lOiAnd2VlaycsXG4gICAgICBsZXZlbDogNDAsXG4gICAgICBtYXhJdGVtTnVtYmVyOiA1NCxcbiAgICAgIGRlZmF1bHRDb2x1bW5OdW1iZXI6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIGQgPSBuZXcgRGF0ZShkKTtcbiAgICAgICAgc3dpdGNoIChzZWxmLm9wdGlvbnMuZG9tYWluKSB7XG4gICAgICAgICAgY2FzZSAneWVhcic6XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5fZG9tYWluVHlwZS53ZWVrLm1heEl0ZW1OdW1iZXI7XG4gICAgICAgICAgY2FzZSAnbW9udGgnOlxuICAgICAgICAgICAgcmV0dXJuIHNlbGYub3B0aW9ucy5kb21haW5EeW5hbWljRGltZW5zaW9uXG4gICAgICAgICAgICAgID8gc2VsZi5nZXRXZWVrTnVtYmVyKG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpICsgMSwgMCkpIC1cbiAgICAgICAgICAgICAgICAgIHNlbGYuZ2V0V2Vla051bWJlcihkKVxuICAgICAgICAgICAgICA6IDU7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBkZWZhdWx0Um93TnVtYmVyOiAxLFxuICAgICAgcm93OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gc2VsZi5nZXRTdWJEb21haW5Sb3dOdW1iZXIoZCk7XG4gICAgICB9LFxuICAgICAgY29sdW1uOiBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gc2VsZi5nZXRTdWJEb21haW5Db2x1bW5OdW1iZXIoZCk7XG4gICAgICB9LFxuICAgICAgcG9zaXRpb246IHtcbiAgICAgICAgeDogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICBzd2l0Y2ggKHNlbGYub3B0aW9ucy5kb21haW4pIHtcbiAgICAgICAgICAgIGNhc2UgJ3llYXInOlxuICAgICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihzZWxmLmdldFdlZWtOdW1iZXIoZCkgLyBzZWxmLl9kb21haW5UeXBlLndlZWsucm93KGQpKTtcbiAgICAgICAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3Ioc2VsZi5nZXRNb250aFdlZWtOdW1iZXIoZCkgLyBzZWxmLl9kb21haW5UeXBlLndlZWsucm93KGQpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHk6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0V2Vla051bWJlcihkKSAlIHNlbGYuX2RvbWFpblR5cGUud2Vlay5yb3coZCk7XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgZm9ybWF0OiB7XG4gICAgICAgIGRhdGU6ICclQiBXZWVrICMlVycsXG4gICAgICAgIGxlZ2VuZDogJyVCIFdlZWsgIyVXJyxcbiAgICAgICAgY29ubmVjdG9yOiAnaW4nLFxuICAgICAgfSxcbiAgICAgIGV4dHJhY3RVbml0OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICB2YXIgZHQgPSBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSwgZC5nZXREYXRlKCkpO1xuICAgICAgICAvLyBBY2NvcmRpbmcgdG8gSVNPLTg2MDEsIHdlZWsgbnVtYmVyIGNvbXB1dGF0aW9uIGFyZSBiYXNlZCBvbiB3ZWVrIHN0YXJ0aW5nIG9uIE1vbmRheVxuICAgICAgICB2YXIgd2Vla0RheSA9IGR0LmdldERheSgpIC0gKHNlbGYub3B0aW9ucy53ZWVrU3RhcnRPbk1vbmRheSA/IDEgOiAwKTtcbiAgICAgICAgaWYgKHdlZWtEYXkgPCAwKSB7XG4gICAgICAgICAgd2Vla0RheSA9IDY7XG4gICAgICAgIH1cbiAgICAgICAgZHQuc2V0RGF0ZShkdC5nZXREYXRlKCkgLSB3ZWVrRGF5KTtcbiAgICAgICAgcmV0dXJuIGR0LmdldFRpbWUoKTtcbiAgICAgIH0sXG4gICAgfSxcbiAgICBtb250aDoge1xuICAgICAgbmFtZTogJ21vbnRoJyxcbiAgICAgIGxldmVsOiA1MCxcbiAgICAgIG1heEl0ZW1OdW1iZXI6IDEyLFxuICAgICAgZGVmYXVsdENvbHVtbk51bWJlcjogMTIsXG4gICAgICBkZWZhdWx0Um93TnVtYmVyOiAxLFxuICAgICAgcm93OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmdldFN1YkRvbWFpblJvd051bWJlcigpO1xuICAgICAgfSxcbiAgICAgIGNvbHVtbjogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc2VsZi5nZXRTdWJEb21haW5Db2x1bW5OdW1iZXIoKTtcbiAgICAgIH0sXG4gICAgICBwb3NpdGlvbjoge1xuICAgICAgICB4OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKGQuZ2V0TW9udGgoKSAvIHNlbGYuX2RvbWFpblR5cGUubW9udGgucm93KGQpKTtcbiAgICAgICAgfSxcbiAgICAgICAgeTogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICByZXR1cm4gZC5nZXRNb250aCgpICUgc2VsZi5fZG9tYWluVHlwZS5tb250aC5yb3coZCk7XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgZm9ybWF0OiB7XG4gICAgICAgIGRhdGU6ICclQiAlWScsXG4gICAgICAgIGxlZ2VuZDogJyVCJyxcbiAgICAgICAgY29ubmVjdG9yOiAnaW4nLFxuICAgICAgfSxcbiAgICAgIGV4dHJhY3RVbml0OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCkpLmdldFRpbWUoKTtcbiAgICAgIH0sXG4gICAgfSxcbiAgICB5ZWFyOiB7XG4gICAgICBuYW1lOiAneWVhcicsXG4gICAgICBsZXZlbDogNjAsXG4gICAgICByb3c6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYub3B0aW9ucy5yb3dMaW1pdCB8fCAxO1xuICAgICAgfSxcbiAgICAgIGNvbHVtbjogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc2VsZi5vcHRpb25zLmNvbExpbWl0IHx8IDE7XG4gICAgICB9LFxuICAgICAgcG9zaXRpb246IHtcbiAgICAgICAgeDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9LFxuICAgICAgICB5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgZm9ybWF0OiB7XG4gICAgICAgIGRhdGU6ICclWScsXG4gICAgICAgIGxlZ2VuZDogJyVZJyxcbiAgICAgICAgY29ubmVjdG9yOiAnaW4nLFxuICAgICAgfSxcbiAgICAgIGV4dHJhY3RVbml0OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpKS5nZXRUaW1lKCk7XG4gICAgICB9LFxuICAgIH0sXG4gIH07XG5cbiAgZm9yICh2YXIgdHlwZSBpbiB0aGlzLl9kb21haW5UeXBlKSB7XG4gICAgaWYgKHRoaXMuX2RvbWFpblR5cGUuaGFzT3duUHJvcGVydHkodHlwZSkpIHtcbiAgICAgIHZhciBkID0gdGhpcy5fZG9tYWluVHlwZVt0eXBlXTtcbiAgICAgIHRoaXMuX2RvbWFpblR5cGVbJ3hfJyArIHR5cGVdID0ge1xuICAgICAgICBuYW1lOiAneF8nICsgdHlwZSxcbiAgICAgICAgbGV2ZWw6IGQudHlwZSxcbiAgICAgICAgbWF4SXRlbU51bWJlcjogZC5tYXhJdGVtTnVtYmVyLFxuICAgICAgICBkZWZhdWx0Um93TnVtYmVyOiBkLmRlZmF1bHRSb3dOdW1iZXIsXG4gICAgICAgIGRlZmF1bHRDb2x1bW5OdW1iZXI6IGQuZGVmYXVsdENvbHVtbk51bWJlcixcbiAgICAgICAgcm93OiBkLmNvbHVtbixcbiAgICAgICAgY29sdW1uOiBkLnJvdyxcbiAgICAgICAgcG9zaXRpb246IHtcbiAgICAgICAgICB4OiBkLnBvc2l0aW9uLnksXG4gICAgICAgICAgeTogZC5wb3NpdGlvbi54LFxuICAgICAgICB9LFxuICAgICAgICBmb3JtYXQ6IGQuZm9ybWF0LFxuICAgICAgICBleHRyYWN0VW5pdDogZC5leHRyYWN0VW5pdCxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLy8gUmVjb3JkIHRoZSBhZGRyZXNzIG9mIHRoZSBsYXN0IGluc2VydGVkIGRvbWFpbiB3aGVuIGJyb3dzaW5nXG4gIHRoaXMubGFzdEluc2VydGVkU3ZnID0gbnVsbDtcblxuICB0aGlzLl9jb21wbGV0ZWQgPSBmYWxzZTtcblxuICAvLyBSZWNvcmQgYWxsIHRoZSB2YWxpZCBkb21haW5zXG4gIC8vIEVhY2ggZG9tYWluIHZhbHVlIGlzIGEgdGltZXN0YW1wIGluIG1pbGxpc2Vjb25kc1xuICB0aGlzLl9kb21haW5zID0gZDMubWFwKCk7XG5cbiAgdGhpcy5ncmFwaERpbSA9IHtcbiAgICB3aWR0aDogMCxcbiAgICBoZWlnaHQ6IDAsXG4gIH07XG5cbiAgdGhpcy5sZWdlbmREaW0gPSB7XG4gICAgd2lkdGg6IDAsXG4gICAgaGVpZ2h0OiAwLFxuICB9O1xuXG4gIHRoaXMuTkFWSUdBVEVfTEVGVCA9IDE7XG4gIHRoaXMuTkFWSUdBVEVfUklHSFQgPSAyO1xuXG4gIC8vIFZhcmlvdXMgdXBkYXRlIG1vZGUgd2hlbiB1c2luZyB0aGUgdXBkYXRlKCkgQVBJXG4gIHRoaXMuUkVTRVRfQUxMX09OX1VQREFURSA9IDA7XG4gIHRoaXMuUkVTRVRfU0lOR0xFX09OX1VQREFURSA9IDE7XG4gIHRoaXMuQVBQRU5EX09OX1VQREFURSA9IDI7XG5cbiAgdGhpcy5ERUZBVUxUX0xFR0VORF9NQVJHSU4gPSAxMDtcblxuICB0aGlzLnJvb3QgPSBudWxsO1xuICB0aGlzLnRvb2x0aXAgPSBudWxsO1xuXG4gIHRoaXMuX21heERvbWFpblJlYWNoZWQgPSBmYWxzZTtcbiAgdGhpcy5fbWluRG9tYWluUmVhY2hlZCA9IGZhbHNlO1xuXG4gIHRoaXMuZG9tYWluUG9zaXRpb24gPSBuZXcgRG9tYWluUG9zaXRpb24oKTtcbiAgdGhpcy5MZWdlbmQgPSBudWxsO1xuICB0aGlzLmxlZ2VuZFNjYWxlID0gbnVsbDtcblxuICAvLyBMaXN0IG9mIGRvbWFpbnMgdGhhdCBhcmUgc2tpcHBlZCBiZWNhdXNlIG9mIERTVFxuICAvLyBBbGwgdGltZXMgYmVsb25naW5nIHRvIHRoZXNlIGRvbWFpbnMgc2hvdWxkIGJlIHJlLWFzc2lnbmVkIHRvIHRoZSBwcmV2aW91cyBkb21haW5cbiAgdGhpcy5EU1REb21haW4gPSBbXTtcblxuICAvKipcbiAgICogRGlzcGxheSB0aGUgZ3JhcGggZm9yIHRoZSBmaXJzdCB0aW1lXG4gICAqIEByZXR1cm4gYm9vbCBUcnVlIGlmIHRoZSBjYWxlbmRhciBpcyBjcmVhdGVkXG4gICAqL1xuICB0aGlzLl9pbml0ID0gZnVuY3Rpb24gKCkge1xuICAgIHNlbGZcbiAgICAgIC5nZXREb21haW4oc2VsZi5vcHRpb25zLnN0YXJ0KVxuICAgICAgLm1hcChmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gZC5nZXRUaW1lKCk7XG4gICAgICB9KVxuICAgICAgLm1hcChmdW5jdGlvbiAoZCkge1xuICAgICAgICBzZWxmLl9kb21haW5zLnNldChcbiAgICAgICAgICBkLFxuICAgICAgICAgIHNlbGYuZ2V0U3ViRG9tYWluKGQpLm1hcChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgdDogc2VsZi5fZG9tYWluVHlwZVtzZWxmLm9wdGlvbnMuc3ViRG9tYWluXS5leHRyYWN0VW5pdChkKSwgdjogbnVsbCB9O1xuICAgICAgICAgIH0pLFxuICAgICAgICApO1xuICAgICAgfSk7XG5cbiAgICBzZWxmLnJvb3QgPSBkM1xuICAgICAgLnNlbGVjdChzZWxmLm9wdGlvbnMuaXRlbVNlbGVjdG9yKVxuICAgICAgLmFwcGVuZCgnc3ZnJylcbiAgICAgIC5hdHRyKCdjbGFzcycsICdjYWwtaGVhdG1hcC1jb250YWluZXInKTtcblxuICAgIHNlbGYucm9vdC5hdHRyKCd4JywgMCkuYXR0cigneScsIDApLmFwcGVuZCgnc3ZnJykuYXR0cignY2xhc3MnLCAnZ3JhcGgnKTtcblxuICAgIHNlbGYuTGVnZW5kID0gbmV3IExlZ2VuZChzZWxmKTtcblxuICAgIGlmIChzZWxmLm9wdGlvbnMucGFpbnRPbkxvYWQpIHtcbiAgICAgIF9pbml0Q2FsZW5kYXIoKTtcbiAgICB9XG4gICAgc2VsZi5yb290LmNhbGwoc2VsZi50aXApO1xuICAgIHNlbGYucm9vdC5jYWxsKHNlbGYubGVnZW5kVGlwKTtcblxuICAgIHJldHVybiB0cnVlO1xuICB9O1xuXG4gIGZ1bmN0aW9uIF9pbml0Q2FsZW5kYXIoKSB7XG4gICAgc2VsZi52ZXJ0aWNhbERvbWFpbkxhYmVsID1cbiAgICAgIHNlbGYub3B0aW9ucy5sYWJlbC5wb3NpdGlvbiA9PT0gJ3RvcCcgfHwgc2VsZi5vcHRpb25zLmxhYmVsLnBvc2l0aW9uID09PSAnYm90dG9tJztcblxuICAgIHNlbGYuZG9tYWluVmVydGljYWxMYWJlbEhlaWdodCA9XG4gICAgICBzZWxmLm9wdGlvbnMubGFiZWwuaGVpZ2h0ID09PSBudWxsXG4gICAgICAgID8gTWF0aC5tYXgoMjUsIHNlbGYub3B0aW9ucy5jZWxsU2l6ZSAqIDIpXG4gICAgICAgIDogc2VsZi5vcHRpb25zLmxhYmVsLmhlaWdodDtcbiAgICBzZWxmLmRvbWFpbkhvcml6b250YWxMYWJlbFdpZHRoID0gMDtcblxuICAgIGlmIChzZWxmLm9wdGlvbnMuZG9tYWluTGFiZWxGb3JtYXQgPT09ICcnICYmIHNlbGYub3B0aW9ucy5sYWJlbC5oZWlnaHQgPT09IG51bGwpIHtcbiAgICAgIHNlbGYuZG9tYWluVmVydGljYWxMYWJlbEhlaWdodCA9IDA7XG4gICAgfVxuXG4gICAgaWYgKCFzZWxmLnZlcnRpY2FsRG9tYWluTGFiZWwpIHtcbiAgICAgIHNlbGYuZG9tYWluVmVydGljYWxMYWJlbEhlaWdodCA9IDA7XG4gICAgICBzZWxmLmRvbWFpbkhvcml6b250YWxMYWJlbFdpZHRoID0gc2VsZi5vcHRpb25zLmxhYmVsLndpZHRoO1xuICAgIH1cblxuICAgIHNlbGYucGFpbnQoKTtcblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuICAgIC8vIEFUVEFDSElORyBET01BSU4gTkFWSUdBVElPTiBFVkVOVCAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgICBpZiAoc2VsZi5vcHRpb25zLm5leHRTZWxlY3RvciAhPT0gZmFsc2UpIHtcbiAgICAgIGQzLnNlbGVjdChzZWxmLm9wdGlvbnMubmV4dFNlbGVjdG9yKS5vbignY2xpY2suJyArIHNlbGYub3B0aW9ucy5pdGVtTmFtZXNwYWNlLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGQzLmV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHJldHVybiBzZWxmLmxvYWROZXh0RG9tYWluKDEpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKHNlbGYub3B0aW9ucy5wcmV2aW91c1NlbGVjdG9yICE9PSBmYWxzZSkge1xuICAgICAgZDMuc2VsZWN0KHNlbGYub3B0aW9ucy5wcmV2aW91c1NlbGVjdG9yKS5vbihcbiAgICAgICAgJ2NsaWNrLicgKyBzZWxmLm9wdGlvbnMuaXRlbU5hbWVzcGFjZSxcbiAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGQzLmV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgcmV0dXJuIHNlbGYubG9hZFByZXZpb3VzRG9tYWluKDEpO1xuICAgICAgICB9LFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBzZWxmLkxlZ2VuZC5yZWRyYXcoc2VsZi5ncmFwaERpbS53aWR0aCAtIHNlbGYub3B0aW9ucy5kb21haW5HdXR0ZXIgLSBzZWxmLm9wdGlvbnMuY2VsbFBhZGRpbmcpO1xuICAgIHNlbGYuYWZ0ZXJMb2FkKCk7XG5cbiAgICB2YXIgZG9tYWlucyA9IHNlbGYuZ2V0RG9tYWluS2V5cygpO1xuXG4gICAgLy8gRmlsbCB0aGUgZ3JhcGggd2l0aCBzb21lIGRhdGFzXG4gICAgaWYgKHNlbGYub3B0aW9ucy5sb2FkT25Jbml0KSB7XG4gICAgICBzZWxmLmdldERhdGFzKFxuICAgICAgICBzZWxmLm9wdGlvbnMuZGF0YSxcbiAgICAgICAgbmV3IERhdGUoZG9tYWluc1swXSksXG4gICAgICAgIHNlbGYuZ2V0U3ViRG9tYWluKGRvbWFpbnNbZG9tYWlucy5sZW5ndGggLSAxXSkucG9wKCksXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBzZWxmLmZpbGwoKTtcbiAgICAgICAgICBzZWxmLm9uQ29tcGxldGUoKTtcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYub25Db21wbGV0ZSgpO1xuICAgIH1cblxuICAgIHNlbGYuY2hlY2tJZk1pbkRvbWFpbklzUmVhY2hlZChkb21haW5zWzBdKTtcbiAgICBzZWxmLmNoZWNrSWZNYXhEb21haW5Jc1JlYWNoZWQoc2VsZi5nZXROZXh0RG9tYWluKCkuZ2V0VGltZSgpKTtcbiAgfVxuXG4gIC8vIFJldHVybiB0aGUgd2lkdGggb2YgdGhlIGRvbWFpbiBibG9jaywgd2l0aG91dCB0aGUgZG9tYWluIGd1dHRlclxuICAvLyBAcGFyYW0gaW50IGQgRG9tYWluIHN0YXJ0IHRpbWVzdGFtcFxuICBmdW5jdGlvbiB3KGQsIG91dGVyKSB7XG4gICAgdmFyIHdpZHRoID1cbiAgICAgIHNlbGYub3B0aW9ucy5jZWxsU2l6ZSAqIHNlbGYuX2RvbWFpblR5cGVbc2VsZi5vcHRpb25zLnN1YkRvbWFpbl0uY29sdW1uKGQpICtcbiAgICAgIHNlbGYub3B0aW9ucy5jZWxsUGFkZGluZyAqIHNlbGYuX2RvbWFpblR5cGVbc2VsZi5vcHRpb25zLnN1YkRvbWFpbl0uY29sdW1uKGQpO1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyICYmIG91dGVyID09PSB0cnVlKSB7XG4gICAgICByZXR1cm4gKHdpZHRoICs9XG4gICAgICAgIHNlbGYuZG9tYWluSG9yaXpvbnRhbExhYmVsV2lkdGggK1xuICAgICAgICBzZWxmLm9wdGlvbnMuZG9tYWluR3V0dGVyICtcbiAgICAgICAgc2VsZi5vcHRpb25zLmRvbWFpbk1hcmdpblsxXSArXG4gICAgICAgIHNlbGYub3B0aW9ucy5kb21haW5NYXJnaW5bM10pO1xuICAgIH1cbiAgICByZXR1cm4gd2lkdGg7XG4gIH1cblxuICAvLyBSZXR1cm4gdGhlIGhlaWdodCBvZiB0aGUgZG9tYWluIGJsb2NrLCB3aXRob3V0IHRoZSBkb21haW4gZ3V0dGVyXG4gIGZ1bmN0aW9uIGgoZCwgb3V0ZXIpIHtcbiAgICB2YXIgaGVpZ2h0ID1cbiAgICAgIHNlbGYub3B0aW9ucy5jZWxsU2l6ZSAqIHNlbGYuX2RvbWFpblR5cGVbc2VsZi5vcHRpb25zLnN1YkRvbWFpbl0ucm93KGQpICtcbiAgICAgIHNlbGYub3B0aW9ucy5jZWxsUGFkZGluZyAqIHNlbGYuX2RvbWFpblR5cGVbc2VsZi5vcHRpb25zLnN1YkRvbWFpbl0ucm93KGQpO1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyICYmIG91dGVyID09PSB0cnVlKSB7XG4gICAgICBoZWlnaHQgKz1cbiAgICAgICAgc2VsZi5vcHRpb25zLmRvbWFpbkd1dHRlciArXG4gICAgICAgIHNlbGYuZG9tYWluVmVydGljYWxMYWJlbEhlaWdodCArXG4gICAgICAgIHNlbGYub3B0aW9ucy5kb21haW5NYXJnaW5bMF0gK1xuICAgICAgICBzZWxmLm9wdGlvbnMuZG9tYWluTWFyZ2luWzJdO1xuICAgIH1cbiAgICByZXR1cm4gaGVpZ2h0O1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqXG4gICAqIEBwYXJhbSBpbnQgbmF2aWdhdGlvbkRpclxuICAgKi9cbiAgdGhpcy5wYWludCA9IGZ1bmN0aW9uIChuYXZpZ2F0aW9uRGlyKSB7XG4gICAgdmFyIG9wdGlvbnMgPSBzZWxmLm9wdGlvbnM7XG5cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgbmF2aWdhdGlvbkRpciA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8vIFBhaW50aW5nIGFsbCB0aGUgZG9tYWluc1xuICAgIHZhciBkb21haW5TdmcgPSBzZWxmLnJvb3RcbiAgICAgIC5zZWxlY3QoJy5ncmFwaCcpXG4gICAgICAuc2VsZWN0QWxsKCcuZ3JhcGgtZG9tYWluJylcbiAgICAgIC5kYXRhKFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIGRhdGEgPSBzZWxmLmdldERvbWFpbktleXMoKTtcbiAgICAgICAgICByZXR1cm4gbmF2aWdhdGlvbkRpciA9PT0gc2VsZi5OQVZJR0FURV9MRUZUID8gZGF0YS5yZXZlcnNlKCkgOiBkYXRhO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHJldHVybiBkO1xuICAgICAgICB9LFxuICAgICAgKTtcbiAgICB2YXIgZW50ZXJpbmdEb21haW5EaW0gPSAwO1xuICAgIHZhciBleGl0aW5nRG9tYWluRGltID0gMDtcblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuICAgIC8vIFBBSU5USU5HIERPTUFJTiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG5cbiAgICB2YXIgc3ZnID0gZG9tYWluU3ZnXG4gICAgICAuZW50ZXIoKVxuICAgICAgLmFwcGVuZCgnc3ZnJylcbiAgICAgIC5hdHRyKCd3aWR0aCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiB3KGQsIHRydWUpO1xuICAgICAgfSlcbiAgICAgIC5hdHRyKCdoZWlnaHQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gaChkLCB0cnVlKTtcbiAgICAgIH0pXG4gICAgICAuYXR0cigneCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIGlmIChvcHRpb25zLnZlcnRpY2FsT3JpZW50YXRpb24pIHtcbiAgICAgICAgICBzZWxmLmdyYXBoRGltLndpZHRoID0gTWF0aC5tYXgoc2VsZi5ncmFwaERpbS53aWR0aCwgdyhkLCB0cnVlKSk7XG4gICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIGdldERvbWFpblBvc2l0aW9uKGQsIHNlbGYuZ3JhcGhEaW0sICd3aWR0aCcsIHcoZCwgdHJ1ZSkpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLmF0dHIoJ3knLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICBpZiAob3B0aW9ucy52ZXJ0aWNhbE9yaWVudGF0aW9uKSB7XG4gICAgICAgICAgcmV0dXJuIGdldERvbWFpblBvc2l0aW9uKGQsIHNlbGYuZ3JhcGhEaW0sICdoZWlnaHQnLCBoKGQsIHRydWUpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzZWxmLmdyYXBoRGltLmhlaWdodCA9IE1hdGgubWF4KHNlbGYuZ3JhcGhEaW0uaGVpZ2h0LCBoKGQsIHRydWUpKTtcbiAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHZhciBjbGFzc25hbWUgPSAnZ3JhcGgtZG9tYWluJztcbiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZShkKTtcbiAgICAgICAgc3dpdGNoIChvcHRpb25zLmRvbWFpbikge1xuICAgICAgICAgIGNhc2UgJ2hvdXInOlxuICAgICAgICAgICAgY2xhc3NuYW1lICs9ICcgaF8nICsgZGF0ZS5nZXRIb3VycygpO1xuICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi9cbiAgICAgICAgICBjYXNlICdkYXknOlxuICAgICAgICAgICAgY2xhc3NuYW1lICs9ICcgZF8nICsgZGF0ZS5nZXREYXRlKCkgKyAnIGR5XycgKyBkYXRlLmdldERheSgpO1xuICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi9cbiAgICAgICAgICBjYXNlICd3ZWVrJzpcbiAgICAgICAgICAgIGNsYXNzbmFtZSArPSAnIHdfJyArIHNlbGYuZ2V0V2Vla051bWJlcihkYXRlKTtcbiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovXG4gICAgICAgICAgY2FzZSAnbW9udGgnOlxuICAgICAgICAgICAgY2xhc3NuYW1lICs9ICcgbV8nICsgKGRhdGUuZ2V0TW9udGgoKSArIDEpO1xuICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi9cbiAgICAgICAgICBjYXNlICd5ZWFyJzpcbiAgICAgICAgICAgIGNsYXNzbmFtZSArPSAnIHlfJyArIGRhdGUuZ2V0RnVsbFllYXIoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2xhc3NuYW1lO1xuICAgICAgfSk7XG4gICAgc2VsZi5sYXN0SW5zZXJ0ZWRTdmcgPSBzdmc7XG5cbiAgICBmdW5jdGlvbiBnZXREb21haW5Qb3NpdGlvbihkb21haW5JbmRleCwgZ3JhcGhEaW0sIGF4aXMsIGRvbWFpbkRpbSkge1xuICAgICAgdmFyIHRtcCA9IDA7XG4gICAgICBzd2l0Y2ggKG5hdmlnYXRpb25EaXIpIHtcbiAgICAgICAgY2FzZSBmYWxzZTpcbiAgICAgICAgICB0bXAgPSBncmFwaERpbVtheGlzXTtcblxuICAgICAgICAgIGdyYXBoRGltW2F4aXNdICs9IGRvbWFpbkRpbTtcbiAgICAgICAgICBzZWxmLmRvbWFpblBvc2l0aW9uLnNldFBvc2l0aW9uKGRvbWFpbkluZGV4LCB0bXApO1xuICAgICAgICAgIHJldHVybiB0bXA7XG5cbiAgICAgICAgY2FzZSBzZWxmLk5BVklHQVRFX1JJR0hUOlxuICAgICAgICAgIHNlbGYuZG9tYWluUG9zaXRpb24uc2V0UG9zaXRpb24oZG9tYWluSW5kZXgsIGdyYXBoRGltW2F4aXNdKTtcblxuICAgICAgICAgIGVudGVyaW5nRG9tYWluRGltID0gZG9tYWluRGltO1xuICAgICAgICAgIGV4aXRpbmdEb21haW5EaW0gPSBzZWxmLmRvbWFpblBvc2l0aW9uLmdldFBvc2l0aW9uRnJvbUluZGV4KDEpO1xuXG4gICAgICAgICAgc2VsZi5kb21haW5Qb3NpdGlvbi5zaGlmdFJpZ2h0QnkoZXhpdGluZ0RvbWFpbkRpbSk7XG4gICAgICAgICAgcmV0dXJuIGdyYXBoRGltW2F4aXNdO1xuXG4gICAgICAgIGNhc2Ugc2VsZi5OQVZJR0FURV9MRUZUOlxuICAgICAgICAgIHRtcCA9IC1kb21haW5EaW07XG5cbiAgICAgICAgICBlbnRlcmluZ0RvbWFpbkRpbSA9IC10bXA7XG4gICAgICAgICAgZXhpdGluZ0RvbWFpbkRpbSA9IGdyYXBoRGltW2F4aXNdIC0gc2VsZi5kb21haW5Qb3NpdGlvbi5nZXRMYXN0KCk7XG5cbiAgICAgICAgICBzZWxmLmRvbWFpblBvc2l0aW9uLnNldFBvc2l0aW9uKGRvbWFpbkluZGV4LCB0bXApO1xuICAgICAgICAgIHNlbGYuZG9tYWluUG9zaXRpb24uc2hpZnRMZWZ0QnkoZW50ZXJpbmdEb21haW5EaW0pO1xuICAgICAgICAgIHJldHVybiB0bXA7XG4gICAgICB9XG4gICAgfVxuXG4gICAgc3ZnXG4gICAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAgIC5hdHRyKCd3aWR0aCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiB3KGQsIHRydWUpIC0gb3B0aW9ucy5kb21haW5HdXR0ZXIgLSBvcHRpb25zLmNlbGxQYWRkaW5nO1xuICAgICAgfSlcbiAgICAgIC5hdHRyKCdoZWlnaHQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gaChkLCB0cnVlKSAtIG9wdGlvbnMuZG9tYWluR3V0dGVyIC0gb3B0aW9ucy5jZWxsUGFkZGluZztcbiAgICAgIH0pXG4gICAgICAuYXR0cignY2xhc3MnLCAnZG9tYWluLWJhY2tncm91bmQnKTtcblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuICAgIC8vIFBBSU5USU5HIFNVQkRPTUFJTlMgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgICB2YXIgc3ViRG9tYWluU3ZnR3JvdXAgPSBzdmdcbiAgICAgIC5hcHBlbmQoJ3N2ZycpXG4gICAgICAuYXR0cigneCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMubGFiZWwucG9zaXRpb24gPT09ICdsZWZ0Jykge1xuICAgICAgICAgIHJldHVybiBzZWxmLmRvbWFpbkhvcml6b250YWxMYWJlbFdpZHRoICsgb3B0aW9ucy5kb21haW5NYXJnaW5bM107XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIG9wdGlvbnMuZG9tYWluTWFyZ2luWzNdO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLmF0dHIoJ3knLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChvcHRpb25zLmxhYmVsLnBvc2l0aW9uID09PSAndG9wJykge1xuICAgICAgICAgIHJldHVybiBzZWxmLmRvbWFpblZlcnRpY2FsTGFiZWxIZWlnaHQgKyBvcHRpb25zLmRvbWFpbk1hcmdpblswXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gb3B0aW9ucy5kb21haW5NYXJnaW5bMF07XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuYXR0cignY2xhc3MnLCAnZ3JhcGgtc3ViZG9tYWluLWdyb3VwJyk7XG4gICAgdmFyIHJlY3QgPSBzdWJEb21haW5TdmdHcm91cFxuICAgICAgLnNlbGVjdEFsbCgnZycpXG4gICAgICAuZGF0YShmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gc2VsZi5fZG9tYWlucy5nZXQoZCk7XG4gICAgICB9KVxuICAgICAgLmVudGVyKClcbiAgICAgIC5hcHBlbmQoJ2cnKTtcbiAgICByZWN0XG4gICAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAgIC5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgJ2dyYXBoLXJlY3QnICtcbiAgICAgICAgICBzZWxmLmdldEhpZ2hsaWdodENsYXNzTmFtZShkLnQpICtcbiAgICAgICAgICAob3B0aW9ucy5vbkNsaWNrICE9PSBudWxsID8gJyBob3Zlcl9jdXJzb3InIDogJycpXG4gICAgICAgICk7XG4gICAgICB9KVxuICAgICAgLmF0dHIoJ3dpZHRoJywgb3B0aW9ucy5jZWxsU2l6ZSlcbiAgICAgIC5hdHRyKCdoZWlnaHQnLCBvcHRpb25zLmNlbGxTaXplKVxuICAgICAgLmF0dHIoJ3gnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gc2VsZi5wb3NpdGlvblN1YkRvbWFpblgoZC50KTtcbiAgICAgIH0pXG4gICAgICAuYXR0cigneScsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBzZWxmLnBvc2l0aW9uU3ViRG9tYWluWShkLnQpO1xuICAgICAgfSlcbiAgICAgIC5vbignY2xpY2snLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICBpZiAob3B0aW9ucy5vbkNsaWNrICE9PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIHNlbGYub25DbGljayhuZXcgRGF0ZShkLnQpLCBkLnYpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLmNhbGwoZnVuY3Rpb24gKHNlbGVjdGlvbikge1xuICAgICAgICBpZiAob3B0aW9ucy5jZWxsUmFkaXVzID4gMCkge1xuICAgICAgICAgIHNlbGVjdGlvbi5hdHRyKCdyeCcsIG9wdGlvbnMuY2VsbFJhZGl1cykuYXR0cigncnknLCBvcHRpb25zLmNlbGxSYWRpdXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIHNlbGYubGVnZW5kU2NhbGUgIT09IG51bGwgJiZcbiAgICAgICAgICBvcHRpb25zLmxlZ2VuZENvbG9ycyAhPT0gbnVsbCAmJlxuICAgICAgICAgIG9wdGlvbnMubGVnZW5kQ29sb3JzLmhhc093blByb3BlcnR5KCdiYXNlJylcbiAgICAgICAgKSB7XG4gICAgICAgICAgc2VsZWN0aW9uLmF0dHIoJ2ZpbGwnLCBvcHRpb25zLmxlZ2VuZENvbG9ycy5iYXNlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvcHRpb25zLnRvb2x0aXApIHtcbiAgICAgICAgICBzZWxlY3Rpb25cbiAgICAgICAgICAgIC5vbignbW91c2VvdmVyJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgc2VsZi50aXAuc2hvdyhkLCB0aGlzKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAub24oJ21vdXNlb3V0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBzZWxmLnRpcC5oaWRlKGQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgLy8gQXBwZW5kaW5nIGEgdGl0bGUgdG8gZWFjaCBzdWJkb21haW5cbiAgICBpZiAoIW9wdGlvbnMudG9vbHRpcCkge1xuICAgICAgcmVjdC5hcHBlbmQoJ3RpdGxlJykudGV4dChmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gc2VsZi5mb3JtYXREYXRlKG5ldyBEYXRlKGQudCksIG9wdGlvbnMuc3ViRG9tYWluRGF0ZUZvcm1hdCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgICAvLyBQQUlOVElORyBMQUJFTCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4gICAgaWYgKG9wdGlvbnMuZG9tYWluTGFiZWxGb3JtYXQgIT09ICcnKSB7XG4gICAgICBzdmdcbiAgICAgICAgLmFwcGVuZCgndGV4dCcpXG4gICAgICAgIC5hdHRyKCdjbGFzcycsICdncmFwaC1sYWJlbCcpXG4gICAgICAgIC5hdHRyKCd5JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICB2YXIgeSA9IG9wdGlvbnMuZG9tYWluTWFyZ2luWzBdO1xuICAgICAgICAgIHN3aXRjaCAob3B0aW9ucy5sYWJlbC5wb3NpdGlvbikge1xuICAgICAgICAgICAgY2FzZSAndG9wJzpcbiAgICAgICAgICAgICAgeSArPSBzZWxmLmRvbWFpblZlcnRpY2FsTGFiZWxIZWlnaHQgLyAyO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2JvdHRvbSc6XG4gICAgICAgICAgICAgIHkgKz0gaChkKSArIHNlbGYuZG9tYWluVmVydGljYWxMYWJlbEhlaWdodCAvIDI7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIHkgK1xuICAgICAgICAgICAgb3B0aW9ucy5sYWJlbC5vZmZzZXQueSAqXG4gICAgICAgICAgICAgICgob3B0aW9ucy5sYWJlbC5yb3RhdGUgPT09ICdyaWdodCcgJiYgb3B0aW9ucy5sYWJlbC5wb3NpdGlvbiA9PT0gJ3JpZ2h0JykgfHxcbiAgICAgICAgICAgICAgKG9wdGlvbnMubGFiZWwucm90YXRlID09PSAnbGVmdCcgJiYgb3B0aW9ucy5sYWJlbC5wb3NpdGlvbiA9PT0gJ2xlZnQnKVxuICAgICAgICAgICAgICAgID8gLTFcbiAgICAgICAgICAgICAgICA6IDEpXG4gICAgICAgICAgKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmF0dHIoJ3gnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHZhciB4ID0gb3B0aW9ucy5kb21haW5NYXJnaW5bM107XG4gICAgICAgICAgc3dpdGNoIChvcHRpb25zLmxhYmVsLnBvc2l0aW9uKSB7XG4gICAgICAgICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgICAgICAgIHggKz0gdyhkKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdib3R0b20nOlxuICAgICAgICAgICAgY2FzZSAndG9wJzpcbiAgICAgICAgICAgICAgeCArPSB3KGQpIC8gMjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAob3B0aW9ucy5sYWJlbC5hbGlnbiA9PT0gJ3JpZ2h0Jykge1xuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgeCArXG4gICAgICAgICAgICAgIHNlbGYuZG9tYWluSG9yaXpvbnRhbExhYmVsV2lkdGggLVxuICAgICAgICAgICAgICBvcHRpb25zLmxhYmVsLm9mZnNldC54ICogKG9wdGlvbnMubGFiZWwucm90YXRlID09PSAncmlnaHQnID8gLTEgOiAxKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHggKyBvcHRpb25zLmxhYmVsLm9mZnNldC54O1xuICAgICAgICB9KVxuICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgc3dpdGNoIChvcHRpb25zLmxhYmVsLmFsaWduKSB7XG4gICAgICAgICAgICBjYXNlICdzdGFydCc6XG4gICAgICAgICAgICBjYXNlICdsZWZ0JzpcbiAgICAgICAgICAgICAgcmV0dXJuICdzdGFydCc7XG4gICAgICAgICAgICBjYXNlICdlbmQnOlxuICAgICAgICAgICAgY2FzZSAncmlnaHQnOlxuICAgICAgICAgICAgICByZXR1cm4gJ2VuZCc7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICByZXR1cm4gJ21pZGRsZSc7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuYXR0cignZG9taW5hbnQtYmFzZWxpbmUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHNlbGYudmVydGljYWxEb21haW5MYWJlbCA/ICdtaWRkbGUnIDogJ3RvcCc7XG4gICAgICAgIH0pXG4gICAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgcmV0dXJuIHNlbGYuZm9ybWF0RGF0ZShuZXcgRGF0ZShkKSwgb3B0aW9ucy5kb21haW5MYWJlbEZvcm1hdCk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYWxsKGRvbWFpblJvdGF0ZSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZG9tYWluUm90YXRlKHNlbGVjdGlvbikge1xuICAgICAgc3dpdGNoIChvcHRpb25zLmxhYmVsLnJvdGF0ZSkge1xuICAgICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgICAgc2VsZWN0aW9uLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICB2YXIgcyA9ICdyb3RhdGUoOTApLCAnO1xuICAgICAgICAgICAgc3dpdGNoIChvcHRpb25zLmxhYmVsLnBvc2l0aW9uKSB7XG4gICAgICAgICAgICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgICAgICAgICAgICBzICs9ICd0cmFuc2xhdGUoLScgKyB3KGQpICsgJyAsIC0nICsgdyhkKSArICcpJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSAnbGVmdCc6XG4gICAgICAgICAgICAgICAgcyArPSAndHJhbnNsYXRlKDAsIC0nICsgc2VsZi5kb21haW5Ib3Jpem9udGFsTGFiZWxXaWR0aCArICcpJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHM7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2xlZnQnOlxuICAgICAgICAgIHNlbGVjdGlvbi5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgdmFyIHMgPSAncm90YXRlKDI3MCksICc7XG4gICAgICAgICAgICBzd2l0Y2ggKG9wdGlvbnMubGFiZWwucG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgY2FzZSAncmlnaHQnOlxuICAgICAgICAgICAgICAgIHMgKz0gJ3RyYW5zbGF0ZSgtJyArICh3KGQpICsgc2VsZi5kb21haW5Ib3Jpem9udGFsTGFiZWxXaWR0aCkgKyAnICwgJyArIHcoZCkgKyAnKSc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgJ2xlZnQnOlxuICAgICAgICAgICAgICAgIHMgKz1cbiAgICAgICAgICAgICAgICAgICd0cmFuc2xhdGUoLScgK1xuICAgICAgICAgICAgICAgICAgc2VsZi5kb21haW5Ib3Jpem9udGFsTGFiZWxXaWR0aCArXG4gICAgICAgICAgICAgICAgICAnICwgJyArXG4gICAgICAgICAgICAgICAgICBzZWxmLmRvbWFpbkhvcml6b250YWxMYWJlbFdpZHRoICtcbiAgICAgICAgICAgICAgICAgICcpJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHM7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4gICAgLy8gUEFJTlRJTkcgRE9NQUlOIFNVQkRPTUFJTiBDT05URU5UICAgICAgICAgICAgICAgICAgICAvL1xuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuICAgIGlmIChvcHRpb25zLnN1YkRvbWFpblRleHRGb3JtYXQgIT09IG51bGwpIHtcbiAgICAgIHJlY3RcbiAgICAgICAgLmFwcGVuZCgndGV4dCcpXG4gICAgICAgIC5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgcmV0dXJuICdzdWJkb21haW4tdGV4dCcgKyBzZWxmLmdldEhpZ2hsaWdodENsYXNzTmFtZShkLnQpO1xuICAgICAgICB9KVxuICAgICAgICAuYXR0cigneCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgcmV0dXJuIHNlbGYucG9zaXRpb25TdWJEb21haW5YKGQudCkgKyBvcHRpb25zLmNlbGxTaXplIC8gMjtcbiAgICAgICAgfSlcbiAgICAgICAgLmF0dHIoJ3knLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHJldHVybiBzZWxmLnBvc2l0aW9uU3ViRG9tYWluWShkLnQpICsgb3B0aW9ucy5jZWxsU2l6ZSAvIDI7XG4gICAgICAgIH0pXG4gICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKVxuICAgICAgICAuYXR0cignZG9taW5hbnQtYmFzZWxpbmUnLCAnY2VudHJhbCcpXG4gICAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgcmV0dXJuIHNlbGYuZm9ybWF0RGF0ZShuZXcgRGF0ZShkLnQpLCBvcHRpb25zLnN1YkRvbWFpblRleHRGb3JtYXQpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgICAvLyBBTklNQVRJT04gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG5cbiAgICBpZiAobmF2aWdhdGlvbkRpciAhPT0gZmFsc2UpIHtcbiAgICAgIGRvbWFpblN2Z1xuICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgIC5kdXJhdGlvbihvcHRpb25zLmFuaW1hdGlvbkR1cmF0aW9uKVxuICAgICAgICAuYXR0cigneCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgcmV0dXJuIG9wdGlvbnMudmVydGljYWxPcmllbnRhdGlvbiA/IDAgOiBzZWxmLmRvbWFpblBvc2l0aW9uLmdldFBvc2l0aW9uKGQpO1xuICAgICAgICB9KVxuICAgICAgICAuYXR0cigneScsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgcmV0dXJuIG9wdGlvbnMudmVydGljYWxPcmllbnRhdGlvbiA/IHNlbGYuZG9tYWluUG9zaXRpb24uZ2V0UG9zaXRpb24oZCkgOiAwO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICB2YXIgdGVtcFdpZHRoID0gc2VsZi5ncmFwaERpbS53aWR0aDtcbiAgICB2YXIgdGVtcEhlaWdodCA9IHNlbGYuZ3JhcGhEaW0uaGVpZ2h0O1xuXG4gICAgaWYgKG9wdGlvbnMudmVydGljYWxPcmllbnRhdGlvbikge1xuICAgICAgc2VsZi5ncmFwaERpbS5oZWlnaHQgKz0gZW50ZXJpbmdEb21haW5EaW0gLSBleGl0aW5nRG9tYWluRGltO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZWxmLmdyYXBoRGltLndpZHRoICs9IGVudGVyaW5nRG9tYWluRGltIC0gZXhpdGluZ0RvbWFpbkRpbTtcbiAgICB9XG5cbiAgICAvLyBBdCB0aGUgdGltZSBvZiBleGl0LCBkb21haW5zV2lkdGggYW5kIGRvbWFpbnNIZWlnaHQgYWxyZWFkeSBhdXRvbWF0aWNhbGx5IHNoaWZ0ZWRcbiAgICBkb21haW5TdmdcbiAgICAgIC5leGl0KClcbiAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgIC5kdXJhdGlvbihvcHRpb25zLmFuaW1hdGlvbkR1cmF0aW9uKVxuICAgICAgLmF0dHIoJ3gnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICBpZiAob3B0aW9ucy52ZXJ0aWNhbE9yaWVudGF0aW9uKSB7XG4gICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3dpdGNoIChuYXZpZ2F0aW9uRGlyKSB7XG4gICAgICAgICAgICBjYXNlIHNlbGYuTkFWSUdBVEVfTEVGVDpcbiAgICAgICAgICAgICAgcmV0dXJuIE1hdGgubWluKHNlbGYuZ3JhcGhEaW0ud2lkdGgsIHRlbXBXaWR0aCk7XG4gICAgICAgICAgICBjYXNlIHNlbGYuTkFWSUdBVEVfUklHSFQ6XG4gICAgICAgICAgICAgIHJldHVybiAtdyhkLCB0cnVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuYXR0cigneScsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIGlmIChvcHRpb25zLnZlcnRpY2FsT3JpZW50YXRpb24pIHtcbiAgICAgICAgICBzd2l0Y2ggKG5hdmlnYXRpb25EaXIpIHtcbiAgICAgICAgICAgIGNhc2Ugc2VsZi5OQVZJR0FURV9MRUZUOlxuICAgICAgICAgICAgICByZXR1cm4gTWF0aC5taW4oc2VsZi5ncmFwaERpbS5oZWlnaHQsIHRlbXBIZWlnaHQpO1xuICAgICAgICAgICAgY2FzZSBzZWxmLk5BVklHQVRFX1JJR0hUOlxuICAgICAgICAgICAgICByZXR1cm4gLWgoZCwgdHJ1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLnJlbW92ZSgpO1xuXG4gICAgLy8gUmVzaXplIHRoZSByb290IGNvbnRhaW5lclxuICAgIHNlbGYucmVzaXplKCk7XG4gIH07XG59O1xuXG5DYWxIZWF0TWFwLnByb3RvdHlwZSA9IHtcbiAgLyoqXG4gICAqIFZhbGlkYXRlIGFuZCBtZXJnZSB1c2VyIHNldHRpbmdzIHdpdGggZGVmYXVsdCBzZXR0aW5nc1xuICAgKlxuICAgKiBAcGFyYW0gIHtvYmplY3R9IHNldHRpbmdzIFVzZXIgc2V0dGluZ3NcbiAgICogQHJldHVybiB7Ym9vbH0gRmFsc2UgaWYgc2V0dGluZ3MgY29udGFpbnMgZXJyb3JcbiAgICovXG4gIC8qIGpzaGludCBtYXhzdGF0ZW1lbnRzOmZhbHNlICovXG4gIGluaXQ6IGZ1bmN0aW9uIChzZXR0aW5ncykge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBwYXJlbnQgPSB0aGlzO1xuXG4gICAgdmFyIG9wdGlvbnMgPSAocGFyZW50Lm9wdGlvbnMgPSBtZXJnZVJlY3Vyc2l2ZShwYXJlbnQub3B0aW9ucywgc2V0dGluZ3MpKTtcblxuICAgIC8vIEZhdGFsIGVycm9yc1xuICAgIC8vIFN0b3Agc2NyaXB0IGV4ZWN1dGlvbiBvbiBlcnJvclxuICAgIHZhbGlkYXRlRG9tYWluVHlwZSgpO1xuICAgIHZhbGlkYXRlU2VsZWN0b3Iob3B0aW9ucy5pdGVtU2VsZWN0b3IsIGZhbHNlLCAnaXRlbVNlbGVjdG9yJyk7XG5cbiAgICBpZiAocGFyZW50LmFsbG93ZWREYXRhVHlwZS5pbmRleE9mKG9wdGlvbnMuZGF0YVR5cGUpID09PSAtMSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlIGRhdGEgdHlwZSAnXCIgKyBvcHRpb25zLmRhdGFUeXBlICsgXCInIGlzIG5vdCB2YWxpZCBkYXRhIHR5cGVcIik7XG4gICAgfVxuXG4gICAgaWYgKGQzLnNlbGVjdChvcHRpb25zLml0ZW1TZWxlY3RvcilbMF1bMF0gPT09IG51bGwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgXCJUaGUgbm9kZSAnXCIgKyBvcHRpb25zLml0ZW1TZWxlY3RvciArIFwiJyBzcGVjaWZpZWQgaW4gaXRlbVNlbGVjdG9yIGRvZXMgbm90IGV4aXN0c1wiLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgdmFsaWRhdGVTZWxlY3RvcihvcHRpb25zLm5leHRTZWxlY3RvciwgdHJ1ZSwgJ25leHRTZWxlY3RvcicpO1xuICAgICAgdmFsaWRhdGVTZWxlY3RvcihvcHRpb25zLnByZXZpb3VzU2VsZWN0b3IsIHRydWUsICdwcmV2aW91c1NlbGVjdG9yJyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUubG9nKGVycm9yLm1lc3NhZ2UpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIElmIG90aGVyIHNldHRpbmdzIGNvbnRhaW5zIGVycm9yLCB3aWxsIGZhbGxiYWNrIHRvIGRlZmF1bHRcblxuICAgIGlmICghc2V0dGluZ3MuaGFzT3duUHJvcGVydHkoJ3N1YkRvbWFpbicpKSB7XG4gICAgICB0aGlzLm9wdGlvbnMuc3ViRG9tYWluID0gZ2V0T3B0aW1hbFN1YkRvbWFpbihzZXR0aW5ncy5kb21haW4pO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5pdGVtTmFtZXNwYWNlICE9PSAnc3RyaW5nJyB8fCBvcHRpb25zLml0ZW1OYW1lc3BhY2UgPT09ICcnKSB7XG4gICAgICBjb25zb2xlLmxvZygnaXRlbU5hbWVzcGFjZSBjYW4gbm90IGJlIGVtcHR5LCBmYWxsaW5nIGJhY2sgdG8gY2FsLWhlYXRtYXAnKTtcbiAgICAgIG9wdGlvbnMuaXRlbU5hbWVzcGFjZSA9ICdjYWwtaGVhdG1hcCc7XG4gICAgfVxuXG4gICAgLy8gRG9uJ3QgdG91Y2ggdGhlc2Ugc2V0dGluZ3NcbiAgICB2YXIgcyA9IFtcbiAgICAgICdkYXRhJyxcbiAgICAgICdvbkNvbXBsZXRlJyxcbiAgICAgICdvbkNsaWNrJyxcbiAgICAgICdhZnRlckxvYWQnLFxuICAgICAgJ2FmdGVyTG9hZERhdGEnLFxuICAgICAgJ2FmdGVyTG9hZFByZXZpb3VzRG9tYWluJyxcbiAgICAgICdhZnRlckxvYWROZXh0RG9tYWluJyxcbiAgICAgICdhZnRlclVwZGF0ZScsXG4gICAgXTtcblxuICAgIGZvciAodmFyIGsgaW4gcykge1xuICAgICAgaWYgKHNldHRpbmdzLmhhc093blByb3BlcnR5KHNba10pKSB7XG4gICAgICAgIG9wdGlvbnNbc1trXV0gPSBzZXR0aW5nc1tzW2tdXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBvcHRpb25zLnN1YkRvbWFpbkRhdGVGb3JtYXQgPVxuICAgICAgdHlwZW9mIG9wdGlvbnMuc3ViRG9tYWluRGF0ZUZvcm1hdCA9PT0gJ3N0cmluZycgfHxcbiAgICAgIHR5cGVvZiBvcHRpb25zLnN1YkRvbWFpbkRhdGVGb3JtYXQgPT09ICdmdW5jdGlvbidcbiAgICAgICAgPyBvcHRpb25zLnN1YkRvbWFpbkRhdGVGb3JtYXRcbiAgICAgICAgOiB0aGlzLl9kb21haW5UeXBlW29wdGlvbnMuc3ViRG9tYWluXS5mb3JtYXQuZGF0ZTtcbiAgICBvcHRpb25zLmRvbWFpbkxhYmVsRm9ybWF0ID1cbiAgICAgIHR5cGVvZiBvcHRpb25zLmRvbWFpbkxhYmVsRm9ybWF0ID09PSAnc3RyaW5nJyB8fFxuICAgICAgdHlwZW9mIG9wdGlvbnMuZG9tYWluTGFiZWxGb3JtYXQgPT09ICdmdW5jdGlvbidcbiAgICAgICAgPyBvcHRpb25zLmRvbWFpbkxhYmVsRm9ybWF0XG4gICAgICAgIDogdGhpcy5fZG9tYWluVHlwZVtvcHRpb25zLmRvbWFpbl0uZm9ybWF0LmxlZ2VuZDtcbiAgICBvcHRpb25zLnN1YkRvbWFpblRleHRGb3JtYXQgPVxuICAgICAgKHR5cGVvZiBvcHRpb25zLnN1YkRvbWFpblRleHRGb3JtYXQgPT09ICdzdHJpbmcnICYmIG9wdGlvbnMuc3ViRG9tYWluVGV4dEZvcm1hdCAhPT0gJycpIHx8XG4gICAgICB0eXBlb2Ygb3B0aW9ucy5zdWJEb21haW5UZXh0Rm9ybWF0ID09PSAnZnVuY3Rpb24nXG4gICAgICAgID8gb3B0aW9ucy5zdWJEb21haW5UZXh0Rm9ybWF0XG4gICAgICAgIDogbnVsbDtcbiAgICBvcHRpb25zLmRvbWFpbk1hcmdpbiA9IGV4cGFuZE1hcmdpblNldHRpbmcob3B0aW9ucy5kb21haW5NYXJnaW4pO1xuICAgIG9wdGlvbnMubGVnZW5kTWFyZ2luID0gZXhwYW5kTWFyZ2luU2V0dGluZyhvcHRpb25zLmxlZ2VuZE1hcmdpbik7XG4gICAgb3B0aW9ucy5oaWdobGlnaHQgPSBwYXJlbnQuZXhwYW5kRGF0ZVNldHRpbmcob3B0aW9ucy5oaWdobGlnaHQpO1xuICAgIG9wdGlvbnMuaXRlbU5hbWUgPSBleHBhbmRJdGVtTmFtZShvcHRpb25zLml0ZW1OYW1lKTtcbiAgICBvcHRpb25zLmNvbExpbWl0ID0gcGFyc2VDb2xMaW1pdChvcHRpb25zLmNvbExpbWl0KTtcbiAgICBvcHRpb25zLnJvd0xpbWl0ID0gcGFyc2VSb3dMaW1pdChvcHRpb25zLnJvd0xpbWl0KTtcbiAgICBpZiAoIXNldHRpbmdzLmhhc093blByb3BlcnR5KCdsZWdlbmRNYXJnaW4nKSkge1xuICAgICAgYXV0b0FkZExlZ2VuZE1hcmdpbigpO1xuICAgIH1cbiAgICBhdXRvQWxpZ25MYWJlbCgpO1xuXG4gICAgLyoqXG4gICAgICogVmFsaWRhdGUgdGhhdCBhIHF1ZXJ5U3RyaW5nIGlzIHZhbGlkXG4gICAgICpcbiAgICAgKiBAcGFyYW0gIHtFbGVtZW50fHN0cmluZ3xib29sfSBzZWxlY3RvciAgIFRoZSBxdWVyeVN0cmluZyB0byB0ZXN0XG4gICAgICogQHBhcmFtICB7Ym9vbH0gIGNhbkJlRmFsc2UgIFdoZXRoZXIgZmFsc2UgaXMgYW4gYWNjZXB0ZWQgYW5kIHZhbGlkIHZhbHVlXG4gICAgICogQHBhcmFtICB7c3RyaW5nfSBuYW1lICAgIE5hbWUgb2YgdGhlIHRlc3RlZCBzZWxlY3RvclxuICAgICAqIEB0aHJvd3Mge0Vycm9yfSAgICAgICAgSWYgdGhlIHNlbGVjdG9yIGlzIG5vdCB2YWxpZFxuICAgICAqIEByZXR1cm4ge2Jvb2x9ICAgICAgICBUcnVlIGlmIHRoZSBzZWxlY3RvciBpcyBhIHZhbGlkIHF1ZXJ5U3RyaW5nXG4gICAgICovXG4gICAgZnVuY3Rpb24gdmFsaWRhdGVTZWxlY3RvcihzZWxlY3RvciwgY2FuQmVGYWxzZSwgbmFtZSkge1xuICAgICAgaWYgKFxuICAgICAgICAoKGNhbkJlRmFsc2UgJiYgc2VsZWN0b3IgPT09IGZhbHNlKSB8fFxuICAgICAgICAgIHNlbGVjdG9yIGluc3RhbmNlb2YgRWxlbWVudCB8fFxuICAgICAgICAgIHR5cGVvZiBzZWxlY3RvciA9PT0gJ3N0cmluZycpICYmXG4gICAgICAgIHNlbGVjdG9yICE9PSAnJ1xuICAgICAgKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgJyArIG5hbWUgKyAnIGlzIG5vdCB2YWxpZCcpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybiB0aGUgb3B0aW1hbCBzdWJEb21haW4gZm9yIHRoZSBzcGVjaWZpZWQgZG9tYWluXG4gICAgICpcbiAgICAgKiBAcGFyYW0gIHtzdHJpbmd9IGRvbWFpbiBhIGRvbWFpbiBuYW1lXG4gICAgICogQHJldHVybiB7c3RyaW5nfSAgICAgICAgdGhlIHN1YkRvbWFpbiBuYW1lXG4gICAgICovXG4gICAgZnVuY3Rpb24gZ2V0T3B0aW1hbFN1YkRvbWFpbihkb21haW4pIHtcbiAgICAgIHN3aXRjaCAoZG9tYWluKSB7XG4gICAgICAgIGNhc2UgJ3llYXInOlxuICAgICAgICAgIHJldHVybiAnbW9udGgnO1xuICAgICAgICBjYXNlICdtb250aCc6XG4gICAgICAgICAgcmV0dXJuICdkYXknO1xuICAgICAgICBjYXNlICd3ZWVrJzpcbiAgICAgICAgICByZXR1cm4gJ2RheSc7XG4gICAgICAgIGNhc2UgJ2RheSc6XG4gICAgICAgICAgcmV0dXJuICdob3VyJztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXR1cm4gJ21pbic7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRW5zdXJlIHRoYXQgdGhlIGRvbWFpbiBhbmQgc3ViZG9tYWluIGFyZSB2YWxpZFxuICAgICAqXG4gICAgICogQHRocm93IHtFcnJvcn0gd2hlbiBkb21haW4gb3Igc3ViZG9tYWluIGFyZSBub3QgdmFsaWRcbiAgICAgKiBAcmV0dXJuIHtib29sfSBUcnVlIGlmIGRvbWFpbiBhbmQgc3ViZG9tYWluIGFyZSB2YWxpZCBhbmQgY29tcGF0aWJsZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHZhbGlkYXRlRG9tYWluVHlwZSgpIHtcbiAgICAgIGlmIChcbiAgICAgICAgIXBhcmVudC5fZG9tYWluVHlwZS5oYXNPd25Qcm9wZXJ0eShvcHRpb25zLmRvbWFpbikgfHxcbiAgICAgICAgb3B0aW9ucy5kb21haW4gPT09ICdtaW4nIHx8XG4gICAgICAgIG9wdGlvbnMuZG9tYWluLnN1YnN0cmluZygwLCAyKSA9PT0gJ3hfJ1xuICAgICAgKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZSBkb21haW4gJ1wiICsgb3B0aW9ucy5kb21haW4gKyBcIicgaXMgbm90IHZhbGlkXCIpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXBhcmVudC5fZG9tYWluVHlwZS5oYXNPd25Qcm9wZXJ0eShvcHRpb25zLnN1YkRvbWFpbikgfHwgb3B0aW9ucy5zdWJEb21haW4gPT09ICd5ZWFyJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgc3ViRG9tYWluICdcIiArIG9wdGlvbnMuc3ViRG9tYWluICsgXCInIGlzIG5vdCB2YWxpZFwiKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHBhcmVudC5fZG9tYWluVHlwZVtvcHRpb25zLmRvbWFpbl0ubGV2ZWwgPD0gcGFyZW50Ll9kb21haW5UeXBlW29wdGlvbnMuc3ViRG9tYWluXS5sZXZlbCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgXCInXCIgKyBvcHRpb25zLnN1YkRvbWFpbiArIFwiJyBpcyBub3QgYSB2YWxpZCBzdWJEb21haW4gdG8gJ1wiICsgb3B0aW9ucy5kb21haW4gKyBcIidcIixcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmluZS10dW5lIHRoZSBsYWJlbCBhbGlnbmVtZW50IGRlcGVuZGluZyBvbiBpdHMgcG9zaXRpb25cbiAgICAgKlxuICAgICAqIEByZXR1cm4gdm9pZFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGF1dG9BbGlnbkxhYmVsKCkge1xuICAgICAgLy8gQXV0by1hbGlnbiBsYWJlbCwgZGVwZW5kaW5nIG9uIGl0J3MgcG9zaXRpb25cbiAgICAgIGlmIChcbiAgICAgICAgIXNldHRpbmdzLmhhc093blByb3BlcnR5KCdsYWJlbCcpIHx8XG4gICAgICAgIChzZXR0aW5ncy5oYXNPd25Qcm9wZXJ0eSgnbGFiZWwnKSAmJiAhc2V0dGluZ3MubGFiZWwuaGFzT3duUHJvcGVydHkoJ2FsaWduJykpXG4gICAgICApIHtcbiAgICAgICAgc3dpdGNoIChvcHRpb25zLmxhYmVsLnBvc2l0aW9uKSB7XG4gICAgICAgICAgY2FzZSAnbGVmdCc6XG4gICAgICAgICAgICBvcHRpb25zLmxhYmVsLmFsaWduID0gJ3JpZ2h0JztcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgICAgICAgIG9wdGlvbnMubGFiZWwuYWxpZ24gPSAnbGVmdCc7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgb3B0aW9ucy5sYWJlbC5hbGlnbiA9ICdjZW50ZXInO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMubGFiZWwucm90YXRlID09PSAnbGVmdCcpIHtcbiAgICAgICAgICBvcHRpb25zLmxhYmVsLmFsaWduID0gJ3JpZ2h0JztcbiAgICAgICAgfSBlbHNlIGlmIChvcHRpb25zLmxhYmVsLnJvdGF0ZSA9PT0gJ3JpZ2h0Jykge1xuICAgICAgICAgIG9wdGlvbnMubGFiZWwuYWxpZ24gPSAnbGVmdCc7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICAhc2V0dGluZ3MuaGFzT3duUHJvcGVydHkoJ2xhYmVsJykgfHxcbiAgICAgICAgKHNldHRpbmdzLmhhc093blByb3BlcnR5KCdsYWJlbCcpICYmICFzZXR0aW5ncy5sYWJlbC5oYXNPd25Qcm9wZXJ0eSgnb2Zmc2V0JykpXG4gICAgICApIHtcbiAgICAgICAgaWYgKG9wdGlvbnMubGFiZWwucG9zaXRpb24gPT09ICdsZWZ0JyB8fCBvcHRpb25zLmxhYmVsLnBvc2l0aW9uID09PSAncmlnaHQnKSB7XG4gICAgICAgICAgb3B0aW9ucy5sYWJlbC5vZmZzZXQgPSB7XG4gICAgICAgICAgICB4OiAxMCxcbiAgICAgICAgICAgIHk6IDE1LFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJZiBub3Qgc3BlY2lmaWVkLCBhZGQgc29tZSBtYXJnaW4gYXJvdW5kIHRoZSBsZWdlbmQgZGVwZW5kaW5nIG9uIGl0cyBwb3NpdGlvblxuICAgICAqXG4gICAgICogQHJldHVybiB2b2lkXG4gICAgICovXG4gICAgZnVuY3Rpb24gYXV0b0FkZExlZ2VuZE1hcmdpbigpIHtcbiAgICAgIHN3aXRjaCAob3B0aW9ucy5sZWdlbmRWZXJ0aWNhbFBvc2l0aW9uKSB7XG4gICAgICAgIGNhc2UgJ3RvcCc6XG4gICAgICAgICAgb3B0aW9ucy5sZWdlbmRNYXJnaW5bMl0gPSBwYXJlbnQuREVGQVVMVF9MRUdFTkRfTUFSR0lOO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdib3R0b20nOlxuICAgICAgICAgIG9wdGlvbnMubGVnZW5kTWFyZ2luWzBdID0gcGFyZW50LkRFRkFVTFRfTEVHRU5EX01BUkdJTjtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnbWlkZGxlJzpcbiAgICAgICAgY2FzZSAnY2VudGVyJzpcbiAgICAgICAgICBvcHRpb25zLmxlZ2VuZE1hcmdpbltvcHRpb25zLmxlZ2VuZEhvcml6b250YWxQb3NpdGlvbiA9PT0gJ3JpZ2h0JyA/IDMgOiAxXSA9XG4gICAgICAgICAgICBwYXJlbnQuREVGQVVMVF9MRUdFTkRfTUFSR0lOO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEV4cGFuZCBhIG51bWJlciBvZiBhbiBhcnJheSBvZiBudW1iZXJzIHRvIGFuIHVzYWJsZSA0IHZhbHVlcyBhcnJheVxuICAgICAqXG4gICAgICogQHBhcmFtICB7aW50ZWdlcnxhcnJheX0gdmFsdWVcbiAgICAgKiBAcmV0dXJuIHthcnJheX0gICAgICAgIGFycmF5XG4gICAgICovXG4gICAgZnVuY3Rpb24gZXhwYW5kTWFyZ2luU2V0dGluZyh2YWx1ZSkge1xuICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgdmFsdWUgPSBbdmFsdWVdO1xuICAgICAgfVxuXG4gICAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdNYXJnaW4gb25seSB0YWtlcyBhbiBpbnRlZ2VyIG9yIGFuIGFycmF5IG9mIGludGVnZXJzJyk7XG4gICAgICAgIHZhbHVlID0gWzBdO1xuICAgICAgfVxuXG4gICAgICBzd2l0Y2ggKHZhbHVlLmxlbmd0aCkge1xuICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgcmV0dXJuIFt2YWx1ZVswXSwgdmFsdWVbMF0sIHZhbHVlWzBdLCB2YWx1ZVswXV07XG4gICAgICAgIGNhc2UgMjpcbiAgICAgICAgICByZXR1cm4gW3ZhbHVlWzBdLCB2YWx1ZVsxXSwgdmFsdWVbMF0sIHZhbHVlWzFdXTtcbiAgICAgICAgY2FzZSAzOlxuICAgICAgICAgIHJldHVybiBbdmFsdWVbMF0sIHZhbHVlWzFdLCB2YWx1ZVsyXSwgdmFsdWVbMV1dO1xuICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJldHVybiB2YWx1ZS5zbGljZSgwLCA0KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0IGEgc3RyaW5nIHRvIGFuIGFycmF5IGxpa2UgW3Npbmd1bGFyLWZvcm0sIHBsdXJhbC1mb3JtXVxuICAgICAqXG4gICAgICogQHBhcmFtICB7c3RyaW5nfGFycmF5fSB2YWx1ZSBEYXRlIHRvIGNvbnZlcnRcbiAgICAgKiBAcmV0dXJuIHthcnJheX0gICAgICAgQW4gYXJyYXkgbGlrZSBbc2luZ3VsYXItZm9ybSwgcGx1cmFsLWZvcm1dXG4gICAgICovXG4gICAgZnVuY3Rpb24gZXhwYW5kSXRlbU5hbWUodmFsdWUpIHtcbiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiBbdmFsdWUsIHZhbHVlICsgKHZhbHVlICE9PSAnJyA/ICdzJyA6ICcnKV07XG4gICAgICB9XG5cbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgcmV0dXJuIFt2YWx1ZVswXSwgdmFsdWVbMF0gKyAncyddO1xuICAgICAgICB9IGVsc2UgaWYgKHZhbHVlLmxlbmd0aCA+IDIpIHtcbiAgICAgICAgICByZXR1cm4gdmFsdWUuc2xpY2UoMCwgMik7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBbJ2l0ZW0nLCAnaXRlbXMnXTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBwYXJzZUNvbExpbWl0KHZhbHVlKSB7XG4gICAgICByZXR1cm4gdmFsdWUgPiAwID8gdmFsdWUgOiBudWxsO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHBhcnNlUm93TGltaXQodmFsdWUpIHtcbiAgICAgIGlmICh2YWx1ZSA+IDAgJiYgb3B0aW9ucy5jb2xMaW1pdCA+IDApIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2NvbExpbWl0IGFuZCByb3dMaW1pdCBhcmUgbXV0dWFsbHkgZXhjbHVzaXZlLCByb3dMaW1pdCB3aWxsIGJlIGlnbm9yZWQnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICByZXR1cm4gdmFsdWUgPiAwID8gdmFsdWUgOiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLl9pbml0KCk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIENvbnZlcnQgYSBrZXl3b3JkIG9yIGFuIGFycmF5IG9mIGtleXdvcmQvZGF0ZSB0byBhbiBhcnJheSBvZiBkYXRlIG9iamVjdHNcbiAgICpcbiAgICogQHBhcmFtICB7c3RyaW5nfGFycmF5fERhdGV9IHZhbHVlIERhdGEgdG8gY29udmVydFxuICAgKiBAcmV0dXJuIHthcnJheX0gICAgICAgQW4gYXJyYXkgb2YgRGF0ZXNcbiAgICovXG4gIGV4cGFuZERhdGVTZXR0aW5nOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICB2YWx1ZSA9IFt2YWx1ZV07XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlXG4gICAgICAubWFwKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIGlmIChkYXRhID09PSAnbm93Jykge1xuICAgICAgICAgIHJldHVybiBuZXcgRGF0ZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkYXRhIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0pXG4gICAgICAuZmlsdGVyKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBkICE9PSBmYWxzZTtcbiAgICAgIH0pO1xuICB9LFxuXG4gIC8qKlxuICAgKiBGaWxsIHRoZSBjYWxlbmRhciBieSBjb2xvcmluZyB0aGUgY2VsbHNcbiAgICpcbiAgICogQHBhcmFtIGFycmF5IHN2ZyBBbiBhcnJheSBvZiBodG1sIG5vZGUgdG8gYXBwbHkgdGhlIHRyYW5zZm9ybWF0aW9uIHRvIChvcHRpb25hbClcbiAgICogICAgICAgICAgICAgICAgICBJdCdzIHVzZWQgdG8gbGltaXQgdGhlIHBhaW50aW5nIHRvIG9ubHkgYSBzdWJzZXQgb2YgdGhlIGNhbGVuZGFyXG4gICAqIEByZXR1cm4gdm9pZFxuICAgKi9cbiAgZmlsbDogZnVuY3Rpb24gKHN2Zykge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBwYXJlbnQgPSB0aGlzO1xuICAgIHZhciBvcHRpb25zID0gcGFyZW50Lm9wdGlvbnM7XG5cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgc3ZnID0gcGFyZW50LnJvb3Quc2VsZWN0QWxsKCcuZ3JhcGgtZG9tYWluJyk7XG4gICAgfVxuXG4gICAgdmFyIHJlY3QgPSBzdmdcbiAgICAgIC5zZWxlY3RBbGwoJ3N2ZycpXG4gICAgICAuc2VsZWN0QWxsKCdnJylcbiAgICAgIC5kYXRhKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBwYXJlbnQuX2RvbWFpbnMuZ2V0KGQpO1xuICAgICAgfSk7XG4gICAgLyoqXG4gICAgICogQ29sb3JpemUgdGhlIGNlbGwgdmlhIGEgc3R5bGUgYXR0cmlidXRlIGlmIGVuYWJsZWRcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhZGRTdHlsZShlbGVtZW50KSB7XG4gICAgICBpZiAocGFyZW50LmxlZ2VuZFNjYWxlID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgZWxlbWVudC5hdHRyKCdmaWxsJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGQudiA9PT0gbnVsbCAmJlxuICAgICAgICAgIG9wdGlvbnMuaGFzT3duUHJvcGVydHkoJ2NvbnNpZGVyTWlzc2luZ0RhdGFBc1plcm8nKSAmJlxuICAgICAgICAgICFvcHRpb25zLmNvbnNpZGVyTWlzc2luZ0RhdGFBc1plcm9cbiAgICAgICAgKSB7XG4gICAgICAgICAgaWYgKG9wdGlvbnMubGVnZW5kQ29sb3JzLmhhc093blByb3BlcnR5KCdiYXNlJykpIHtcbiAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmxlZ2VuZENvbG9ycy5iYXNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChcbiAgICAgICAgICBvcHRpb25zLmxlZ2VuZENvbG9ycyAhPT0gbnVsbCAmJlxuICAgICAgICAgIG9wdGlvbnMubGVnZW5kQ29sb3JzLmhhc093blByb3BlcnR5KCdlbXB0eScpICYmXG4gICAgICAgICAgKGQudiA9PT0gMCB8fFxuICAgICAgICAgICAgKGQudiA9PT0gbnVsbCAmJlxuICAgICAgICAgICAgICBvcHRpb25zLmhhc093blByb3BlcnR5KCdjb25zaWRlck1pc3NpbmdEYXRhQXNaZXJvJykgJiZcbiAgICAgICAgICAgICAgb3B0aW9ucy5jb25zaWRlck1pc3NpbmdEYXRhQXNaZXJvKSlcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuIG9wdGlvbnMubGVnZW5kQ29sb3JzLmVtcHR5O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIGQudiA8IDAgJiZcbiAgICAgICAgICBvcHRpb25zLmxlZ2VuZFswXSA+IDAgJiZcbiAgICAgICAgICBvcHRpb25zLmxlZ2VuZENvbG9ycyAhPT0gbnVsbCAmJlxuICAgICAgICAgIG9wdGlvbnMubGVnZW5kQ29sb3JzLmhhc093blByb3BlcnR5KCdvdmVyZmxvdycpXG4gICAgICAgICkge1xuICAgICAgICAgIHJldHVybiBvcHRpb25zLmxlZ2VuZENvbG9ycy5vdmVyZmxvdztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBwYXJlbnQubGVnZW5kU2NhbGUoTWF0aC5taW4oZC52LCBvcHRpb25zLmxlZ2VuZFtvcHRpb25zLmxlZ2VuZC5sZW5ndGggLSAxXSkpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmVjdFxuICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgLmR1cmF0aW9uKG9wdGlvbnMuYW5pbWF0aW9uRHVyYXRpb24pXG4gICAgICAuc2VsZWN0KCdyZWN0JylcbiAgICAgIC5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHZhciBodG1sQ2xhc3MgPSBwYXJlbnQuZ2V0SGlnaGxpZ2h0Q2xhc3NOYW1lKGQudCkudHJpbSgpLnNwbGl0KCcgJyk7XG4gICAgICAgIHZhciBwYXN0RGF0ZSA9IHBhcmVudC5kYXRlSXNMZXNzVGhhbihkLnQsIG5ldyBEYXRlKCkpO1xuICAgICAgICB2YXIgc2FtZURhdGUgPSBwYXJlbnQuZGF0ZUlzRXF1YWwoZC50LCBuZXcgRGF0ZSgpKTtcblxuICAgICAgICBpZiAoXG4gICAgICAgICAgcGFyZW50LmxlZ2VuZFNjYWxlID09PSBudWxsIHx8XG4gICAgICAgICAgKGQudiA9PT0gbnVsbCAmJlxuICAgICAgICAgICAgb3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgnY29uc2lkZXJNaXNzaW5nRGF0YUFzWmVybycpICYmXG4gICAgICAgICAgICAhb3B0aW9ucy5jb25zaWRlck1pc3NpbmdEYXRhQXNaZXJvICYmXG4gICAgICAgICAgICAhb3B0aW9ucy5sZWdlbmRDb2xvcnMuaGFzT3duUHJvcGVydHkoJ2Jhc2UnKSlcbiAgICAgICAgKSB7XG4gICAgICAgICAgaHRtbENsYXNzLnB1c2goJ2dyYXBoLXJlY3QnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzYW1lRGF0ZSkge1xuICAgICAgICAgIGh0bWxDbGFzcy5wdXNoKCdub3cnKTtcbiAgICAgICAgfSBlbHNlIGlmICghcGFzdERhdGUpIHtcbiAgICAgICAgICBodG1sQ2xhc3MucHVzaCgnZnV0dXJlJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZC52ICE9PSBudWxsKSB7XG4gICAgICAgICAgaHRtbENsYXNzLnB1c2gocGFyZW50LkxlZ2VuZC5nZXRDbGFzcyhkLnYsIHBhcmVudC5sZWdlbmRTY2FsZSA9PT0gbnVsbCkpO1xuICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMuY29uc2lkZXJNaXNzaW5nRGF0YUFzWmVybyAmJiBwYXN0RGF0ZSkge1xuICAgICAgICAgIGh0bWxDbGFzcy5wdXNoKHBhcmVudC5MZWdlbmQuZ2V0Q2xhc3MoMCwgcGFyZW50LmxlZ2VuZFNjYWxlID09PSBudWxsKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0aW9ucy5vbkNsaWNrICE9PSBudWxsKSB7XG4gICAgICAgICAgaHRtbENsYXNzLnB1c2goJ2hvdmVyX2N1cnNvcicpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGh0bWxDbGFzcy5qb2luKCcgJyk7XG4gICAgICB9KVxuICAgICAgLmNhbGwoYWRkU3R5bGUpO1xuXG4gICAgcmVjdFxuICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgLmR1cmF0aW9uKG9wdGlvbnMuYW5pbWF0aW9uRHVyYXRpb24pXG4gICAgICAuc2VsZWN0KCd0aXRsZScpXG4gICAgICAudGV4dChmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gcGFyZW50LmdldFN1YkRvbWFpblRpdGxlKGQpO1xuICAgICAgfSk7XG5cbiAgICBmdW5jdGlvbiBmb3JtYXRTdWJEb21haW5UZXh0KGVsZW1lbnQpIHtcbiAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5zdWJEb21haW5UZXh0Rm9ybWF0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGVsZW1lbnQudGV4dChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHJldHVybiBvcHRpb25zLnN1YkRvbWFpblRleHRGb3JtYXQoZC50LCBkLnYpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGFuZ2UgdGhlIHN1YkRvbWFpblRleHQgY2xhc3MgaWYgbmVjZXNzYXJ5XG4gICAgICogQWxzbyBjaGFuZ2UgdGhlIHRleHQsIGUuZyB3aGVuIHRleHQgaXMgcmVwcmVzZW50aW5nIHRoZSB2YWx1ZVxuICAgICAqIGluc3RlYWQgb2YgdGhlIGRhdGVcbiAgICAgKi9cbiAgICByZWN0XG4gICAgICAudHJhbnNpdGlvbigpXG4gICAgICAuZHVyYXRpb24ob3B0aW9ucy5hbmltYXRpb25EdXJhdGlvbilcbiAgICAgIC5zZWxlY3QoJ3RleHQnKVxuICAgICAgLmF0dHIoJ2NsYXNzJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuICdzdWJkb21haW4tdGV4dCcgKyBwYXJlbnQuZ2V0SGlnaGxpZ2h0Q2xhc3NOYW1lKGQudCk7XG4gICAgICB9KVxuICAgICAgLmNhbGwoZm9ybWF0U3ViRG9tYWluVGV4dCk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFNwcmludGYgbGlrZSBmdW5jdGlvbi5cbiAgICogUmVwbGFjZXMgcGxhY2Vob2xkZXJzIHswfSBpbiBzdHJpbmcgd2l0aCB2YWx1ZXMgZnJvbSBwcm92aWRlZCBvYmplY3QuXG4gICAqXG4gICAqIEBwYXJhbSBzdHJpbmcgZm9ybWF0dGVkIFN0cmluZyBjb250YWluaW5nIHBsYWNlaG9sZGVycy5cbiAgICogQHBhcmFtIG9iamVjdCBhcmdzIE9iamVjdCB3aXRoIHByb3BlcnRpZXMgdG8gcmVwbGFjZSBwbGFjZWhvbGRlcnMgaW4gc3RyaW5nLlxuICAgKlxuICAgKiBAcmV0dXJuIFN0cmluZ1xuICAgKi9cbiAgZm9ybWF0U3RyaW5nV2l0aE9iamVjdDogZnVuY3Rpb24gKGZvcm1hdHRlZCwgYXJncykge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICBmb3IgKHZhciBwcm9wIGluIGFyZ3MpIHtcbiAgICAgIGlmIChhcmdzLmhhc093blByb3BlcnR5KHByb3ApKSB7XG4gICAgICAgIHZhciByZWdleHAgPSBuZXcgUmVnRXhwKCdcXFxceycgKyBwcm9wICsgJ1xcXFx9JywgJ2dpJyk7XG4gICAgICAgIGZvcm1hdHRlZCA9IGZvcm1hdHRlZC5yZXBsYWNlKHJlZ2V4cCwgYXJnc1twcm9wXSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmb3JtYXR0ZWQ7XG4gIH0sXG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4gIC8vIEVWRU5UUyBDQUxMQkFDSyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuXG4gIC8qKlxuICAgKiBIZWxwZXIgbWV0aG9kIGZvciB0cmlnZ2VyaW5nIGV2ZW50IGNhbGxiYWNrXG4gICAqXG4gICAqIEBwYXJhbSAgc3RyaW5nICBldmVudE5hbWUgICAgICAgTmFtZSBvZiB0aGUgZXZlbnQgdG8gdHJpZ2dlclxuICAgKiBAcGFyYW0gIGFycmF5ICBzdWNjZXNzQXJncyAgICAgTGlzdCBvZiBhcmd1bWVudCB0byBwYXNzIHRvIHRoZSBjYWxsYmFja1xuICAgKiBAcGFyYW0gIGJvb2xlYW4gIHNraXAgICAgICBXaGV0aGVyIHRvIHNraXAgdGhlIGV2ZW50IHRyaWdnZXJpbmdcbiAgICogQHJldHVybiBtaXhlZCAgVHJ1ZSB3aGVuIHRoZSB0cmlnZ2VyaW5nIHdhcyBza2lwcGVkLCBmYWxzZSBvbiBlcnJvciwgZWxzZSB0aGUgY2FsbGJhY2sgZnVuY3Rpb25cbiAgICovXG4gIHRyaWdnZXJFdmVudDogZnVuY3Rpb24gKGV2ZW50TmFtZSwgc3VjY2Vzc0FyZ3MsIHNraXApIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAoKGFyZ3VtZW50cy5sZW5ndGggPT09IDMgJiYgc2tpcCkgfHwgdGhpcy5vcHRpb25zW2V2ZW50TmFtZV0gPT09IG51bGwpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgdGhpcy5vcHRpb25zW2V2ZW50TmFtZV0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGlmICh0eXBlb2Ygc3VjY2Vzc0FyZ3MgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgc3VjY2Vzc0FyZ3MgPSBzdWNjZXNzQXJncygpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMub3B0aW9uc1tldmVudE5hbWVdLmFwcGx5KHRoaXMsIHN1Y2Nlc3NBcmdzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2coJ1Byb3ZpZGVkIGNhbGxiYWNrIGZvciAnICsgZXZlbnROYW1lICsgJyBpcyBub3QgYSBmdW5jdGlvbi4nKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIEV2ZW50IHRyaWdnZXJlZCBvbiBhIG1vdXNlIGNsaWNrIG9uIGEgc3ViRG9tYWluIGNlbGxcbiAgICpcbiAgICogQHBhcmFtICBEYXRlICAgIGQgICAgRGF0ZSBvZiB0aGUgc3ViZG9tYWluIGJsb2NrXG4gICAqIEBwYXJhbSAgaW50ICAgIGl0ZW1OYiAgTnVtYmVyIG9mIGl0ZW1zIGluIHRoYXQgZGF0ZVxuICAgKi9cbiAgb25DbGljazogZnVuY3Rpb24gKGQsIGl0ZW1OYikge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHJldHVybiB0aGlzLnRyaWdnZXJFdmVudCgnb25DbGljaycsIFtkLCBpdGVtTmJdKTtcbiAgfSxcblxuICAvKipcbiAgICogRXZlbnQgdHJpZ2dlcmVkIGFmdGVyIGRyYXdpbmcgdGhlIGNhbGVuZGFyLCBieXQgYmVmb3JlIGZpbGxpbmcgaXQgd2l0aCBkYXRhXG4gICAqL1xuICBhZnRlckxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICByZXR1cm4gdGhpcy50cmlnZ2VyRXZlbnQoJ2FmdGVyTG9hZCcpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBFdmVudCB0cmlnZ2VyZWQgYWZ0ZXIgY29tcGxldGluZyBkcmF3aW5nIGFuZCBmaWxsaW5nIHRoZSBjYWxlbmRhclxuICAgKi9cbiAgb25Db21wbGV0ZTogZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciByZXNwb25zZSA9IHRoaXMudHJpZ2dlckV2ZW50KCdvbkNvbXBsZXRlJywgW10sIHRoaXMuX2NvbXBsZXRlZCk7XG4gICAgdGhpcy5fY29tcGxldGVkID0gdHJ1ZTtcbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEV2ZW50IHRyaWdnZXJlZCBhZnRlciBzaGlmdGluZyB0aGUgY2FsZW5kYXIgb25lIGRvbWFpbiBiYWNrXG4gICAqXG4gICAqIEBwYXJhbSAgRGF0ZSAgICBzdGFydCAgRG9tYWluIHN0YXJ0IGRhdGVcbiAgICogQHBhcmFtICBEYXRlICAgIGVuZCAgICBEb21haW4gZW5kIGRhdGVcbiAgICovXG4gIGFmdGVyTG9hZFByZXZpb3VzRG9tYWluOiBmdW5jdGlvbiAoc3RhcnQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgcGFyZW50ID0gdGhpcztcbiAgICByZXR1cm4gdGhpcy50cmlnZ2VyRXZlbnQoJ2FmdGVyTG9hZFByZXZpb3VzRG9tYWluJywgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHN1YkRvbWFpbiA9IHBhcmVudC5nZXRTdWJEb21haW4oc3RhcnQpO1xuICAgICAgcmV0dXJuIFtzdWJEb21haW4uc2hpZnQoKSwgc3ViRG9tYWluLnBvcCgpXTtcbiAgICB9KTtcbiAgfSxcblxuICAvKipcbiAgICogRXZlbnQgdHJpZ2dlcmVkIGFmdGVyIHNoaWZ0aW5nIHRoZSBjYWxlbmRhciBvbmUgZG9tYWluIGFib3ZlXG4gICAqXG4gICAqIEBwYXJhbSAgRGF0ZSAgICBzdGFydCAgRG9tYWluIHN0YXJ0IGRhdGVcbiAgICogQHBhcmFtICBEYXRlICAgIGVuZCAgICBEb21haW4gZW5kIGRhdGVcbiAgICovXG4gIGFmdGVyTG9hZE5leHREb21haW46IGZ1bmN0aW9uIChzdGFydCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBwYXJlbnQgPSB0aGlzO1xuICAgIHJldHVybiB0aGlzLnRyaWdnZXJFdmVudCgnYWZ0ZXJMb2FkTmV4dERvbWFpbicsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBzdWJEb21haW4gPSBwYXJlbnQuZ2V0U3ViRG9tYWluKHN0YXJ0KTtcbiAgICAgIHJldHVybiBbc3ViRG9tYWluLnNoaWZ0KCksIHN1YkRvbWFpbi5wb3AoKV07XG4gICAgfSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEV2ZW50IHRyaWdnZXJlZCBhZnRlciBsb2FkaW5nIHRoZSBsZWZ0bW9zdCBkb21haW4gYWxsb3dlZCBieSBtaW5EYXRlXG4gICAqXG4gICAqIEBwYXJhbSAgYm9vbGVhbiAgcmVhY2hlZCBUcnVlIGlmIHRoZSBsZWZ0bW9zdCBkb21haW4gd2FzIHJlYWNoZWRcbiAgICovXG4gIG9uTWluRG9tYWluUmVhY2hlZDogZnVuY3Rpb24gKHJlYWNoZWQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB0aGlzLl9taW5Eb21haW5SZWFjaGVkID0gcmVhY2hlZDtcbiAgICByZXR1cm4gdGhpcy50cmlnZ2VyRXZlbnQoJ29uTWluRG9tYWluUmVhY2hlZCcsIFtyZWFjaGVkXSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEV2ZW50IHRyaWdnZXJlZCBhZnRlciBsb2FkaW5nIHRoZSByaWdodG1vc3QgZG9tYWluIGFsbG93ZWQgYnkgbWF4RGF0ZVxuICAgKlxuICAgKiBAcGFyYW0gIGJvb2xlYW4gIHJlYWNoZWQgVHJ1ZSBpZiB0aGUgcmlnaHRtb3N0IGRvbWFpbiB3YXMgcmVhY2hlZFxuICAgKi9cbiAgb25NYXhEb21haW5SZWFjaGVkOiBmdW5jdGlvbiAocmVhY2hlZCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHRoaXMuX21heERvbWFpblJlYWNoZWQgPSByZWFjaGVkO1xuICAgIHJldHVybiB0aGlzLnRyaWdnZXJFdmVudCgnb25NYXhEb21haW5SZWFjaGVkJywgW3JlYWNoZWRdKTtcbiAgfSxcblxuICBjaGVja0lmTWluRG9tYWluSXNSZWFjaGVkOiBmdW5jdGlvbiAoZGF0ZSwgdXBwZXJCb3VuZCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICh0aGlzLm1pbkRvbWFpbklzUmVhY2hlZChkYXRlKSkge1xuICAgICAgdGhpcy5vbk1pbkRvbWFpblJlYWNoZWQodHJ1ZSk7XG4gICAgfVxuXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHtcbiAgICAgIGlmICh0aGlzLl9tYXhEb21haW5SZWFjaGVkICYmICF0aGlzLm1heERvbWFpbklzUmVhY2hlZCh1cHBlckJvdW5kKSkge1xuICAgICAgICB0aGlzLm9uTWF4RG9tYWluUmVhY2hlZChmYWxzZSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIGNoZWNrSWZNYXhEb21haW5Jc1JlYWNoZWQ6IGZ1bmN0aW9uIChkYXRlLCBsb3dlckJvdW5kKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKHRoaXMubWF4RG9tYWluSXNSZWFjaGVkKGRhdGUpKSB7XG4gICAgICB0aGlzLm9uTWF4RG9tYWluUmVhY2hlZCh0cnVlKTtcbiAgICB9XG5cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikge1xuICAgICAgaWYgKHRoaXMuX21pbkRvbWFpblJlYWNoZWQgJiYgIXRoaXMubWluRG9tYWluSXNSZWFjaGVkKGxvd2VyQm91bmQpKSB7XG4gICAgICAgIHRoaXMub25NaW5Eb21haW5SZWFjaGVkKGZhbHNlKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgYWZ0ZXJVcGRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICByZXR1cm4gdGhpcy50cmlnZ2VyRXZlbnQoJ2FmdGVyVXBkYXRlJyk7XG4gIH0sXG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4gIC8vIEZPUk1BVFRFUiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG5cbiAgZm9ybWF0TnVtYmVyOiBkMy5mb3JtYXQoJyxnJyksXG5cbiAgZm9ybWF0RGF0ZTogZnVuY3Rpb24gKGQsIGZvcm1hdCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikge1xuICAgICAgZm9ybWF0ID0gJ3RpdGxlJztcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIGZvcm1hdCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgcmV0dXJuIGZvcm1hdChkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGYgPSBkMy50aW1lLmZvcm1hdChmb3JtYXQpO1xuICAgICAgcmV0dXJuIGYoZCk7XG4gICAgfVxuICB9LFxuXG4gIGdldFN1YkRvbWFpblRpdGxlOiBmdW5jdGlvbiAoZCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmIChkLnYgPT09IG51bGwgJiYgIXRoaXMub3B0aW9ucy5jb25zaWRlck1pc3NpbmdEYXRhQXNaZXJvKSB7XG4gICAgICByZXR1cm4gdGhpcy5mb3JtYXRTdHJpbmdXaXRoT2JqZWN0KHRoaXMub3B0aW9ucy5zdWJEb21haW5UaXRsZUZvcm1hdC5lbXB0eSwge1xuICAgICAgICBkYXRlOiB0aGlzLmZvcm1hdERhdGUobmV3IERhdGUoZC50KSwgdGhpcy5vcHRpb25zLnN1YkRvbWFpbkRhdGVGb3JtYXQpLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciB2YWx1ZSA9IGQudjtcbiAgICAgIC8vIENvbnNpZGVyIG51bGwgYXMgMFxuICAgICAgaWYgKHZhbHVlID09PSBudWxsICYmIHRoaXMub3B0aW9ucy5jb25zaWRlck1pc3NpbmdEYXRhQXNaZXJvKSB7XG4gICAgICAgIHZhbHVlID0gMDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0U3RyaW5nV2l0aE9iamVjdCh0aGlzLm9wdGlvbnMuc3ViRG9tYWluVGl0bGVGb3JtYXQuZmlsbGVkLCB7XG4gICAgICAgIGNvdW50OiB0aGlzLmZvcm1hdE51bWJlcih2YWx1ZSksXG4gICAgICAgIG5hbWU6IHRoaXMub3B0aW9ucy5pdGVtTmFtZVt2YWx1ZSAhPT0gMSA/IDEgOiAwXSxcbiAgICAgICAgY29ubmVjdG9yOiB0aGlzLl9kb21haW5UeXBlW3RoaXMub3B0aW9ucy5zdWJEb21haW5dLmZvcm1hdC5jb25uZWN0b3IsXG4gICAgICAgIGRhdGU6IHRoaXMuZm9ybWF0RGF0ZShuZXcgRGF0ZShkLnQpLCB0aGlzLm9wdGlvbnMuc3ViRG9tYWluRGF0ZUZvcm1hdCksXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4gIC8vIERPTUFJTiBOQVZJR0FUSU9OICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuXG4gIC8qKlxuICAgKiBTaGlmdCB0aGUgY2FsZW5kYXIgb25lIGRvbWFpbiBmb3J3YXJkXG4gICAqXG4gICAqIFRoZSBuZXcgZG9tYWluIGlzIGxvYWRlZCBvbmx5IGlmIGl0J3Mgbm90IGJleW9uZCBtYXhEYXRlXG4gICAqXG4gICAqIEBwYXJhbSBpbnQgbiBOdW1iZXIgb2YgZG9tYWlucyB0byBsb2FkXG4gICAqIEByZXR1cm4gYm9vbCBUcnVlIGlmIHRoZSBuZXh0IGRvbWFpbiB3YXMgbG9hZGVkLCBlbHNlIGZhbHNlXG4gICAqL1xuICBsb2FkTmV4dERvbWFpbjogZnVuY3Rpb24gKG4pIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAodGhpcy5fbWF4RG9tYWluUmVhY2hlZCB8fCBuID09PSAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdmFyIGJvdW5kID0gdGhpcy5sb2FkTmV3RG9tYWlucyh0aGlzLk5BVklHQVRFX1JJR0hULCB0aGlzLmdldERvbWFpbih0aGlzLmdldE5leHREb21haW4oKSwgbikpO1xuXG4gICAgdGhpcy5hZnRlckxvYWROZXh0RG9tYWluKGJvdW5kLmVuZCk7XG4gICAgdGhpcy5jaGVja0lmTWF4RG9tYWluSXNSZWFjaGVkKHRoaXMuZ2V0TmV4dERvbWFpbigpLmdldFRpbWUoKSwgYm91bmQuc3RhcnQpO1xuXG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFNoaWZ0IHRoZSBjYWxlbmRhciBvbmUgZG9tYWluIGJhY2t3YXJkXG4gICAqXG4gICAqIFRoZSBwcmV2aW91cyBkb21haW4gaXMgbG9hZGVkIG9ubHkgaWYgaXQncyBub3QgYmV5b25kIHRoZSBtaW5EYXRlXG4gICAqXG4gICAqIEBwYXJhbSBpbnQgbiBOdW1iZXIgb2YgZG9tYWlucyB0byBsb2FkXG4gICAqIEByZXR1cm4gYm9vbCBUcnVlIGlmIHRoZSBwcmV2aW91cyBkb21haW4gd2FzIGxvYWRlZCwgZWxzZSBmYWxzZVxuICAgKi9cbiAgbG9hZFByZXZpb3VzRG9tYWluOiBmdW5jdGlvbiAobikge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICh0aGlzLl9taW5Eb21haW5SZWFjaGVkIHx8IG4gPT09IDApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgYm91bmQgPSB0aGlzLmxvYWROZXdEb21haW5zKFxuICAgICAgdGhpcy5OQVZJR0FURV9MRUZULFxuICAgICAgdGhpcy5nZXREb21haW4odGhpcy5nZXREb21haW5LZXlzKClbMF0sIC1uKS5yZXZlcnNlKCksXG4gICAgKTtcblxuICAgIHRoaXMuYWZ0ZXJMb2FkUHJldmlvdXNEb21haW4oYm91bmQuc3RhcnQpO1xuICAgIHRoaXMuY2hlY2tJZk1pbkRvbWFpbklzUmVhY2hlZChib3VuZC5zdGFydCwgYm91bmQuZW5kKTtcblxuICAgIHJldHVybiB0cnVlO1xuICB9LFxuXG4gIGxvYWROZXdEb21haW5zOiBmdW5jdGlvbiAoZGlyZWN0aW9uLCBuZXdEb21haW5zKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHBhcmVudCA9IHRoaXM7XG4gICAgdmFyIGJhY2t3YXJkID0gZGlyZWN0aW9uID09PSB0aGlzLk5BVklHQVRFX0xFRlQ7XG4gICAgdmFyIGkgPSAtMTtcbiAgICB2YXIgdG90YWwgPSBuZXdEb21haW5zLmxlbmd0aDtcbiAgICB2YXIgZG9tYWlucyA9IHRoaXMuZ2V0RG9tYWluS2V5cygpO1xuXG4gICAgZnVuY3Rpb24gYnVpbGRTdWJEb21haW4oZCkge1xuICAgICAgcmV0dXJuIHsgdDogcGFyZW50Ll9kb21haW5UeXBlW3BhcmVudC5vcHRpb25zLnN1YkRvbWFpbl0uZXh0cmFjdFVuaXQoZCksIHY6IG51bGwgfTtcbiAgICB9XG5cbiAgICAvLyBSZW1vdmUgb3V0IG9mIGJvdW5kIGRvbWFpbnMgZnJvbSBsaXN0IG9mIG5ldyBkb21haW5zIHRvIHByZXBlbmRcbiAgICB3aGlsZSAoKytpIDwgdG90YWwpIHtcbiAgICAgIGlmIChiYWNrd2FyZCAmJiB0aGlzLm1pbkRvbWFpbklzUmVhY2hlZChuZXdEb21haW5zW2ldKSkge1xuICAgICAgICBuZXdEb21haW5zID0gbmV3RG9tYWlucy5zbGljZSgwLCBpICsgMSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgaWYgKCFiYWNrd2FyZCAmJiB0aGlzLm1heERvbWFpbklzUmVhY2hlZChuZXdEb21haW5zW2ldKSkge1xuICAgICAgICBuZXdEb21haW5zID0gbmV3RG9tYWlucy5zbGljZSgwLCBpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbmV3RG9tYWlucyA9IG5ld0RvbWFpbnMuc2xpY2UoLXRoaXMub3B0aW9ucy5yYW5nZSk7XG5cbiAgICBmb3IgKGkgPSAwLCB0b3RhbCA9IG5ld0RvbWFpbnMubGVuZ3RoOyBpIDwgdG90YWw7IGkrKykge1xuICAgICAgdGhpcy5fZG9tYWlucy5zZXQoXG4gICAgICAgIG5ld0RvbWFpbnNbaV0uZ2V0VGltZSgpLFxuICAgICAgICB0aGlzLmdldFN1YkRvbWFpbihuZXdEb21haW5zW2ldKS5tYXAoYnVpbGRTdWJEb21haW4pLFxuICAgICAgKTtcblxuICAgICAgdGhpcy5fZG9tYWlucy5yZW1vdmUoYmFja3dhcmQgPyBkb21haW5zLnBvcCgpIDogZG9tYWlucy5zaGlmdCgpKTtcbiAgICB9XG5cbiAgICBkb21haW5zID0gdGhpcy5nZXREb21haW5LZXlzKCk7XG5cbiAgICBpZiAoYmFja3dhcmQpIHtcbiAgICAgIG5ld0RvbWFpbnMgPSBuZXdEb21haW5zLnJldmVyc2UoKTtcbiAgICB9XG5cbiAgICB0aGlzLnBhaW50KGRpcmVjdGlvbik7XG5cbiAgICB0aGlzLmdldERhdGFzKFxuICAgICAgdGhpcy5vcHRpb25zLmRhdGEsXG4gICAgICBuZXdEb21haW5zWzBdLFxuICAgICAgdGhpcy5nZXRTdWJEb21haW4obmV3RG9tYWluc1tuZXdEb21haW5zLmxlbmd0aCAtIDFdKS5wb3AoKSxcbiAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcGFyZW50LmZpbGwocGFyZW50Lmxhc3RJbnNlcnRlZFN2Zyk7XG4gICAgICB9LFxuICAgICk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3RhcnQ6IG5ld0RvbWFpbnNbYmFja3dhcmQgPyAwIDogMV0sXG4gICAgICBlbmQ6IGRvbWFpbnNbZG9tYWlucy5sZW5ndGggLSAxXSxcbiAgICB9O1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm4gd2hldGhlciBhIGRhdGUgaXMgaW5zaWRlIHRoZSBzY29wZSBkZXRlcm1pbmVkIGJ5IG1heERhdGVcbiAgICpcbiAgICogQHBhcmFtIGludCBkYXRldGltZXN0YW1wIFRoZSB0aW1lc3RhbXAgaW4gbXMgdG8gdGVzdFxuICAgKiBAcmV0dXJuIGJvb2wgVHJ1ZSBpZiB0aGUgc3BlY2lmaWVkIGRhdGUgY29ycmVzcG9uZCB0byB0aGUgY2FsZW5kYXIgdXBwZXIgYm91bmRcbiAgICovXG4gIG1heERvbWFpbklzUmVhY2hlZDogZnVuY3Rpb24gKGRhdGV0aW1lc3RhbXApIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLm1heERhdGUgIT09IG51bGwgJiYgdGhpcy5vcHRpb25zLm1heERhdGUuZ2V0VGltZSgpIDwgZGF0ZXRpbWVzdGFtcDtcbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJuIHdoZXRoZXIgYSBkYXRlIGlzIGluc2lkZSB0aGUgc2NvcGUgZGV0ZXJtaW5lZCBieSBtaW5EYXRlXG4gICAqXG4gICAqIEBwYXJhbSBpbnQgZGF0ZXRpbWVzdGFtcCBUaGUgdGltZXN0YW1wIGluIG1zIHRvIHRlc3RcbiAgICogQHJldHVybiBib29sIFRydWUgaWYgdGhlIHNwZWNpZmllZCBkYXRlIGNvcnJlc3BvbmQgdG8gdGhlIGNhbGVuZGFyIGxvd2VyIGJvdW5kXG4gICAqL1xuICBtaW5Eb21haW5Jc1JlYWNoZWQ6IGZ1bmN0aW9uIChkYXRldGltZXN0YW1wKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5taW5EYXRlICE9PSBudWxsICYmIHRoaXMub3B0aW9ucy5taW5EYXRlLmdldFRpbWUoKSA+PSBkYXRldGltZXN0YW1wO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIGxpc3Qgb2YgdGhlIGNhbGVuZGFyJ3MgZG9tYWluIHRpbWVzdGFtcFxuICAgKlxuICAgKiBAcmV0dXJuIEFycmF5IGEgc29ydGVkIGFycmF5IG9mIHRpbWVzdGFtcFxuICAgKi9cbiAgZ2V0RG9tYWluS2V5czogZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHJldHVybiB0aGlzLl9kb21haW5zXG4gICAgICAua2V5cygpXG4gICAgICAubWFwKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBwYXJzZUludChkLCAxMCk7XG4gICAgICB9KVxuICAgICAgLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgcmV0dXJuIGEgLSBiO1xuICAgICAgfSk7XG4gIH0sXG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4gIC8vIFBPU0lUSU9OTklORyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG5cbiAgcG9zaXRpb25TdWJEb21haW5YOiBmdW5jdGlvbiAoZCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBpbmRleCA9IHRoaXMuX2RvbWFpblR5cGVbdGhpcy5vcHRpb25zLnN1YkRvbWFpbl0ucG9zaXRpb24ueChuZXcgRGF0ZShkKSk7XG4gICAgcmV0dXJuIGluZGV4ICogdGhpcy5vcHRpb25zLmNlbGxTaXplICsgaW5kZXggKiB0aGlzLm9wdGlvbnMuY2VsbFBhZGRpbmc7XG4gIH0sXG5cbiAgcG9zaXRpb25TdWJEb21haW5ZOiBmdW5jdGlvbiAoZCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBpbmRleCA9IHRoaXMuX2RvbWFpblR5cGVbdGhpcy5vcHRpb25zLnN1YkRvbWFpbl0ucG9zaXRpb24ueShuZXcgRGF0ZShkKSk7XG4gICAgcmV0dXJuIGluZGV4ICogdGhpcy5vcHRpb25zLmNlbGxTaXplICsgaW5kZXggKiB0aGlzLm9wdGlvbnMuY2VsbFBhZGRpbmc7XG4gIH0sXG5cbiAgZ2V0U3ViRG9tYWluQ29sdW1uTnVtYmVyOiBmdW5jdGlvbiAoZCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICh0aGlzLm9wdGlvbnMucm93TGltaXQgPiAwKSB7XG4gICAgICB2YXIgaSA9IHRoaXMuX2RvbWFpblR5cGVbdGhpcy5vcHRpb25zLnN1YkRvbWFpbl0ubWF4SXRlbU51bWJlcjtcbiAgICAgIGlmICh0eXBlb2YgaSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBpID0gaShkKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBNYXRoLmNlaWwoaSAvIHRoaXMub3B0aW9ucy5yb3dMaW1pdCk7XG4gICAgfVxuXG4gICAgdmFyIGogPSB0aGlzLl9kb21haW5UeXBlW3RoaXMub3B0aW9ucy5zdWJEb21haW5dLmRlZmF1bHRDb2x1bW5OdW1iZXI7XG4gICAgaWYgKHR5cGVvZiBqID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBqID0gaihkKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5jb2xMaW1pdCB8fCBqO1xuICB9LFxuXG4gIGdldFN1YkRvbWFpblJvd051bWJlcjogZnVuY3Rpb24gKGQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAodGhpcy5vcHRpb25zLmNvbExpbWl0ID4gMCkge1xuICAgICAgdmFyIGkgPSB0aGlzLl9kb21haW5UeXBlW3RoaXMub3B0aW9ucy5zdWJEb21haW5dLm1heEl0ZW1OdW1iZXI7XG4gICAgICBpZiAodHlwZW9mIGkgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgaSA9IGkoZCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gTWF0aC5jZWlsKGkgLyB0aGlzLm9wdGlvbnMuY29sTGltaXQpO1xuICAgIH1cblxuICAgIHZhciBqID0gdGhpcy5fZG9tYWluVHlwZVt0aGlzLm9wdGlvbnMuc3ViRG9tYWluXS5kZWZhdWx0Um93TnVtYmVyO1xuICAgIGlmICh0eXBlb2YgaiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgaiA9IGooZCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLm9wdGlvbnMucm93TGltaXQgfHwgajtcbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJuIGEgY2xhc3NuYW1lIGlmIHRoZSBzcGVjaWZpZWQgZGF0ZSBzaG91bGQgYmUgaGlnaGxpZ2h0ZWRcbiAgICpcbiAgICogQHBhcmFtICB0aW1lc3RhbXAgZGF0ZSBEYXRlIG9mIHRoZSBjdXJyZW50IHN1YkRvbWFpblxuICAgKiBAcmV0dXJuIFN0cmluZyB0aGUgaGlnaGxpZ2h0IGNsYXNzXG4gICAqL1xuICBnZXRIaWdobGlnaHRDbGFzc05hbWU6IGZ1bmN0aW9uIChkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgZCA9IG5ldyBEYXRlKGQpO1xuXG4gICAgaWYgKHRoaXMub3B0aW9ucy5oaWdobGlnaHQubGVuZ3RoID4gMCkge1xuICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLm9wdGlvbnMuaGlnaGxpZ2h0KSB7XG4gICAgICAgIGlmICh0aGlzLmRhdGVJc0VxdWFsKHRoaXMub3B0aW9ucy5oaWdobGlnaHRbaV0sIGQpKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuaXNOb3codGhpcy5vcHRpb25zLmhpZ2hsaWdodFtpXSkgPyAnIGhpZ2hsaWdodC1ub3cnIDogJyBoaWdobGlnaHQnO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiAnJztcbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJuIHdoZXRoZXIgdGhlIHNwZWNpZmllZCBkYXRlIGlzIG5vdyxcbiAgICogYWNjb3JkaW5nIHRvIHRoZSB0eXBlIG9mIHN1YmRvbWFpblxuICAgKlxuICAgKiBAcGFyYW0gIERhdGUgZCBUaGUgZGF0ZSB0byBjb21wYXJlXG4gICAqIEByZXR1cm4gYm9vbCBUcnVlIGlmIHRoZSBkYXRlIGNvcnJlc3BvbmQgdG8gYSBzdWJkb21haW4gY2VsbFxuICAgKi9cbiAgaXNOb3c6IGZ1bmN0aW9uIChkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgcmV0dXJuIHRoaXMuZGF0ZUlzRXF1YWwoZCwgbmV3IERhdGUoKSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybiB3aGV0aGVyIDIgZGF0ZXMgYXJlIGVxdWFsc1xuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHN1YmRvbWFpbi1hd2FyZSxcbiAgICogYW5kIGRhdGVzIGNvbXBhcmlzb24gYXJlIGRlcGVuZGVudCBvZiB0aGUgc3ViZG9tYWluXG4gICAqXG4gICAqIEBwYXJhbSAgRGF0ZSBkYXRlQSBGaXJzdCBkYXRlIHRvIGNvbXBhcmVcbiAgICogQHBhcmFtICBEYXRlIGRhdGVCIFNlY29uIGRhdGUgdG8gY29tcGFyZVxuICAgKiBAcmV0dXJuIGJvb2wgdHJ1ZSBpZiB0aGUgMiBkYXRlcyBhcmUgZXF1YWxzXG4gICAqL1xuICAvKiBqc2hpbnQgbWF4Y29tcGxleGl0eTogZmFsc2UgKi9cbiAgZGF0ZUlzRXF1YWw6IGZ1bmN0aW9uIChkYXRlQSwgZGF0ZUIpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAoIShkYXRlQSBpbnN0YW5jZW9mIERhdGUpKSB7XG4gICAgICBkYXRlQSA9IG5ldyBEYXRlKGRhdGVBKTtcbiAgICB9XG5cbiAgICBpZiAoIShkYXRlQiBpbnN0YW5jZW9mIERhdGUpKSB7XG4gICAgICBkYXRlQiA9IG5ldyBEYXRlKGRhdGVCKTtcbiAgICB9XG5cbiAgICBzd2l0Y2ggKHRoaXMub3B0aW9ucy5zdWJEb21haW4pIHtcbiAgICAgIGNhc2UgJ3hfbWluJzpcbiAgICAgIGNhc2UgJ21pbic6XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgZGF0ZUEuZ2V0RnVsbFllYXIoKSA9PT0gZGF0ZUIuZ2V0RnVsbFllYXIoKSAmJlxuICAgICAgICAgIGRhdGVBLmdldE1vbnRoKCkgPT09IGRhdGVCLmdldE1vbnRoKCkgJiZcbiAgICAgICAgICBkYXRlQS5nZXREYXRlKCkgPT09IGRhdGVCLmdldERhdGUoKSAmJlxuICAgICAgICAgIGRhdGVBLmdldEhvdXJzKCkgPT09IGRhdGVCLmdldEhvdXJzKCkgJiZcbiAgICAgICAgICBkYXRlQS5nZXRNaW51dGVzKCkgPT09IGRhdGVCLmdldE1pbnV0ZXMoKVxuICAgICAgICApO1xuICAgICAgY2FzZSAneF9ob3VyJzpcbiAgICAgIGNhc2UgJ2hvdXInOlxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIGRhdGVBLmdldEZ1bGxZZWFyKCkgPT09IGRhdGVCLmdldEZ1bGxZZWFyKCkgJiZcbiAgICAgICAgICBkYXRlQS5nZXRNb250aCgpID09PSBkYXRlQi5nZXRNb250aCgpICYmXG4gICAgICAgICAgZGF0ZUEuZ2V0RGF0ZSgpID09PSBkYXRlQi5nZXREYXRlKCkgJiZcbiAgICAgICAgICBkYXRlQS5nZXRIb3VycygpID09PSBkYXRlQi5nZXRIb3VycygpXG4gICAgICAgICk7XG4gICAgICBjYXNlICd4X2RheSc6XG4gICAgICBjYXNlICdkYXknOlxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIGRhdGVBLmdldEZ1bGxZZWFyKCkgPT09IGRhdGVCLmdldEZ1bGxZZWFyKCkgJiZcbiAgICAgICAgICBkYXRlQS5nZXRNb250aCgpID09PSBkYXRlQi5nZXRNb250aCgpICYmXG4gICAgICAgICAgZGF0ZUEuZ2V0RGF0ZSgpID09PSBkYXRlQi5nZXREYXRlKClcbiAgICAgICAgKTtcbiAgICAgIGNhc2UgJ3hfd2Vlayc6XG4gICAgICBjYXNlICd3ZWVrJzpcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICBkYXRlQS5nZXRGdWxsWWVhcigpID09PSBkYXRlQi5nZXRGdWxsWWVhcigpICYmXG4gICAgICAgICAgdGhpcy5nZXRXZWVrTnVtYmVyKGRhdGVBKSA9PT0gdGhpcy5nZXRXZWVrTnVtYmVyKGRhdGVCKVxuICAgICAgICApO1xuICAgICAgY2FzZSAneF9tb250aCc6XG4gICAgICBjYXNlICdtb250aCc6XG4gICAgICAgIHJldHVybiBkYXRlQS5nZXRGdWxsWWVhcigpID09PSBkYXRlQi5nZXRGdWxsWWVhcigpICYmIGRhdGVBLmdldE1vbnRoKCkgPT09IGRhdGVCLmdldE1vbnRoKCk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHdldGhlciBvciBub3QgZGF0ZUEgaXMgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIGRhdGVCLiBUaGlzIGZ1bmN0aW9uIGlzIHN1YmRvbWFpbiBhd2FyZS5cbiAgICogUGVyZm9ybXMgYXV0b21hdGljIGNvbnZlcnNpb24gb2YgdmFsdWVzLlxuICAgKiBAcGFyYW0gZGF0ZUEgbWF5IGJlIGEgbnVtYmVyIG9yIGEgRGF0ZVxuICAgKiBAcGFyYW0gZGF0ZUIgbWF5IGJlIGEgbnVtYmVyIG9yIGEgRGF0ZVxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICovXG4gIGRhdGVJc0xlc3NUaGFuOiBmdW5jdGlvbiAoZGF0ZUEsIGRhdGVCKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKCEoZGF0ZUEgaW5zdGFuY2VvZiBEYXRlKSkge1xuICAgICAgZGF0ZUEgPSBuZXcgRGF0ZShkYXRlQSk7XG4gICAgfVxuXG4gICAgaWYgKCEoZGF0ZUIgaW5zdGFuY2VvZiBEYXRlKSkge1xuICAgICAgZGF0ZUIgPSBuZXcgRGF0ZShkYXRlQik7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbm9ybWFsaXplZE1pbGxpcyhkYXRlLCBzdWJkb21haW4pIHtcbiAgICAgIHN3aXRjaCAoc3ViZG9tYWluKSB7XG4gICAgICAgIGNhc2UgJ3hfbWluJzpcbiAgICAgICAgY2FzZSAnbWluJzpcbiAgICAgICAgICByZXR1cm4gbmV3IERhdGUoXG4gICAgICAgICAgICBkYXRlLmdldEZ1bGxZZWFyKCksXG4gICAgICAgICAgICBkYXRlLmdldE1vbnRoKCksXG4gICAgICAgICAgICBkYXRlLmdldERhdGUoKSxcbiAgICAgICAgICAgIGRhdGUuZ2V0SG91cnMoKSxcbiAgICAgICAgICAgIGRhdGUuZ2V0TWludXRlcygpLFxuICAgICAgICAgICkuZ2V0VGltZSgpO1xuICAgICAgICBjYXNlICd4X2hvdXInOlxuICAgICAgICBjYXNlICdob3VyJzpcbiAgICAgICAgICByZXR1cm4gbmV3IERhdGUoXG4gICAgICAgICAgICBkYXRlLmdldEZ1bGxZZWFyKCksXG4gICAgICAgICAgICBkYXRlLmdldE1vbnRoKCksXG4gICAgICAgICAgICBkYXRlLmdldERhdGUoKSxcbiAgICAgICAgICAgIGRhdGUuZ2V0SG91cnMoKSxcbiAgICAgICAgICApLmdldFRpbWUoKTtcbiAgICAgICAgY2FzZSAneF9kYXknOlxuICAgICAgICBjYXNlICdkYXknOlxuICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIGRhdGUuZ2V0TW9udGgoKSwgZGF0ZS5nZXREYXRlKCkpLmdldFRpbWUoKTtcbiAgICAgICAgY2FzZSAneF93ZWVrJzpcbiAgICAgICAgY2FzZSAnd2Vlayc6XG4gICAgICAgIGNhc2UgJ3hfbW9udGgnOlxuICAgICAgICBjYXNlICdtb250aCc6XG4gICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgZGF0ZS5nZXRNb250aCgpKS5nZXRUaW1lKCk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuIGRhdGUuZ2V0VGltZSgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICBub3JtYWxpemVkTWlsbGlzKGRhdGVBLCB0aGlzLm9wdGlvbnMuc3ViRG9tYWluKSA8XG4gICAgICBub3JtYWxpemVkTWlsbGlzKGRhdGVCLCB0aGlzLm9wdGlvbnMuc3ViRG9tYWluKVxuICAgICk7XG4gIH0sXG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4gIC8vIERBVEUgQ09NUFVUQVRJT04gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cblxuICAvKipcbiAgICogUmV0dXJuIHRoZSBkYXkgb2YgdGhlIHllYXIgZm9yIHRoZSBkYXRlXG4gICAqIEBwYXJhbSAgRGF0ZVxuICAgKiBAcmV0dXJuICBpbnQgRGF5IG9mIHRoZSB5ZWFyIFsxLDM2Nl1cbiAgICovXG4gIGdldERheU9mWWVhcjogZDMudGltZS5mb3JtYXQoJyVqJyksXG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgd2VlayBudW1iZXIgb2YgdGhlIHllYXJcbiAgICogTW9uZGF5IGFzIHRoZSBmaXJzdCBkYXkgb2YgdGhlIHdlZWtcbiAgICogQHJldHVybiBpbnQgIFdlZWsgbnVtYmVyIFswLTUzXVxuICAgKi9cbiAgZ2V0V2Vla051bWJlcjogZnVuY3Rpb24gKGQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgZiA9IHRoaXMub3B0aW9ucy53ZWVrU3RhcnRPbk1vbmRheSA9PT0gdHJ1ZSA/IGQzLnRpbWUuZm9ybWF0KCclVycpIDogZDMudGltZS5mb3JtYXQoJyVVJyk7XG4gICAgcmV0dXJuIGYoZCk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgd2VlayBudW1iZXIsIHJlbGF0aXZlIHRvIGl0cyBtb250aFxuICAgKlxuICAgKiBAcGFyYW0gIGludHxEYXRlIGQgRGF0ZSBvciB0aW1lc3RhbXAgaW4gbWlsbGlzZWNvbmRzXG4gICAqIEByZXR1cm4gaW50IFdlZWsgbnVtYmVyLCByZWxhdGl2ZSB0byB0aGUgbW9udGggWzAtNV1cbiAgICovXG4gIGdldE1vbnRoV2Vla051bWJlcjogZnVuY3Rpb24gKGQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAodHlwZW9mIGQgPT09ICdudW1iZXInKSB7XG4gICAgICBkID0gbmV3IERhdGUoZCk7XG4gICAgfVxuXG4gICAgdmFyIG1vbnRoRmlyc3RXZWVrTnVtYmVyID0gdGhpcy5nZXRXZWVrTnVtYmVyKG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpKSk7XG4gICAgcmV0dXJuIHRoaXMuZ2V0V2Vla051bWJlcihkKSAtIG1vbnRoRmlyc3RXZWVrTnVtYmVyIC0gMTtcbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJuIHRoZSBudW1iZXIgb2Ygd2Vla3MgaW4gdGhlIGRhdGVzJyB5ZWFyXG4gICAqXG4gICAqIEBwYXJhbSAgaW50fERhdGUgZCBEYXRlIG9yIHRpbWVzdGFtcCBpbiBtaWxsaXNlY29uZHNcbiAgICogQHJldHVybiBpbnQgTnVtYmVyIG9mIHdlZWtzIGluIHRoZSBkYXRlJ3MgeWVhclxuICAgKi9cbiAgZ2V0V2Vla051bWJlckluWWVhcjogZnVuY3Rpb24gKGQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAodHlwZW9mIGQgPT09ICdudW1iZXInKSB7XG4gICAgICBkID0gbmV3IERhdGUoZCk7XG4gICAgfVxuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIG51bWJlciBvZiBkYXlzIGluIHRoZSBkYXRlJ3MgbW9udGhcbiAgICpcbiAgICogQHBhcmFtICBpbnR8RGF0ZSBkIERhdGUgb3IgdGltZXN0YW1wIGluIG1pbGxpc2Vjb25kc1xuICAgKiBAcmV0dXJuIGludCBOdW1iZXIgb2YgZGF5cyBpbiB0aGUgZGF0ZSdzIG1vbnRoXG4gICAqL1xuICBnZXREYXlDb3VudEluTW9udGg6IGZ1bmN0aW9uIChkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgcmV0dXJuIHRoaXMuZ2V0RW5kT2ZNb250aChkKS5nZXREYXRlKCk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgbnVtYmVyIG9mIGRheXMgaW4gdGhlIGRhdGUncyB5ZWFyXG4gICAqXG4gICAqIEBwYXJhbSAgaW50fERhdGUgZCBEYXRlIG9yIHRpbWVzdGFtcCBpbiBtaWxsaXNlY29uZHNcbiAgICogQHJldHVybiBpbnQgTnVtYmVyIG9mIGRheXMgaW4gdGhlIGRhdGUncyB5ZWFyXG4gICAqL1xuICBnZXREYXlDb3VudEluWWVhcjogZnVuY3Rpb24gKGQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAodHlwZW9mIGQgPT09ICdudW1iZXInKSB7XG4gICAgICBkID0gbmV3IERhdGUoZCk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIDEsIDI5KS5nZXRNb250aCgpID09PSAxID8gMzY2IDogMzY1O1xuICB9LFxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHdlZWtkYXkgZnJvbSBhIGRhdGVcbiAgICpcbiAgICogUmV0dXJuIHRoZSB3ZWVrIGRheSBudW1iZXIgKDAtNikgb2YgYSBkYXRlLFxuICAgKiBkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgd2VlayBzdGFydCBvbiBtb25kYXkgb3Igc3VuZGF5XG4gICAqXG4gICAqIEBwYXJhbSAgRGF0ZSBkXG4gICAqIEByZXR1cm4gaW50IFRoZSB3ZWVrIGRheSBudW1iZXIgKDAtNilcbiAgICovXG4gIGdldFdlZWtEYXk6IGZ1bmN0aW9uIChkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKHRoaXMub3B0aW9ucy53ZWVrU3RhcnRPbk1vbmRheSA9PT0gZmFsc2UpIHtcbiAgICAgIHJldHVybiBkLmdldERheSgpO1xuICAgIH1cbiAgICByZXR1cm4gZC5nZXREYXkoKSA9PT0gMCA/IDYgOiBkLmdldERheSgpIC0gMTtcbiAgfSxcblxuICAvKipcbiAgICogR2V0IHRoZSBsYXN0IGRheSBvZiB0aGUgbW9udGhcbiAgICogQHBhcmFtICBEYXRlfGludCAgZCAgRGF0ZSBvciB0aW1lc3RhbXAgaW4gbWlsbGlzZWNvbmRzXG4gICAqIEByZXR1cm4gRGF0ZSAgICAgIExhc3QgZGF5IG9mIHRoZSBtb250aFxuICAgKi9cbiAgZ2V0RW5kT2ZNb250aDogZnVuY3Rpb24gKGQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAodHlwZW9mIGQgPT09ICdudW1iZXInKSB7XG4gICAgICBkID0gbmV3IERhdGUoZCk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSArIDEsIDApO1xuICB9LFxuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gIERhdGUgZGF0ZVxuICAgKiBAcGFyYW0gIGludCBjb3VudFxuICAgKiBAcGFyYW0gIHN0cmluZyBzdGVwXG4gICAqIEByZXR1cm4gRGF0ZVxuICAgKi9cbiAganVtcERhdGU6IGZ1bmN0aW9uIChkYXRlLCBjb3VudCwgc3RlcCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBkID0gbmV3IERhdGUoZGF0ZSk7XG4gICAgc3dpdGNoIChzdGVwKSB7XG4gICAgICBjYXNlICdob3VyJzpcbiAgICAgICAgZC5zZXRIb3VycyhkLmdldEhvdXJzKCkgKyBjb3VudCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnZGF5JzpcbiAgICAgICAgZC5zZXRIb3VycyhkLmdldEhvdXJzKCkgKyBjb3VudCAqIDI0KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICd3ZWVrJzpcbiAgICAgICAgZC5zZXRIb3VycyhkLmdldEhvdXJzKCkgKyBjb3VudCAqIDI0ICogNyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnbW9udGgnOlxuICAgICAgICBkLnNldE1vbnRoKGQuZ2V0TW9udGgoKSArIGNvdW50KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICd5ZWFyJzpcbiAgICAgICAgZC5zZXRGdWxsWWVhcihkLmdldEZ1bGxZZWFyKCkgKyBjb3VudCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBEYXRlKGQpO1xuICB9LFxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuICAvLyBET01BSU4gQ09NUFVUQVRJT04gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG5cbiAgLyoqXG4gICAqIFJldHVybiBhbGwgdGhlIG1pbnV0ZXMgYmV0d2VlbiAyIGRhdGVzXG4gICAqXG4gICAqIEBwYXJhbSAgRGF0ZSAgZCAgZGF0ZSAgQSBkYXRlXG4gICAqIEBwYXJhbSAgaW50fGRhdGUgIHJhbmdlICBOdW1iZXIgb2YgbWludXRlcyBpbiB0aGUgcmFuZ2UsIG9yIGEgc3RvcCBkYXRlXG4gICAqIEByZXR1cm4gYXJyYXkgIEFuIGFycmF5IG9mIG1pbnV0ZXNcbiAgICovXG4gIGdldE1pbnV0ZURvbWFpbjogZnVuY3Rpb24gKGQsIHJhbmdlKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHN0YXJ0ID0gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCksIGQuZ2V0RGF0ZSgpLCBkLmdldEhvdXJzKCkpO1xuICAgIHZhciBzdG9wID0gbnVsbDtcbiAgICBpZiAocmFuZ2UgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICBzdG9wID0gbmV3IERhdGUocmFuZ2UuZ2V0RnVsbFllYXIoKSwgcmFuZ2UuZ2V0TW9udGgoKSwgcmFuZ2UuZ2V0RGF0ZSgpLCByYW5nZS5nZXRIb3VycygpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RvcCA9IG5ldyBEYXRlKCtzdGFydCArIHJhbmdlICogMTAwMCAqIDYwKTtcbiAgICB9XG4gICAgcmV0dXJuIGQzLnRpbWUubWludXRlcyhNYXRoLm1pbihzdGFydCwgc3RvcCksIE1hdGgubWF4KHN0YXJ0LCBzdG9wKSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybiBhbGwgdGhlIGhvdXJzIGJldHdlZW4gMiBkYXRlc1xuICAgKlxuICAgKiBAcGFyYW0gIERhdGUgIGQgIEEgZGF0ZVxuICAgKiBAcGFyYW0gIGludHxkYXRlICByYW5nZSAgTnVtYmVyIG9mIGhvdXJzIGluIHRoZSByYW5nZSwgb3IgYSBzdG9wIGRhdGVcbiAgICogQHJldHVybiBhcnJheSAgQW4gYXJyYXkgb2YgaG91cnNcbiAgICovXG4gIGdldEhvdXJEb21haW46IGZ1bmN0aW9uIChkLCByYW5nZSkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBzdGFydCA9IG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpLCBkLmdldERhdGUoKSwgZC5nZXRIb3VycygpKTtcbiAgICB2YXIgc3RvcCA9IG51bGw7XG4gICAgaWYgKHJhbmdlIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgc3RvcCA9IG5ldyBEYXRlKHJhbmdlLmdldEZ1bGxZZWFyKCksIHJhbmdlLmdldE1vbnRoKCksIHJhbmdlLmdldERhdGUoKSwgcmFuZ2UuZ2V0SG91cnMoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0b3AgPSBuZXcgRGF0ZShzdGFydCk7XG4gICAgICBzdG9wLnNldEhvdXJzKHN0b3AuZ2V0SG91cnMoKSArIHJhbmdlKTtcbiAgICB9XG5cbiAgICB2YXIgZG9tYWlucyA9IGQzLnRpbWUuaG91cnMoTWF0aC5taW4oc3RhcnQsIHN0b3ApLCBNYXRoLm1heChzdGFydCwgc3RvcCkpO1xuXG4gICAgLy8gUGFzc2luZyBmcm9tIERTVCB0byBzdGFuZGFyZCB0aW1lXG4gICAgLy8gSWYgdGhlcmUgYXJlIDI1IGhvdXJzLCBsZXQncyBjb21wcmVzcyB0aGUgZHVwbGljYXRlIGhvdXJzXG4gICAgdmFyIGkgPSAwO1xuICAgIHZhciB0b3RhbCA9IGRvbWFpbnMubGVuZ3RoO1xuICAgIGZvciAoaSA9IDA7IGkgPCB0b3RhbDsgaSsrKSB7XG4gICAgICBpZiAoaSA+IDAgJiYgZG9tYWluc1tpXS5nZXRIb3VycygpID09PSBkb21haW5zW2kgLSAxXS5nZXRIb3VycygpKSB7XG4gICAgICAgIHRoaXMuRFNURG9tYWluLnB1c2goZG9tYWluc1tpXS5nZXRUaW1lKCkpO1xuICAgICAgICBkb21haW5zLnNwbGljZShpLCAxKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gZDMudGltZS5ob3VycyBpcyByZXR1cm5pbmcgbW9yZSBob3VycyB0aGFuIG5lZWRlZCB3aGVuIGNoYW5naW5nXG4gICAgLy8gZnJvbSBEU1QgdG8gc3RhbmRhcmQgdGltZSwgYmVjYXVzZSB0aGVyZSBpcyByZWFsbHkgMiBob3VycyBiZXR3ZWVuXG4gICAgLy8gMWFtIGFuZCAyYW0hXG4gICAgaWYgKHR5cGVvZiByYW5nZSA9PT0gJ251bWJlcicgJiYgZG9tYWlucy5sZW5ndGggPiBNYXRoLmFicyhyYW5nZSkpIHtcbiAgICAgIGRvbWFpbnMuc3BsaWNlKGRvbWFpbnMubGVuZ3RoIC0gMSwgMSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGRvbWFpbnM7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybiBhbGwgdGhlIGRheXMgYmV0d2VlbiAyIGRhdGVzXG4gICAqXG4gICAqIEBwYXJhbSAgRGF0ZSAgICBkICAgIEEgZGF0ZVxuICAgKiBAcGFyYW0gIGludHxkYXRlICByYW5nZSAgTnVtYmVyIG9mIGRheXMgaW4gdGhlIHJhbmdlLCBvciBhIHN0b3AgZGF0ZVxuICAgKiBAcmV0dXJuIGFycmF5ICBBbiBhcnJheSBvZiB3ZWVrc1xuICAgKi9cbiAgZ2V0RGF5RG9tYWluOiBmdW5jdGlvbiAoZCwgcmFuZ2UpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgc3RhcnQgPSBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSwgZC5nZXREYXRlKCkpO1xuICAgIHZhciBzdG9wID0gbnVsbDtcbiAgICBpZiAocmFuZ2UgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICBzdG9wID0gbmV3IERhdGUocmFuZ2UuZ2V0RnVsbFllYXIoKSwgcmFuZ2UuZ2V0TW9udGgoKSwgcmFuZ2UuZ2V0RGF0ZSgpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RvcCA9IG5ldyBEYXRlKHN0YXJ0KTtcbiAgICAgIHN0b3AgPSBuZXcgRGF0ZShzdG9wLnNldERhdGUoc3RvcC5nZXREYXRlKCkgKyBwYXJzZUludChyYW5nZSwgMTApKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGQzLnRpbWUuZGF5cyhNYXRoLm1pbihzdGFydCwgc3RvcCksIE1hdGgubWF4KHN0YXJ0LCBzdG9wKSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybiBhbGwgdGhlIHdlZWtzIGJldHdlZW4gMiBkYXRlc1xuICAgKlxuICAgKiBAcGFyYW0gIERhdGUgIGQgIEEgZGF0ZVxuICAgKiBAcGFyYW0gIGludHxkYXRlICByYW5nZSAgTnVtYmVyIG9mIG1pbnV0ZXMgaW4gdGhlIHJhbmdlLCBvciBhIHN0b3AgZGF0ZVxuICAgKiBAcmV0dXJuIGFycmF5ICBBbiBhcnJheSBvZiB3ZWVrc1xuICAgKi9cbiAgZ2V0V2Vla0RvbWFpbjogZnVuY3Rpb24gKGQsIHJhbmdlKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHdlZWtTdGFydDtcblxuICAgIGlmICh0aGlzLm9wdGlvbnMud2Vla1N0YXJ0T25Nb25kYXkgPT09IGZhbHNlKSB7XG4gICAgICB3ZWVrU3RhcnQgPSBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSwgZC5nZXREYXRlKCkgLSBkLmdldERheSgpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGQuZ2V0RGF5KCkgPT09IDEpIHtcbiAgICAgICAgd2Vla1N0YXJ0ID0gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCksIGQuZ2V0RGF0ZSgpKTtcbiAgICAgIH0gZWxzZSBpZiAoZC5nZXREYXkoKSA9PT0gMCkge1xuICAgICAgICB3ZWVrU3RhcnQgPSBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSwgZC5nZXREYXRlKCkpO1xuICAgICAgICB3ZWVrU3RhcnQuc2V0RGF0ZSh3ZWVrU3RhcnQuZ2V0RGF0ZSgpIC0gNik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB3ZWVrU3RhcnQgPSBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSwgZC5nZXREYXRlKCkgLSBkLmdldERheSgpICsgMSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIGVuZERhdGUgPSBuZXcgRGF0ZSh3ZWVrU3RhcnQpO1xuXG4gICAgdmFyIHN0b3AgPSByYW5nZTtcbiAgICBpZiAodHlwZW9mIHJhbmdlICE9PSAnb2JqZWN0Jykge1xuICAgICAgc3RvcCA9IG5ldyBEYXRlKGVuZERhdGUuc2V0RGF0ZShlbmREYXRlLmdldERhdGUoKSArIHJhbmdlICogNykpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLm9wdGlvbnMud2Vla1N0YXJ0T25Nb25kYXkgPT09IHRydWVcbiAgICAgID8gZDMudGltZS5tb25kYXlzKE1hdGgubWluKHdlZWtTdGFydCwgc3RvcCksIE1hdGgubWF4KHdlZWtTdGFydCwgc3RvcCkpXG4gICAgICA6IGQzLnRpbWUuc3VuZGF5cyhNYXRoLm1pbih3ZWVrU3RhcnQsIHN0b3ApLCBNYXRoLm1heCh3ZWVrU3RhcnQsIHN0b3ApKTtcbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJuIGFsbCB0aGUgbW9udGhzIGJldHdlZW4gMiBkYXRlc1xuICAgKlxuICAgKiBAcGFyYW0gIERhdGUgICAgZCAgICBBIGRhdGVcbiAgICogQHBhcmFtICBpbnR8ZGF0ZSAgcmFuZ2UgIE51bWJlciBvZiBtb250aHMgaW4gdGhlIHJhbmdlLCBvciBhIHN0b3AgZGF0ZVxuICAgKiBAcmV0dXJuIGFycmF5ICBBbiBhcnJheSBvZiBtb250aHNcbiAgICovXG4gIGdldE1vbnRoRG9tYWluOiBmdW5jdGlvbiAoZCwgcmFuZ2UpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgc3RhcnQgPSBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSk7XG4gICAgdmFyIHN0b3AgPSBudWxsO1xuICAgIGlmIChyYW5nZSBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgIHN0b3AgPSBuZXcgRGF0ZShyYW5nZS5nZXRGdWxsWWVhcigpLCByYW5nZS5nZXRNb250aCgpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RvcCA9IG5ldyBEYXRlKHN0YXJ0KTtcbiAgICAgIHN0b3AgPSBzdG9wLnNldE1vbnRoKHN0b3AuZ2V0TW9udGgoKSArIHJhbmdlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZDMudGltZS5tb250aHMoTWF0aC5taW4oc3RhcnQsIHN0b3ApLCBNYXRoLm1heChzdGFydCwgc3RvcCkpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm4gYWxsIHRoZSB5ZWFycyBiZXR3ZWVuIDIgZGF0ZXNcbiAgICpcbiAgICogQHBhcmFtICBEYXRlICBkICBkYXRlICBBIGRhdGVcbiAgICogQHBhcmFtICBpbnR8ZGF0ZSAgcmFuZ2UgIE51bWJlciBvZiBtaW51dGVzIGluIHRoZSByYW5nZSwgb3IgYSBzdG9wIGRhdGVcbiAgICogQHJldHVybiBhcnJheSAgQW4gYXJyYXkgb2YgaG91cnNcbiAgICovXG4gIGdldFllYXJEb21haW46IGZ1bmN0aW9uIChkLCByYW5nZSkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBzdGFydCA9IG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgMCk7XG4gICAgdmFyIHN0b3AgPSBudWxsO1xuICAgIGlmIChyYW5nZSBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgIHN0b3AgPSBuZXcgRGF0ZShyYW5nZS5nZXRGdWxsWWVhcigpLCAwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RvcCA9IG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSArIHJhbmdlLCAwKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZDMudGltZS55ZWFycyhNYXRoLm1pbihzdGFydCwgc3RvcCksIE1hdGgubWF4KHN0YXJ0LCBzdG9wKSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldCBhbiBhcnJheSBvZiBkb21haW4gc3RhcnQgZGF0ZXNcbiAgICpcbiAgICogQHBhcmFtICBpbnR8RGF0ZSBkYXRlIEEgcmFuZG9tIGRhdGUgaW5jbHVkZWQgaW4gdGhlIHdhbnRlZCBkb21haW5cbiAgICogQHBhcmFtICBpbnR8RGF0ZSByYW5nZSBOdW1iZXIgb2YgZGF0ZXMgdG8gZ2V0LCBvciBhIHN0b3AgZGF0ZVxuICAgKiBAcmV0dXJuIEFycmF5IG9mIGRhdGVzXG4gICAqL1xuICBnZXREb21haW46IGZ1bmN0aW9uIChkYXRlLCByYW5nZSkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICh0eXBlb2YgZGF0ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgIGRhdGUgPSBuZXcgRGF0ZShkYXRlKTtcbiAgICB9XG5cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHtcbiAgICAgIHJhbmdlID0gdGhpcy5vcHRpb25zLnJhbmdlO1xuICAgIH1cblxuICAgIHN3aXRjaCAodGhpcy5vcHRpb25zLmRvbWFpbikge1xuICAgICAgY2FzZSAnaG91cic6XG4gICAgICAgIHZhciBkb21haW5zID0gdGhpcy5nZXRIb3VyRG9tYWluKGRhdGUsIHJhbmdlKTtcblxuICAgICAgICAvLyBDYXNlIHdoZXJlIGFuIGhvdXIgaXMgbWlzc2luZywgd2hlbiBwYXNzaW5nIGZyb20gc3RhbmRhcmQgdGltZSB0byBEU1RcbiAgICAgICAgLy8gTWlzc2luZyBob3VyIGlzIHBlcmZlY3RseSBhY2NlcHRhYmwgaW4gc3ViRG9tYWluLCBidXQgbm90IGluIGRvbWFpbnNcbiAgICAgICAgaWYgKHR5cGVvZiByYW5nZSA9PT0gJ251bWJlcicgJiYgZG9tYWlucy5sZW5ndGggPCByYW5nZSkge1xuICAgICAgICAgIGlmIChyYW5nZSA+IDApIHtcbiAgICAgICAgICAgIGRvbWFpbnMucHVzaCh0aGlzLmdldEhvdXJEb21haW4oZG9tYWluc1tkb21haW5zLmxlbmd0aCAtIDFdLCAyKVsxXSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRvbWFpbnMuc2hpZnQodGhpcy5nZXRIb3VyRG9tYWluKGRvbWFpbnNbMF0sIC0yKVswXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkb21haW5zO1xuICAgICAgY2FzZSAnZGF5JzpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RGF5RG9tYWluKGRhdGUsIHJhbmdlKTtcbiAgICAgIGNhc2UgJ3dlZWsnOlxuICAgICAgICByZXR1cm4gdGhpcy5nZXRXZWVrRG9tYWluKGRhdGUsIHJhbmdlKTtcbiAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TW9udGhEb21haW4oZGF0ZSwgcmFuZ2UpO1xuICAgICAgY2FzZSAneWVhcic6XG4gICAgICAgIHJldHVybiB0aGlzLmdldFllYXJEb21haW4oZGF0ZSwgcmFuZ2UpO1xuICAgIH1cbiAgfSxcblxuICAvKiBqc2hpbnQgbWF4Y29tcGxleGl0eTogZmFsc2UgKi9cbiAgZ2V0U3ViRG9tYWluOiBmdW5jdGlvbiAoZGF0ZSkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICh0eXBlb2YgZGF0ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgIGRhdGUgPSBuZXcgRGF0ZShkYXRlKTtcbiAgICB9XG5cbiAgICB2YXIgcGFyZW50ID0gdGhpcztcblxuICAgIC8qKlxuICAgICAqIEByZXR1cm4gaW50XG4gICAgICovXG4gICAgdmFyIGNvbXB1dGVEYXlTdWJEb21haW5TaXplID0gZnVuY3Rpb24gKGRhdGUsIGRvbWFpbikge1xuICAgICAgc3dpdGNoIChkb21haW4pIHtcbiAgICAgICAgY2FzZSAneWVhcic6XG4gICAgICAgICAgcmV0dXJuIHBhcmVudC5nZXREYXlDb3VudEluWWVhcihkYXRlKTtcbiAgICAgICAgY2FzZSAnbW9udGgnOlxuICAgICAgICAgIHJldHVybiBwYXJlbnQuZ2V0RGF5Q291bnRJbk1vbnRoKGRhdGUpO1xuICAgICAgICBjYXNlICd3ZWVrJzpcbiAgICAgICAgICByZXR1cm4gNztcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHJldHVybiBpbnRcbiAgICAgKi9cbiAgICB2YXIgY29tcHV0ZU1pblN1YkRvbWFpblNpemUgPSBmdW5jdGlvbiAoZGF0ZSwgZG9tYWluKSB7XG4gICAgICBzd2l0Y2ggKGRvbWFpbikge1xuICAgICAgICBjYXNlICdob3VyJzpcbiAgICAgICAgICByZXR1cm4gNjA7XG4gICAgICAgIGNhc2UgJ2RheSc6XG4gICAgICAgICAgcmV0dXJuIDYwICogMjQ7XG4gICAgICAgIGNhc2UgJ3dlZWsnOlxuICAgICAgICAgIHJldHVybiA2MCAqIDI0ICogNztcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHJldHVybiBpbnRcbiAgICAgKi9cbiAgICB2YXIgY29tcHV0ZUhvdXJTdWJEb21haW5TaXplID0gZnVuY3Rpb24gKGRhdGUsIGRvbWFpbikge1xuICAgICAgc3dpdGNoIChkb21haW4pIHtcbiAgICAgICAgY2FzZSAnZGF5JzpcbiAgICAgICAgICByZXR1cm4gMjQ7XG4gICAgICAgIGNhc2UgJ3dlZWsnOlxuICAgICAgICAgIHJldHVybiAxNjg7XG4gICAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgICByZXR1cm4gcGFyZW50LmdldERheUNvdW50SW5Nb250aChkYXRlKSAqIDI0O1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJuIGludFxuICAgICAqL1xuICAgIHZhciBjb21wdXRlV2Vla1N1YkRvbWFpblNpemUgPSBmdW5jdGlvbiAoZGF0ZSwgZG9tYWluKSB7XG4gICAgICBpZiAoZG9tYWluID09PSAnbW9udGgnKSB7XG4gICAgICAgIHZhciBlbmRPZk1vbnRoID0gbmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLCBkYXRlLmdldE1vbnRoKCkgKyAxLCAwKTtcbiAgICAgICAgdmFyIGVuZFdlZWtOYiA9IHBhcmVudC5nZXRXZWVrTnVtYmVyKGVuZE9mTW9udGgpO1xuICAgICAgICB2YXIgc3RhcnRXZWVrTmIgPSBwYXJlbnQuZ2V0V2Vla051bWJlcihuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIGRhdGUuZ2V0TW9udGgoKSkpO1xuXG4gICAgICAgIGlmIChzdGFydFdlZWtOYiA+IGVuZFdlZWtOYikge1xuICAgICAgICAgIHN0YXJ0V2Vla05iID0gMDtcbiAgICAgICAgICBlbmRXZWVrTmIrKztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBlbmRXZWVrTmIgLSBzdGFydFdlZWtOYiArIDE7XG4gICAgICB9IGVsc2UgaWYgKGRvbWFpbiA9PT0gJ3llYXInKSB7XG4gICAgICAgIHJldHVybiBwYXJlbnQuZ2V0V2Vla051bWJlcihuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIDExLCAzMSkpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBzd2l0Y2ggKHRoaXMub3B0aW9ucy5zdWJEb21haW4pIHtcbiAgICAgIGNhc2UgJ3hfbWluJzpcbiAgICAgIGNhc2UgJ21pbic6XG4gICAgICAgIHJldHVybiB0aGlzLmdldE1pbnV0ZURvbWFpbihkYXRlLCBjb21wdXRlTWluU3ViRG9tYWluU2l6ZShkYXRlLCB0aGlzLm9wdGlvbnMuZG9tYWluKSk7XG4gICAgICBjYXNlICd4X2hvdXInOlxuICAgICAgY2FzZSAnaG91cic6XG4gICAgICAgIHJldHVybiB0aGlzLmdldEhvdXJEb21haW4oZGF0ZSwgY29tcHV0ZUhvdXJTdWJEb21haW5TaXplKGRhdGUsIHRoaXMub3B0aW9ucy5kb21haW4pKTtcbiAgICAgIGNhc2UgJ3hfZGF5JzpcbiAgICAgIGNhc2UgJ2RheSc6XG4gICAgICAgIHJldHVybiB0aGlzLmdldERheURvbWFpbihkYXRlLCBjb21wdXRlRGF5U3ViRG9tYWluU2l6ZShkYXRlLCB0aGlzLm9wdGlvbnMuZG9tYWluKSk7XG4gICAgICBjYXNlICd4X3dlZWsnOlxuICAgICAgY2FzZSAnd2Vlayc6XG4gICAgICAgIHJldHVybiB0aGlzLmdldFdlZWtEb21haW4oZGF0ZSwgY29tcHV0ZVdlZWtTdWJEb21haW5TaXplKGRhdGUsIHRoaXMub3B0aW9ucy5kb21haW4pKTtcbiAgICAgIGNhc2UgJ3hfbW9udGgnOlxuICAgICAgY2FzZSAnbW9udGgnOlxuICAgICAgICByZXR1cm4gdGhpcy5nZXRNb250aERvbWFpbihkYXRlLCAxMik7XG4gICAgfVxuICB9LFxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIG4tdGggbmV4dCBkb21haW4gYWZ0ZXIgdGhlIGNhbGVuZGFyIG5ld2VzdCAocmlnaHRtb3N0KSBkb21haW5cbiAgICogQHBhcmFtICBpbnQgblxuICAgKiBAcmV0dXJuIERhdGUgVGhlIHN0YXJ0IGRhdGUgb2YgdGhlIHdhbnRlZCBkb21haW5cbiAgICovXG4gIGdldE5leHREb21haW46IGZ1bmN0aW9uIChuKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgIG4gPSAxO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5nZXREb21haW4odGhpcy5qdW1wRGF0ZSh0aGlzLmdldERvbWFpbktleXMoKS5wb3AoKSwgbiwgdGhpcy5vcHRpb25zLmRvbWFpbiksIDEpWzBdO1xuICB9LFxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIG4tdGggZG9tYWluIGJlZm9yZSB0aGUgY2FsZW5kYXIgb2xkZXN0IChsZWZ0bW9zdCkgZG9tYWluXG4gICAqIEBwYXJhbSAgaW50IG5cbiAgICogQHJldHVybiBEYXRlIFRoZSBzdGFydCBkYXRlIG9mIHRoZSB3YW50ZWQgZG9tYWluXG4gICAqL1xuICBnZXRQcmV2aW91c0RvbWFpbjogZnVuY3Rpb24gKG4pIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgbiA9IDE7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmdldERvbWFpbihcbiAgICAgIHRoaXMuanVtcERhdGUodGhpcy5nZXREb21haW5LZXlzKCkuc2hpZnQoKSwgLW4sIHRoaXMub3B0aW9ucy5kb21haW4pLFxuICAgICAgMSxcbiAgICApWzBdO1xuICB9LFxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuICAvLyBEQVRBUyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cblxuICAvKipcbiAgICogRmV0Y2ggYW5kIGludGVycHJldCBkYXRhIGZyb20gdGhlIGRhdGFzb3VyY2VcbiAgICpcbiAgICogQHBhcmFtIHN0cmluZ3xvYmplY3Qgc291cmNlXG4gICAqIEBwYXJhbSBEYXRlIHN0YXJ0RGF0ZVxuICAgKiBAcGFyYW0gRGF0ZSBlbmREYXRlXG4gICAqIEBwYXJhbSBmdW5jdGlvbiBjYWxsYmFja1xuICAgKiBAcGFyYW0gZnVuY3Rpb258Ym9vbGVhbiBhZnRlckxvYWQgZnVuY3Rpb24gdXNlZCB0byBjb252ZXJ0IHRoZSBkYXRhIGludG8gYSBqc29uIG9iamVjdC4gVXNlIHRydWUgdG8gdXNlIHRoZSBhZnRlckxvYWQgY2FsbGJhY2tcbiAgICogQHBhcmFtIHVwZGF0ZU1vZGVcbiAgICpcbiAgICogQHJldHVybiBtaXhlZFxuICAgKiAtIFRydWUgaWYgdGhlcmUgYXJlIG5vIGRhdGEgdG8gbG9hZFxuICAgKiAtIEZhbHNlIGlmIGRhdGEgYXJlIGxvYWRlZCBhc3luY2hyb25vdXNseVxuICAgKi9cbiAgZ2V0RGF0YXM6IGZ1bmN0aW9uIChzb3VyY2UsIHN0YXJ0RGF0ZSwgZW5kRGF0ZSwgY2FsbGJhY2ssIGFmdGVyTG9hZCwgdXBkYXRlTW9kZSkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDUpIHtcbiAgICAgIGFmdGVyTG9hZCA9IHRydWU7XG4gICAgfVxuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgNikge1xuICAgICAgdXBkYXRlTW9kZSA9IHRoaXMuQVBQRU5EX09OX1VQREFURTtcbiAgICB9XG4gICAgdmFyIF9jYWxsYmFjayA9IGZ1bmN0aW9uIChlcnJvciwgZGF0YSkge1xuICAgICAgaWYgKGFmdGVyTG9hZCAhPT0gZmFsc2UpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBhZnRlckxvYWQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICBkYXRhID0gYWZ0ZXJMb2FkKGRhdGEpO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBzZWxmLm9wdGlvbnMuYWZ0ZXJMb2FkRGF0YSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIGRhdGEgPSBzZWxmLm9wdGlvbnMuYWZ0ZXJMb2FkRGF0YShkYXRhKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnUHJvdmlkZWQgY2FsbGJhY2sgZm9yIGFmdGVyTG9hZERhdGEgaXMgbm90IGEgZnVuY3Rpb24uJyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoc2VsZi5vcHRpb25zLmRhdGFUeXBlID09PSAnY3N2JyB8fCBzZWxmLm9wdGlvbnMuZGF0YVR5cGUgPT09ICd0c3YnKSB7XG4gICAgICAgIGRhdGEgPSB0aGlzLmludGVycHJldENTVihkYXRhKTtcbiAgICAgIH1cbiAgICAgIHNlbGYucGFyc2VEYXRhcyhkYXRhLCB1cGRhdGVNb2RlLCBzdGFydERhdGUsIGVuZERhdGUpO1xuICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBzd2l0Y2ggKHR5cGVvZiBzb3VyY2UpIHtcbiAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgIGlmIChzb3VyY2UgPT09ICcnKSB7XG4gICAgICAgICAgX2NhbGxiYWNrKG51bGwsIHt9KTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgdXJsID0gdGhpcy5wYXJzZVVSSShzb3VyY2UsIHN0YXJ0RGF0ZSwgZW5kRGF0ZSk7XG4gICAgICAgICAgdmFyIHJlcXVlc3RUeXBlID0gJ0dFVCc7XG4gICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5kYXRhUG9zdFBheWxvYWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHJlcXVlc3RUeXBlID0gJ1BPU1QnO1xuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgcGF5bG9hZCA9IG51bGw7XG4gICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5kYXRhUG9zdFBheWxvYWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHBheWxvYWQgPSB0aGlzLnBhcnNlVVJJKHNlbGYub3B0aW9ucy5kYXRhUG9zdFBheWxvYWQsIHN0YXJ0RGF0ZSwgZW5kRGF0ZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIHhociA9IG51bGw7XG4gICAgICAgICAgc3dpdGNoICh0aGlzLm9wdGlvbnMuZGF0YVR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ2pzb24nOlxuICAgICAgICAgICAgICB4aHIgPSBkMy5qc29uKHVybCk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnY3N2JzpcbiAgICAgICAgICAgICAgeGhyID0gZDMuY3N2KHVybCk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAndHN2JzpcbiAgICAgICAgICAgICAgeGhyID0gZDMudHN2KHVybCk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAndHh0JzpcbiAgICAgICAgICAgICAgeGhyID0gZDMudGV4dCh1cmwsICd0ZXh0L3BsYWluJyk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIGpzaGludCBtYXhkZXB0aDo1XG4gICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5kYXRhUmVxdWVzdEhlYWRlcnMgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGhlYWRlciBpbiBzZWxmLm9wdGlvbnMuZGF0YVJlcXVlc3RIZWFkZXJzKSB7XG4gICAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuZGF0YVJlcXVlc3RIZWFkZXJzLmhhc093blByb3BlcnR5KGhlYWRlcikpIHtcbiAgICAgICAgICAgICAgICB4aHIuaGVhZGVyKGhlYWRlciwgc2VsZi5vcHRpb25zLmRhdGFSZXF1ZXN0SGVhZGVyc1toZWFkZXJdKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIHhoci5zZW5kKHJlcXVlc3RUeXBlLCBwYXlsb2FkLCBfY2FsbGJhY2spO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgIGlmIChzb3VyY2UgPT09IE9iamVjdChzb3VyY2UpKSB7XG4gICAgICAgICAgX2NhbGxiYWNrKG51bGwsIHNvdXJjZSk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAvKiBmYWxscyB0aHJvdWdoICovXG4gICAgICBkZWZhdWx0OlxuICAgICAgICBfY2FsbGJhY2sobnVsbCwge30pO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIFBvcHVsYXRlIHRoZSBjYWxlbmRhciBpbnRlcm5hbCBkYXRhXG4gICAqXG4gICAqIEBwYXJhbSBvYmplY3QgZGF0YVxuICAgKiBAcGFyYW0gY29uc3RhbnQgdXBkYXRlTW9kZVxuICAgKiBAcGFyYW0gRGF0ZSBzdGFydERhdGVcbiAgICogQHBhcmFtIERhdGUgZW5kRGF0ZVxuICAgKlxuICAgKiBAcmV0dXJuIHZvaWRcbiAgICovXG4gIHBhcnNlRGF0YXM6IGZ1bmN0aW9uIChkYXRhLCB1cGRhdGVNb2RlLCBzdGFydERhdGUsIGVuZERhdGUpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAodXBkYXRlTW9kZSA9PT0gdGhpcy5SRVNFVF9BTExfT05fVVBEQVRFKSB7XG4gICAgICB0aGlzLl9kb21haW5zLmZvckVhY2goZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICAgICAgdmFsdWUuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCwgaW5kZXgsIGFycmF5KSB7XG4gICAgICAgICAgYXJyYXlbaW5kZXhdLnYgPSBudWxsO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHZhciB0ZW1wID0ge307XG5cbiAgICB2YXIgZXh0cmFjdFRpbWUgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgcmV0dXJuIGQudDtcbiAgICB9O1xuXG4gICAgLypqc2hpbnQgZm9yaW46ZmFsc2UgKi9cbiAgICBmb3IgKHZhciBkIGluIGRhdGEpIHtcbiAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoZCAqIDEwMDApO1xuICAgICAgdmFyIGRvbWFpblVuaXQgPSB0aGlzLmdldERvbWFpbihkYXRlKVswXS5nZXRUaW1lKCk7XG4gICAgICAvLyBUaGUgY3VycmVudCBkYXRhIGJlbG9uZ3MgdG8gYSBkb21haW4gdGhhdCB3YXMgY29tcHJlc3NlZFxuICAgICAgLy8gQ29tcHJlc3MgdGhlIGRhdGEgZm9yIHRoZSB0d28gZHVwbGljYXRlIGhvdXJzIGludG8gdGhlIHNhbWUgaG91clxuICAgICAgaWYgKHRoaXMuRFNURG9tYWluLmluZGV4T2YoZG9tYWluVW5pdCkgPj0gMCkge1xuICAgICAgICAvLyBSZS1hc3NpZ24gYWxsIGRhdGEgdG8gdGhlIGZpcnN0IG9yIHRoZSBzZWNvbmQgZHVwbGljYXRlIGhvdXJzXG4gICAgICAgIC8vIGRlcGVuZGluZyBvbiB3aGljaCBpcyB2aXNpYmxlXG4gICAgICAgIGlmICh0aGlzLl9kb21haW5zLmhhcyhkb21haW5Vbml0IC0gMzYwMCAqIDEwMDApKSB7XG4gICAgICAgICAgZG9tYWluVW5pdCAtPSAzNjAwICogMTAwMDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBTa2lwIGlmIGRhdGEgaXMgbm90IHJlbGV2YW50IHRvIGN1cnJlbnQgZG9tYWluXG4gICAgICBpZiAoXG4gICAgICAgIGlzTmFOKGQpIHx8XG4gICAgICAgICFkYXRhLmhhc093blByb3BlcnR5KGQpIHx8XG4gICAgICAgICF0aGlzLl9kb21haW5zLmhhcyhkb21haW5Vbml0KSB8fFxuICAgICAgICAhKGRvbWFpblVuaXQgPj0gK3N0YXJ0RGF0ZSAmJiBkb21haW5Vbml0IDwgK2VuZERhdGUpXG4gICAgICApIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIHZhciBzdWJEb21haW5zRGF0YSA9IHRoaXMuX2RvbWFpbnMuZ2V0KGRvbWFpblVuaXQpO1xuXG4gICAgICBpZiAoIXRlbXAuaGFzT3duUHJvcGVydHkoZG9tYWluVW5pdCkpIHtcbiAgICAgICAgdGVtcFtkb21haW5Vbml0XSA9IHN1YkRvbWFpbnNEYXRhLm1hcChleHRyYWN0VGltZSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBpbmRleCA9IHRlbXBbZG9tYWluVW5pdF0uaW5kZXhPZihcbiAgICAgICAgdGhpcy5fZG9tYWluVHlwZVt0aGlzLm9wdGlvbnMuc3ViRG9tYWluXS5leHRyYWN0VW5pdChkYXRlKSxcbiAgICAgICk7XG5cbiAgICAgIGlmICh1cGRhdGVNb2RlID09PSB0aGlzLlJFU0VUX1NJTkdMRV9PTl9VUERBVEUpIHtcbiAgICAgICAgc3ViRG9tYWluc0RhdGFbaW5kZXhdLnYgPSBkYXRhW2RdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKCFpc05hTihzdWJEb21haW5zRGF0YVtpbmRleF0udikpIHtcbiAgICAgICAgICBzdWJEb21haW5zRGF0YVtpbmRleF0udiArPSBkYXRhW2RdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN1YkRvbWFpbnNEYXRhW2luZGV4XS52ID0gZGF0YVtkXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICBwYXJzZVVSSTogZnVuY3Rpb24gKHN0ciwgc3RhcnREYXRlLCBlbmREYXRlKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgLy8gVXNlIGEgdGltZXN0YW1wIGluIHNlY29uZHNcbiAgICBzdHIgPSBzdHIucmVwbGFjZSgvXFx7XFx7dDpzdGFydFxcfVxcfS9nLCBzdGFydERhdGUuZ2V0VGltZSgpIC8gMTAwMCk7XG4gICAgc3RyID0gc3RyLnJlcGxhY2UoL1xce1xce3Q6ZW5kXFx9XFx9L2csIGVuZERhdGUuZ2V0VGltZSgpIC8gMTAwMCk7XG5cbiAgICAvLyBVc2UgYSBzdHJpbmcgZGF0ZSwgZm9sbG93aW5nIHRoZSBJU08tODYwMVxuICAgIHN0ciA9IHN0ci5yZXBsYWNlKC9cXHtcXHtkOnN0YXJ0XFx9XFx9L2csIHN0YXJ0RGF0ZS50b0lTT1N0cmluZygpKTtcbiAgICBzdHIgPSBzdHIucmVwbGFjZSgvXFx7XFx7ZDplbmRcXH1cXH0vZywgZW5kRGF0ZS50b0lTT1N0cmluZygpKTtcblxuICAgIHJldHVybiBzdHI7XG4gIH0sXG5cbiAgaW50ZXJwcmV0Q1NWOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBkID0ge307XG4gICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhkYXRhWzBdKTtcbiAgICB2YXIgaSwgdG90YWw7XG4gICAgZm9yIChpID0gMCwgdG90YWwgPSBkYXRhLmxlbmd0aDsgaSA8IHRvdGFsOyBpKyspIHtcbiAgICAgIGRbZGF0YVtpXVtrZXlzWzBdXV0gPSArZGF0YVtpXVtrZXlzWzFdXTtcbiAgICB9XG4gICAgcmV0dXJuIGQ7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEhhbmRsZSB0aGUgY2FsZW5kYXIgbGF5b3V0IGFuZCBkaW1lbnNpb25cbiAgICpcbiAgICogRXhwYW5kIGFuZCBzaHJpbmsgdGhlIGNvbnRhaW5lciBkZXBlbmRpbmcgb24gaXRzIGNoaWxkcmVuIGRpbWVuc2lvblxuICAgKiBBbHNvIHJlYXJyYW5nZSB0aGUgY2hpbGRyZW4gcG9zaXRpb24gZGVwZW5kaW5nIG9uIHRoZWlyIGRpbWVuc2lvbixcbiAgICogYW5kIHRoZSBsZWdlbmQgcG9zaXRpb25cbiAgICpcbiAgICogQHJldHVybiB2b2lkXG4gICAqL1xuICByZXNpemU6IGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgcGFyZW50ID0gdGhpcztcbiAgICB2YXIgb3B0aW9ucyA9IHBhcmVudC5vcHRpb25zO1xuICAgIHZhciBsZWdlbmRXaWR0aCA9IG9wdGlvbnMuZGlzcGxheUxlZ2VuZFxuICAgICAgPyBwYXJlbnQuTGVnZW5kLmdldERpbSgnd2lkdGgnKSArIG9wdGlvbnMubGVnZW5kTWFyZ2luWzFdICsgb3B0aW9ucy5sZWdlbmRNYXJnaW5bM11cbiAgICAgIDogMDtcbiAgICB2YXIgbGVnZW5kSGVpZ2h0ID0gb3B0aW9ucy5kaXNwbGF5TGVnZW5kXG4gICAgICA/IHBhcmVudC5MZWdlbmQuZ2V0RGltKCdoZWlnaHQnKSArIG9wdGlvbnMubGVnZW5kTWFyZ2luWzBdICsgb3B0aW9ucy5sZWdlbmRNYXJnaW5bMl1cbiAgICAgIDogMDtcblxuICAgIHZhciBncmFwaFdpZHRoID0gcGFyZW50LmdyYXBoRGltLndpZHRoIC0gb3B0aW9ucy5kb21haW5HdXR0ZXIgLSBvcHRpb25zLmNlbGxQYWRkaW5nO1xuICAgIHZhciBncmFwaEhlaWdodCA9IHBhcmVudC5ncmFwaERpbS5oZWlnaHQgLSBvcHRpb25zLmRvbWFpbkd1dHRlciAtIG9wdGlvbnMuY2VsbFBhZGRpbmc7XG5cbiAgICB0aGlzLnJvb3RcbiAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgIC5kdXJhdGlvbihvcHRpb25zLmFuaW1hdGlvbkR1cmF0aW9uKVxuICAgICAgLmF0dHIoJ3dpZHRoJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgb3B0aW9ucy5sZWdlbmRWZXJ0aWNhbFBvc2l0aW9uID09PSAnbWlkZGxlJyB8fFxuICAgICAgICAgIG9wdGlvbnMubGVnZW5kVmVydGljYWxQb3NpdGlvbiA9PT0gJ2NlbnRlcidcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuIGdyYXBoV2lkdGggKyBsZWdlbmRXaWR0aDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gTWF0aC5tYXgoZ3JhcGhXaWR0aCwgbGVnZW5kV2lkdGgpO1xuICAgICAgfSlcbiAgICAgIC5hdHRyKCdoZWlnaHQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBvcHRpb25zLmxlZ2VuZFZlcnRpY2FsUG9zaXRpb24gPT09ICdtaWRkbGUnIHx8XG4gICAgICAgICAgb3B0aW9ucy5sZWdlbmRWZXJ0aWNhbFBvc2l0aW9uID09PSAnY2VudGVyJ1xuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm4gTWF0aC5tYXgoZ3JhcGhIZWlnaHQsIGxlZ2VuZEhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGdyYXBoSGVpZ2h0ICsgbGVnZW5kSGVpZ2h0O1xuICAgICAgfSk7XG5cbiAgICB0aGlzLnJvb3RcbiAgICAgIC5zZWxlY3QoJy5ncmFwaCcpXG4gICAgICAudHJhbnNpdGlvbigpXG4gICAgICAuZHVyYXRpb24ob3B0aW9ucy5hbmltYXRpb25EdXJhdGlvbilcbiAgICAgIC5hdHRyKCd5JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAob3B0aW9ucy5sZWdlbmRWZXJ0aWNhbFBvc2l0aW9uID09PSAndG9wJykge1xuICAgICAgICAgIHJldHVybiBsZWdlbmRIZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9KVxuICAgICAgLmF0dHIoJ3gnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICAob3B0aW9ucy5sZWdlbmRWZXJ0aWNhbFBvc2l0aW9uID09PSAnbWlkZGxlJyB8fFxuICAgICAgICAgICAgb3B0aW9ucy5sZWdlbmRWZXJ0aWNhbFBvc2l0aW9uID09PSAnY2VudGVyJykgJiZcbiAgICAgICAgICBvcHRpb25zLmxlZ2VuZEhvcml6b250YWxQb3NpdGlvbiA9PT0gJ2xlZnQnXG4gICAgICAgICkge1xuICAgICAgICAgIHJldHVybiBsZWdlbmRXaWR0aDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH0pO1xuICB9LFxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuICAvLyBQVUJMSUMgQVBJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cblxuICAvKipcbiAgICogU2hpZnQgdGhlIGNhbGVuZGFyIGZvcndhcmRcbiAgICovXG4gIG5leHQ6IGZ1bmN0aW9uIChuKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgIG4gPSAxO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5sb2FkTmV4dERvbWFpbihuKTtcbiAgfSxcblxuICAvKipcbiAgICogU2hpZnQgdGhlIGNhbGVuZGFyIGJhY2t3YXJkXG4gICAqL1xuICBwcmV2aW91czogZnVuY3Rpb24gKG4pIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgbiA9IDE7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmxvYWRQcmV2aW91c0RvbWFpbihuKTtcbiAgfSxcblxuICAvKipcbiAgICogSnVtcCBkaXJlY3RseSB0byBhIHNwZWNpZmljIGRhdGVcbiAgICpcbiAgICogSnVtcFRvIHdpbGwgc2Nyb2xsIHRoZSBjYWxlbmRhciB1bnRpbCB0aGUgd2FudGVkIGRvbWFpbiB3aXRoIHRoZSBzcGVjaWZpZWRcbiAgICogZGF0ZSBpcyB2aXNpYmxlLiBVbmxlc3MgeW91IHNldCByZXNldCB0byB0cnVlLCB0aGUgd2FudGVkIGRvbWFpblxuICAgKiB3aWxsIG5vdCBuZWNlc3NhcmlseSBiZSB0aGUgZmlyc3QgKGxlZnRtb3N0KSBkb21haW4gb2YgdGhlIGNhbGVuZGFyLlxuICAgKlxuICAgKiBAcGFyYW0gRGF0ZSBkYXRlIEp1bXAgdG8gdGhlIGRvbWFpbiBjb250YWluaW5nIHRoYXQgZGF0ZVxuICAgKiBAcGFyYW0gYm9vbCByZXNldCBXaGV0aGVyIHRoZSB3YW50ZWQgZG9tYWluIHNob3VsZCBiZSB0aGUgZmlyc3QgZG9tYWluIG9mIHRoZSBjYWxlbmRhclxuICAgKiBAcGFyYW0gYm9vbCBUcnVlIG9mIHRoZSBjYWxlbmRhciB3YXMgc2Nyb2xsZWRcbiAgICovXG4gIGp1bXBUbzogZnVuY3Rpb24gKGRhdGUsIHJlc2V0KSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSB7XG4gICAgICByZXNldCA9IGZhbHNlO1xuICAgIH1cbiAgICB2YXIgZG9tYWlucyA9IHRoaXMuZ2V0RG9tYWluS2V5cygpO1xuICAgIHZhciBmaXJzdERvbWFpbiA9IGRvbWFpbnNbMF07XG4gICAgdmFyIGxhc3REb21haW4gPSBkb21haW5zW2RvbWFpbnMubGVuZ3RoIC0gMV07XG5cbiAgICBpZiAoZGF0ZSA8IGZpcnN0RG9tYWluKSB7XG4gICAgICByZXR1cm4gdGhpcy5sb2FkUHJldmlvdXNEb21haW4odGhpcy5nZXREb21haW4oZmlyc3REb21haW4sIGRhdGUpLmxlbmd0aCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChyZXNldCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sb2FkTmV4dERvbWFpbih0aGlzLmdldERvbWFpbihmaXJzdERvbWFpbiwgZGF0ZSkubGVuZ3RoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGRhdGUgPiBsYXN0RG9tYWluKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxvYWROZXh0RG9tYWluKHRoaXMuZ2V0RG9tYWluKGxhc3REb21haW4sIGRhdGUpLmxlbmd0aCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuXG4gIC8qKlxuICAgKiBOYXZpZ2F0ZSBiYWNrIHRvIHRoZSBzdGFydCBkYXRlXG4gICAqXG4gICAqIEBzaW5jZSAgMy4zLjhcbiAgICogQHJldHVybiB2b2lkXG4gICAqL1xuICByZXdpbmQ6IGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB0aGlzLmp1bXBUbyh0aGlzLm9wdGlvbnMuc3RhcnQsIHRydWUpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIGNhbGVuZGFyIHdpdGggbmV3IGRhdGFcbiAgICpcbiAgICogQHBhcmFtICBvYmplY3R8c3RyaW5nICAgIGRhdGFTb3VyY2UgICAgVGhlIGNhbGVuZGFyJ3MgZGF0YXNvdXJjZSwgc2FtZSB0eXBlIGFzIHRoaXMub3B0aW9ucy5kYXRhXG4gICAqIEBwYXJhbSAgYm9vbGVhbnxmdW5jdGlvbiAgICBhZnRlckxvYWQgICAgV2hldGhlciB0byBleGVjdXRlIGFmdGVyTG9hZCgpIG9uIHRoZSBkYXRhLiBQYXNzIGRpcmVjdGx5IGEgZnVuY3Rpb25cbiAgICogaWYgeW91IGRvbid0IHdhbnQgdG8gdXNlIHRoZSBhZnRlckxvYWQoKSBjYWxsYmFja1xuICAgKi9cbiAgdXBkYXRlOiBmdW5jdGlvbiAoZGF0YVNvdXJjZSwgYWZ0ZXJMb2FkLCB1cGRhdGVNb2RlKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgIGRhdGFTb3VyY2UgPSB0aGlzLm9wdGlvbnMuZGF0YTtcbiAgICB9XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSB7XG4gICAgICBhZnRlckxvYWQgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDMpIHtcbiAgICAgIHVwZGF0ZU1vZGUgPSB0aGlzLlJFU0VUX0FMTF9PTl9VUERBVEU7XG4gICAgfVxuXG4gICAgdmFyIGRvbWFpbnMgPSB0aGlzLmdldERvbWFpbktleXMoKTtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdGhpcy5nZXREYXRhcyhcbiAgICAgIGRhdGFTb3VyY2UsXG4gICAgICBuZXcgRGF0ZShkb21haW5zWzBdKSxcbiAgICAgIHRoaXMuZ2V0U3ViRG9tYWluKGRvbWFpbnNbZG9tYWlucy5sZW5ndGggLSAxXSkucG9wKCksXG4gICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGYuZmlsbCgpO1xuICAgICAgICBzZWxmLmFmdGVyVXBkYXRlKCk7XG4gICAgICB9LFxuICAgICAgYWZ0ZXJMb2FkLFxuICAgICAgdXBkYXRlTW9kZSxcbiAgICApO1xuICB9LFxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIGxlZ2VuZFxuICAgKlxuICAgKiBAcGFyYW0gYXJyYXkgbGVnZW5kIGFuIGFycmF5IG9mIGludGVnZXIsIHJlcHJlc2VudGluZyB0aGUgZGlmZmVyZW50IHRocmVzaG9sZCB2YWx1ZVxuICAgKiBAcGFyYW0gYXJyYXkgY29sb3JSYW5nZSBhbiBhcnJheSBvZiAyIGhleCBjb2xvcnMsIGZvciB0aGUgbWluaW11bSBhbmQgbWF4aW11bSBjb2xvcnNcbiAgICovXG4gIHNldExlZ2VuZDogZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBvbGRMZWdlbmQgPSB0aGlzLm9wdGlvbnMubGVnZW5kLnNsaWNlKDApO1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID49IDEgJiYgQXJyYXkuaXNBcnJheShhcmd1bWVudHNbMF0pKSB7XG4gICAgICB0aGlzLm9wdGlvbnMubGVnZW5kID0gYXJndW1lbnRzWzBdO1xuICAgIH1cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+PSAyKSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShhcmd1bWVudHNbMV0pICYmIGFyZ3VtZW50c1sxXS5sZW5ndGggPj0gMikge1xuICAgICAgICB0aGlzLm9wdGlvbnMubGVnZW5kQ29sb3JzID0gW2FyZ3VtZW50c1sxXVswXSwgYXJndW1lbnRzWzFdWzFdXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5sZWdlbmRDb2xvcnMgPSBhcmd1bWVudHNbMV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgKGFyZ3VtZW50cy5sZW5ndGggPiAwICYmICFhcnJheUVxdWFscyhvbGRMZWdlbmQsIHRoaXMub3B0aW9ucy5sZWdlbmQpKSB8fFxuICAgICAgYXJndW1lbnRzLmxlbmd0aCA+PSAyXG4gICAgKSB7XG4gICAgICB0aGlzLkxlZ2VuZC5idWlsZENvbG9ycygpO1xuICAgICAgdGhpcy5maWxsKCk7XG4gICAgfVxuXG4gICAgdGhpcy5MZWdlbmQucmVkcmF3KHRoaXMuZ3JhcGhEaW0ud2lkdGggLSB0aGlzLm9wdGlvbnMuZG9tYWluR3V0dGVyIC0gdGhpcy5vcHRpb25zLmNlbGxQYWRkaW5nKTtcbiAgfSxcblxuICAvKipcbiAgICogUmVtb3ZlIHRoZSBsZWdlbmRcbiAgICpcbiAgICogQHJldHVybiBib29sIEZhbHNlIGlmIHRoZXJlIGlzIG5vIGxlZ2VuZCB0byByZW1vdmVcbiAgICovXG4gIHJlbW92ZUxlZ2VuZDogZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICghdGhpcy5vcHRpb25zLmRpc3BsYXlMZWdlbmQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5vcHRpb25zLmRpc3BsYXlMZWdlbmQgPSBmYWxzZTtcbiAgICB0aGlzLkxlZ2VuZC5yZW1vdmUoKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSxcblxuICAvKipcbiAgICogRGlzcGxheSB0aGUgbGVnZW5kXG4gICAqXG4gICAqIEByZXR1cm4gYm9vbCBGYWxzZSBpZiB0aGUgbGVnZW5kIHdhcyBhbHJlYWR5IGRpc3BsYXllZFxuICAgKi9cbiAgc2hvd0xlZ2VuZDogZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICh0aGlzLm9wdGlvbnMuZGlzcGxheUxlZ2VuZCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLm9wdGlvbnMuZGlzcGxheUxlZ2VuZCA9IHRydWU7XG4gICAgdGhpcy5MZWdlbmQucmVkcmF3KHRoaXMuZ3JhcGhEaW0ud2lkdGggLSB0aGlzLm9wdGlvbnMuZG9tYWluR3V0dGVyIC0gdGhpcy5vcHRpb25zLmNlbGxQYWRkaW5nKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSxcblxuICAvKipcbiAgICogSGlnaGxpZ2h0IGRhdGVzXG4gICAqXG4gICAqIEFkZCBhIGhpZ2hsaWdodCBjbGFzcyB0byBhIHNldCBvZiBkYXRlc1xuICAgKlxuICAgKiBAc2luY2UgIDMuMy41XG4gICAqIEBwYXJhbSAgYXJyYXkgQXJyYXkgb2YgZGF0ZXMgdG8gaGlnaGxpZ2h0XG4gICAqIEByZXR1cm4gYm9vbCBUcnVlIGlmIGRhdGVzIHdlcmUgaGlnaGxpZ2h0ZWRcbiAgICovXG4gIGhpZ2hsaWdodDogZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAoKHRoaXMub3B0aW9ucy5oaWdobGlnaHQgPSB0aGlzLmV4cGFuZERhdGVTZXR0aW5nKGFyZ3MpKS5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLmZpbGwoKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG5cbiAgLyoqXG4gICAqIERlc3Ryb3kgdGhlIGNhbGVuZGFyXG4gICAqXG4gICAqIFVzYWdlOiBjYWwgPSBjYWwuZGVzdHJveSgpO1xuICAgKlxuICAgKiBAc2luY2UgIDMuMy42XG4gICAqIEBwYXJhbSBmdW5jdGlvbiBBIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIHRyaWdnZXIgYWZ0ZXIgZGVzdHJveWluZyB0aGUgY2FsZW5kYXJcbiAgICogQHJldHVybiBudWxsXG4gICAqL1xuICBkZXN0cm95OiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB0aGlzLnJvb3RcbiAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgIC5kdXJhdGlvbih0aGlzLm9wdGlvbnMuYW5pbWF0aW9uRHVyYXRpb24pXG4gICAgICAuYXR0cignd2lkdGgnLCAwKVxuICAgICAgLmF0dHIoJ2hlaWdodCcsIDApXG4gICAgICAucmVtb3ZlKClcbiAgICAgIC5lYWNoKCdlbmQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBjYWxsYmFjayAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnUHJvdmlkZWQgY2FsbGJhY2sgZm9yIGRlc3Ryb3koKSBpcyBub3QgYSBmdW5jdGlvbi4nKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfSxcblxuICBnZXRTVkc6IGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgc3R5bGVzID0ge1xuICAgICAgJy5jYWwtaGVhdG1hcC1jb250YWluZXInOiB7fSxcbiAgICAgICcuZ3JhcGgnOiB7fSxcbiAgICAgICcuZ3JhcGgtcmVjdCc6IHt9LFxuICAgICAgJ3JlY3QuaGlnaGxpZ2h0Jzoge30sXG4gICAgICAncmVjdC5ub3cnOiB7fSxcbiAgICAgICdyZWN0LmhpZ2hsaWdodC1ub3cnOiB7fSxcbiAgICAgICd0ZXh0LmhpZ2hsaWdodCc6IHt9LFxuICAgICAgJ3RleHQubm93Jzoge30sXG4gICAgICAndGV4dC5oaWdobGlnaHQtbm93Jzoge30sXG4gICAgICAnLmRvbWFpbi1iYWNrZ3JvdW5kJzoge30sXG4gICAgICAnLmdyYXBoLWxhYmVsJzoge30sXG4gICAgICAnLnN1YmRvbWFpbi10ZXh0Jzoge30sXG4gICAgICAnLnEwJzoge30sXG4gICAgICAnLnFpJzoge30sXG4gICAgfTtcblxuICAgIGZvciAodmFyIGogPSAxLCB0b3RhbCA9IHRoaXMub3B0aW9ucy5sZWdlbmQubGVuZ3RoICsgMTsgaiA8PSB0b3RhbDsgaisrKSB7XG4gICAgICBzdHlsZXNbJy5xJyArIGpdID0ge307XG4gICAgfVxuXG4gICAgdmFyIHJvb3QgPSB0aGlzLnJvb3Q7XG5cbiAgICB2YXIgd2hpdGVsaXN0U3R5bGVzID0gW1xuICAgICAgLy8gU1ZHIHNwZWNpZmljIHByb3BlcnRpZXNcbiAgICAgICdzdHJva2UnLFxuICAgICAgJ3N0cm9rZS13aWR0aCcsXG4gICAgICAnc3Ryb2tlLW9wYWNpdHknLFxuICAgICAgJ3N0cm9rZS1kYXNoYXJyYXknLFxuICAgICAgJ3N0cm9rZS1kYXNob2Zmc2V0JyxcbiAgICAgICdzdHJva2UtbGluZWNhcCcsXG4gICAgICAnc3Ryb2tlLW1pdGVybGltaXQnLFxuICAgICAgJ2ZpbGwnLFxuICAgICAgJ2ZpbGwtb3BhY2l0eScsXG4gICAgICAnZmlsbC1ydWxlJyxcbiAgICAgICdtYXJrZXInLFxuICAgICAgJ21hcmtlci1zdGFydCcsXG4gICAgICAnbWFya2VyLW1pZCcsXG4gICAgICAnbWFya2VyLWVuZCcsXG4gICAgICAnYWxpZ25lbWVudC1iYXNlbGluZScsXG4gICAgICAnYmFzZWxpbmUtc2hpZnQnLFxuICAgICAgJ2RvbWluYW50LWJhc2VsaW5lJyxcbiAgICAgICdnbHlwaC1vcmllbnRhdGlvbi1ob3Jpem9udGFsJyxcbiAgICAgICdnbHlwaC1vcmllbnRhdGlvbi12ZXJ0aWNhbCcsXG4gICAgICAna2VybmluZycsXG4gICAgICAndGV4dC1hbmNob3InLFxuICAgICAgJ3NoYXBlLXJlbmRlcmluZycsXG5cbiAgICAgIC8vIFRleHQgU3BlY2lmaWMgcHJvcGVydGllc1xuICAgICAgJ3RleHQtdHJhbnNmb3JtJyxcbiAgICAgICdmb250LWZhbWlseScsXG4gICAgICAnZm9udCcsXG4gICAgICAnZm9udC1zaXplJyxcbiAgICAgICdmb250LXdlaWdodCcsXG4gICAgXTtcblxuICAgIHZhciBmaWx0ZXJTdHlsZXMgPSBmdW5jdGlvbiAoYXR0cmlidXRlLCBwcm9wZXJ0eSwgdmFsdWUpIHtcbiAgICAgIGlmICh3aGl0ZWxpc3RTdHlsZXMuaW5kZXhPZihwcm9wZXJ0eSkgIT09IC0xKSB7XG4gICAgICAgIHN0eWxlc1thdHRyaWJ1dGVdW3Byb3BlcnR5XSA9IHZhbHVlO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgZ2V0RWxlbWVudCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4gcm9vdC5zZWxlY3QoZSlbMF1bMF07XG4gICAgfTtcblxuICAgIC8qIGpzaGludCBmb3JpbjpmYWxzZSAqL1xuICAgIGZvciAodmFyIGVsZW1lbnQgaW4gc3R5bGVzKSB7XG4gICAgICBpZiAoIXN0eWxlcy5oYXNPd25Qcm9wZXJ0eShlbGVtZW50KSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgdmFyIGRvbSA9IGdldEVsZW1lbnQoZWxlbWVudCk7XG5cbiAgICAgIGlmIChkb20gPT09IG51bGwpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIC8vIFRoZSBET00gTGV2ZWwgMiBDU1Mgd2F5XG4gICAgICAvKiBqc2hpbnQgbWF4ZGVwdGg6IGZhbHNlICovXG4gICAgICBpZiAoJ2dldENvbXB1dGVkU3R5bGUnIGluIHdpbmRvdykge1xuICAgICAgICB2YXIgY3MgPSBnZXRDb21wdXRlZFN0eWxlKGRvbSwgbnVsbCk7XG4gICAgICAgIGlmIChjcy5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBmaWx0ZXJTdHlsZXMoZWxlbWVudCwgY3MuaXRlbShpKSwgY3MuZ2V0UHJvcGVydHlWYWx1ZShjcy5pdGVtKGkpKSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gT3BlcmEgd29ya2Fyb3VuZC4gT3BlcmEgZG9lc25cInQgc3VwcG9ydCBgaXRlbWAvYGxlbmd0aGBcbiAgICAgICAgICAvLyBvbiBDU1NTdHlsZURlY2xhcmF0aW9uLlxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZvciAodmFyIGsgaW4gY3MpIHtcbiAgICAgICAgICAgIGlmIChjcy5oYXNPd25Qcm9wZXJ0eShrKSkge1xuICAgICAgICAgICAgICBmaWx0ZXJTdHlsZXMoZWxlbWVudCwgaywgY3Nba10pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFRoZSBJRSB3YXlcbiAgICAgIH0gZWxzZSBpZiAoJ2N1cnJlbnRTdHlsZScgaW4gZG9tKSB7XG4gICAgICAgIHZhciBjc3MgPSBkb20uY3VycmVudFN0eWxlO1xuICAgICAgICBmb3IgKHZhciBwIGluIGNzcykge1xuICAgICAgICAgIGZpbHRlclN0eWxlcyhlbGVtZW50LCBwLCBjc3NbcF0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIHN0cmluZyA9XG4gICAgICAnPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgJyArXG4gICAgICAneG1sbnM6eGxpbms9XCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rXCI+PHN0eWxlIHR5cGU9XCJ0ZXh0L2Nzc1wiPjwhW0NEQVRBWyAnO1xuXG4gICAgZm9yICh2YXIgc3R5bGUgaW4gc3R5bGVzKSB7XG4gICAgICBzdHJpbmcgKz0gc3R5bGUgKyAnIHtcXG4nO1xuICAgICAgZm9yICh2YXIgbCBpbiBzdHlsZXNbc3R5bGVdKSB7XG4gICAgICAgIHN0cmluZyArPSAnXFx0JyArIGwgKyAnOicgKyBzdHlsZXNbc3R5bGVdW2xdICsgJztcXG4nO1xuICAgICAgfVxuICAgICAgc3RyaW5nICs9ICd9XFxuJztcbiAgICB9XG5cbiAgICBzdHJpbmcgKz0gJ11dPjwvc3R5bGU+JztcbiAgICBzdHJpbmcgKz0gbmV3IFhNTFNlcmlhbGl6ZXIoKS5zZXJpYWxpemVUb1N0cmluZyh0aGlzLnJvb3RbMF1bMF0pO1xuICAgIHN0cmluZyArPSAnPC9zdmc+JztcblxuICAgIHJldHVybiBzdHJpbmc7XG4gIH0sXG59O1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbi8vIERPTUFJTiBQT1NJVElPTiBDT01QVVRBVElPTiAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cblxuLyoqXG4gKiBDb21wdXRlIHRoZSBwb3NpdGlvbiBvZiBhIGRvbWFpbiwgcmVsYXRpdmUgdG8gdGhlIGNhbGVuZGFyXG4gKi9cbnZhciBEb21haW5Qb3NpdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHRoaXMucG9zaXRpb25zID0gZDMubWFwKCk7XG59O1xuXG5Eb21haW5Qb3NpdGlvbi5wcm90b3R5cGUuZ2V0UG9zaXRpb24gPSBmdW5jdGlvbiAoZCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgcmV0dXJuIHRoaXMucG9zaXRpb25zLmdldChkKTtcbn07XG5cbkRvbWFpblBvc2l0aW9uLnByb3RvdHlwZS5nZXRQb3NpdGlvbkZyb21JbmRleCA9IGZ1bmN0aW9uIChpKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB2YXIgZG9tYWlucyA9IHRoaXMuZ2V0S2V5cygpO1xuICByZXR1cm4gdGhpcy5wb3NpdGlvbnMuZ2V0KGRvbWFpbnNbaV0pO1xufTtcblxuRG9tYWluUG9zaXRpb24ucHJvdG90eXBlLmdldExhc3QgPSBmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB2YXIgZG9tYWlucyA9IHRoaXMuZ2V0S2V5cygpO1xuICByZXR1cm4gdGhpcy5wb3NpdGlvbnMuZ2V0KGRvbWFpbnNbZG9tYWlucy5sZW5ndGggLSAxXSk7XG59O1xuXG5Eb21haW5Qb3NpdGlvbi5wcm90b3R5cGUuc2V0UG9zaXRpb24gPSBmdW5jdGlvbiAoZCwgZGltKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB0aGlzLnBvc2l0aW9ucy5zZXQoZCwgZGltKTtcbn07XG5cbkRvbWFpblBvc2l0aW9uLnByb3RvdHlwZS5zaGlmdFJpZ2h0QnkgPSBmdW5jdGlvbiAoZXhpdGluZ0RvbWFpbkRpbSkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdGhpcy5wb3NpdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgIHRoaXMuc2V0KGtleSwgdmFsdWUgLSBleGl0aW5nRG9tYWluRGltKTtcbiAgfSk7XG5cbiAgdmFyIGRvbWFpbnMgPSB0aGlzLmdldEtleXMoKTtcbiAgdGhpcy5wb3NpdGlvbnMucmVtb3ZlKGRvbWFpbnNbMF0pO1xufTtcblxuRG9tYWluUG9zaXRpb24ucHJvdG90eXBlLnNoaWZ0TGVmdEJ5ID0gZnVuY3Rpb24gKGVudGVyaW5nRG9tYWluRGltKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB0aGlzLnBvc2l0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgdGhpcy5zZXQoa2V5LCB2YWx1ZSArIGVudGVyaW5nRG9tYWluRGltKTtcbiAgfSk7XG5cbiAgdmFyIGRvbWFpbnMgPSB0aGlzLmdldEtleXMoKTtcbiAgdGhpcy5wb3NpdGlvbnMucmVtb3ZlKGRvbWFpbnNbZG9tYWlucy5sZW5ndGggLSAxXSk7XG59O1xuXG5Eb21haW5Qb3NpdGlvbi5wcm90b3R5cGUuZ2V0S2V5cyA9IGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHJldHVybiB0aGlzLnBvc2l0aW9ucy5rZXlzKCkuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgIHJldHVybiBwYXJzZUludChhLCAxMCkgLSBwYXJzZUludChiLCAxMCk7XG4gIH0pO1xufTtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4vLyBMRUdFTkQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuXG52YXIgTGVnZW5kID0gZnVuY3Rpb24gKGNhbGVuZGFyKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB0aGlzLmNhbGVuZGFyID0gY2FsZW5kYXI7XG4gIHRoaXMuY29tcHV0ZURpbSgpO1xuXG4gIGlmIChjYWxlbmRhci5vcHRpb25zLmxlZ2VuZENvbG9ycyAhPT0gbnVsbCkge1xuICAgIHRoaXMuYnVpbGRDb2xvcnMoKTtcbiAgfVxufTtcblxuTGVnZW5kLnByb3RvdHlwZS5jb21wdXRlRGltID0gZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdmFyIG9wdGlvbnMgPSB0aGlzLmNhbGVuZGFyLm9wdGlvbnM7IC8vIFNob3J0ZXIgYWNjZXNzb3IgZm9yIHZhcmlhYmxlIG5hbWUgbWFuZ2xpbmcgd2hlbiBtaW5pZnlpbmdcbiAgdGhpcy5kaW0gPSB7XG4gICAgd2lkdGg6XG4gICAgICBvcHRpb25zLmxlZ2VuZENlbGxTaXplICogKG9wdGlvbnMubGVnZW5kLmxlbmd0aCArIDEpICtcbiAgICAgIG9wdGlvbnMubGVnZW5kQ2VsbFBhZGRpbmcgKiBvcHRpb25zLmxlZ2VuZC5sZW5ndGgsXG4gICAgaGVpZ2h0OiBvcHRpb25zLmxlZ2VuZENlbGxTaXplLFxuICB9O1xufTtcblxuTGVnZW5kLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB0aGlzLmNhbGVuZGFyLnJvb3Quc2VsZWN0KCcuZ3JhcGgtbGVnZW5kJykucmVtb3ZlKCk7XG4gIHRoaXMuY2FsZW5kYXIucmVzaXplKCk7XG59O1xuXG5MZWdlbmQucHJvdG90eXBlLnJlZHJhdyA9IGZ1bmN0aW9uICh3aWR0aCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgaWYgKCF0aGlzLmNhbGVuZGFyLm9wdGlvbnMuZGlzcGxheUxlZ2VuZCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHZhciBwYXJlbnQgPSB0aGlzO1xuICB2YXIgY2FsZW5kYXIgPSB0aGlzLmNhbGVuZGFyO1xuICB2YXIgbGVnZW5kID0gY2FsZW5kYXIucm9vdDtcbiAgdmFyIGxlZ2VuZEl0ZW07XG4gIHZhciBvcHRpb25zID0gY2FsZW5kYXIub3B0aW9uczsgLy8gU2hvcnRlciBhY2Nlc3NvciBmb3IgdmFyaWFibGUgbmFtZSBtYW5nbGluZyB3aGVuIG1pbmlmeWluZ1xuXG4gIHRoaXMuY29tcHV0ZURpbSgpO1xuXG4gIHZhciBfbGVnZW5kID0gb3B0aW9ucy5sZWdlbmQuc2xpY2UoMCk7XG4gIF9sZWdlbmQucHVzaChfbGVnZW5kW19sZWdlbmQubGVuZ3RoIC0gMV0gKyAxKTtcblxuICB2YXIgbGVnZW5kRWxlbWVudCA9IGNhbGVuZGFyLnJvb3Quc2VsZWN0KCcuZ3JhcGgtbGVnZW5kJyk7XG4gIGlmIChsZWdlbmRFbGVtZW50WzBdWzBdICE9PSBudWxsKSB7XG4gICAgbGVnZW5kID0gbGVnZW5kRWxlbWVudDtcbiAgICBsZWdlbmRJdGVtID0gbGVnZW5kLnNlbGVjdCgnZycpLnNlbGVjdEFsbCgncmVjdCcpLmRhdGEoX2xlZ2VuZCk7XG4gIH0gZWxzZSB7XG4gICAgLy8gQ3JlYXRpbmcgdGhlIG5ldyBsZWdlbmQgRE9NIGlmIGl0IGRvZXNuJ3QgYWxyZWFkeSBleGlzdFxuICAgIGxlZ2VuZCA9XG4gICAgICBvcHRpb25zLmxlZ2VuZFZlcnRpY2FsUG9zaXRpb24gPT09ICd0b3AnXG4gICAgICAgID8gbGVnZW5kLmluc2VydCgnc3ZnJywgJy5ncmFwaCcpXG4gICAgICAgIDogbGVnZW5kLmFwcGVuZCgnc3ZnJyk7XG5cbiAgICBsZWdlbmQuYXR0cigneCcsIGdldExlZ2VuZFhQb3NpdGlvbigpKS5hdHRyKCd5JywgZ2V0TGVnZW5kWVBvc2l0aW9uKCkpO1xuXG4gICAgbGVnZW5kSXRlbSA9IGxlZ2VuZFxuICAgICAgLmF0dHIoJ2NsYXNzJywgJ2dyYXBoLWxlZ2VuZCcpXG4gICAgICAuYXR0cignaGVpZ2h0JywgcGFyZW50LmdldERpbSgnaGVpZ2h0JykpXG4gICAgICAuYXR0cignd2lkdGgnLCBwYXJlbnQuZ2V0RGltKCd3aWR0aCcpKVxuICAgICAgLmFwcGVuZCgnZycpXG4gICAgICAuc2VsZWN0QWxsKClcbiAgICAgIC5kYXRhKF9sZWdlbmQpO1xuICB9XG5cbiAgbGVnZW5kSXRlbVxuICAgIC5lbnRlcigpXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmNhbGwobGVnZW5kQ2VsbExheW91dClcbiAgICAuYXR0cignY2xhc3MnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgcmV0dXJuIGNhbGVuZGFyLkxlZ2VuZC5nZXRDbGFzcyhkLCBjYWxlbmRhci5sZWdlbmRTY2FsZSA9PT0gbnVsbCk7XG4gICAgfSlcbiAgICAuYXR0cignZmlsbC1vcGFjaXR5JywgMClcbiAgICAuY2FsbChmdW5jdGlvbiAoc2VsZWN0aW9uKSB7XG4gICAgICBpZiAoXG4gICAgICAgIGNhbGVuZGFyLmxlZ2VuZFNjYWxlICE9PSBudWxsICYmXG4gICAgICAgIG9wdGlvbnMubGVnZW5kQ29sb3JzICE9PSBudWxsICYmXG4gICAgICAgIG9wdGlvbnMubGVnZW5kQ29sb3JzLmhhc093blByb3BlcnR5KCdiYXNlJylcbiAgICAgICkge1xuICAgICAgICBzZWxlY3Rpb24uYXR0cignZmlsbCcsIG9wdGlvbnMubGVnZW5kQ29sb3JzLmJhc2UpO1xuICAgICAgfVxuICAgIH0pXG4gICAgLmFwcGVuZCgndGl0bGUnKTtcblxuICBsZWdlbmRJdGVtXG4gICAgLmV4aXQoKVxuICAgIC50cmFuc2l0aW9uKClcbiAgICAuZHVyYXRpb24ob3B0aW9ucy5hbmltYXRpb25EdXJhdGlvbilcbiAgICAuYXR0cignZmlsbC1vcGFjaXR5JywgMClcbiAgICAucmVtb3ZlKCk7XG5cbiAgbGVnZW5kSXRlbVxuICAgIC50cmFuc2l0aW9uKClcbiAgICAuZGVsYXkoZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgIHJldHVybiAob3B0aW9ucy5hbmltYXRpb25EdXJhdGlvbiAqIGkpIC8gMTA7XG4gICAgfSlcbiAgICAuY2FsbChsZWdlbmRDZWxsTGF5b3V0KVxuICAgIC5hdHRyKCdmaWxsLW9wYWNpdHknLCAxKVxuICAgIC5jYWxsKGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICBlbGVtZW50LmF0dHIoJ2ZpbGwnLCBmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICBpZiAoY2FsZW5kYXIubGVnZW5kU2NhbGUgPT09IG51bGwpIHtcbiAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgICAgIHJldHVybiBjYWxlbmRhci5sZWdlbmRTY2FsZShkIC0gMSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNhbGVuZGFyLmxlZ2VuZFNjYWxlKG9wdGlvbnMubGVnZW5kW2kgLSAxXSk7XG4gICAgICB9KTtcblxuICAgICAgZWxlbWVudC5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBjYWxlbmRhci5MZWdlbmQuZ2V0Q2xhc3MoZCwgY2FsZW5kYXIubGVnZW5kU2NhbGUgPT09IG51bGwpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgZnVuY3Rpb24gbGVnZW5kQ2VsbExheW91dChzZWxlY3Rpb24pIHtcbiAgICBzZWxlY3Rpb25cbiAgICAgIC5hdHRyKCd3aWR0aCcsIG9wdGlvbnMubGVnZW5kQ2VsbFNpemUpXG4gICAgICAuYXR0cignaGVpZ2h0Jywgb3B0aW9ucy5sZWdlbmRDZWxsU2l6ZSlcbiAgICAgIC5hdHRyKCdyeCcsIG9wdGlvbnMubGVnZW5kQ2VsbFJhZGl1cylcbiAgICAgIC5hdHRyKCdyeScsIG9wdGlvbnMubGVnZW5kQ2VsbFJhZGl1cylcbiAgICAgIC5hdHRyKCd4JywgZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgcmV0dXJuIGkgKiAob3B0aW9ucy5sZWdlbmRDZWxsU2l6ZSArIG9wdGlvbnMubGVnZW5kQ2VsbFBhZGRpbmcpO1xuICAgICAgfSk7XG4gIH1cblxuICBsZWdlbmRJdGVtLnNlbGVjdCgndGl0bGUnKS50ZXh0KGZ1bmN0aW9uIChkLCBpKSB7XG4gICAgaWYgKGkgPT09IDApIHtcbiAgICAgIHJldHVybiBjYWxlbmRhci5mb3JtYXRTdHJpbmdXaXRoT2JqZWN0KG9wdGlvbnMubGVnZW5kVGl0bGVGb3JtYXQubG93ZXIsIHtcbiAgICAgICAgbWluOiBvcHRpb25zLmxlZ2VuZFtpXSxcbiAgICAgICAgbmFtZTogb3B0aW9ucy5pdGVtTmFtZVsxXSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoaSA9PT0gX2xlZ2VuZC5sZW5ndGggLSAxKSB7XG4gICAgICByZXR1cm4gY2FsZW5kYXIuZm9ybWF0U3RyaW5nV2l0aE9iamVjdChvcHRpb25zLmxlZ2VuZFRpdGxlRm9ybWF0LnVwcGVyLCB7XG4gICAgICAgIG1heDogb3B0aW9ucy5sZWdlbmRbaSAtIDFdLFxuICAgICAgICBuYW1lOiBvcHRpb25zLml0ZW1OYW1lWzFdLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBjYWxlbmRhci5mb3JtYXRTdHJpbmdXaXRoT2JqZWN0KG9wdGlvbnMubGVnZW5kVGl0bGVGb3JtYXQuaW5uZXIsIHtcbiAgICAgICAgZG93bjogb3B0aW9ucy5sZWdlbmRbaSAtIDFdLFxuICAgICAgICB1cDogb3B0aW9ucy5sZWdlbmRbaV0sXG4gICAgICAgIG5hbWU6IG9wdGlvbnMuaXRlbU5hbWVbMV0sXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuICBsZWdlbmRJdGVtXG4gICAgLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoZCkge1xuICAgICAgY2FsZW5kYXIubGVnZW5kVGlwLnNob3coZCwgdGhpcyk7XG4gICAgfSlcbiAgICAub24oJ21vdXNlb3V0JywgZnVuY3Rpb24gKCkge1xuICAgICAgY2FsZW5kYXIubGVnZW5kVGlwLmhpZGUoKTtcbiAgICB9KTtcblxuICBsZWdlbmRcbiAgICAudHJhbnNpdGlvbigpXG4gICAgLmR1cmF0aW9uKG9wdGlvbnMuYW5pbWF0aW9uRHVyYXRpb24pXG4gICAgLmF0dHIoJ3gnLCBnZXRMZWdlbmRYUG9zaXRpb24oKSlcbiAgICAuYXR0cigneScsIGdldExlZ2VuZFlQb3NpdGlvbigpKVxuICAgIC5hdHRyKCd3aWR0aCcsIHBhcmVudC5nZXREaW0oJ3dpZHRoJykpXG4gICAgLmF0dHIoJ2hlaWdodCcsIHBhcmVudC5nZXREaW0oJ2hlaWdodCcpKTtcblxuICBsZWdlbmRcbiAgICAuc2VsZWN0KCdnJylcbiAgICAudHJhbnNpdGlvbigpXG4gICAgLmR1cmF0aW9uKG9wdGlvbnMuYW5pbWF0aW9uRHVyYXRpb24pXG4gICAgLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChvcHRpb25zLmxlZ2VuZE9yaWVudGF0aW9uID09PSAndmVydGljYWwnKSB7XG4gICAgICAgIHJldHVybiAncm90YXRlKDkwICcgKyBvcHRpb25zLmxlZ2VuZENlbGxTaXplIC8gMiArICcgJyArIG9wdGlvbnMubGVnZW5kQ2VsbFNpemUgLyAyICsgJyknO1xuICAgICAgfVxuICAgICAgcmV0dXJuICcnO1xuICAgIH0pO1xuXG4gIGZ1bmN0aW9uIGdldExlZ2VuZFhQb3NpdGlvbigpIHtcbiAgICBzd2l0Y2ggKG9wdGlvbnMubGVnZW5kSG9yaXpvbnRhbFBvc2l0aW9uKSB7XG4gICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgIGlmIChcbiAgICAgICAgICBvcHRpb25zLmxlZ2VuZFZlcnRpY2FsUG9zaXRpb24gPT09ICdjZW50ZXInIHx8XG4gICAgICAgICAgb3B0aW9ucy5sZWdlbmRWZXJ0aWNhbFBvc2l0aW9uID09PSAnbWlkZGxlJ1xuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm4gd2lkdGggKyBvcHRpb25zLmxlZ2VuZE1hcmdpblszXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gd2lkdGggLSBwYXJlbnQuZ2V0RGltKCd3aWR0aCcpIC0gb3B0aW9ucy5sZWdlbmRNYXJnaW5bMV07XG4gICAgICBjYXNlICdtaWRkbGUnOlxuICAgICAgY2FzZSAnY2VudGVyJzpcbiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQod2lkdGggLyAyIC0gcGFyZW50LmdldERpbSgnd2lkdGgnKSAvIDIpO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMubGVnZW5kTWFyZ2luWzNdO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGdldExlZ2VuZFlQb3NpdGlvbigpIHtcbiAgICBpZiAob3B0aW9ucy5sZWdlbmRWZXJ0aWNhbFBvc2l0aW9uID09PSAnYm90dG9tJykge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgY2FsZW5kYXIuZ3JhcGhEaW0uaGVpZ2h0ICtcbiAgICAgICAgb3B0aW9ucy5sZWdlbmRNYXJnaW5bMF0gLVxuICAgICAgICBvcHRpb25zLmRvbWFpbkd1dHRlciAtXG4gICAgICAgIG9wdGlvbnMuY2VsbFBhZGRpbmdcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiBvcHRpb25zLmxlZ2VuZE1hcmdpblswXTtcbiAgfVxuXG4gIGNhbGVuZGFyLnJlc2l6ZSgpO1xufTtcblxuLyoqXG4gKiBSZXR1cm4gdGhlIGRpbWVuc2lvbiBvZiB0aGUgbGVnZW5kXG4gKlxuICogVGFrZXMgaW50byBhY2NvdW50IHJvdGF0aW9uXG4gKlxuICogQHBhcmFtICBzdHJpbmcgYXhpcyBXaWR0aCBvciBoZWlnaHRcbiAqIEByZXR1cm4gaW50IGhlaWdodCBvciB3aWR0aCBpbiBwaXhlbHNcbiAqL1xuTGVnZW5kLnByb3RvdHlwZS5nZXREaW0gPSBmdW5jdGlvbiAoYXhpcykge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdmFyIGlzSG9yaXpvbnRhbCA9IHRoaXMuY2FsZW5kYXIub3B0aW9ucy5sZWdlbmRPcmllbnRhdGlvbiA9PT0gJ2hvcml6b250YWwnO1xuXG4gIHN3aXRjaCAoYXhpcykge1xuICAgIGNhc2UgJ3dpZHRoJzpcbiAgICAgIHJldHVybiB0aGlzLmRpbVtpc0hvcml6b250YWwgPyAnd2lkdGgnIDogJ2hlaWdodCddO1xuICAgIGNhc2UgJ2hlaWdodCc6XG4gICAgICByZXR1cm4gdGhpcy5kaW1baXNIb3Jpem9udGFsID8gJ2hlaWdodCcgOiAnd2lkdGgnXTtcbiAgfVxufTtcblxuTGVnZW5kLnByb3RvdHlwZS5idWlsZENvbG9ycyA9IGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHZhciBvcHRpb25zID0gdGhpcy5jYWxlbmRhci5vcHRpb25zOyAvLyBTaG9ydGVyIGFjY2Vzc29yIGZvciB2YXJpYWJsZSBuYW1lIG1hbmdsaW5nIHdoZW4gbWluaWZ5aW5nXG5cbiAgaWYgKG9wdGlvbnMubGVnZW5kQ29sb3JzID09PSBudWxsKSB7XG4gICAgdGhpcy5jYWxlbmRhci5sZWdlbmRTY2FsZSA9IG51bGw7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgdmFyIF9jb2xvclJhbmdlID0gW107XG5cbiAgaWYgKEFycmF5LmlzQXJyYXkob3B0aW9ucy5sZWdlbmRDb2xvcnMpKSB7XG4gICAgX2NvbG9yUmFuZ2UgPSBvcHRpb25zLmxlZ2VuZENvbG9ycztcbiAgfSBlbHNlIGlmIChcbiAgICBvcHRpb25zLmxlZ2VuZENvbG9ycy5oYXNPd25Qcm9wZXJ0eSgnbWluJykgJiZcbiAgICBvcHRpb25zLmxlZ2VuZENvbG9ycy5oYXNPd25Qcm9wZXJ0eSgnbWF4JylcbiAgKSB7XG4gICAgX2NvbG9yUmFuZ2UgPSBbb3B0aW9ucy5sZWdlbmRDb2xvcnMubWluLCBvcHRpb25zLmxlZ2VuZENvbG9ycy5tYXhdO1xuICB9IGVsc2Uge1xuICAgIG9wdGlvbnMubGVnZW5kQ29sb3JzID0gbnVsbDtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICB2YXIgX2xlZ2VuZCA9IG9wdGlvbnMubGVnZW5kLnNsaWNlKDApO1xuXG4gIGlmIChfbGVnZW5kWzBdID4gMCkge1xuICAgIF9sZWdlbmQudW5zaGlmdCgwKTtcbiAgfSBlbHNlIGlmIChfbGVnZW5kWzBdIDw9IDApIHtcbiAgICAvLyBMZXQncyBndWVzcyB0aGUgbGVmdG1vc3QgdmFsdWUsIGl0IHdlIGhhdmUgdG8gYWRkIG9uZVxuICAgIF9sZWdlbmQudW5zaGlmdChfbGVnZW5kWzBdIC0gKF9sZWdlbmRbX2xlZ2VuZC5sZW5ndGggLSAxXSAtIF9sZWdlbmRbMF0pIC8gX2xlZ2VuZC5sZW5ndGgpO1xuICB9XG4gIHZhciBjb2xvclNjYWxlO1xuICBpZiAob3B0aW9ucy5sZWdlbmRDb2xvcnMuaGFzT3duUHJvcGVydHkoJ2NvbG9yU2NhbGUnKSkge1xuICAgIGNvbG9yU2NhbGUgPSBvcHRpb25zLmxlZ2VuZENvbG9ycy5jb2xvclNjYWxlO1xuICB9IGVsc2Uge1xuICAgIGNvbG9yU2NhbGUgPSBkMy5zY2FsZVxuICAgICAgLmxpbmVhcigpXG4gICAgICAucmFuZ2UoX2NvbG9yUmFuZ2UpXG4gICAgICAuaW50ZXJwb2xhdGUoZDMuaW50ZXJwb2xhdGVIY2wpXG4gICAgICAuZG9tYWluKFtkMy5taW4oX2xlZ2VuZCksIGQzLm1heChfbGVnZW5kKV0pO1xuICB9XG5cbiAgdmFyIGxlZ2VuZENvbG9ycyA9IF9sZWdlbmQubWFwKGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgcmV0dXJuIGNvbG9yU2NhbGUoZWxlbWVudCk7XG4gIH0pO1xuICB0aGlzLmNhbGVuZGFyLmxlZ2VuZFNjYWxlID0gZDMuc2NhbGUudGhyZXNob2xkKCkuZG9tYWluKG9wdGlvbnMubGVnZW5kKS5yYW5nZShsZWdlbmRDb2xvcnMpO1xuXG4gIHJldHVybiB0cnVlO1xufTtcblxuLyoqXG4gKiBSZXR1cm4gdGhlIGNsYXNzbmFtZSBvbiB0aGUgbGVnZW5kIGZvciB0aGUgc3BlY2lmaWVkIHZhbHVlXG4gKlxuICogQHBhcmFtIGludGVnZXIgbiBWYWx1ZSBhc3NvY2lhdGVkIHRvIGEgZGF0ZVxuICogQHBhcmFtIGJvb2wgd2l0aENzc0NsYXNzIFdoZXRoZXIgdG8gZGlzcGxheSB0aGUgY3NzIGNsYXNzIHVzZWQgdG8gc3R5bGUgdGhlIGNlbGwuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgRGlzYWJsaW5nIHdpbGwgYWxsb3cgc3R5bGluZyBkaXJlY3RseSB2aWEgaHRtbCBmaWxsIGF0dHJpYnV0ZVxuICpcbiAqIEByZXR1cm4gc3RyaW5nIENsYXNzbmFtZSBhY2NvcmRpbmcgdG8gdGhlIGxlZ2VuZFxuICovXG5MZWdlbmQucHJvdG90eXBlLmdldENsYXNzID0gZnVuY3Rpb24gKG4sIHdpdGhDc3NDbGFzcykge1xuICAndXNlIHN0cmljdCc7XG5cbiAgaWYgKG4gPT09IG51bGwgfHwgaXNOYU4obikpIHtcbiAgICByZXR1cm4gJyc7XG4gIH1cblxuICB2YXIgaW5kZXggPSBbdGhpcy5jYWxlbmRhci5vcHRpb25zLmxlZ2VuZC5sZW5ndGggKyAxXTtcblxuICBmb3IgKHZhciBpID0gMCwgdG90YWwgPSB0aGlzLmNhbGVuZGFyLm9wdGlvbnMubGVnZW5kLmxlbmd0aCAtIDE7IGkgPD0gdG90YWw7IGkrKykge1xuICAgIGlmICh0aGlzLmNhbGVuZGFyLm9wdGlvbnMubGVnZW5kWzBdID4gMCAmJiBuIDwgMCkge1xuICAgICAgaW5kZXggPSBbJzEnLCAnaSddO1xuICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgaWYgKG4gPD0gdGhpcy5jYWxlbmRhci5vcHRpb25zLmxlZ2VuZFtpXSkge1xuICAgICAgaW5kZXggPSBbaSArIDFdO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgaWYgKG4gPT09IDApIHtcbiAgICBpbmRleC5wdXNoKDApO1xuICB9XG5cbiAgaW5kZXgudW5zaGlmdCgnJyk7XG4gIHJldHVybiAoaW5kZXguam9pbignIHInKSArICh3aXRoQ3NzQ2xhc3MgPyBpbmRleC5qb2luKCcgcScpIDogJycpKS50cmltKCk7XG59O1xuXG4vKipcbiAqICNzb3VyY2UgaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMzgzMjQ1LzgwNTY0OVxuICovXG5mdW5jdGlvbiBtZXJnZVJlY3Vyc2l2ZShvYmoxLCBvYmoyKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICAvKmpzaGludCBmb3JpbjpmYWxzZSAqL1xuICBmb3IgKHZhciBwIGluIG9iajIpIHtcbiAgICB0cnkge1xuICAgICAgLy8gUHJvcGVydHkgaW4gZGVzdGluYXRpb24gb2JqZWN0IHNldDsgdXBkYXRlIGl0cyB2YWx1ZS5cbiAgICAgIGlmIChvYmoyW3BdLmNvbnN0cnVjdG9yID09PSBPYmplY3QpIHtcbiAgICAgICAgb2JqMVtwXSA9IG1lcmdlUmVjdXJzaXZlKG9iajFbcF0sIG9iajJbcF0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb2JqMVtwXSA9IG9iajJbcF07XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgLy8gUHJvcGVydHkgaW4gZGVzdGluYXRpb24gb2JqZWN0IG5vdCBzZXQ7IGNyZWF0ZSBpdCBhbmQgc2V0IGl0cyB2YWx1ZS5cbiAgICAgIG9iajFbcF0gPSBvYmoyW3BdO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBvYmoxO1xufVxuXG4vKipcbiAqIENoZWNrIGlmIDIgYXJyYXlzIGFyZSBlcXVhbHNcbiAqXG4gKiBAbGluayBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xNDg1Mzk3NC84MDU2NDlcbiAqIEBwYXJhbSAgYXJyYXkgYXJyYXkgdGhlIGFycmF5IHRvIGNvbXBhcmUgdG9cbiAqIEByZXR1cm4gYm9vbCB0cnVlIG9mIHRoZSAyIGFycmF5cyBhcmUgZXF1YWxzXG4gKi9cbmZ1bmN0aW9uIGFycmF5RXF1YWxzKGFycmF5QSwgYXJyYXlCKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICAvLyBpZiB0aGUgb3RoZXIgYXJyYXkgaXMgYSBmYWxzeSB2YWx1ZSwgcmV0dXJuXG4gIGlmICghYXJyYXlCIHx8ICFhcnJheUEpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyBjb21wYXJlIGxlbmd0aHMgLSBjYW4gc2F2ZSBhIGxvdCBvZiB0aW1lXG4gIGlmIChhcnJheUEubGVuZ3RoICE9PSBhcnJheUIubGVuZ3RoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheUEubGVuZ3RoOyBpKyspIHtcbiAgICAvLyBDaGVjayBpZiB3ZSBoYXZlIG5lc3RlZCBhcnJheXNcbiAgICBpZiAoYXJyYXlBW2ldIGluc3RhbmNlb2YgQXJyYXkgJiYgYXJyYXlCW2ldIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIC8vIHJlY3Vyc2UgaW50byB0aGUgbmVzdGVkIGFycmF5c1xuICAgICAgaWYgKCFhcnJheUVxdWFscyhhcnJheUFbaV0sIGFycmF5QltpXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoYXJyYXlBW2ldICE9PSBhcnJheUJbaV0pIHtcbiAgICAgIC8vIFdhcm5pbmcgLSB0d28gZGlmZmVyZW50IG9iamVjdCBpbnN0YW5jZXMgd2lsbCBuZXZlciBiZSBlcXVhbDoge3g6MjB9ICE9IHt4OjIwfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgQ2FsSGVhdE1hcDtcbiIsIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgeyBleHRlbnQgYXMgZDNFeHRlbnQsIHJhbmdlIGFzIGQzUmFuZ2UgfSBmcm9tICdkMy1hcnJheSc7XG5pbXBvcnQgeyBzZWxlY3QgYXMgZDNTZWxlY3QgfSBmcm9tICdkMy1zZWxlY3Rpb24nO1xuaW1wb3J0IHsgZ2V0U2VxdWVudGlhbFNjaGVtZVJlZ2lzdHJ5IH0gZnJvbSAnQHN1cGVyc2V0LXVpL2NvbG9yJztcbmltcG9ydCB7IGdldE51bWJlckZvcm1hdHRlciB9IGZyb20gJ0BzdXBlcnNldC11aS9udW1iZXItZm9ybWF0JztcbmltcG9ydCB7IGdldFRpbWVGb3JtYXR0ZXIgfSBmcm9tICdAc3VwZXJzZXQtdWkvdGltZS1mb3JtYXQnO1xuaW1wb3J0IENhbEhlYXRNYXAgZnJvbSAnLi92ZW5kb3IvY2FsLWhlYXRtYXAnO1xuaW1wb3J0ICcuL3ZlbmRvci9jYWwtaGVhdG1hcC5jc3MnO1xuXG5mdW5jdGlvbiBjb252ZXJ0VVRDKGR0dG0pIHtcbiAgcmV0dXJuIG5ldyBEYXRlKFxuICAgIGR0dG0uZ2V0VVRDRnVsbFllYXIoKSxcbiAgICBkdHRtLmdldFVUQ01vbnRoKCksXG4gICAgZHR0bS5nZXRVVENEYXRlKCksXG4gICAgZHR0bS5nZXRVVENIb3VycygpLFxuICAgIGR0dG0uZ2V0VVRDTWludXRlcygpLFxuICAgIGR0dG0uZ2V0VVRDU2Vjb25kcygpLFxuICApO1xufVxuXG5jb25zdCBjb252ZXJ0VVRDVFMgPSB1dHMgPT4gY29udmVydFVUQyhuZXcgRGF0ZSh1dHMpKS5nZXRUaW1lKCk7XG5cbmNvbnN0IHByb3BUeXBlcyA9IHtcbiAgZGF0YTogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAvLyBPYmplY3QgaGFzaGVkIGJ5IG1ldHJpYyBuYW1lLFxuICAgIC8vIHRoZW4gaGFzaGVkIGJ5IHRpbWVzdGFtcCAoaW4gc2Vjb25kcywgbm90IG1pbGxpc2Vjb25kcykgYXMgZmxvYXRcbiAgICAvLyB0aGUgaW5uZXJtb3N0IHZhbHVlIGlzIGNvdW50XG4gICAgLy8gZS5nLiB7IGNvdW50X2Rpc3RpbmN0X3NvbWV0aGluZzogeyAxNTM1MDM0MjM2LjA6IDMgfSB9XG4gICAgZGF0YTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBkb21haW46IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgcmFuZ2U6IFByb3BUeXBlcy5udW1iZXIsXG4gICAgLy8gdGltZXN0YW1wIGluIG1pbGxpc2Vjb25kc1xuICAgIHN0YXJ0OiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIHN1YmRvbWFpbjogUHJvcFR5cGVzLnN0cmluZyxcbiAgfSksXG4gIGhlaWdodDogUHJvcFR5cGVzLm51bWJlcixcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L3NvcnQtcHJvcC10eXBlc1xuICBjZWxsUGFkZGluZzogUHJvcFR5cGVzLm51bWJlcixcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L3NvcnQtcHJvcC10eXBlc1xuICBjZWxsUmFkaXVzOiBQcm9wVHlwZXMubnVtYmVyLFxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3Qvc29ydC1wcm9wLXR5cGVzXG4gIGNlbGxTaXplOiBQcm9wVHlwZXMubnVtYmVyLFxuICBsaW5lYXJDb2xvclNjaGVtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgc2hvd0xlZ2VuZDogUHJvcFR5cGVzLmJvb2wsXG4gIHNob3dNZXRyaWNOYW1lOiBQcm9wVHlwZXMuYm9vbCxcbiAgc2hvd1ZhbHVlczogUHJvcFR5cGVzLmJvb2wsXG4gIHN0ZXBzOiBQcm9wVHlwZXMubnVtYmVyLFxuICB0aW1lRm9ybWF0OiBQcm9wVHlwZXMuc3RyaW5nLFxuICB2YWx1ZUZvcm1hdDogUHJvcFR5cGVzLnN0cmluZyxcbiAgdmVyYm9zZU1hcDogUHJvcFR5cGVzLm9iamVjdCxcbn07XG5cbmZ1bmN0aW9uIENhbGVuZGFyKGVsZW1lbnQsIHByb3BzKSB7XG4gIGNvbnN0IHtcbiAgICBkYXRhLFxuICAgIGhlaWdodCxcbiAgICBjZWxsUGFkZGluZyA9IDMsXG4gICAgY2VsbFJhZGl1cyA9IDAsXG4gICAgY2VsbFNpemUgPSAxMCxcbiAgICBkb21haW5HcmFudWxhcml0eSxcbiAgICBsaW5lYXJDb2xvclNjaGVtZSxcbiAgICBzaG93TGVnZW5kLFxuICAgIHNob3dNZXRyaWNOYW1lLFxuICAgIHNob3dWYWx1ZXMsXG4gICAgc3RlcHMsXG4gICAgc3ViZG9tYWluR3JhbnVsYXJpdHksXG4gICAgdGltZUZvcm1hdCxcbiAgICB2YWx1ZUZvcm1hdCxcbiAgICB2ZXJib3NlTWFwLFxuICB9ID0gcHJvcHM7XG5cbiAgY29uc3QgdmFsdWVGb3JtYXR0ZXIgPSBnZXROdW1iZXJGb3JtYXR0ZXIodmFsdWVGb3JtYXQpO1xuICBjb25zdCB0aW1lRm9ybWF0dGVyID0gZ2V0VGltZUZvcm1hdHRlcih0aW1lRm9ybWF0KTtcblxuICBjb25zdCBjb250YWluZXIgPSBkM1NlbGVjdChlbGVtZW50KVxuICAgIC5jbGFzc2VkKCdzdXBlcnNldC1sZWdhY3ktY2hhcnQtY2FsZW5kYXInLCB0cnVlKVxuICAgIC5zdHlsZSgnaGVpZ2h0JywgaGVpZ2h0KTtcbiAgY29udGFpbmVyLnNlbGVjdEFsbCgnKicpLnJlbW92ZSgpO1xuICBjb25zdCBkaXYgPSBjb250YWluZXIuYXBwZW5kKCdkaXYnKTtcblxuICBjb25zdCBzdWJEb21haW5UZXh0Rm9ybWF0ID0gc2hvd1ZhbHVlcyA/IChkYXRlLCB2YWx1ZSkgPT4gdmFsdWVGb3JtYXR0ZXIodmFsdWUpIDogbnVsbDtcblxuICAvLyBUcmljayB0byBjb252ZXJ0IGFsbCB0aW1lc3RhbXBzIHRvIFVUQ1xuICAvLyBUT0RPOiBWZXJpZnkgaWYgdGhpcyBjb252ZXJzaW9uIGlzIHJlYWxseSBuZWNlc3NhcnlcbiAgLy8gc2luY2UgYWxsIHRpbWVzdGFtcHMgc2hvdWxkIGFsd2F5cyBiZSBpbiBVVEMuXG4gIGNvbnN0IG1ldHJpY3NEYXRhID0ge307XG4gIE9iamVjdC5rZXlzKGRhdGEuZGF0YSkuZm9yRWFjaChtZXRyaWMgPT4ge1xuICAgIG1ldHJpY3NEYXRhW21ldHJpY10gPSB7fTtcbiAgICBPYmplY3Qua2V5cyhkYXRhLmRhdGFbbWV0cmljXSkuZm9yRWFjaCh0cyA9PiB7XG4gICAgICBtZXRyaWNzRGF0YVttZXRyaWNdW2NvbnZlcnRVVENUUyh0cyAqIDEwMDApIC8gMTAwMF0gPSBkYXRhLmRhdGFbbWV0cmljXVt0c107XG4gICAgfSk7XG4gIH0pO1xuXG4gIE9iamVjdC5rZXlzKG1ldHJpY3NEYXRhKS5mb3JFYWNoKG1ldHJpYyA9PiB7XG4gICAgY29uc3QgY2FsQ29udGFpbmVyID0gZGl2LmFwcGVuZCgnZGl2Jyk7XG4gICAgaWYgKHNob3dNZXRyaWNOYW1lKSB7XG4gICAgICBjYWxDb250YWluZXIudGV4dChgTWV0cmljOiAke3ZlcmJvc2VNYXBbbWV0cmljXSB8fCBtZXRyaWN9YCk7XG4gICAgfVxuICAgIGNvbnN0IHRpbWVzdGFtcHMgPSBtZXRyaWNzRGF0YVttZXRyaWNdO1xuICAgIGNvbnN0IGV4dGVudHMgPSBkM0V4dGVudChPYmplY3Qua2V5cyh0aW1lc3RhbXBzKSwga2V5ID0+IHRpbWVzdGFtcHNba2V5XSk7XG4gICAgY29uc3Qgc3RlcCA9IChleHRlbnRzWzFdIC0gZXh0ZW50c1swXSkgLyAoc3RlcHMgLSAxKTtcbiAgICBjb25zdCBjb2xvclNjYWxlID0gZ2V0U2VxdWVudGlhbFNjaGVtZVJlZ2lzdHJ5KClcbiAgICAgIC5nZXQobGluZWFyQ29sb3JTY2hlbWUpXG4gICAgICAuY3JlYXRlTGluZWFyU2NhbGUoZXh0ZW50cyk7XG5cbiAgICBjb25zdCBsZWdlbmQgPSBkM1JhbmdlKHN0ZXBzKS5tYXAoaSA9PiBleHRlbnRzWzBdICsgc3RlcCAqIGkpO1xuICAgIGNvbnN0IGxlZ2VuZENvbG9ycyA9IGxlZ2VuZC5tYXAoeCA9PiBjb2xvclNjYWxlKHgpKTtcblxuICAgIGNvbnN0IGNhbCA9IG5ldyBDYWxIZWF0TWFwKCk7XG4gICAgY2FsLmluaXQoe1xuICAgICAgc3RhcnQ6IGNvbnZlcnRVVENUUyhkYXRhLnN0YXJ0KSxcbiAgICAgIGRhdGE6IHRpbWVzdGFtcHMsXG4gICAgICBpdGVtU2VsZWN0b3I6IGNhbENvbnRhaW5lci5ub2RlKCksXG4gICAgICBsZWdlbmRWZXJ0aWNhbFBvc2l0aW9uOiAndG9wJyxcbiAgICAgIGNlbGxTaXplLFxuICAgICAgY2VsbFBhZGRpbmcsXG4gICAgICBjZWxsUmFkaXVzLFxuICAgICAgbGVnZW5kQ2VsbFNpemU6IGNlbGxTaXplLFxuICAgICAgbGVnZW5kQ2VsbFBhZGRpbmc6IDIsXG4gICAgICBsZWdlbmRDZWxsUmFkaXVzOiBjZWxsUmFkaXVzLFxuICAgICAgdG9vbHRpcDogdHJ1ZSxcbiAgICAgIGRvbWFpbjogZG9tYWluR3JhbnVsYXJpdHksXG4gICAgICBzdWJEb21haW46IHN1YmRvbWFpbkdyYW51bGFyaXR5LFxuICAgICAgcmFuZ2U6IGRhdGEucmFuZ2UsXG4gICAgICBicm93c2luZzogdHJ1ZSxcbiAgICAgIGxlZ2VuZCxcbiAgICAgIGxlZ2VuZENvbG9yczoge1xuICAgICAgICBjb2xvclNjYWxlLFxuICAgICAgICBtaW46IGxlZ2VuZENvbG9yc1swXSxcbiAgICAgICAgbWF4OiBsZWdlbmRDb2xvcnNbbGVnZW5kQ29sb3JzLmxlbmd0aCAtIDFdLFxuICAgICAgICBlbXB0eTogJ3doaXRlJyxcbiAgICAgIH0sXG4gICAgICBkaXNwbGF5TGVnZW5kOiBzaG93TGVnZW5kLFxuICAgICAgaXRlbU5hbWU6ICcnLFxuICAgICAgdmFsdWVGb3JtYXR0ZXIsXG4gICAgICB0aW1lRm9ybWF0dGVyLFxuICAgICAgc3ViRG9tYWluVGV4dEZvcm1hdCxcbiAgICB9KTtcbiAgfSk7XG59XG5cbkNhbGVuZGFyLmRpc3BsYXlOYW1lID0gJ0NhbGVuZGFyJztcbkNhbGVuZGFyLnByb3BUeXBlcyA9IHByb3BUeXBlcztcblxuZXhwb3J0IGRlZmF1bHQgQ2FsZW5kYXI7XG4iLCIvKipcbiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuICogZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbiAqIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbiAqIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4gKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbiAqIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7IHJlYWN0aWZ5IH0gZnJvbSAnQHN1cGVyc2V0LXVpL2NoYXJ0JztcbmltcG9ydCBzdHlsZWQgZnJvbSAnQHN1cGVyc2V0LXVpL3N0eWxlJztcbmltcG9ydCBDb21wb25lbnQgZnJvbSAnLi9DYWxlbmRhcic7XG5cbmNvbnN0IFJlYWN0Q29tcG9uZW50ID0gcmVhY3RpZnkoQ29tcG9uZW50KTtcblxuY29uc3QgQ2FsZW5kZXIgPSAoeyBjbGFzc05hbWUsIC4uLm90aGVyUHJvcHMgfSkgPT4ge1xuICByZXR1cm4gKFxuICAgIDxkaXYgY2xhc3NOYW1lPXtjbGFzc05hbWV9PlxuICAgICAgPFJlYWN0Q29tcG9uZW50IHsuLi5vdGhlclByb3BzfSAvPlxuICAgIDwvZGl2PlxuICApO1xufTtcblxuQ2FsZW5kZXIuZGVmYXVsdFByb3BzID0ge1xuICBvdGhlclByb3BzOiB7fSxcbn07XG5cbkNhbGVuZGVyLnByb3BUeXBlcyA9IHtcbiAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gIG90aGVyUHJvcHM6IFByb3BUeXBlcy5vYmplY3RPZihQcm9wVHlwZXMuYW55KSxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHN0eWxlZChDYWxlbmRlcilgXG4gIC5zdXBlcnNldC1sZWdhY3ktY2hhcnQtY2FsZW5kYXIge1xuICAgIHBhZGRpbmc6IDEwcHg7XG4gICAgcG9zaXRpb246IHN0YXRpYyAhaW1wb3J0YW50O1xuICAgIG92ZXJmbG93OiBhdXRvICFpbXBvcnRhbnQ7XG4gIH1cblxuICAuc3VwZXJzZXQtbGVnYWN5LWNoYXJ0LWNhbGVuZGFyIC5jaC10b29sdGlwIHtcbiAgICBtYXJnaW4tbGVmdDogMjBweDtcbiAgICBtYXJnaW4tdG9wOiA1cHg7XG4gIH1cbmA7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7Ozs7O0FBT0E7QUErQkE7QUFFQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBR0E7QUFDQTtBQUVBO0FBQ0E7QUFHQTtBQUdBO0FBR0E7QUFlQTtBQUNBO0FBR0E7QUFDQTtBQUdBO0FBQ0E7QUFHQTtBQUNBO0FBT0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBR0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFHQTtBQUVBO0FBR0E7QUFDQTtBQUdBO0FBUUE7QUFHQTtBQUlBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFTQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBR0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBRUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFPQTtBQVdBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFDQTtBQUdBO0FBR0E7QUFHQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFrUEE7QUFzRkE7QUFLQTtBQUNBO0FBZ0JBO0FBaUJBO0FBQ0E7OztBQU1BO0FBdURBO0FBQ0E7QUFDQTtBQXVCQTtBQW1CQTtBQUNBO0FBZUE7Ozs7QUFtQkE7QUFBQTtBQXFIQTtBQUNBO0FBdEhBO0FBOExBO0FBT0E7QUFDQTtBQUNBO0FBeUdBO0FBQ0E7QUFDQTtBQW9CQTtBQUNBO0FBRUE7QUFzQkE7QUErQkE7Ozs7O0FBSUE7QUFnQkE7QUFDQTs7Ozs7QUE0SEE7Ozs7QUE1SEE7QUF1QkE7QUFVQTs7Ozs7QUFtTkE7QUEzRkE7Ozs7QUEvRUE7Ozs7Ozs7O0FBV0E7Ozs7O0FBa0JBOzs7OztBQStHQTs7Ozs7QUFxRUE7Ozs7OztBQTZCQTs7QUEyREE7Ozs7QUE0REE7Ozs7Ozs7O0FBbUJBO0FBWUE7QUFDQTtBQUVBOzs7Ozs7O0FBUUE7Ozs7O0FBd0JBOztBQVNBOztBQVNBOzs7OztBQWNBOzs7OztBQWdCQTs7OztBQWVBOzs7O0FBWUE7QUEwQ0E7QUFDQTtBQUVBO0FBMkJBO0FBY0E7QUFDQTtBQUVBOzs7Ozs7O0FBUUE7Ozs7Ozs7QUF1QkE7QUFnQ0E7Ozs7O0FBbURBOzs7OztBQVlBOzs7O0FBV0E7QUFjQTtBQUNBO0FBRUE7Ozs7O0FBd0RBOzs7Ozs7QUFzQkE7Ozs7Ozs7O0FBOTRCQTs7Ozs7O0FBdTlCQTtBQWtEQTtBQUNBO0FBRUE7Ozs7QUFLQTs7OztBQU9BOzs7OztBQWFBOzs7OztBQWlCQTs7Ozs7QUFjQTs7Ozs7QUFZQTs7Ozs7Ozs7QUFrQkE7Ozs7QUFjQTs7Ozs7O0FBZ0JBO0FBeUJBO0FBQ0E7QUFFQTs7Ozs7O0FBT0E7Ozs7OztBQW9CQTtBQWVBO0FBR0E7QUFTQTtBQUNBO0FBQ0E7Ozs7OztBQWNBOzs7Ozs7QUFzQkE7Ozs7OztBQXFDQTs7Ozs7O0FBc0JBOzs7Ozs7QUFxQkE7QUFnQkE7QUFDQTs7QUEyRkE7Ozs7QUF3QkE7Ozs7QUFjQTtBQWFBO0FBQ0E7QUFFQTs7Ozs7Ozs7Ozs7OztBQWNBO0FBNkRBOzs7Ozs7Ozs7QUFpQ0E7QUFzQkE7QUFDQTtBQUVBO0FBQ0E7QUFNQTtBQW1DQTtBQUlBOzs7Ozs7OztBQTJCQTtBQTREQTtBQUNBO0FBRUE7O0FBR0E7O0FBWUE7Ozs7Ozs7Ozs7QUFvQkE7Ozs7O0FBK0JBOzs7Ozs7QUFhQTs7Ozs7QUFrQ0E7Ozs7QUErQkE7Ozs7QUFnQkE7Ozs7Ozs7O0FBb0JBOzs7Ozs7OztBQW1CQTtBQWdEQTtBQXdCQTtBQThCQTtBQVNBO0FBQ0E7QUFTQTtBQTZCQTtBQUNBO0FBRUE7O0FBR0E7QUErREE7QUFDQTtBQUVBO0FBZUE7QUE0QkE7QUFXQTs7Ozs7OztBQW9LQTtBQWtCQTtBQXlCQTs7Ozs7Ozs7QUE4QkE7O0FBZ0NBO0FBT0E7QUFPQTs7Ozs7O0FBY0E7QUFJQTtBQUtBO0FBTUE7QUFFQTtBQUtBOzs7OztBQzVzSEE7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBa0JBO0FBeUJBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFLQTtBQUVBO0FBRUE7O0FDM0RBOzs7Ozs7Ozs7Ozs7Ozs7OztBQWtCQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///2304\n')}}]);